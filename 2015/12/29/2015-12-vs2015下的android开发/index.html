<html>
<head>
  <meta charset="utf-8">
  
  <title>vs2015下的android开发 | 苍山溪水</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="vs2015的安装
ndk资源
StaticLibrary(Android)

#1.vs2015的安装#vs2015全部安装需要占用很大的磁盘空间，最好预留20G，安装完成之后，可以看到VS有这几个跟移动相关的工程向导C++部分

OpenGLES 2 Application(Android IOS Widnows Universal)
Native-Activity App(Android)">
<meta property="og:type" content="article">
<meta property="og:title" content="vs2015下的android开发">
<meta property="og:url" content="http://blog.uxfork.cn/2015/12/29/2015-12-vs2015下的android开发/index.html">
<meta property="og:site_name" content="苍山溪水">
<meta property="og:description" content="vs2015的安装
ndk资源
StaticLibrary(Android)

#1.vs2015的安装#vs2015全部安装需要占用很大的磁盘空间，最好预留20G，安装完成之后，可以看到VS有这几个跟移动相关的工程向导C++部分

OpenGLES 2 Application(Android IOS Widnows Universal)
Native-Activity App(Android)">
<meta property="og:image" content="http://blog.uxfork.cn/images/StaticLibAndroid.png">
<meta property="og:updated_time" content="2015-12-08T01:33:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vs2015下的android开发">
<meta name="twitter:description" content="vs2015的安装
ndk资源
StaticLibrary(Android)

#1.vs2015的安装#vs2015全部安装需要占用很大的磁盘空间，最好预留20G，安装完成之后，可以看到VS有这几个跟移动相关的工程向导C++部分

OpenGLES 2 Application(Android IOS Widnows Universal)
Native-Activity App(Android)">
  
    <link rel="alternative" href="/atom.xml" title="苍山溪水" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/zhihu.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/zhihu.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">uxfork</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录点滴---滴水石穿</p>
		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">true</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">uxfork</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/zhihu.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">uxfork</h1>
			</hgroup>
			
			<p class="header-subtitle">记录点滴---滴水石穿</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2015-12-vs2015下的android开发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/29/2015-12-vs2015下的android开发/" class="article-date">
  	<time datetime="2015-12-29T03:06:28.000Z" itemprop="datePublished">2015-12-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      vs2015下的android开发
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vs2015/">vs2015</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><strong><a href="/#1.vs2015的安装">vs2015的安装</a></strong></li>
<li><strong><a href="/#2.ndk资源">ndk资源</a></strong></li>
<li><strong><a href="/#3.StaticLibrary_Android">StaticLibrary(Android)</a></strong></li>
</ul>
<p>#1.vs2015的安装#<br>vs2015全部安装需要占用很大的磁盘空间，最好预留20G，安装完成之后，可以看到VS有这几个跟移动相关的工程向导<br>C++部分</p>
<ul>
<li>OpenGLES 2 Application(Android IOS Widnows Universal)</li>
<li>Native-Activity App(Android)</li>
<li>OpenGLES Application(Android, IOS)</li>
<li>Shared Library(Android, IOS)</li>
<li>Basic Application(Android)</li>
<li>Dynamic Library(Windows) for Clang 3.7 with Microsoft CodeGen</li>
<li>Dynamic Shared Library(Android)</li>
<li>Static Library(Android)</li>
<li>Static Library(IOS)</li>
<li>Static Library(Windows) for Clang 3.7 with Microsoft CodeGen</li>
<li>Makefile Project(Android)</li>
</ul>
<p>Javascript部分</p>
<ul>
<li>Cordova App</li>
</ul>
<p>显著的几个特点：</p>
<ul>
<li>支持android、IOS、windows，</li>
<li>跨平台(C++具有良好的跨平台性:java只能运行在android上， objc只能运行在IOS上)，所以公共部分最好用C++实现、或者hybird方式实现</li>
<li>全面支持clang(clang是个好东西，底层用llvm)</li>
</ul>
<p>#2.ndk资源#<br>可以看一下ndk为我们提供了些什么资源</p>
<p><strong>NDK的编译脚本，在BUILD SCRIPT中可以通过INCLUDE调用</strong></p>
<pre><code>add-application.mk
add-platform.mk
add-toolchain.mk
build-all.mk
build-binary.mk
build-executable.mk
build-local.mk
build-module.mk
build-shared-library.mk
build-static-library.mk
check-cygwin-make.mk
clear-vars.mk
default-application.mk
default-build-commands.mk
definitions-graph.mk
definitions-host.mk
definitions-tests.mk
definitions-utils.mk
definitions.mk
import-locals.mk
init.mk
main.mk
prebuilt-library.mk
prebuilt-shared-library.mk
prebuilt-static-library.mk
setup-abi.mk
setup-app.mk
setup-imports.mk
setup-toolchain.mk
build-analyzer.sh
build-ccache.sh
build-compiler-rt.sh
build-cxx-stl.sh
build-device-llvm.sh
build-docs.sh
build-gcc.sh
build-gdb-stub.sh
build-gdbserver.sh
build-gnu-libstdc++.sh
build-host-awk.sh
build-host-gcc.sh
build-host-gdb.sh
build-host-make.sh
build-host-perl.sh
build-host-prebuilts.sh
build-host-python.sh
build-host-sed.sh
build-host-toolbox.sh
build-host-yasm.sh
build-libportable.sh
build-llvm.sh
build-mingw64-toolchain.sh
build-ndk-depends.sh
build-ndk-stack.sh
build-ndk-sysroot.sh
build-on-device-toolchain.sh
build-target-prebuilts.sh
builder-funcs.sh
check-glibc.sh
cleanup-apps.sh
cleanup-headers.sh
common-build-host-funcs.sh
deploy-host-mcld.sh
dev-cleanup.sh
dev-defaults.sh
dev-platform-compress.sh
dev-platform-expand-all.sh
dev-platform-expand.sh
dev-platform-import.sh
dev-rebuild-ndk.sh
DEV-SCRIPTS-USAGE.TXT
dev-system-import.sh
download-toolchain-sources.sh
find-case-duplicates.sh
gen-platforms.sh
gen-system-symbols.sh
gen-toolchain-wrapper.sh
make-release.sh
make-standalone-toolchain.sh
ndk-ccache-g++.sh
ndk-ccache-gcc.sh
ndk-common.sh
package-release.sh
patch-sources.sh
prebuilt-common.sh
rebuild-all-prebuilt.sh
</code></pre><p><strong>ndk开发文档</strong></p>
<p><strong>各android平台的lib库和头文件库</strong></p>
<p>头文件库就是android平台提供给我们的可用系统库<br>大部分头文件和Linux下的头文件和lib库并无差别，新增了android目录</p>
<p><strong>各平台下预编译的gdbserver(用于android远程调试用，有空要学习一下)</strong></p>
<p><strong>一些示例代码</strong></p>
<ul>
<li>bitmap-plasma</li>
<li>gles3jni</li>
<li>hello-gl2</li>
<li>hello-jni</li>
<li>hello-neon</li>
<li>HelloComputeNDK</li>
<li>module-exports</li>
<li>MoreTeapots</li>
<li>native-activity</li>
<li>native-audio</li>
<li>native-codec</li>
<li>native-media</li>
<li>native-plasma</li>
<li>san-angeles</li>
<li>Teapot</li>
<li>test-libstdc++</li>
<li>two-libs</li>
</ul>
<p>这些代码都可以作为学习参考</p>
<p><strong>一些android库的源码</strong></p>
<h1 id="compiler-rt_u5E93"><a href="#compiler-rt_u5E93" class="headerlink" title="compiler-rt库"></a><strong>compiler-rt库</strong></h1><pre><code>是llvm需要用到的runtime库
</code></pre><h1 id="cpufeatures_u5E93"><a href="#cpufeatures_u5E93" class="headerlink" title="cpufeatures库"></a><strong>cpufeatures库</strong></h1><pre><code>主要提供这几个API函数
</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">获取CPU个数</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">android_getCpuCount</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">沙箱进程中使用：强制设置cpu个数和<span class="function">feature</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">android_setCpu</span><span class="params">(<span class="keyword">int</span>  cpu_count, uint64_t cpu_features)</span></span>;</span><br><span class="line">调用<span class="function">CPUID</span><br><span class="line"><span class="keyword">extern</span> uint32_t <span class="title">android_getCpuIdArm</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">android_setCpuArm</span><span class="params">(<span class="keyword">int</span> cpu_count, uint64_t cpu_features, uint32_t cpu_id)</span></span>;</span><br></pre></td></tr></table></figure>
<h1 id="crazy_linker"><a href="#crazy_linker" class="headerlink" title="crazy_linker"></a><strong>crazy_linker</strong></h1><p>是android下的一个动态链接器，要了解有啥用，先要了解一下linux下程序的加载机制，<br><a href="http://jzhihui.iteye.com/blog/1447570" target="_blank" rel="external">http://jzhihui.iteye.com/blog/1447570</a></p>
<p>它跟windows下的PE加载有一些区别</p>
<p>ELF格式分为几种：</p>
<p>relocatable file 可与其他obj文件一起链接生成可执行文件(<strong>类似EXE</strong>)或动态链接库(<strong>类似DLL</strong>)</p>
<p>executable file 可执行文件(<strong>类似EXE</strong>)</p>
<p>shared object file 动态链接库(<strong>类似DLL</strong>)</p>
<p>根据是否引用其他动态库，可以把可执行文件分为两类：静态链接(<strong>不使用其他动态库，相当于在windows下一个EXE不引用任何DLL一样</strong>)、动态链接(<strong>使用了其他动态库</strong>)</p>
<p>内核对可执行文件的加载过程</p>
<ol>
<li>内核先加载elf到内存</li>
<li>扫描elf的interp段(<strong>解释器段，就是一个字符串路径，用来指定一个动态链接器，Linux下一般是/lib/ld-linux.so.2，android下一般是/system/bin/linker</strong>)</li>
<li>通过调用load_elf_interp将”动态链接器”加载到进程，并修改elf的入口为加载器</li>
<li>启动线程，执行新的elf入口，如果存在interp段，一般elf入口就是”动态链接器”的入口</li>
<li>加载器将所依赖的动态库加载到进程空间</li>
</ol>
<p>要了解动态链接库(类似DLL)怎么加载，先了解这几个概念</p>
<p><strong>Global Offset Table（GOT）</strong></p>
<p>动态库中的重定位表(动态库绝大部分代码都是可重定位的，编译器把绝对地址引用放在一起，构成了GOT)，一般是由”动态链接器”负责修改</p>
<p><strong>Procedure Linkage Table（PLT）</strong></p>
<p>对于设置了惰性加载的动态库，它还有PLT表，与其说是表不如说是一堆桩代码，它用来做惰性加载，例如PLT中一条：</p>
<pre><code>080482bc &lt;puts@plt&gt;:  
80482bc:   ff 25 78 95 04 08   jmp *0x8049578  
80482c2:   68 10 00 00 00  push$0x10  
80482c7:   e9 c0 ff ff ff  jmp 804828c &lt;_init+0x18&gt; 
</code></pre><p>它是puts函数的桩代码，puts函数在libc库中，第一条指令中的0x8049578位于GOT中，第三条指令的804828c其实指向_dl_runtime_resolve函数，</p>
<p><strong>原理介绍完了，现在看一下crazy_linker有啥特点</strong></p>
<ol>
<li>支持动态修改lib搜索路径，system linker只能搜索LD_LIBRARY_PATH，启动时就定死了，crazy_linker支持运行时添加路径，这可以解决几个问题：调整动态库的加载顺序，自定义加载一些系统库（库冲突）</li>
<li>没有lib库的数量限制（系统链接器不支持64个以上的lib库）</li>
<li>可自定义lib库的加载内存地址（系统链接器是随机分配地址）</li>
<li>可从外部文件的指定部分加载lib库</li>
<li>支持多进程共享lib库</li>
<li>libdl.so中的函数随便用，dlopen，dlsym函数已经被crazy linker替换</li>
</ol>
<p><strong>如何使用crazy_linker?</strong></p>
<p>crazy_linker是一个静态链接库，不能在java中直接使用，而应该链接到so库中</p>
<p>在Android.mk中加入(引入crazy_linker静态库):</p>
<pre><code>LOCAL_STATIC_LIBRARIES := crazy_linker
</code></pre><p>编译crazy_linker静态库</p>
<pre><code>include /path/to/crazy_linker/Android.mk
</code></pre><p>在我们代码中</p>
<p> #include <crazy_linker.h></crazy_linker.h></p>
<h1 id="native_app_glue"><a href="#native_app_glue" class="headerlink" title="native_app_glue"></a><strong>native_app_glue</strong></h1><p>NativeActivity的封装</p>
<p>其他就是gcc、llvm的编译工具链</p>
<p>#3.StaticLibrary_Android#</p>
<p>向导生成的代码结构：<br><img src="/images/StaticLibAndroid.png" alt=""></p>
<p>最开始编译时，提示找不到clang.exe，然后发现NDK_ROOT环境变量为空，可以设置NDK环境为vs2015安装的ndk的路径，2015的ndk安装在C:\ProgramData\Microsoft\AndroidNDK\android-ndk-r10e</p>
<p>还有一个错误，提示找不到syslimits.h，这个需要从ndk官方文档中拷贝一份到对应目录即可</p>
<p>总结一下，vs2015开发android的优缺点</p>
<p>优点：开发效率高，集成环境好，clang也是加分项<br>缺点：暂时没找到如何导入现有的ndk工程，以及如何导出生成android.mk</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/16/2016-01-jxcore集成/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"></strong>
      <div class="article-nav-title">
        
          jxcore集成
        
      </div>
    </a>
  
  
    <a href="/2015/12/08/2015-12-基于co与thunkify的Javascript异步流程控制/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">基于co与thunkify的Javascript异步流程控制</div>
      <strong class="article-nav-caption"></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 uxfork
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script type="text/javascript">
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	};
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<!--script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"-->


  </div>
</body>
</html>