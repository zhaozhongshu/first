<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>node.js API汇总(从官网copy过来，方便自己查询) | 技术人生</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="About these Docs
Synopsis
Assertion Testing
Buffer
C/C++ Addons
Child Processes
Cluster
Console
Crypto
Debugger
DNS
Domain
Events
File System
Globals
HTTP
HTTPS
Modules
Net
OS
Path
Process
Punycode
Qu">
<meta property="og:type" content="article">
<meta property="og:title" content="node.js API汇总(从官网copy过来，方便自己查询)">
<meta property="og:url" content="http://localhost:4000/2015/07/24/2015-07-node-js-API/index.html">
<meta property="og:site_name" content="技术人生">
<meta property="og:description" content="About these Docs
Synopsis
Assertion Testing
Buffer
C/C++ Addons
Child Processes
Cluster
Console
Crypto
Debugger
DNS
Domain
Events
File System
Globals
HTTP
HTTPS
Modules
Net
OS
Path
Process
Punycode
Qu">
<meta property="og:updated_time" content="2015-07-24T07:43:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="node.js API汇总(从官网copy过来，方便自己查询)">
<meta name="twitter:description" content="About these Docs
Synopsis
Assertion Testing
Buffer
C/C++ Addons
Child Processes
Cluster
Console
Crypto
Debugger
DNS
Domain
Events
File System
Globals
HTTP
HTTPS
Modules
Net
OS
Path
Process
Punycode
Qu">
  
    <link rel="alternative" href="/atom.xml" title="技术人生" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">uxfork</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录点点滴滴</p>
		

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">uxfork</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="null" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">uxfork</h1>
			</hgroup>
			
			<p class="header-subtitle">记录点点滴滴</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2015-07-node-js-API" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/24/2015-07-node-js-API/" class="article-date">
  	<time datetime="2015-07-24T07:43:27.000Z" itemprop="datePublished">2015-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      node.js API汇总(从官网copy过来，方便自己查询)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="#documentation">About these Docs</a></li>
<li><a href="#synopsis">Synopsis</a></li>
<li><a href="#assert">Assertion Testing</a></li>
<li><a href="#buffer">Buffer</a></li>
<li><a href="#addons">C/C++ Addons</a></li>
<li><a href="#child_process">Child Processes</a></li>
<li><a href="#cluster">Cluster</a></li>
<li><a href="#console">Console</a></li>
<li><a href="#crypto">Crypto</a></li>
<li><a href="#debugger">Debugger</a></li>
<li><a href="#dns">DNS</a></li>
<li><a href="#domain">Domain</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#fs">File System</a></li>
<li><a href="#globals">Globals</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#https">HTTPS</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#net">Net</a></li>
<li><a href="#os">OS</a></li>
<li><a href="#path">Path</a></li>
<li><a href="#process">Process</a></li>
<li><a href="#punycode">Punycode</a></li>
<li><a href="#querystring">Query Strings</a></li>
<li><a href="#readline">Readline</a></li>
<li><a href="#repl">REPL</a></li>
<li><a href="#smalloc">Smalloc</a></li>
<li><a href="#stream">Stream</a></li>
<li><a href="#string_decoder">String Decoder</a></li>
<li><a href="#timers">Timers</a></li>
<li><a href="#tls">TLS/SSL</a></li>
<li><a href="#tty">TTY</a></li>
<li><a href="#dgram">UDP/Datagram</a></li>
<li><a href="#url">URL</a></li>
<li><a href="#util">Utilities</a></li>
<li><a href="#vm">VM</a></li>
<li><a href="#zlib">ZLIB</a></li>
</ul>
<h1 id="About_this_Documentation"><a id="documentation"></a>About this Documentation</h1><!-- type=misc -->
<p>The goal of this documentation is to comprehensively explain the Node.js<br>API, both from a reference as well as a conceptual point of view.  Each<br>section describes a built-in module or high-level concept.</p>
<p>Where appropriate, property types, method arguments, and the arguments<br>provided to event handlers are detailed in a list underneath the topic<br>heading.</p>
<p>Every <code>.html</code> document has a corresponding <code>.json</code> document presenting<br>the same information in a structured manner.  This feature is<br>experimental, and added for the benefit of IDEs and other utilities that<br>wish to do programmatic things with the documentation.</p>
<p>Every <code>.html</code> and <code>.json</code> file is generated based on the corresponding<br><code>.markdown</code> file in the <code>doc/api/</code> folder in node’s source tree.  The<br>documentation is generated using the <code>tools/doc/generate.js</code> program.<br>The HTML template is located at <code>doc/template.html</code>.</p>
<h2 id="Stability_Index">Stability Index</h2><!--type=misc-->
<p>Throughout the documentation, you will see indications of a section’s<br>stability.  The Node.js API is still somewhat changing, and as it<br>matures, certain parts are more reliable than others.  Some are so<br>proven, and so relied upon, that they are unlikely to ever change at<br>all.  Others are brand new and experimental, or known to be hazardous<br>and in the process of being redesigned.</p>
<p>The stability indices are as follows:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stability: <span class="number">0</span> - Deprecated</span><br><span class="line">This feature <span class="keyword">is</span> known <span class="keyword">to</span> be problematic, <span class="keyword">and</span> changes are</span><br><span class="line">planned.  Do <span class="keyword">not</span> rely <span class="function_start"><span class="keyword">on</span></span> <span class="keyword">it</span>.  Use <span class="keyword">of</span> <span class="keyword">the</span> feature may cause warnings.  Backwards</span><br><span class="line">compatibility should <span class="keyword">not</span> be expected.</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stability: <span class="number">1</span> - Experimental</span><br><span class="line">This feature was introduced recently, <span class="keyword">and</span> may change</span><br><span class="line"><span class="keyword">or</span> be removed <span class="keyword">in</span> future versions.  Please <span class="keyword">try</span> <span class="keyword">it</span> out <span class="keyword">and</span> provide feedback.</span><br><span class="line">If <span class="keyword">it</span> addresses a use-case <span class="keyword">that</span> <span class="keyword">is</span> important <span class="keyword">to</span> you, <span class="keyword">tell</span> <span class="keyword">the</span> node core team.</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stability: <span class="number">2</span> - Unstable</span><br><span class="line">The API <span class="keyword">is</span> <span class="keyword">in</span> <span class="keyword">the</span> process <span class="keyword">of</span> settling, <span class="keyword">but</span> has <span class="keyword">not</span> yet had</span><br><span class="line">sufficient <span class="type">real</span>-world testing <span class="keyword">to</span> be considered stable. Backwards-compatibility</span><br><span class="line">will be maintained <span class="keyword">if</span> reasonable.</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stability: <span class="number">3</span> - Stable</span><br><span class="line">The API has proven satisfactory, <span class="keyword">but</span> cleanup <span class="keyword">in</span> <span class="keyword">the</span> underlying</span><br><span class="line">code may cause minor changes.  Backwards-compatibility <span class="keyword">is</span> guaranteed.</span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stability: <span class="number">4</span> - API Frozen</span><br><span class="line">This API <span class="keyword">has</span> been tested extensively <span class="keyword">in</span> production <span class="keyword">and</span> <span class="keyword">is</span></span><br><span class="line">unlikely <span class="keyword">to</span> ever have <span class="keyword">to</span> change.</span><br></pre></td></tr></table></figure>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stability: 5 - <span class="keyword">Locked</span></span><br><span class="line">Unless serious bugs <span class="keyword">are</span> found, this code will not ever</span><br><span class="line">change.  Please do not suggest changes in this area; they will be refused.</span><br></pre></td></tr></table></figure>
<h2 id="JSON_Output">JSON Output</h2><pre><code><span class="attribute">Stability</span>: <span class="string">1 - Experimental</span>
</code></pre><p>Every HTML file in the markdown has a corresponding JSON file with the<br>same data.</p>
<p>This feature is new as of node v0.6.12.  It is experimental.</p>
<h1 id="Synopsis"><a id="synopsis">Synopsis</a></h1><!--type=misc-->
<p>An example of a <a href="http.html">web server</a> written with Node which responds with ‘Hello<br>World’:</p>
<pre><code><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>{
  response.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  response.end(<span class="string">'Hello World\n'</span>);
}).listen(<span class="number">8124</span>);

<span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:8124/'</span>);
</code></pre><p>To run the server, put the code into a file called <code>example.js</code> and execute<br>it with the node program</p>
<pre><code>&gt; node example<span class="class">.js</span>
Server running at http:<span class="comment">//127.0.0.1:8124/</span>
</code></pre><p>All of the examples in the documentation can be run similarly.</p>
<h1 id="Global_Objects"><a id="globals"> Global Objects</a></h1><!-- type=misc -->
<p>These objects are available in all modules. Some of these objects aren’t<br>actually in the global scope but in the module scope - this will be noted.</p>
<h2 id="global">global</h2><!-- type=global -->
<ul>
<li>{Object} The global namespace object.</li>
</ul>
<p>In browsers, the top-level scope is the global scope. That means that in<br>browsers if you’re in the global scope <code>var something</code> will define a global<br>variable. In Node this is different. The top-level scope is not the global<br>scope; <code>var something</code> inside a Node module will be local to that module.</p>
<h2 id="process">process</h2><!-- type=global -->
<ul>
<li>{Object}</li>
</ul>
<p>The process object. See the <a href="process.html#process_process">process object</a> section.</p>
<h2 id="console">console</h2><!-- type=global -->
<ul>
<li>{Object}</li>
</ul>
<p>Used to print to stdout and stderr. See the <a href="console.html">console</a> section.</p>
<h2 id="Class:_Buffer">Class: Buffer</h2><!-- type=global -->
<ul>
<li>{Function}</li>
</ul>
<p>Used to handle binary data. See the <a href="buffer.html">buffer section</a></p>
<h2 id="require()">require()</h2><!-- type=var -->
<ul>
<li>{Function}</li>
</ul>
<p>To require modules. See the <a href="modules.html#modules_modules">Modules</a> section.  <code>require</code> isn’t actually a<br>global but rather local to each module.</p>
<h3 id="require-resolve()">require.resolve()</h3><p>Use the internal <code>require()</code> machinery to look up the location of a module,<br>but rather than loading the module, just return the resolved filename.</p>
<h3 id="require-cache">require.cache</h3><ul>
<li>{Object}</li>
</ul>
<p>Modules are cached in this object when they are required. By deleting a key<br>value from this object, the next <code>require</code> will reload the module.</p>
<h3 id="require-extensions">require.extensions</h3><pre><code><span class="attribute">Stability</span>: <span class="string">0 - Deprecated</span>
</code></pre><ul>
<li>{Object}</li>
</ul>
<p>Instruct <code>require</code> on how to handle certain file extensions.</p>
<p>Process files with the extension <code>.sjs</code> as <code>.js</code>:</p>
<pre><code><span class="built_in">require</span>.extensions[<span class="string">'.sjs'</span>] = <span class="built_in">require</span>.extensions[<span class="string">'.js'</span>];
</code></pre><p><strong>Deprecated</strong>  In the past, this list has been used to load<br>non-JavaScript modules into Node by compiling them on-demand.<br>However, in practice, there are much better ways to do this, such as<br>loading modules via some other Node program, or compiling them to<br>JavaScript ahead of time.</p>
<p>Since the Module system is locked, this feature will probably never go<br>away.  However, it may have subtle bugs and complexities that are best<br>left untouched.</p>
<h2 id="__filename">__filename</h2><!-- type=var -->
<ul>
<li>{String}</li>
</ul>
<p>The filename of the code being executed.  This is the resolved absolute path<br>of this code file.  For a main program this is not necessarily the same<br>filename used in the command line.  The value inside a module is the path<br>to that module file.</p>
<p>Example: running <code>node example.js</code> from <code>/Users/mjr</code></p>
<pre><code>console.<span class="built_in">log</span><span class="params">(__filename)</span>;
<span class="comment">// /Users/mjr/example.js</span>
</code></pre><p><code>__filename</code> isn’t actually a global but rather local to each module.</p>
<h2 id="__dirname">__dirname</h2><!-- type=var -->
<ul>
<li>{String}</li>
</ul>
<p>The name of the directory that the currently executing script resides in.</p>
<p>Example: running <code>node example.js</code> from <code>/Users/mjr</code></p>
<pre><code>console.<span class="built_in">log</span><span class="params">(__dirname)</span>;
<span class="comment">// /Users/mjr</span>
</code></pre><p><code>__dirname</code> isn’t actually a global but rather local to each module.</p>
<h2 id="module">module</h2><!-- type=var -->
<ul>
<li>{Object}</li>
</ul>
<p>A reference to the current module. In particular<br><code>module.exports</code> is used for defining what a module exports and makes<br>available through <code>require()</code>.</p>
<p><code>module</code> isn’t actually a global but rather local to each module.</p>
<p>See the <a href="modules.html">module system documentation</a> for more information.</p>
<h2 id="exports">exports</h2><!-- type=var -->
<p>A reference to the <code>module.exports</code> that is shorter to type.<br>See <a href="modules.html">module system documentation</a> for details on when to use <code>exports</code> and<br>when to use <code>module.exports</code>.</p>
<p><code>exports</code> isn’t actually a global but rather local to each module.</p>
<p>See the <a href="modules.html">module system documentation</a> for more information.</p>
<p>See the <a href="modules.html">module section</a> for more information.</p>
<h2 id="setTimeout(cb,_ms)">setTimeout(cb, ms)</h2><p>Run callback <code>cb</code> after <em>at least</em> <code>ms</code> milliseconds. The actual delay depends<br>on external factors like OS timer granularity and system load.</p>
<p>The timeout must be in the range of 1-2,147,483,647 inclusive. If the value is<br>outside that range, it’s changed to 1 millisecond. Broadly speaking, a timer<br>cannot span more than 24.8 days.</p>
<p>Returns an opaque value that represents the timer.</p>
<h2 id="clearTimeout(t)">clearTimeout(t)</h2><p>Stop a timer that was previously created with <code>setTimeout()</code>. The callback will<br>not execute.</p>
<h2 id="setInterval(cb,_ms)">setInterval(cb, ms)</h2><p>Run callback <code>cb</code> repeatedly every <code>ms</code> milliseconds. Note that the actual<br>interval may vary, depending on external factors like OS timer granularity and<br>system load. It’s never less than <code>ms</code> but it may be longer.</p>
<p>The interval must be in the range of 1-2,147,483,647 inclusive. If the value is<br>outside that range, it’s changed to 1 millisecond. Broadly speaking, a timer<br>cannot span more than 24.8 days.</p>
<p>Returns an opaque value that represents the timer.</p>
<h2 id="clearInterval(t)">clearInterval(t)</h2><p>Stop a timer that was previously created with <code>setInterval()</code>. The callback<br>will not execute.</p>
<!--type=global-->
<p>The timer functions are global variables. See the <a href="timers.html">timers</a> section.</p>
<h1 id="console-1"><a id="console"> console</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">4 - API Frozen</span>
</code></pre><ul>
<li>{Object}</li>
</ul>
<!--type=global-->
<p>For printing to stdout and stderr.  Similar to the console object functions<br>provided by most web browsers, here the output is sent to stdout or stderr.</p>
<p>The console functions are synchronous when the destination is a terminal or<br>a file (to avoid lost messages in case of premature exit) and asynchronous<br>when it’s a pipe (to avoid blocking for long periods of time).</p>
<p>That is, in the following example, stdout is non-blocking while stderr<br>is blocking:</p>
<pre><code>$ node <span class="keyword">script</span>.js <span class="number">2</span>&gt; <span class="keyword">error</span>.<span class="command">log</span> | tee info.<span class="command">log</span>
</code></pre><p>In daily use, the blocking/non-blocking dichotomy is not something you<br>should worry about unless you log huge amounts of data.</p>
<h2 id="console-log([data][,_…])">console.log([data][, …])</h2><p>Prints to stdout with newline. This function can take multiple arguments in a<br><code>printf()</code>-like way. Example:</p>
<pre><code><span class="keyword">var</span> <span class="keyword">count</span> = 5;
console.<span class="literal">log</span>('<span class="keyword">count</span>: %<span class="keyword">d</span>', <span class="keyword">count</span>);
<span class="comment">// prints 'count: 5'</span>
</code></pre><p>If formatting elements are not found in the first string then <code>util.inspect</code><br>is used on each argument.  See <a href="util.html#util_util_format_format">util.format()</a> for more information.</p>
<h2 id="console-info([data][,_…])">console.info([data][, …])</h2><p>Same as <code>console.log</code>.</p>
<h2 id="console-error([data][,_…])">console.error([data][, …])</h2><p>Same as <code>console.log</code> but prints to stderr.</p>
<h2 id="console-warn([data][,_…])">console.warn([data][, …])</h2><p>Same as <code>console.error</code>.</p>
<h2 id="console-dir(obj[,_options])">console.dir(obj[, options])</h2><p>Uses <code>util.inspect</code> on <code>obj</code> and prints resulting string to stdout. This function<br>bypasses any custom <code>inspect()</code> function on <code>obj</code>. An optional <em>options</em> object<br>may be passed that alters certain aspects of the formatted string:</p>
<ul>
<li><p><code>showHidden</code> - if <code>true</code> then the object’s non-enumerable properties will be<br>shown too. Defaults to <code>false</code>.</p>
</li>
<li><p><code>depth</code> - tells <code>inspect</code> how many times to recurse while formatting the<br>object. This is useful for inspecting large complicated objects. Defaults to<br><code>2</code>. To make it recurse indefinitely pass <code>null</code>.</p>
</li>
<li><p><code>colors</code> - if <code>true</code>, then the output will be styled with ANSI color codes.<br>Defaults to <code>false</code>. Colors are customizable, see below.</p>
</li>
</ul>
<h2 id="console-time(label)">console.time(label)</h2><p>Mark a time.</p>
<h2 id="console-timeEnd(label)">console.timeEnd(label)</h2><p>Finish timer, record output. Example:</p>
<pre><code><span class="built_in">console</span>.time(<span class="string">'100-elements'</span>);
<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {
  ;
}
<span class="built_in">console</span>.timeEnd(<span class="string">'100-elements'</span>);
<span class="comment">// prints 100-elements: 262ms</span>
</code></pre><h2 id="console-trace(message[,_…])">console.trace(message[, …])</h2><p>Print to stderr <code>&#39;Trace :&#39;</code>, followed by the formatted message and stack trace<br>to the current position.</p>
<h2 id="console-assert(value[,_message][,_…])">console.assert(value[, message][, …])</h2><p>Similar to <a href="assert.html#assert_assert_value_message_assert_ok_value_message">assert.ok()</a>, but the error message is formatted as<br><code>util.format(message...)</code>.</p>
<h1 id="Timers"><a id="timers"> Timers</a></h1><pre><code>Stability: 5 - <span class="keyword">Locked</span>
</code></pre><p>All of the timer functions are globals.  You do not need to <code>require()</code><br>this module in order to use them.</p>
<h2 id="setTimeout(callback,_delay[,_arg][,_…])">setTimeout(callback, delay[, arg][, …])</h2><p>To schedule execution of a one-time <code>callback</code> after <code>delay</code> milliseconds. Returns a<br><code>timeoutObject</code> for possible use with <code>clearTimeout()</code>. Optionally you can<br>also pass arguments to the callback.</p>
<p>It is important to note that your callback will probably not be called in exactly<br><code>delay</code> milliseconds - Node.js makes no guarantees about the exact timing of when<br>the callback will fire, nor of the ordering things will fire in. The callback will<br>be called as close as possible to the time specified.</p>
<h2 id="clearTimeout(timeoutObject)">clearTimeout(timeoutObject)</h2><p>Prevents a timeout from triggering.</p>
<h2 id="setInterval(callback,_delay[,_arg][,_…])">setInterval(callback, delay[, arg][, …])</h2><p>To schedule the repeated execution of <code>callback</code> every <code>delay</code> milliseconds.<br>Returns a <code>intervalObject</code> for possible use with <code>clearInterval()</code>. Optionally<br>you can also pass arguments to the callback.</p>
<h2 id="clearInterval(intervalObject)">clearInterval(intervalObject)</h2><p>Stops an interval from triggering.</p>
<h2 id="unref()">unref()</h2><p>The opaque value returned by <code>setTimeout</code> and <code>setInterval</code> also has the method<br><code>timer.unref()</code> which will allow you to create a timer that is active but if<br>it is the only item left in the event loop won’t keep the program running.<br>If the timer is already <code>unref</code>d calling <code>unref</code> again will have no effect.</p>
<p>In the case of <code>setTimeout</code> when you <code>unref</code> you create a separate timer that<br>will wakeup the event loop, creating too many of these may adversely effect<br>event loop performance — use wisely.</p>
<h2 id="ref()">ref()</h2><p>If you had previously <code>unref()</code>d a timer you can call <code>ref()</code> to explicitly<br>request the timer hold the program open. If the timer is already <code>ref</code>d calling<br><code>ref</code> again will have no effect.</p>
<h2 id="setImmediate(callback[,_arg][,_…])">setImmediate(callback[, arg][, …])</h2><p>To schedule the “immediate” execution of <code>callback</code> after I/O events<br>callbacks and before <code>setTimeout</code> and <code>setInterval</code> . Returns an<br><code>immediateObject</code> for possible use with <code>clearImmediate()</code>. Optionally you<br>can also pass arguments to the callback.</p>
<p>Callbacks for immediates are queued in the order in which they were created.<br>The entire callback queue is processed every event loop iteration. If you queue<br>an immediate from inside an executing callback, that immediate won’t fire<br>until the next event loop iteration.</p>
<h2 id="clearImmediate(immediateObject)">clearImmediate(immediateObject)</h2><p>Stops an immediate from triggering.</p>
<h1 id="Modules"><a id="modules">Modules</a></h1><pre><code>Stability: 5 - <span class="keyword">Locked</span>
</code></pre><!--name=module-->
<p>Node has a simple module loading system.  In Node, files and modules are in<br>one-to-one correspondence.  As an example, <code>foo.js</code> loads the module<br><code>circle.js</code> in the same directory.</p>
<p>The contents of <code>foo.js</code>:</p>
<pre><code><span class="reserved">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);
<span class="built_in">console</span>.log( <span class="string">'The area of a circle of radius 4 is '</span>
           + circle.area(<span class="number">4</span>));
</code></pre><p>The contents of <code>circle.js</code>:</p>
<pre><code><span class="keyword">var</span> PI = <span class="built_in">Math</span>.PI;

exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>{
  <span class="keyword">return</span> PI * r * r;
};

exports.circumference = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>{
  <span class="keyword">return</span> <span class="number">2</span> * PI * r;
};
</code></pre><p>The module <code>circle.js</code> has exported the functions <code>area()</code> and<br><code>circumference()</code>.  To add functions and objects to the root of your module,<br>you can add them to the special <code>exports</code> object.</p>
<p>Variables local to the module will be private, as though the module was wrapped<br>in a function. In this example the variable <code>PI</code> is private to <code>circle.js</code>.</p>
<p>If you want the root of your module’s export to be a function (such as a<br>constructor) or if you want to export a complete object in one assignment<br>instead of building it one property at a time, assign it to <code>module.exports</code><br>instead of <code>exports</code>.</p>
<p>Below, <code>bar.js</code> makes use of the <code>square</code> module, which exports a constructor:</p>
<pre><code>var <span class="built_in">square</span> = require<span class="params">('./square.js')</span>;
var mySquare = <span class="built_in">square</span><span class="params">(<span class="number">2</span>)</span>;
console.<span class="built_in">log</span><span class="params">('The area of my square is ' + mySquare.area<span class="params">()</span>)</span>;
</code></pre><p>The <code>square</code> module is defined in <code>square.js</code>:</p>
<pre><code>// assigning to exports will not modify <span class="keyword">module</span>, must <span class="keyword">use</span> <span class="keyword">module</span>.exports
<span class="keyword">module</span>.exports = <span class="function"><span class="keyword">function</span><span class="params">(width)</span></span> {
  <span class="keyword">return</span> {
    area: <span class="function"><span class="keyword">function</span><span class="params">()</span></span> {
      <span class="keyword">return</span> width * width;
    }
  };
}
</code></pre><p>The module system is implemented in the <code>require(&quot;module&quot;)</code> module.</p>
<h2 id="Cycles">Cycles</h2><!--type=misc-->
<p>When there are circular <code>require()</code> calls, a module might not have finished<br>executing when it is returned.</p>
<p>Consider this situation:</p>
<p><code>a.js</code>:</p>
<pre><code>console.log(<span class="symbol">'a</span> starting');
exports.<span class="keyword">done</span> = <span class="literal">false</span>;
var b = require(<span class="char">'./b.js'</span>);
console.log(<span class="symbol">'in</span> a, b.<span class="keyword">done</span> = %j', b.<span class="keyword">done</span>);
exports.<span class="keyword">done</span> = <span class="literal">true</span>;
console.log(<span class="symbol">'a</span> done');
</code></pre><p><code>b.js</code>:</p>
<pre><code>console.log(<span class="symbol">'b</span> starting');
exports.<span class="keyword">done</span> = <span class="literal">false</span>;
var a = require(<span class="char">'./a.js'</span>);
console.log(<span class="symbol">'in</span> b, a.<span class="keyword">done</span> = %j', a.<span class="keyword">done</span>);
exports.<span class="keyword">done</span> = <span class="literal">true</span>;
console.log(<span class="symbol">'b</span> done');
</code></pre><p><code>main.js</code>:</p>
<pre><code><span class="built_in">console</span>.log(<span class="string">'main starting'</span>);
<span class="reserved">var</span> a = <span class="built_in">require</span>(<span class="string">'./a.js'</span>);
<span class="reserved">var</span> b = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);
<span class="built_in">console</span>.log(<span class="string">'in main, a.done=%j, b.done=%j'</span>, a.done, b.done);
</code></pre><p>When <code>main.js</code> loads <code>a.js</code>, then <code>a.js</code> in turn loads <code>b.js</code>.  At that<br>point, <code>b.js</code> tries to load <code>a.js</code>.  In order to prevent an infinite<br>loop, an <strong>unfinished copy</strong> of the <code>a.js</code> exports object is returned to the<br><code>b.js</code> module.  <code>b.js</code> then finishes loading, and its <code>exports</code> object is<br>provided to the <code>a.js</code> module.</p>
<p>By the time <code>main.js</code> has loaded both modules, they’re both finished.<br>The output of this program would thus be:</p>
<pre><code>$ node main<span class="class">.js</span>
main starting
<span class="tag">a</span> starting
<span class="tag">b</span> starting
<span class="keyword">in</span> <span class="tag">b</span>, <span class="tag">a</span><span class="class">.done</span> = false
<span class="tag">b</span> done
<span class="keyword">in</span> <span class="tag">a</span>, <span class="tag">b</span><span class="class">.done</span> = true
<span class="tag">a</span> done
<span class="keyword">in</span> main, <span class="tag">a</span>.done=true, <span class="tag">b</span>.done=true
</code></pre><p>If you have cyclic module dependencies in your program, make sure to<br>plan accordingly.</p>
<h2 id="Core_Modules">Core Modules</h2><!--type=misc-->
<p>Node has several modules compiled into the binary.  These modules are<br>described in greater detail elsewhere in this documentation.</p>
<p>The core modules are defined in node’s source in the <code>lib/</code> folder.</p>
<p>Core modules are always preferentially loaded if their identifier is<br>passed to <code>require()</code>.  For instance, <code>require(&#39;http&#39;)</code> will always<br>return the built in HTTP module, even if there is a file by that name.</p>
<h2 id="File_Modules">File Modules</h2><!--type=misc-->
<p>If the exact filename is not found, then node will attempt to load the<br>required filename with the added extension of <code>.js</code>, <code>.json</code>, and then <code>.node</code>.</p>
<p><code>.js</code> files are interpreted as JavaScript text files, and <code>.json</code> files are<br>parsed as JSON text files. <code>.node</code> files are interpreted as compiled addon<br>modules loaded with <code>dlopen</code>.</p>
<p>A module prefixed with <code>&#39;/&#39;</code> is an absolute path to the file.  For<br>example, <code>require(&#39;/home/marco/foo.js&#39;)</code> will load the file at<br><code>/home/marco/foo.js</code>.</p>
<p>A module prefixed with <code>&#39;./&#39;</code> is relative to the file calling <code>require()</code>.<br>That is, <code>circle.js</code> must be in the same directory as <code>foo.js</code> for<br><code>require(&#39;./circle&#39;)</code> to find it.</p>
<p>Without a leading ‘/‘ or ‘./‘ to indicate a file, the module is either a<br>“core module” or is loaded from a <code>node_modules</code> folder.</p>
<p>If the given path does not exist, <code>require()</code> will throw an Error with its<br><code>code</code> property set to <code>&#39;MODULE_NOT_FOUND&#39;</code>.</p>
<h2 id="Loading_from_node_modules_Folders">Loading from <code>node_modules</code> Folders</h2><!--type=misc-->
<p>If the module identifier passed to <code>require()</code> is not a native module,<br>and does not begin with <code>&#39;/&#39;</code>, <code>&#39;../&#39;</code>, or <code>&#39;./&#39;</code>, then node starts at the<br>parent directory of the current module, and adds <code>/node_modules</code>, and<br>attempts to load the module from that location.</p>
<p>If it is not found there, then it moves to the parent directory, and so<br>on, until the root of the file system is reached.</p>
<p>For example, if the file at <code>&#39;/home/ry/projects/foo.js&#39;</code> called<br><code>require(&#39;bar.js&#39;)</code>, then node would look in the following locations, in<br>this order:</p>
<ul>
<li><code>/home/ry/projects/node_modules/bar.js</code></li>
<li><code>/home/ry/node_modules/bar.js</code></li>
<li><code>/home/node_modules/bar.js</code></li>
<li><code>/node_modules/bar.js</code></li>
</ul>
<p>This allows programs to localize their dependencies, so that they do not<br>clash.</p>
<p>You can require specific files or sub modules distributed with a module by<br>including a path suffix after the module name. For instance<br><code>require(&#39;example-module/path/to/file&#39;)</code> would resolve <code>path/to/file</code><br>relative to where <code>example-module</code> is located. The suffixed path follows the<br>same module resolution semantics.</p>
<h2 id="Folders_as_Modules">Folders as Modules</h2><!--type=misc-->
<p>It is convenient to organize programs and libraries into self-contained<br>directories, and then provide a single entry point to that library.<br>There are three ways in which a folder may be passed to <code>require()</code> as<br>an argument.</p>
<p>The first is to create a <code>package.json</code> file in the root of the folder,<br>which specifies a <code>main</code> module.  An example package.json file might<br>look like this:</p>
<pre><code>{ "<span class="attribute">name</span>" : <span class="value"><span class="string">"some-library"</span></span>,
  "<span class="attribute">main</span>" : <span class="value"><span class="string">"./lib/some-library.js"</span> </span>}
</code></pre><p>If this was in a folder at <code>./some-library</code>, then<br><code>require(&#39;./some-library&#39;)</code> would attempt to load<br><code>./some-library/lib/some-library.js</code>.</p>
<p>This is the extent of Node’s awareness of package.json files.</p>
<p>If there is no package.json file present in the directory, then node<br>will attempt to load an <code>index.js</code> or <code>index.node</code> file out of that<br>directory.  For example, if there was no package.json file in the above<br>example, then <code>require(&#39;./some-library&#39;)</code> would attempt to load:</p>
<ul>
<li><code>./some-library/index.js</code></li>
<li><code>./some-library/index.node</code></li>
</ul>
<h2 id="Caching">Caching</h2><!--type=misc-->
<p>Modules are cached after the first time they are loaded.  This means<br>(among other things) that every call to <code>require(&#39;foo&#39;)</code> will get<br>exactly the same object returned, if it would resolve to the same file.</p>
<p>Multiple calls to <code>require(&#39;foo&#39;)</code> may not cause the module code to be<br>executed multiple times.  This is an important feature.  With it,<br>“partially done” objects can be returned, thus allowing transitive<br>dependencies to be loaded even when they would cause cycles.</p>
<p>If you want to have a module execute code multiple times, then export a<br>function, and call that function.</p>
<h3 id="Module_Caching_Caveats">Module Caching Caveats</h3><!--type=misc-->
<p>Modules are cached based on their resolved filename.  Since modules may<br>resolve to a different filename based on the location of the calling<br>module (loading from <code>node_modules</code> folders), it is not a <em>guarantee</em><br>that <code>require(&#39;foo&#39;)</code> will always return the exact same object, if it<br>would resolve to different files.</p>
<h2 id="The_module_Object">The <code>module</code> Object</h2><!-- type=var -->
<!-- name=module -->
<ul>
<li>{Object}</li>
</ul>
<p>In each module, the <code>module</code> free variable is a reference to the object<br>representing the current module.  For convenience, <code>module.exports</code> is<br>also accessible via the <code>exports</code> module-global. <code>module</code> isn’t actually<br>a global but rather local to each module.</p>
<h3 id="module-exports">module.exports</h3><ul>
<li>{Object}</li>
</ul>
<p>The <code>module.exports</code> object is created by the Module system. Sometimes this is not<br>acceptable; many want their module to be an instance of some class. To do this,<br>assign the desired export object to <code>module.exports</code>. Note that assigning the<br>desired object to <code>exports</code> will simply rebind the local <code>exports</code> variable,<br>which is probably not what you want to do.</p>
<p>For example suppose we were making a module called <code>a.js</code></p>
<pre><code>var EventEmitter = require('events').EventEmitter;

module.exports = new EventEmitter();

// <span class="operator"><span class="keyword">Do</span> <span class="keyword">some</span> <span class="keyword">work</span>, <span class="keyword">and</span> <span class="keyword">after</span> <span class="keyword">some</span> <span class="keyword">time</span> emit
// the <span class="string">'ready'</span> <span class="keyword">event</span> <span class="keyword">from</span> the <span class="keyword">module</span> itself.
setTimeout(<span class="keyword">function</span>() {
  <span class="keyword">module</span>.exports.emit(<span class="string">'ready'</span>);</span>
}, 1000);
</code></pre><p>Then in another file we could do</p>
<pre><code><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>);
a.on(<span class="string">'ready'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'module a is ready'</span>);
});
</code></pre><p>Note that assignment to <code>module.exports</code> must be done immediately. It cannot be<br>done in any callbacks.  This does not work:</p>
<p>x.js:</p>
<pre><code>setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">module</span>.exports = { a: <span class="string">"hello"</span> };
}, <span class="number">0</span>);
</code></pre><p>y.js:</p>
<pre><code><span class="reserved">var</span> x = <span class="built_in">require</span>(<span class="string">'./x'</span>);
<span class="built_in">console</span>.log(x.a);
</code></pre><h4 id="exports_alias">exports alias</h4><p>The <code>exports</code> variable that is available within a module starts as a reference<br>to <code>module.exports</code>. As with any variable, if you assign a new value to it, it<br>is no longer bound to the previous value.</p>
<p>To illustrate the behaviour, imagine this hypothetical implementation of<br><code>require()</code>:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">require</span><span class="params">(<span class="rest_arg">...) {
  // ...
  function</span> (module, exports)</span> </span>{
    <span class="comment">// Your module code here</span>
    exports = some_func;        <span class="comment">// re-assigns exports, exports is no longer</span>
                                <span class="comment">// a shortcut, and nothing is exported.</span>
    module.exports = some_func; <span class="comment">// makes your module export 0</span>
  } (module, module.exports);
  <span class="keyword">return</span> module;
}
</code></pre><p>As a guideline, if the relationship between <code>exports</code> and <code>module.exports</code><br>seems like magic to you, ignore <code>exports</code> and only use <code>module.exports</code>.</p>
<h3 id="module-require(id)">module.require(id)</h3><ul>
<li><code>id</code> {String}</li>
<li>Return: {Object} <code>module.exports</code> from the resolved module</li>
</ul>
<p>The <code>module.require</code> method provides a way to load a module as if<br><code>require()</code> was called from the original module.</p>
<p>Note that in order to do this, you must get a reference to the <code>module</code><br>object.  Since <code>require()</code> returns the <code>module.exports</code>, and the <code>module</code> is<br>typically <em>only</em> available within a specific module’s code, it must be<br>explicitly exported in order to be used.</p>
<h3 id="module-id">module.id</h3><ul>
<li>{String}</li>
</ul>
<p>The identifier for the module.  Typically this is the fully resolved<br>filename.</p>
<h3 id="module-filename">module.filename</h3><ul>
<li>{String}</li>
</ul>
<p>The fully resolved filename to the module.</p>
<h3 id="module-loaded">module.loaded</h3><ul>
<li>{Boolean}</li>
</ul>
<p>Whether or not the module is done loading, or is in the process of<br>loading.</p>
<h3 id="module-parent">module.parent</h3><ul>
<li>{Module Object}</li>
</ul>
<p>The module that required this one.</p>
<h3 id="module-children">module.children</h3><ul>
<li>{Array}</li>
</ul>
<p>The module objects required by this one.</p>
<h2 id="All_Together…">All Together…</h2><!-- type=misc -->
<p>To get the exact filename that will be loaded when <code>require()</code> is called, use<br>the <code>require.resolve()</code> function.</p>
<p>Putting together all of the above, here is the high-level algorithm<br>in pseudocode of what require.resolve does:</p>
<pre><code><span class="function"><span class="title">require</span><span class="params">(X)</span></span> from module at path Y
<span class="number">1</span>. If X is <span class="tag">a</span> core module,
   <span class="tag">a</span>. return the core module
   <span class="tag">b</span>. STOP
<span class="number">2</span>. If X begins with <span class="string">'./'</span> or <span class="string">'/'</span> or <span class="string">'../'</span>
   <span class="tag">a</span>. <span class="function"><span class="title">LOAD_AS_FILE</span><span class="params">(Y + X)</span></span>
   <span class="tag">b</span>. <span class="function"><span class="title">LOAD_AS_DIRECTORY</span><span class="params">(Y + X)</span></span>
<span class="number">3</span>. <span class="function"><span class="title">LOAD_NODE_MODULES</span><span class="params">(X, dirname(Y)</span></span>)
<span class="number">4</span>. THROW <span class="string">"not found"</span>

<span class="function"><span class="title">LOAD_AS_FILE</span><span class="params">(X)</span></span>
<span class="number">1</span>. If X is <span class="tag">a</span> file, load X as JavaScript text.  STOP
<span class="number">2</span>. If X<span class="class">.js</span> is <span class="tag">a</span> file, load X<span class="class">.js</span> as JavaScript text.  STOP
<span class="number">3</span>. If X<span class="class">.json</span> is <span class="tag">a</span> file, parse X<span class="class">.json</span> to <span class="tag">a</span> JavaScript Object.  STOP
<span class="number">4</span>. If X<span class="class">.node</span> is <span class="tag">a</span> file, load X<span class="class">.node</span> as binary addon.  STOP

<span class="function"><span class="title">LOAD_AS_DIRECTORY</span><span class="params">(X)</span></span>
<span class="number">1</span>. If X/package<span class="class">.json</span> is <span class="tag">a</span> file,
   <span class="tag">a</span>. Parse X/package<span class="class">.json</span>, and look <span class="keyword">for</span> <span class="string">"main"</span> field.
   <span class="tag">b</span>. let M = X + (json main field)
   c. <span class="function"><span class="title">LOAD_AS_FILE</span><span class="params">(M)</span></span>
<span class="number">2</span>. If X/index<span class="class">.js</span> is <span class="tag">a</span> file, load X/index<span class="class">.js</span> as JavaScript text.  STOP
<span class="number">3</span>. If X/index<span class="class">.json</span> is <span class="tag">a</span> file, parse X/index<span class="class">.json</span> to <span class="tag">a</span> JavaScript <span class="tag">object</span>. STOP
<span class="number">4</span>. If X/index<span class="class">.node</span> is <span class="tag">a</span> file, load X/index<span class="class">.node</span> as binary addon.  STOP

<span class="function"><span class="title">LOAD_NODE_MODULES</span><span class="params">(X, START)</span></span>
<span class="number">1</span>. let DIRS=<span class="function"><span class="title">NODE_MODULES_PATHS</span><span class="params">(START)</span></span>
<span class="number">2</span>. <span class="keyword">for</span> each DIR <span class="keyword">in</span> DIRS:
   <span class="tag">a</span>. <span class="function"><span class="title">LOAD_AS_FILE</span><span class="params">(DIR/X)</span></span>
   <span class="tag">b</span>. <span class="function"><span class="title">LOAD_AS_DIRECTORY</span><span class="params">(DIR/X)</span></span>

<span class="function"><span class="title">NODE_MODULES_PATHS</span><span class="params">(START)</span></span>
<span class="number">1</span>. let PARTS = path <span class="function"><span class="title">split</span><span class="params">(START)</span></span>
<span class="number">2</span>. let I = count of PARTS - <span class="number">1</span>
<span class="number">3</span>. let DIRS = []
<span class="number">4</span>. while I &gt;= <span class="number">0</span>,
   <span class="tag">a</span>. <span class="keyword">if</span> PARTS[I] = <span class="string">"node_modules"</span> CONTINUE
   c. DIR = path <span class="function"><span class="title">join</span><span class="params">(PARTS[<span class="number">0</span> .. I] + <span class="string">"node_modules"</span>)</span></span>
   <span class="tag">b</span>. DIRS = DIRS + DIR
   c. let I = I - <span class="number">1</span>
<span class="number">5</span>. return DIRS
</code></pre><h2 id="Loading_from_the_global_folders">Loading from the global folders</h2><!-- type=misc -->
<p>If the <code>NODE_PATH</code> environment variable is set to a colon-delimited list<br>of absolute paths, then node will search those paths for modules if they<br>are not found elsewhere.  (Note: On Windows, <code>NODE_PATH</code> is delimited by<br>semicolons instead of colons.)</p>
<p>Additionally, node will search in the following locations:</p>
<ul>
<li>1: <code>$HOME/.node_modules</code></li>
<li>2: <code>$HOME/.node_libraries</code></li>
<li>3: <code>$PREFIX/lib/node</code></li>
</ul>
<p>Where <code>$HOME</code> is the user’s home directory, and <code>$PREFIX</code> is node’s<br>configured <code>node_prefix</code>.</p>
<p>These are mostly for historic reasons.  You are highly encouraged to<br>place your dependencies locally in <code>node_modules</code> folders.  They will be<br>loaded faster, and more reliably.</p>
<h2 id="Accessing_the_main_module">Accessing the main module</h2><!-- type=misc -->
<p>When a file is run directly from Node, <code>require.main</code> is set to its<br><code>module</code>. That means that you can determine whether a file has been run<br>directly by testing</p>
<pre><code><span class="keyword">require</span>.main === <span class="class"><span class="keyword">module</span></span>
</code></pre><p>For a file <code>foo.js</code>, this will be <code>true</code> if run via <code>node foo.js</code>, but<br><code>false</code> if run by <code>require(&#39;./foo&#39;)</code>.</p>
<p>Because <code>module</code> provides a <code>filename</code> property (normally equivalent to<br><code>__filename</code>), the entry point of the current application can be obtained<br>by checking <code>require.main.filename</code>.</p>
<h2 id="Addenda:_Package_Manager_Tips">Addenda: Package Manager Tips</h2><!-- type=misc -->
<p>The semantics of Node’s <code>require()</code> function were designed to be general<br>enough to support a number of sane directory structures. Package manager<br>programs such as <code>dpkg</code>, <code>rpm</code>, and <code>npm</code> will hopefully find it possible to<br>build native packages from Node modules without modification.</p>
<p>Below we give a suggested directory structure that could work:</p>
<p>Let’s say that we wanted to have the folder at<br><code>/usr/lib/node/&lt;some-package&gt;/&lt;some-version&gt;</code> hold the contents of a<br>specific version of a package.</p>
<p>Packages can depend on one another. In order to install package <code>foo</code>, you<br>may have to install a specific version of package <code>bar</code>.  The <code>bar</code> package<br>may itself have dependencies, and in some cases, these dependencies may even<br>collide or form cycles.</p>
<p>Since Node looks up the <code>realpath</code> of any modules it loads (that is,<br>resolves symlinks), and then looks for their dependencies in the<br><code>node_modules</code> folders as described above, this situation is very simple to<br>resolve with the following architecture:</p>
<ul>
<li><code>/usr/lib/node/foo/1.2.3/</code> - Contents of the <code>foo</code> package, version 1.2.3.</li>
<li><code>/usr/lib/node/bar/4.3.2/</code> - Contents of the <code>bar</code> package that <code>foo</code><br>depends on.</li>
<li><code>/usr/lib/node/foo/1.2.3/node_modules/bar</code> - Symbolic link to<br><code>/usr/lib/node/bar/4.3.2/</code>.</li>
<li><code>/usr/lib/node/bar/4.3.2/node_modules/*</code> - Symbolic links to the packages<br>that <code>bar</code> depends on.</li>
</ul>
<p>Thus, even if a cycle is encountered, or if there are dependency<br>conflicts, every module will be able to get a version of its dependency<br>that it can use.</p>
<p>When the code in the <code>foo</code> package does <code>require(&#39;bar&#39;)</code>, it will get the<br>version that is symlinked into <code>/usr/lib/node/foo/1.2.3/node_modules/bar</code>.<br>Then, when the code in the <code>bar</code> package calls <code>require(&#39;quux&#39;)</code>, it’ll get<br>the version that is symlinked into<br><code>/usr/lib/node/bar/4.3.2/node_modules/quux</code>.</p>
<p>Furthermore, to make the module lookup process even more optimal, rather<br>than putting packages directly in <code>/usr/lib/node</code>, we could put them in<br><code>/usr/lib/node_modules/&lt;name&gt;/&lt;version&gt;</code>.  Then node will not bother<br>looking for missing dependencies in <code>/usr/node_modules</code> or <code>/node_modules</code>.</p>
<p>In order to make modules available to the node REPL, it might be useful to<br>also add the <code>/usr/lib/node_modules</code> folder to the <code>$NODE_PATH</code> environment<br>variable.  Since the module lookups using <code>node_modules</code> folders are all<br>relative, and based on the real path of the files making the calls to<br><code>require()</code>, the packages themselves can be anywhere.</p>
<h1 id="Addons"><a id="addons"> Addons</a></h1><p>Addons are dynamically linked shared objects. They can provide glue to C and<br>C++ libraries. The API (at the moment) is rather complex, involving<br>knowledge of several libraries:</p>
<ul>
<li><p>V8 JavaScript, a C++ library. Used for interfacing with JavaScript:<br>creating objects, calling functions, etc.  Documented mostly in the<br><code>v8.h</code> header file (<code>deps/v8/include/v8.h</code> in the Node source<br>tree), which is also available<br><a href="http://izs.me/v8-docs/main.html" target="_blank" rel="external">online</a>.</p>
</li>
<li><p><a href="https://github.com/joyent/libuv" target="_blank" rel="external">libuv</a>, C event loop library.<br>Anytime one needs to wait for a file descriptor to become readable,<br>wait for a timer, or wait for a signal to be received one will need<br>to interface with libuv. That is, if you perform any I/O, libuv will<br>need to be used.</p>
</li>
<li><p>Internal Node libraries. Most importantly is the <code>node::ObjectWrap</code><br>class which you will likely want to derive from.</p>
</li>
<li><p>Others. Look in <code>deps/</code> for what else is available.</p>
</li>
</ul>
<p>Node statically compiles all its dependencies into the executable.<br>When compiling your module, you don’t need to worry about linking to<br>any of these libraries.</p>
<p>All of the following examples are available for<br><a href="https://github.com/rvagg/node-addon-examples" target="_blank" rel="external">download</a> and may be<br>used as a starting-point for your own Addon.</p>
<h2 id="Hello_world">Hello world</h2><p>To get started let’s make a small Addon which is the C++ equivalent of<br>the following JavaScript code:</p>
<pre><code><span class="built_in">module</span>.exports.hello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{ <span class="keyword">return</span> <span class="string">'world'</span>; };
</code></pre><p>First we create a file <code>hello.cc</code>:</p>
<pre><code><span class="comment">// hello.cc</span>
#include &lt;node.h&gt;

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

void <span class="function"><span class="keyword">Method</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> <span class="comment">{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);
  args.GetReturnValue().Set(String::NewFromUtf8(isolate, "world"));
}</span>

<span class="title">void</span> <span class="title">init</span><span class="params">(Handle&lt;Object&gt; exports)</span> <span class="comment">{
  NODE_SET_METHOD(exports, "hello", Method);
}</span>

<span class="title">NODE_MODULE</span><span class="params">(addon, init)</span></span>
</code></pre><p>Note that all Node addons must export an initialization function:</p>
<pre><code>void Initialize <span class="list">(<span class="keyword">Handle&lt;Object&gt;</span> exports)</span><span class="comment">;</span>
NODE_MODULE<span class="list">(<span class="keyword">module_name</span>, Initialize)</span>
</code></pre><p>There is no semi-colon after <code>NODE_MODULE</code> as it’s not a function (see<br><code>node.h</code>).</p>
<p>The <code>module_name</code> needs to match the filename of the final binary (minus the<br>.node suffix).</p>
<p>The source code needs to be built into <code>addon.node</code>, the binary Addon. To<br>do this we create a file called <code>binding.gyp</code> which describes the configuration<br>to build your module in a JSON-like format. This file gets compiled by<br><a href="https://github.com/TooTallNate/node-gyp" target="_blank" rel="external">node-gyp</a>.</p>
<pre><code>{
  "<span class="attribute">targets</span>": <span class="value">[
    {
      "<span class="attribute">target_name</span>": <span class="value"><span class="string">"addon"</span></span>,
      "<span class="attribute">sources</span>": <span class="value">[ <span class="string">"hello.cc"</span> ]
    </span>}
  ]
</span>}
</code></pre><p>The next step is to generate the appropriate project build files for the<br>current platform. Use <code>node-gyp configure</code> for that.</p>
<p>Now you will have either a <code>Makefile</code> (on Unix platforms) or a <code>vcxproj</code> file<br>(on Windows) in the <code>build/</code> directory. Next invoke the <code>node-gyp build</code><br>command.</p>
<p>Now you have your compiled <code>.node</code> bindings file! The compiled bindings end up<br>in <code>build/Release/</code>.</p>
<p>You can now use the binary addon in a Node project <code>hello.js</code> by pointing<br><code>require</code> to the recently built <code>hello.node</code> module:</p>
<pre><code><span class="comment">// hello.js</span>
<span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);

<span class="built_in">console</span>.log(addon.hello()); <span class="comment">// 'world'</span>
</code></pre><p>Please see patterns below for further information or<br><a href="https://github.com/arturadib/node-qt" target="_blank" rel="external">https://github.com/arturadib/node-qt</a> for an example in production.</p>
<h2 id="Addon_patterns">Addon patterns</h2><p>Below are some addon patterns to help you get started. Consult the online<br><a href="http://izs.me/v8-docs/main.html" target="_blank" rel="external">v8 reference</a> for help with the various v8<br>calls, and v8’s <a href="http://code.google.com/apis/v8/embed.html" target="_blank" rel="external">Embedder’s Guide</a><br>for an explanation of several concepts used such as handles, scopes,<br>function templates, etc.</p>
<p>In order to use these examples you need to compile them using <code>node-gyp</code>.<br>Create the following <code>binding.gyp</code> file:</p>
<pre><code>{
  "<span class="attribute">targets</span>": <span class="value">[
    {
      "<span class="attribute">target_name</span>": <span class="value"><span class="string">"addon"</span></span>,
      "<span class="attribute">sources</span>": <span class="value">[ <span class="string">"addon.cc"</span> ]
    </span>}
  ]
</span>}
</code></pre><p>In cases where there is more than one <code>.cc</code> file, simply add the file name to<br>the <code>sources</code> array, e.g.:</p>
<pre><code><span class="string">"sources"</span>: [<span class="string">"addon.cc"</span>, <span class="string">"myexample.cc"</span>]
</code></pre><p>Now that you have your <code>binding.gyp</code> ready, you can configure and build the<br>addon:</p>
<pre><code><span class="variable">$ </span>node-gyp configure build
</code></pre><h3 id="Function_arguments">Function arguments</h3><p>The following pattern illustrates how to read arguments from JavaScript<br>function calls and return a result. This is the main and only needed source<br><code>addon.cc</code>:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="built_in">#</span><span class="preprocessor"><span class="keyword">include</span> &lt;node.h&gt;</span>

using namespace v8;

void Add<span class="params">(const FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> {
  Isolate<span class="built_in">*</span> isolate = Isolate::GetCurrent<span class="params">()</span>;
  HandleScope scope<span class="params">(isolate)</span>;

  <span class="keyword">if</span> <span class="params">(args.Length<span class="params">()</span> &lt; <span class="number">2</span>)</span> {
    isolate-&gt;ThrowException<span class="params">(Exception::TypeError<span class="params">(
        String::NewFromUtf8<span class="params">(isolate, <span class="string">"Wrong number of arguments"</span>)</span>)</span>)</span>;
    return;
  }

  <span class="keyword">if</span> <span class="params">(!args[<span class="number">0</span>]-&gt;IsNumber<span class="params">()</span> || !args[<span class="number">1</span>]-&gt;IsNumber<span class="params">()</span>)</span> {
    isolate-&gt;ThrowException<span class="params">(Exception::TypeError<span class="params">(
        String::NewFromUtf8<span class="params">(isolate, <span class="string">"Wrong arguments"</span>)</span>)</span>)</span>;
    return;
  }

  double value = args[<span class="number">0</span>]-&gt;NumberValue<span class="params">()</span> + args[<span class="number">1</span>]-&gt;NumberValue<span class="params">()</span>;
  Local&lt;Number&gt; num = Number::New<span class="params">(isolate, value)</span>;

  args.GetReturnValue<span class="params">()</span>.Set<span class="params">(num)</span>;
}

void Init<span class="params">(Handle&lt;Object&gt; exports)</span> {
  NODE_SET_METHOD<span class="params">(exports, <span class="string">"add"</span>, Add)</span>;
}

NODE_MODULE<span class="params">(addon, Init)</span>
</code></pre><p>You can test it with the following JavaScript snippet:</p>
<pre><code><span class="comment">// test.js</span>
<span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);

<span class="built_in">console</span>.log( <span class="string">'This should be eight:'</span>, addon.add(<span class="number">3</span>,<span class="number">5</span>) );
</code></pre><h3 id="Callbacks">Callbacks</h3><p>You can pass JavaScript functions to a C++ function and execute them from<br>there. Here’s <code>addon.cc</code>:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">RunCallback</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;

  Local&lt;Function&gt; cb = Local&lt;Function&gt;::Cast(args[<span class="number">0</span>]);
  <span class="keyword">const</span> <span class="keyword">unsigned</span> argc = <span class="number">1</span>;
  Local&lt;Value&gt; argv[argc] = { String::NewFromUtf8(isolate, <span class="string">"hello world"</span>) };
  cb-&gt;Call(isolate-&gt;GetCurrentContext()-&gt;Global(), argc, argv);
}

<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; module)</span> </span>{
  NODE_SET_METHOD(module, <span class="string">"exports"</span>, RunCallback);
}

NODE_MODULE(addon, Init)
</code></pre><p>Note that this example uses a two-argument form of <code>Init()</code> that receives<br>the full <code>module</code> object as the second argument. This allows the addon<br>to completely overwrite <code>exports</code> with a single function instead of<br>adding the function as a property of <code>exports</code>.</p>
<p>To test it run the following JavaScript snippet:</p>
<pre><code><span class="comment">// test.js</span>
<span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);

addon(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>{
  <span class="built_in">console</span>.log(msg); <span class="comment">// 'hello world'</span>
});
</code></pre><h3 id="Object_factory">Object factory</h3><p>You can create and return new objects from within a C++ function with this<br><code>addon.cc</code> pattern, which returns an object with property <code>msg</code> that echoes<br>the string passed to <code>createObject()</code>:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">CreateObject</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;

  Local&lt;Object&gt; obj = Object::New(isolate);
  obj-&gt;Set(String::NewFromUtf8(isolate, <span class="string">"msg"</span>), args[<span class="number">0</span>]-&gt;ToString());

  args.GetReturnValue().Set(obj);
}

<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; module)</span> </span>{
  NODE_SET_METHOD(module, <span class="string">"exports"</span>, CreateObject);
}

NODE_MODULE(addon, Init)
</code></pre><p>To test it in JavaScript:</p>
<pre><code><span class="comment">// test.js</span>
<span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);

<span class="keyword">var</span> obj1 = addon(<span class="string">'hello'</span>);
<span class="keyword">var</span> obj2 = addon(<span class="string">'world'</span>);
<span class="built_in">console</span>.log(obj1.msg+<span class="string">' '</span>+obj2.msg); <span class="comment">// 'hello world'</span>
</code></pre><h3 id="Function_factory">Function factory</h3><p>This pattern illustrates how to create and return a JavaScript function that<br>wraps a C++ function:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">MyFunction</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;
  args.GetReturnValue().Set(String::NewFromUtf8(isolate, <span class="string">"hello world"</span>));
}

<span class="function"><span class="keyword">void</span> <span class="title">CreateFunction</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;

  Local&lt;FunctionTemplate&gt; tpl = FunctionTemplate::New(isolate, MyFunction);
  Local&lt;Function&gt; fn = tpl-&gt;GetFunction();

  <span class="comment">// omit this to make it anonymous</span>
  fn-&gt;SetName(String::NewFromUtf8(isolate, <span class="string">"theFunction"</span>));

  args.GetReturnValue().Set(fn);
}

<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; module)</span> </span>{
  NODE_SET_METHOD(module, <span class="string">"exports"</span>, CreateFunction);
}

NODE_MODULE(addon, Init)
</code></pre><p>To test:</p>
<pre><code><span class="comment">// test.js</span>
<span class="keyword">var</span> addon = <span class="built_in">require</span>(<span class="string">'./build/Release/addon'</span>);

<span class="keyword">var</span> fn = addon();
<span class="built_in">console</span>.log(fn()); <span class="comment">// 'hello world'</span>
</code></pre><h3 id="Wrapping_C++_objects">Wrapping C++ objects</h3><p>Here we will create a wrapper for a C++ object/class <code>MyObject</code> that can be<br>instantiated in JavaScript through the <code>new</code> operator. First prepare the main<br>module <code>addon.cc</code>:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "myobject.h"</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">InitAll</span><span class="params">(Handle&lt;Object&gt; exports)</span> </span>{
  MyObject::Init(exports);
}

NODE_MODULE(addon, InitAll)
</code></pre><p>Then in <code>myobject.h</code> make your wrapper inherit from <code>node::ObjectWrap</code>:</p>
<pre><code><span class="comment">// myobject.h</span>
<span class="preprocessor">#ifndef MYOBJECT_H</span>
<span class="preprocessor">#<span class="keyword">define</span> MYOBJECT_H</span>

<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node_object_wrap.h&gt;</span>

<span class="keyword">class</span> MyObject : <span class="keyword">public</span> node::ObjectWrap {
 <span class="keyword">public</span>:
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">(v8::Handle&lt;v8::Object&gt; exports)</span></span>;

 <span class="keyword">private</span>:
  <span class="function"><span class="keyword">explicit</span> <span class="title">MyObject</span><span class="params">(<span class="keyword">double</span> value = 0)</span></span>;
  ~MyObject();

  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">New</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PlusOne</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="keyword">static</span> v8::Persistent&lt;v8::Function&gt; constructor;
  <span class="keyword">double</span> value_;
};

<span class="preprocessor">#<span class="keyword">endif</span></span>
</code></pre><p>And in <code>myobject.cc</code> implement the various methods that you want to expose.<br>Here we expose the method <code>plusOne</code> by adding it to the constructor’s<br>prototype:</p>
<pre><code><span class="comment">// myobject.cc</span>
#include <span class="string">"myobject.h"</span>

using namespace v8;

Persistent&lt;<span class="built_in">Function</span>&gt; MyObject::<span class="constructor"><span class="keyword">constructor</span>;

MyObject::MyObject(double value) : value_(value) </span>{
}

MyObject::~MyObject() {
}

<span class="built_in">void</span> MyObject::Init(Handle&lt;<span class="built_in">Object</span>&gt; exports) {
  Isolate* isolate = Isolate::GetCurrent();

  <span class="comment">// Prepare constructor template</span>
  Local&lt;FunctionTemplate&gt; tpl = FunctionTemplate::New(isolate, New);
  tpl-&gt;SetClassName(<span class="built_in">String</span>::NewFromUtf8(isolate, <span class="string">"MyObject"</span>));
  tpl-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(<span class="number">1</span>);

  <span class="comment">// Prototype</span>
  NODE_SET_PROTOTYPE_METHOD(tpl, <span class="string">"plusOne"</span>, PlusOne);

  <span class="constructor"><span class="keyword">constructor</span>.Reset(isolate, tpl-&gt;GetFunction());
  exports-&gt;Set(<span class="built_in">String</span>::NewFromUtf8(isolate, "MyObject"),
               tpl-&gt;GetFunction());
}

<span class="built_in">void</span> MyObject::New(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  <span class="keyword">if</span> (args.IsConstructCall()) {
    <span class="comment">// Invoked as constructor: `new MyObject(...)`</span>
    double value = args[<span class="number">0</span>]-&gt;IsUndefined() ? <span class="number">0</span> : args[<span class="number">0</span>]-&gt;NumberValue();
    MyObject* obj = <span class="keyword">new</span> MyObject(value);
    obj-&gt;Wrap(args.This());
    args.GetReturnValue().Set(args.This());
  } <span class="keyword">else</span> {
    <span class="comment">// Invoked as plain function `MyObject(...)`, turn into construct call.</span>
    <span class="keyword">const</span> int argc = <span class="number">1</span>;
    Local&lt;Value&gt; argv[argc] = { args[<span class="number">0</span>] };
    Local&lt;<span class="built_in">Function</span>&gt; cons = Local&lt;<span class="built_in">Function</span>&gt;::New(isolate, <span class="constructor"><span class="keyword">constructor</span>);
    args.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv));
  }
}

<span class="built_in">void</span> MyObject::PlusOne(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  MyObject* obj = ObjectWrap::Unwrap&lt;MyObject&gt;(args.Holder());
  obj-&gt;value_ += <span class="number">1</span>;

  args.GetReturnValue().Set(<span class="built_in">Number</span>::New(isolate, obj-&gt;value_));
}
</code></pre><p>Test it with:</p>
<pre><code><span class="comment">// test.js</span>
var addon = require<span class="params">('./build/Release/addon')</span>;

var obj = new addon.MyObject<span class="params">(<span class="number">10</span>)</span>;
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 11</span>
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 12</span>
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 13</span>
</code></pre><h3 id="Factory_of_wrapped_objects">Factory of wrapped objects</h3><p>This is useful when you want to be able to create native objects without<br>explicitly instantiating them with the <code>new</code> operator in JavaScript, e.g.</p>
<pre><code><span class="variable"><span class="keyword">var</span> obj</span> = addon.createObject();
<span class="comment">// instead of:</span>
<span class="comment">// var obj = new addon.Object();</span>
</code></pre><p>Let’s register our <code>createObject</code> method in <code>addon.cc</code>:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "myobject.h"</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">CreateObject</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;
  MyObject::NewInstance(args);
}

<span class="function"><span class="keyword">void</span> <span class="title">InitAll</span><span class="params">(Handle&lt;Object&gt; exports, Handle&lt;Object&gt; module)</span> </span>{
  MyObject::Init();

  NODE_SET_METHOD(module, <span class="string">"exports"</span>, CreateObject);
}

NODE_MODULE(addon, InitAll)
</code></pre><p>In <code>myobject.h</code> we now introduce the static method <code>NewInstance</code> that takes<br>care of instantiating the object (i.e. it does the job of <code>new</code> in JavaScript):</p>
<pre><code><span class="comment">// myobject.h</span>
<span class="preprocessor">#ifndef MYOBJECT_H</span>
<span class="preprocessor">#<span class="keyword">define</span> MYOBJECT_H</span>

<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node_object_wrap.h&gt;</span>

<span class="keyword">class</span> MyObject : <span class="keyword">public</span> node::ObjectWrap {
 <span class="keyword">public</span>:
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>;
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">NewInstance</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;

 <span class="keyword">private</span>:
  <span class="function"><span class="keyword">explicit</span> <span class="title">MyObject</span><span class="params">(<span class="keyword">double</span> value = 0)</span></span>;
  ~MyObject();

  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">New</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PlusOne</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="keyword">static</span> v8::Persistent&lt;v8::Function&gt; constructor;
  <span class="keyword">double</span> value_;
};

<span class="preprocessor">#<span class="keyword">endif</span></span>
</code></pre><p>The implementation is similar to the above in <code>myobject.cc</code>:</p>
<pre><code><span class="comment">// myobject.cc</span>
#include &lt;node.h&gt;
#include <span class="string">"myobject.h"</span>

using namespace v8;

Persistent&lt;<span class="built_in">Function</span>&gt; MyObject::<span class="constructor"><span class="keyword">constructor</span>;

MyObject::MyObject(double value) : value_(value) </span>{
}

MyObject::~MyObject() {
}

<span class="built_in">void</span> MyObject::Init() {
  Isolate* isolate = Isolate::GetCurrent();
  <span class="comment">// Prepare constructor template</span>
  Local&lt;FunctionTemplate&gt; tpl = FunctionTemplate::New(isolate, New);
  tpl-&gt;SetClassName(<span class="built_in">String</span>::NewFromUtf8(isolate, <span class="string">"MyObject"</span>));
  tpl-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(<span class="number">1</span>);

  <span class="comment">// Prototype</span>
  NODE_SET_PROTOTYPE_METHOD(tpl, <span class="string">"plusOne"</span>, PlusOne);

  <span class="constructor"><span class="keyword">constructor</span>.Reset(isolate, tpl-&gt;GetFunction());
}

<span class="built_in">void</span> MyObject::New(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  <span class="keyword">if</span> (args.IsConstructCall()) {
    <span class="comment">// Invoked as constructor: `new MyObject(...)`</span>
    double value = args[<span class="number">0</span>]-&gt;IsUndefined() ? <span class="number">0</span> : args[<span class="number">0</span>]-&gt;NumberValue();
    MyObject* obj = <span class="keyword">new</span> MyObject(value);
    obj-&gt;Wrap(args.This());
    args.GetReturnValue().Set(args.This());
  } <span class="keyword">else</span> {
    <span class="comment">// Invoked as plain function `MyObject(...)`, turn into construct call.</span>
    <span class="keyword">const</span> int argc = <span class="number">1</span>;
    Local&lt;Value&gt; argv[argc] = { args[<span class="number">0</span>] };
    Local&lt;<span class="built_in">Function</span>&gt; cons = Local&lt;<span class="built_in">Function</span>&gt;::New(isolate, <span class="constructor"><span class="keyword">constructor</span>);
    args.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv));
  }
}

<span class="built_in">void</span> MyObject::NewInstance(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  <span class="keyword">const</span> unsigned argc = <span class="number">1</span>;
  Handle&lt;Value&gt; argv[argc] = { args[<span class="number">0</span>] };
  Local&lt;<span class="built_in">Function</span>&gt; cons = Local&lt;<span class="built_in">Function</span>&gt;::New(isolate, <span class="constructor"><span class="keyword">constructor</span>);
  Local&lt;<span class="built_in">Object</span>&gt; instance = cons-&gt;NewInstance(argc, argv);

  args.GetReturnValue().Set(instance);
}

<span class="built_in">void</span> MyObject::PlusOne(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  MyObject* obj = ObjectWrap::Unwrap&lt;MyObject&gt;(args.Holder());
  obj-&gt;value_ += <span class="number">1</span>;

  args.GetReturnValue().Set(<span class="built_in">Number</span>::New(isolate, obj-&gt;value_));
}
</code></pre><p>Test it with:</p>
<pre><code><span class="comment">// test.js</span>
var createObject = require<span class="params">('./build/Release/addon')</span>;

var obj = createObject<span class="params">(<span class="number">10</span>)</span>;
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 11</span>
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 12</span>
console.<span class="built_in">log</span><span class="params">( obj.plusOne<span class="params">()</span> )</span>; <span class="comment">// 13</span>

var obj2 = createObject<span class="params">(<span class="number">20</span>)</span>;
console.<span class="built_in">log</span><span class="params">( obj2.plusOne<span class="params">()</span> )</span>; <span class="comment">// 21</span>
console.<span class="built_in">log</span><span class="params">( obj2.plusOne<span class="params">()</span> )</span>; <span class="comment">// 22</span>
console.<span class="built_in">log</span><span class="params">( obj2.plusOne<span class="params">()</span> )</span>; <span class="comment">// 23</span>
</code></pre><h3 id="Passing_wrapped_objects_around">Passing wrapped objects around</h3><p>In addition to wrapping and returning C++ objects, you can pass them around<br>by unwrapping them with Node’s <code>node::ObjectWrap::Unwrap</code> helper function.<br>In the following <code>addon.cc</code> we introduce a function <code>add()</code> that can take on two<br><code>MyObject</code> objects:</p>
<pre><code><span class="comment">// addon.cc</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node_object_wrap.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "myobject.h"</span>

<span class="keyword">using</span> <span class="keyword">namespace</span> v8;

<span class="function"><span class="keyword">void</span> <span class="title">CreateObject</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;
  MyObject::NewInstance(args);
}

<span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>{
  Isolate* isolate = Isolate::GetCurrent();
  <span class="function">HandleScope <span class="title">scope</span><span class="params">(isolate)</span></span>;

  MyObject* obj1 = node::ObjectWrap::Unwrap&lt;MyObject&gt;(
      args[<span class="number">0</span>]-&gt;ToObject());
  MyObject* obj2 = node::ObjectWrap::Unwrap&lt;MyObject&gt;(
      args[<span class="number">1</span>]-&gt;ToObject());

  <span class="keyword">double</span> sum = obj1-&gt;value() + obj2-&gt;value();
  args.GetReturnValue().Set(Number::New(isolate, sum));
}

<span class="function"><span class="keyword">void</span> <span class="title">InitAll</span><span class="params">(Handle&lt;Object&gt; exports)</span> </span>{
  MyObject::Init();

  NODE_SET_METHOD(exports, <span class="string">"createObject"</span>, CreateObject);
  NODE_SET_METHOD(exports, <span class="string">"add"</span>, Add);
}

NODE_MODULE(addon, InitAll)
</code></pre><p>To make things interesting we introduce a public method in <code>myobject.h</code> so we<br>can probe private values after unwrapping the object:</p>
<pre><code><span class="comment">// myobject.h</span>
<span class="preprocessor">#ifndef MYOBJECT_H</span>
<span class="preprocessor">#<span class="keyword">define</span> MYOBJECT_H</span>

<span class="preprocessor">#<span class="keyword">include</span> &lt;node.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;node_object_wrap.h&gt;</span>

<span class="keyword">class</span> MyObject : <span class="keyword">public</span> node::ObjectWrap {
 <span class="keyword">public</span>:
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>;
  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">NewInstance</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">const</span> </span>{ <span class="keyword">return</span> value_; }

 <span class="keyword">private</span>:
  <span class="function"><span class="keyword">explicit</span> <span class="title">MyObject</span><span class="params">(<span class="keyword">double</span> value = 0)</span></span>;
  ~MyObject();

  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">New</span><span class="params">(<span class="keyword">const</span> v8::FunctionCallbackInfo&lt;v8::Value&gt;&amp; args)</span></span>;
  <span class="keyword">static</span> v8::Persistent&lt;v8::Function&gt; constructor;
  <span class="keyword">double</span> value_;
};

<span class="preprocessor">#<span class="keyword">endif</span></span>
</code></pre><p>The implementation of <code>myobject.cc</code> is similar as before:</p>
<pre><code><span class="comment">// myobject.cc</span>
#include &lt;node.h&gt;
#include <span class="string">"myobject.h"</span>

using namespace v8;

Persistent&lt;<span class="built_in">Function</span>&gt; MyObject::<span class="constructor"><span class="keyword">constructor</span>;

MyObject::MyObject(double value) : value_(value) </span>{
}

MyObject::~MyObject() {
}

<span class="built_in">void</span> MyObject::Init() {
  Isolate* isolate = Isolate::GetCurrent();

  <span class="comment">// Prepare constructor template</span>
  Local&lt;FunctionTemplate&gt; tpl = FunctionTemplate::New(isolate, New);
  tpl-&gt;SetClassName(<span class="built_in">String</span>::NewFromUtf8(isolate, <span class="string">"MyObject"</span>));
  tpl-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(<span class="number">1</span>);

  <span class="constructor"><span class="keyword">constructor</span>.Reset(isolate, tpl-&gt;GetFunction());
}

<span class="built_in">void</span> MyObject::New(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  <span class="keyword">if</span> (args.IsConstructCall()) {
    <span class="comment">// Invoked as constructor: `new MyObject(...)`</span>
    double value = args[<span class="number">0</span>]-&gt;IsUndefined() ? <span class="number">0</span> : args[<span class="number">0</span>]-&gt;NumberValue();
    MyObject* obj = <span class="keyword">new</span> MyObject(value);
    obj-&gt;Wrap(args.This());
    args.GetReturnValue().Set(args.This());
  } <span class="keyword">else</span> {
    <span class="comment">// Invoked as plain function `MyObject(...)`, turn into construct call.</span>
    <span class="keyword">const</span> int argc = <span class="number">1</span>;
    Local&lt;Value&gt; argv[argc] = { args[<span class="number">0</span>] };
    Local&lt;<span class="built_in">Function</span>&gt; cons = Local&lt;<span class="built_in">Function</span>&gt;::New(isolate, <span class="constructor"><span class="keyword">constructor</span>);
    args.GetReturnValue().Set(cons-&gt;NewInstance(argc, argv));
  }
}

<span class="built_in">void</span> MyObject::NewInstance(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args) </span>{
  Isolate* isolate = Isolate::GetCurrent();
  HandleScope scope(isolate);

  <span class="keyword">const</span> unsigned argc = <span class="number">1</span>;
  Handle&lt;Value&gt; argv[argc] = { args[<span class="number">0</span>] };
  Local&lt;<span class="built_in">Function</span>&gt; cons = Local&lt;<span class="built_in">Function</span>&gt;::New(isolate, <span class="constructor"><span class="keyword">constructor</span>);
  Local&lt;<span class="built_in">Object</span>&gt; instance = cons-&gt;NewInstance(argc, argv);

  args.GetReturnValue().Set(instance);
}</span>
</code></pre><p>Test it with:</p>
<pre><code>// test.js
<span class="keyword">var</span> addon = require('./build/<span class="type">Release</span>/addon');

<span class="keyword">var</span> obj1 = addon.createObject(<span class="number">10</span>);
<span class="keyword">var</span> obj2 = addon.createObject(<span class="number">20</span>);
<span class="keyword">var</span> <span class="literal">result</span> = addon.add(obj1, obj2);

console.log(<span class="literal">result</span>); // <span class="number">30</span>
</code></pre><h1 id="process-1"><a id="process">process</a></h1><!-- type=global -->
<p>The <code>process</code> object is a global object and can be accessed from anywhere.<br>It is an instance of <a href="events.html#events_class_events_eventemitter">EventEmitter</a>.</p>
<h2 id="Exit_Codes">Exit Codes</h2><p>Node will normally exit with a <code>0</code> status code when no more async<br>operations are pending.  The following status codes are used in other<br>cases:</p>
<ul>
<li><code>1</code> <strong>Uncaught Fatal Exception</strong> - There was an uncaught exception,<br>and it was not handled by a domain or an <code>uncaughtException</code> event<br>handler.</li>
<li><code>2</code> - Unused (reserved by Bash for builtin misuse)</li>
<li><code>3</code> <strong>Internal JavaScript Parse Error</strong> - The JavaScript source code<br>internal in Node’s bootstrapping process caused a parse error.  This<br>is extremely rare, and generally can only happen during development<br>of Node itself.</li>
<li><code>4</code> <strong>Internal JavaScript Evaluation Failure</strong> - The JavaScript<br>source code internal in Node’s bootstrapping process failed to<br>return a function value when evaluated.  This is extremely rare, and<br>generally can only happen during development of Node itself.</li>
<li><code>5</code> <strong>Fatal Error</strong> - There was a fatal unrecoverable error in V8.<br>Typically a message will be printed to stderr with the prefix <code>FATAL
ERROR</code>.</li>
<li><code>6</code> <strong>Non-function Internal Exception Handler</strong> - There was an<br>uncaught exception, but the internal fatal exception handler<br>function was somehow set to a non-function, and could not be called.</li>
<li><code>7</code> <strong>Internal Exception Handler Run-Time Failure</strong> - There was an<br>uncaught exception, and the internal fatal exception handler<br>function itself threw an error while attempting to handle it.  This<br>can happen, for example, if a <code>process.on(&#39;uncaughtException&#39;)</code> or<br><code>domain.on(&#39;error&#39;)</code> handler throws an error.</li>
<li><code>8</code> - Unused.  In previous versions of Node, exit code 8 sometimes<br>indicated an uncaught exception.</li>
<li><code>9</code> - <strong>Invalid Argument</strong> - Either an unknown option was specified,<br>or an option requiring a value was provided without a value.</li>
<li><code>10</code> <strong>Internal JavaScript Run-Time Failure</strong> - The JavaScript<br>source code internal in Node’s bootstrapping process threw an error<br>when the bootstrapping function was called.  This is extremely rare,<br>and generally can only happen during development of Node itself.</li>
<li><code>12</code> <strong>Invalid Debug Argument</strong> - The <code>--debug</code> and/or <code>--debug-brk</code><br>options were set, but an invalid port number was chosen.</li>
<li><code>&gt;128</code> <strong>Signal Exits</strong> - If Node receives a fatal signal such as<br><code>SIGKILL</code> or <code>SIGHUP</code>, then its exit code will be <code>128</code> plus the<br>value of the signal code.  This is a standard Unix practice, since<br>exit codes are defined to be 7-bit integers, and signal exits set<br>the high-order bit, and then contain the value of the signal code.</li>
</ul>
<h2 id="Event:_‘exit’">Event: ‘exit’</h2><p>Emitted when the process is about to exit. There is no way to prevent the<br>exiting of the event loop at this point, and once all <code>exit</code> listeners have<br>finished running the process will exit. Therefore you <strong>must</strong> only perform<br><strong>synchronous</strong> operations in this handler. This is a good hook to perform<br>checks on the module’s state (like for unit tests). The callback takes one<br>argument, the code the process is exiting with.</p>
<p>Example of listening for <code>exit</code>:</p>
<pre><code>process.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>{
  <span class="comment">// do *NOT* do this</span>
  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'This will not run'</span>);
  }, <span class="number">0</span>);
  <span class="built_in">console</span>.log(<span class="string">'About to exit with code:'</span>, code);
});
</code></pre><h2 id="Event:_‘beforeExit’">Event: ‘beforeExit’</h2><p>This event is emitted when node empties it’s event loop and has nothing else to<br>schedule. Normally, node exits when there is no work scheduled, but a listener<br>for ‘beforeExit’ can make asynchronous calls, and cause node to continue.</p>
<p>‘beforeExit’ is not emitted for conditions causing explicit termination, such as<br><code>process.exit()</code> or uncaught exceptions, and should not be used as an<br>alternative to the ‘exit’ event unless the intention is to schedule more work.</p>
<h2 id="Event:_‘uncaughtException’">Event: ‘uncaughtException’</h2><p>Emitted when an exception bubbles all the way back to the event loop. If a<br>listener is added for this exception, the default action (which is to print<br>a stack trace and exit) will not occur.</p>
<p>Example of listening for <code>uncaughtException</code>:</p>
<pre><code>process.on(<span class="string">'uncaughtException'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Caught exception: '</span> + err);
});

setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'This will still run.'</span>);
}, <span class="number">500</span>);

<span class="comment">// Intentionally cause an exception, but don't catch it.</span>
nonexistentFunc();
<span class="built_in">console</span>.log(<span class="string">'This will not run.'</span>);
</code></pre><p>Note that <code>uncaughtException</code> is a very crude mechanism for exception<br>handling.</p>
<p>Don’t use it, use <a href="domain.html">domains</a> instead. If you do use it, restart<br>your application after every unhandled exception!</p>
<p>Do <em>not</em> use it as the node.js equivalent of <code>On Error Resume Next</code>. An<br>unhandled exception means your application - and by extension node.js itself -<br>is in an undefined state. Blindly resuming means <em>anything</em> could happen.</p>
<p>Think of resuming as pulling the power cord when you are upgrading your system.<br>Nine out of ten times nothing happens - but the 10th time, your system is bust.</p>
<p>You have been warned.</p>
<h2 id="Signal_Events">Signal Events</h2><!--type=event-->
<!--name=SIGINT, SIGHUP, etc.-->
<p>Emitted when the processes receives a signal. See sigaction(2) for a list of<br>standard POSIX signal names such as SIGINT, SIGHUP, etc.</p>
<p>Example of listening for <code>SIGINT</code>:</p>
<pre><code><span class="comment">// Start reading from stdin so we don't exit.</span>
process.stdin.resume();

process.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Got SIGINT.  Press Control-D to exit.'</span>);
});
</code></pre><p>An easy way to send the <code>SIGINT</code> signal is with <code>Control-C</code> in most terminal<br>programs.</p>
<p>Note:</p>
<ul>
<li><code>SIGUSR1</code> is reserved by node.js to start the debugger.  It’s possible to<br>install a listener but that won’t stop the debugger from starting.</li>
<li><code>SIGTERM</code> and <code>SIGINT</code> have default handlers on non-Windows platforms that resets<br>the terminal mode before exiting with code <code>128 + signal number</code>. If one of<br>these signals has a listener installed, its default behaviour will be removed<br>(node will no longer exit).</li>
<li><code>SIGPIPE</code> is ignored by default, it can have a listener installed.</li>
<li><code>SIGHUP</code> is generated on Windows when the console window is closed, and on other<br>platforms under various similar conditions, see signal(7). It can have a<br>listener installed, however node will be unconditionally terminated by Windows<br>about 10 seconds later. On non-Windows platforms, the default behaviour of<br><code>SIGHUP</code> is to terminate node, but once a listener has been installed its<br>default behaviour will be removed.</li>
<li><code>SIGTERM</code> is not supported on Windows, it can be listened on.</li>
<li><code>SIGINT</code> from the terminal is supported on all platforms, and can usually be<br>generated with <code>CTRL+C</code> (though this may be configurable). It is not generated<br>when terminal raw mode is enabled.</li>
<li><code>SIGBREAK</code> is delivered on Windows when <code>CTRL+BREAK</code> is pressed, on non-Windows<br>platforms it can be listened on, but there is no way to send or generate it.</li>
<li><code>SIGWINCH</code> is delivered when the console has been resized. On Windows, this will<br>only happen on write to the console when the cursor is being moved, or when a<br>readable tty is used in raw mode.</li>
<li><code>SIGKILL</code> cannot have a listener installed, it will unconditionally terminate<br>node on all platforms.</li>
<li><code>SIGSTOP</code> cannot have a listener installed.</li>
</ul>
<p>Note that Windows does not support sending Signals, but node offers some<br>emulation with <code>process.kill()</code>, and <code>child_process.kill()</code>:</p>
<ul>
<li>Sending signal <code>0</code> can be used to search for the existence of a process</li>
<li>Sending <code>SIGINT</code>, <code>SIGTERM</code>, and <code>SIGKILL</code> cause the unconditional exit of the<br>target process.</li>
</ul>
<h2 id="process-stdout">process.stdout</h2><p>A <code>Writable Stream</code> to <code>stdout</code> (on fd <code>1</code>).</p>
<p>Example: the definition of <code>console.log</code></p>
<pre><code>console.<span class="built_in">log</span> = <span class="function"><span class="keyword">function</span><span class="params">(d)</span></span> {
  process.stdout.<span class="built_in">write</span>(d + <span class="string">'\n'</span>);
};
</code></pre><p><code>process.stderr</code> and <code>process.stdout</code> are unlike other streams in Node in<br>that they cannot be closed (<code>end()</code> will throw), they never emit the <code>finish</code><br>event and that writes are usually blocking.</p>
<ul>
<li>They are blocking in the case that they refer to regular files or TTY file<br>descriptors.</li>
<li>In the case they refer to pipes:<ul>
<li>They are blocking in Linux/Unix.</li>
<li>They are non-blocking like other streams in Windows.</li>
</ul>
</li>
</ul>
<p>To check if Node is being run in a TTY context, read the <code>isTTY</code> property<br>on <code>process.stderr</code>, <code>process.stdout</code>, or <code>process.stdin</code>:</p>
<pre><code><span class="variable">$ </span>node -p <span class="string">"Boolean(process.stdin.isTTY)"</span>
<span class="keyword">true</span>
<span class="variable">$ </span>echo <span class="string">"foo"</span> | node -p <span class="string">"Boolean(process.stdin.isTTY)"</span>
<span class="keyword">false</span>

<span class="variable">$ </span>node -p <span class="string">"Boolean(process.stdout.isTTY)"</span>
<span class="keyword">true</span>
<span class="variable">$ </span>node -p <span class="string">"Boolean(process.stdout.isTTY)"</span> | cat
<span class="keyword">false</span>
</code></pre><p>See <a href="tty.html#tty_tty">the tty docs</a> for more information.</p>
<h2 id="process-stderr">process.stderr</h2><p>A writable stream to stderr (on fd <code>2</code>).</p>
<p><code>process.stderr</code> and <code>process.stdout</code> are unlike other streams in Node in<br>that they cannot be closed (<code>end()</code> will throw), they never emit the <code>finish</code><br>event and that writes are usually blocking.</p>
<ul>
<li>They are blocking in the case that they refer to regular files or TTY file<br>descriptors.</li>
<li>In the case they refer to pipes:<ul>
<li>They are blocking in Linux/Unix.</li>
<li>They are non-blocking like other streams in Windows.</li>
</ul>
</li>
</ul>
<h2 id="process-stdin">process.stdin</h2><p>A <code>Readable Stream</code> for stdin (on fd <code>0</code>).</p>
<p>Example of opening standard input and listening for both events:</p>
<pre><code>process.stdin.setEncoding(<span class="string">'utf8'</span>);

process.stdin.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> chunk = process.stdin.read();
  <span class="keyword">if</span> (chunk !== <span class="literal">null</span>) {
    process.stdout.write(<span class="string">'data: '</span> + chunk);
  }
});

process.stdin.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  process.stdout.write(<span class="string">'end'</span>);
});
</code></pre><p>As a Stream, <code>process.stdin</code> can also be used in “old” mode that is compatible<br>with scripts written for node prior v0.10.<br>For more information see<br><a href="stream.html#stream_compatibility_with_older_node_versions">Stream compatibility</a>.</p>
<p>In “old” Streams mode the stdin stream is paused by default, so one<br>must call <code>process.stdin.resume()</code> to read from it. Note also that calling<br><code>process.stdin.resume()</code> itself would switch stream to “old” mode.</p>
<p>If you are starting a new project you should prefer a more recent “new” Streams<br>mode over “old” one.</p>
<h2 id="process-argv">process.argv</h2><p>An array containing the command line arguments.  The first element will be<br>‘node’, the second element will be the name of the JavaScript file.  The<br>next elements will be any additional command line arguments.</p>
<pre><code>// <span class="keyword">print</span> process.<span class="built_in">argv</span>
process.<span class="built_in">argv</span>.forEach(<span class="function"><span class="keyword">function</span><span class="params">(val, index, array)</span> {</span>
  console.<span class="built_in">log</span>(<span class="built_in">index</span> + <span class="string">': '</span> + val);
});
</code></pre><p>This will generate:</p>
<pre><code>$ node <span class="built_in">process</span>-<span class="number">2.</span>js <span class="constant">one</span> <span class="constant">two</span>=<span class="constant">three</span> <span class="constant">four</span>
<span class="number">0</span>: node
<span class="number">1</span>: /Users/mjr/work/node/<span class="built_in">process</span>-<span class="number">2.</span>js
<span class="number">2</span>: <span class="constant">one</span>
<span class="number">3</span>: <span class="constant">two</span>=<span class="constant">three</span>
<span class="number">4</span>: <span class="constant">four</span>
</code></pre><h2 id="process-execPath">process.execPath</h2><p>This is the absolute pathname of the executable that started the process.</p>
<p>Example:</p>
<pre><code><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>node
</code></pre><h2 id="process-execArgv">process.execArgv</h2><p>This is the set of node-specific command line options from the<br>executable that started the process.  These options do not show up in<br><code>process.argv</code>, and do not include the node executable, the name of<br>the script, or any options following the script name. These options<br>are useful in order to spawn child processes with the same execution<br>environment as the parent.</p>
<p>Example:</p>
<pre><code><span class="comment">$</span> <span class="comment">node</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">harmony</span> <span class="comment">script</span><span class="string">.</span><span class="comment">js</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">version</span>
</code></pre><p>results in process.execArgv:</p>
<pre><code>[&#39;--harmony&#39;]
</code></pre><p>and process.argv:</p>
<pre><code>[&#39;/usr/local/bin/node&#39;, &#39;script.js&#39;, &#39;--version&#39;]
</code></pre><h2 id="process-abort()">process.abort()</h2><p>This causes node to emit an abort. This will cause node to exit and<br>generate a core file.</p>
<h2 id="process-chdir(directory)">process.chdir(directory)</h2><p>Changes the current working directory of the process or throws an exception if that fails.</p>
<pre><code>console.<span class="built_in">log</span><span class="params">('Starting directory: ' + process.cwd<span class="params">()</span>)</span>;
try {
  process.chdir<span class="params">('/tmp')</span>;
  console.<span class="built_in">log</span><span class="params">('New directory: ' + process.cwd<span class="params">()</span>)</span>;
}
catch <span class="params">(err)</span> {
  console.<span class="built_in">log</span><span class="params">('chdir: ' + err)</span>;
}
</code></pre><h2 id="process-cwd()">process.cwd()</h2><p>Returns the current working directory of the process.</p>
<pre><code>console.<span class="built_in">log</span><span class="params">('Current directory: ' + process.cwd<span class="params">()</span>)</span>;
</code></pre><h2 id="process-env">process.env</h2><p>An object containing the user environment. See environ(7).</p>
<p>An example of this object looks like:</p>
<pre><code><span class="xml"></span><span class="expression">{ <span class="variable">TERM</span>: '<span class="variable">xterm-</span>256<span class="variable">color</span>',
  <span class="variable">SHELL</span>: '<span class="end-block">/usr</span><span class="end-block">/local</span><span class="end-block">/bin</span><span class="end-block">/bash</span>',
  <span class="variable">USER</span>: '<span class="variable">maciej</span>',
  <span class="variable">PATH</span>: '~<span class="end-block">/.bin</span>/:<span class="end-block">/usr</span><span class="end-block">/bin</span>:<span class="end-block">/bin</span>:<span class="end-block">/usr</span><span class="end-block">/sbin</span>:<span class="end-block">/sbin</span>:<span class="end-block">/usr</span><span class="end-block">/local</span><span class="end-block">/bin</span>',
  <span class="variable">PWD</span>: '<span class="end-block">/Users</span><span class="end-block">/maciej</span>',
  <span class="variable">EDITOR</span>: '<span class="variable">vim</span>',
  <span class="variable">SHLVL</span>: '1',
  <span class="variable">HOME</span>: '<span class="end-block">/Users</span><span class="end-block">/maciej</span>',
  <span class="variable">LOGNAME</span>: '<span class="variable">maciej</span>',
  _: '<span class="end-block">/usr</span><span class="end-block">/local</span><span class="end-block">/bin</span><span class="end-block">/node</span>' }</span><span class="xml"></span>
</code></pre><p>You can write to this object, but changes won’t be reflected outside of your<br>process. That means that the following won’t work:</p>
<pre><code>node <span class="operator">-e</span> <span class="string">'process.env.foo = "bar"'</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$foo</span>
</code></pre><p>But this will:</p>
<pre><code>process.<span class="keyword">env</span>.foo = <span class="string">'bar'</span>;
console.<span class="keyword">log</span>(process.<span class="keyword">env</span>.foo);
</code></pre><h2 id="process-exit([code])">process.exit([code])</h2><p>Ends the process with the specified <code>code</code>.  If omitted, exit uses the<br>‘success’ code <code>0</code>.</p>
<p>To exit with a ‘failure’ code:</p>
<pre><code><span class="keyword">process</span>.<span class="keyword">exit</span>(<span class="number">1</span>);
</code></pre><p>The shell that executed node should see the exit code as 1.</p>
<h2 id="process-exitCode">process.exitCode</h2><p>A number which will be the process exit code, when the process either<br>exits gracefully, or is exited via <code>process.exit()</code> without specifying<br>a code.</p>
<p>Specifying a code to <code>process.exit(code)</code> will override any previous<br>setting of <code>process.exitCode</code>.</p>
<h2 id="process-getgid()">process.getgid()</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Gets the group identity of the process. (See getgid(2).)<br>This is the numerical group id, not the group name.</p>
<pre><code><span class="keyword">if</span> <span class="params">(process.getgid)</span> {
  console.<span class="built_in">log</span><span class="params">('Current gid: ' + process.getgid<span class="params">()</span>)</span>;
}
</code></pre><h2 id="process-setgid(id)">process.setgid(id)</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Sets the group identity of the process. (See setgid(2).)  This accepts either<br>a numerical ID or a groupname string. If a groupname is specified, this method<br>blocks while resolving it to a numerical ID.</p>
<pre><code><span class="keyword">if</span> <span class="params">(process.getgid &amp;&amp; process.setgid)</span> {
  console.<span class="built_in">log</span><span class="params">('Current gid: ' + process.getgid<span class="params">()</span>)</span>;
  try {
    process.setgid<span class="params">(<span class="number">501</span>)</span>;
    console.<span class="built_in">log</span><span class="params">('New gid: ' + process.getgid<span class="params">()</span>)</span>;
  }
  catch <span class="params">(err)</span> {
    console.<span class="built_in">log</span><span class="params">('Failed to set gid: ' + err)</span>;
  }
}
</code></pre><h2 id="process-getuid()">process.getuid()</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Gets the user identity of the process. (See getuid(2).)<br>This is the numerical userid, not the username.</p>
<pre><code><span class="keyword">if</span> <span class="params">(process.getuid)</span> {
  console.<span class="built_in">log</span><span class="params">('Current uid: ' + process.getuid<span class="params">()</span>)</span>;
}
</code></pre><h2 id="process-setuid(id)">process.setuid(id)</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Sets the user identity of the process. (See setuid(2).)  This accepts either<br>a numerical ID or a username string.  If a username is specified, this method<br>blocks while resolving it to a numerical ID.</p>
<pre><code><span class="keyword">if</span> <span class="params">(process.getuid &amp;&amp; process.setuid)</span> {
  console.<span class="built_in">log</span><span class="params">('Current uid: ' + process.getuid<span class="params">()</span>)</span>;
  try {
    process.setuid<span class="params">(<span class="number">501</span>)</span>;
    console.<span class="built_in">log</span><span class="params">('New uid: ' + process.getuid<span class="params">()</span>)</span>;
  }
  catch <span class="params">(err)</span> {
    console.<span class="built_in">log</span><span class="params">('Failed to set uid: ' + err)</span>;
  }
}
</code></pre><h2 id="process-getgroups()">process.getgroups()</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Returns an array with the supplementary group IDs. POSIX leaves it unspecified<br>if the effective group ID is included but node.js ensures it always is.</p>
<h2 id="process-setgroups(groups)">process.setgroups(groups)</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Sets the supplementary group IDs. This is a privileged operation, meaning you<br>need to be root or have the CAP_SETGID capability.</p>
<p>The list can contain group IDs, group names or both.</p>
<h2 id="process-initgroups(user,_extra_group)">process.initgroups(user, extra_group)</h2><p>Note: this function is only available on POSIX platforms (i.e. not Windows,<br>Android)</p>
<p>Reads /etc/group and initializes the group access list, using all groups of<br>which the user is a member. This is a privileged operation, meaning you need<br>to be root or have the CAP_SETGID capability.</p>
<p><code>user</code> is a user name or user ID. <code>extra_group</code> is a group name or group ID.</p>
<p>Some care needs to be taken when dropping privileges. Example:</p>
<pre><code>console.<span class="built_in">log</span><span class="params">(process.getgroups<span class="params">()</span>)</span>;         <span class="comment">// [ 0 ]</span>
process.initgroups<span class="params">('bnoordhuis', <span class="number">1000</span>)</span>;   <span class="comment">// switch user</span>
console.<span class="built_in">log</span><span class="params">(process.getgroups<span class="params">()</span>)</span>;         <span class="comment">// [ 27, 30, 46, 1000, 0 ]</span>
process.setgid<span class="params">(<span class="number">1000</span>)</span>;                     <span class="comment">// drop root gid</span>
console.<span class="built_in">log</span><span class="params">(process.getgroups<span class="params">()</span>)</span>;         <span class="comment">// [ 27, 30, 46, 1000 ]</span>
</code></pre><h2 id="process-version">process.version</h2><p>A compiled-in property that exposes <code>NODE_VERSION</code>.</p>
<pre><code>console.<span class="literal">log</span>('<span class="keyword">Version</span>: ' + process.<span class="keyword">version</span>);
</code></pre><h2 id="process-versions">process.versions</h2><p>A property exposing version strings of node and its dependencies.</p>
<pre><code><span class="tag">console</span><span class="class">.log</span>(<span class="tag">process</span><span class="class">.versions</span>);
</code></pre><p>Will print something like:</p>
<pre><code>{ <span class="attribute">http_parser</span>: <span class="string">'1.0'</span>,
  <span class="attribute">node</span>: <span class="string">'0.10.4'</span>,
  <span class="attribute">v8</span>: <span class="string">'3.14.5.8'</span>,
  <span class="attribute">ares</span>: <span class="string">'1.9.0-DEV'</span>,
  <span class="attribute">uv</span>: <span class="string">'0.10.3'</span>,
  <span class="attribute">zlib</span>: <span class="string">'1.2.3'</span>,
  <span class="attribute">modules</span>: <span class="string">'11'</span>,
  <span class="attribute">openssl</span>: <span class="string">'1.0.1e'</span> }
</code></pre><h2 id="process-config">process.config</h2><p>An Object containing the JavaScript representation of the configure options<br>that were used to compile the current node executable. This is the same as<br>the “config.gypi” file that was produced when running the <code>./configure</code> script.</p>
<p>An example of the possible output looks like:</p>
<pre><code>{ target_defaults:
   { cflags: [],
     default_configuration: '<span class="operator"><span class="keyword">Release</span><span class="string">',
     defines: [],
     include_dirs: [],
     libraries: [] },
  variables:
   { host_arch: '</span>x64<span class="string">',
     node_install_npm: '</span><span class="literal">true</span><span class="string">',
     node_prefix: '',
     node_shared_cares: '</span><span class="literal">false</span><span class="string">',
     node_shared_http_parser: '</span><span class="literal">false</span><span class="string">',
     node_shared_libuv: '</span><span class="literal">false</span><span class="string">',
     node_shared_v8: '</span><span class="literal">false</span><span class="string">',
     node_shared_zlib: '</span><span class="literal">false</span><span class="string">',
     node_use_dtrace: '</span><span class="literal">false</span><span class="string">',
     node_use_openssl: '</span><span class="literal">true</span><span class="string">',
     node_shared_openssl: '</span><span class="literal">false</span><span class="string">',
     strict_aliasing: '</span><span class="literal">true</span><span class="string">',
     target_arch: '</span>x64<span class="string">',
     v8_use_snapshot: '</span><span class="literal">true</span><span class="string">' } }</span></span>
</code></pre><h2 id="process-kill(pid[,_signal])">process.kill(pid[, signal])</h2><p>Send a signal to a process. <code>pid</code> is the process id and <code>signal</code> is the<br>string describing the signal to send.  Signal names are strings like<br>‘SIGINT’ or ‘SIGHUP’.  If omitted, the signal will be ‘SIGTERM’.<br>See <a href="#process_signal_events">Signal Events</a> and kill(2) for more information.</p>
<p>Will throw an error if target does not exist, and as a special case, a signal of<br><code>0</code> can be used to test for the existence of a process.</p>
<p>Note that just because the name of this function is <code>process.kill</code>, it is<br>really just a signal sender, like the <code>kill</code> system call.  The signal sent<br>may do something other than kill the target process.</p>
<p>Example of sending a signal to yourself:</p>
<pre><code>process.on(<span class="string">'SIGHUP'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Got SIGHUP signal.'</span>);
});

setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Exiting.'</span>);
  process.exit(<span class="number">0</span>);
}, <span class="number">100</span>);

process.kill(process.pid, <span class="string">'SIGHUP'</span>);
</code></pre><p>Note: When SIGUSR1 is received by Node.js it starts the debugger, see<br><a href="#process_signal_events">Signal Events</a>.</p>
<h2 id="process-pid">process.pid</h2><p>The PID of the process.</p>
<pre><code>console.log(<span class="attribute">'This</span> <span class="keyword">process</span> <span class="keyword">is</span> pid ' + <span class="keyword">process</span>.pid);
</code></pre><h2 id="process-title">process.title</h2><p>Getter/setter to set what is displayed in ‘ps’.</p>
<p>When used as a setter, the maximum length is platform-specific and probably<br>short.</p>
<p>On Linux and OS X, it’s limited to the size of the binary name plus the<br>length of the command line arguments because it overwrites the argv memory.</p>
<p>v0.8 allowed for longer process title strings by also overwriting the environ<br>memory but that was potentially insecure/confusing in some (rather obscure)<br>cases.</p>
<h2 id="process-arch">process.arch</h2><p>What processor architecture you’re running on: <code>&#39;arm&#39;</code>, <code>&#39;ia32&#39;</code>, or <code>&#39;x64&#39;</code>.</p>
<pre><code>console.log(<span class="attribute">'This</span> processor <span class="keyword">architecture</span> <span class="keyword">is</span> ' + <span class="keyword">process</span>.arch);
</code></pre><h2 id="process-platform">process.platform</h2><p>What platform you’re running on:<br><code>&#39;darwin&#39;</code>, <code>&#39;freebsd&#39;</code>, <code>&#39;linux&#39;</code>, <code>&#39;sunos&#39;</code> or <code>&#39;win32&#39;</code></p>
<pre><code>console.log(<span class="attribute">'This</span> platform <span class="keyword">is</span> ' + <span class="keyword">process</span>.platform);
</code></pre><h2 id="process-memoryUsage()">process.memoryUsage()</h2><p>Returns an object describing the memory usage of the Node process<br>measured in bytes.</p>
<pre><code>var util = require<span class="params">('util')</span>;

console.<span class="built_in">log</span><span class="params">(util.inspect<span class="params">(process.memoryUsage<span class="params">()</span>)</span>)</span>;
</code></pre><p>This will generate:</p>
<pre><code>{ <span class="attribute">rss</span>: <span class="number">4935680</span>,
  <span class="attribute">heapTotal</span>: <span class="number">1826816</span>,
  <span class="attribute">heapUsed</span>: <span class="number">650472</span> }
</code></pre><p><code>heapTotal</code> and <code>heapUsed</code> refer to V8’s memory usage.</p>
<h2 id="process-nextTick(callback)">process.nextTick(callback)</h2><ul>
<li><code>callback</code> {Function}</li>
</ul>
<p>Once the current event loop turn runs to completion, call the callback<br>function.</p>
<p>This is <em>not</em> a simple alias to <code>setTimeout(fn, 0)</code>, it’s much more<br>efficient.  It runs before any additional I/O events (including<br>timers) fire in subsequent ticks of the event loop.</p>
<pre><code><span class="built_in">console</span>.log(<span class="string">'start'</span>);
process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'nextTick callback'</span>);
});
<span class="built_in">console</span>.log(<span class="string">'scheduled'</span>);
<span class="comment">// Output:</span>
<span class="comment">// start</span>
<span class="comment">// scheduled</span>
<span class="comment">// nextTick callback</span>
</code></pre><p>This is important in developing APIs where you want to give the user the<br>chance to assign event handlers after an object has been constructed,<br>but before any I/O has occurred.</p>
<pre><code>function MyThing(options) {
  this.setupOptions(options);

  process.nextTick(function() {
    this.startDoingStuff();
  }.bind(this));
}

var <span class="keyword">thing</span> = new MyThing();
<span class="keyword">thing</span>.getReadyForStuff();

// <span class="keyword">thing</span>.startDoingStuff() gets called now, not before.
</code></pre><p>It is very important for APIs to be either 100% synchronous or 100%<br>asynchronous.  Consider this example:</p>
<pre><code><span class="comment">// WARNING!  DO NOT USE!  BAD UNSAFE HAZARD!</span>
<span class="function"><span class="keyword">function</span> <span class="title">maybeSync</span><span class="params">(arg, cb)</span> {</span>
  <span class="keyword">if</span> <span class="params">(arg)</span> {
    cb<span class="params">()</span>;
    return;
  }

  fs.stat<span class="params">('file', cb)</span>;
}
</code></pre><p>This API is hazardous.  If you do this:</p>
<pre><code>maybeSync<span class="list">(<span class="keyword">true</span>, function<span class="list">()</span> {
  foo<span class="list">()</span><span class="comment">;</span>
})</span><span class="comment">;</span>
bar<span class="list">()</span><span class="comment">;</span>
</code></pre><p>then it’s not clear whether <code>foo()</code> or <code>bar()</code> will be called first.</p>
<p>This approach is much better:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">definitelyAsync</span><span class="params">(arg, cb)</span> {</span>
  <span class="keyword">if</span> <span class="params">(arg)</span> {
    process.nextTick<span class="params">(cb)</span>;
    return;
  }

  fs.stat<span class="params">('file', cb)</span>;
}
</code></pre><p>Note: the nextTick queue is completely drained on each pass of the<br>event loop <strong>before</strong> additional I/O is processed.  As a result,<br>recursively setting nextTick callbacks will block any I/O from<br>happening, just like a <code>while(true);</code> loop.</p>
<h2 id="process-umask([mask])">process.umask([mask])</h2><p>Sets or reads the process’s file mode creation mask. Child processes inherit<br>the mask from the parent process. Returns the old mask if <code>mask</code> argument is<br>given, otherwise returns the current mask.</p>
<pre><code>var oldmask, newmask = <span class="number">0022</span>;

oldmask = process.umask<span class="params">(newmask)</span>;
console.<span class="built_in">log</span><span class="params">('Changed umask from: ' + oldmask.toString<span class="params">(<span class="number">8</span>)</span> +
            ' to ' + newmask.toString<span class="params">(<span class="number">8</span>)</span>)</span>;
</code></pre><h2 id="process-uptime()">process.uptime()</h2><p>Number of seconds Node has been running.</p>
<h2 id="process-hrtime()">process.hrtime()</h2><p>Returns the current high-resolution real time in a <code>[seconds, nanoseconds]</code><br>tuple Array. It is relative to an arbitrary time in the past. It is not<br>related to the time of day and therefore not subject to clock drift. The<br>primary use is for measuring performance between intervals.</p>
<p>You may pass in the result of a previous call to <code>process.hrtime()</code> to get<br>a diff reading, useful for benchmarks and measuring intervals:</p>
<pre><code><span class="keyword">var</span> time = process.hrtime();
<span class="comment">// [ 1800216, 25 ]</span>

setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="keyword">var</span> diff = process.hrtime(time);
  <span class="comment">// [ 1, 552 ]</span>

  <span class="built_in">console</span>.log(<span class="string">'benchmark took %d nanoseconds'</span>, diff[<span class="number">0</span>] * <span class="number">1e9</span> + diff[<span class="number">1</span>]);
  <span class="comment">// benchmark took 1000000527 nanoseconds</span>
}, <span class="number">1000</span>);
</code></pre><h2 id="process-mainModule">process.mainModule</h2><p>Alternate way to retrieve<br><a href="modules.html#modules_accessing_the_main_module"><code>require.main</code></a>.<br>The difference is that if the main module changes at runtime, <code>require.main</code><br>might still refer to the original main module in modules that were required<br>before the change occurred. Generally it’s safe to assume that the two refer<br>to the same module.</p>
<p>As with <code>require.main</code>, it will be <code>undefined</code> if there was no entry script.</p>
<h1 id="util"><a id="util">util</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">4 - API Frozen</span>
</code></pre><p>These functions are in the module <code>&#39;util&#39;</code>. Use <code>require(&#39;util&#39;)</code> to<br>access them.</p>
<p>The <code>util</code> module is primarily designed to support the needs of Node’s<br>internal APIs.  Many of these utilities are useful for your own<br>programs.  If you find that these functions are lacking for your<br>purposes, however, you are encouraged to write your own utilities.  We<br>are not interested in any future additions to the <code>util</code> module that<br>are unnecessary for Node’s internal functionality.</p>
<h2 id="util-debuglog(section)">util.debuglog(section)</h2><ul>
<li><code>section</code> {String} The section of the program to be debugged</li>
<li>Returns: {Function} The logging function</li>
</ul>
<p>This is used to create a function which conditionally writes to stderr<br>based on the existence of a <code>NODE_DEBUG</code> environment variable.  If the<br><code>section</code> name appears in that environment variable, then the returned<br>function will be similar to <code>console.error()</code>.  If not, then the<br>returned function is a no-op.</p>
<p>For example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debuglog = util.debuglog(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="number">123</span>;</span><br><span class="line">debuglog(<span class="string">'hello from foo [%d]'</span>, bar);</span><br></pre></td></tr></table></figure>
<p>If this program is run with <code>NODE_DEBUG=foo</code> in the environment, then<br>it will output something like:</p>
<pre><code><span class="keyword">FOO</span> 3245: hello from foo<span class="sqbracket"> [123]</span>
</code></pre><p>where <code>3245</code> is the process id.  If it is not run with that<br>environment variable set, then it will not print anything.</p>
<p>You may separate multiple <code>NODE_DEBUG</code> environment variables with a<br>comma.  For example, <code>NODE_DEBUG=fs,net,tls</code>.</p>
<h2 id="util-format(format[,_…])">util.format(format[, …])</h2><p>Returns a formatted string using the first argument as a <code>printf</code>-like format.</p>
<p>The first argument is a string that contains zero or more <em>placeholders</em>.<br>Each placeholder is replaced with the converted value from its corresponding<br>argument. Supported placeholders are:</p>
<ul>
<li><code>%s</code> - String.</li>
<li><code>%d</code> - Number (both integer and float).</li>
<li><code>%j</code> - JSON.  Replaced with the string <code>&#39;[Circular]&#39;</code> if the argument<pre><code><span class="keyword">contains</span> circular references.
</code></pre></li>
<li><code>%%</code> - single percent sign (<code>&#39;%&#39;</code>). This does not consume an argument.</li>
</ul>
<p>If the placeholder does not have a corresponding argument, the placeholder is<br>not replaced.</p>
<pre><code>util.format(<span class="string">'%s:%s'</span>, <span class="string">'foo'</span>); <span class="regexp">//</span> <span class="string">'foo:%s'</span>
</code></pre><p>If there are more arguments than placeholders, the extra arguments are<br>converted to strings with <code>util.inspect()</code> and these strings are concatenated,<br>delimited by a space.</p>
<pre><code>util.format(<span class="string">'%s:%s'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>); <span class="regexp">//</span> <span class="string">'foo:bar baz'</span>
</code></pre><p>If the first argument is not a format string then <code>util.format()</code> returns<br>a string that is the concatenation of all its arguments separated by spaces.<br>Each argument is converted to a string with <code>util.inspect()</code>.</p>
<pre><code>util.format(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="regexp">//</span> <span class="string">'1 2 3'</span>
</code></pre><h2 id="util-log(string)">util.log(string)</h2><p>Output with timestamp on <code>stdout</code>.</p>
<pre><code><span class="keyword">require</span>(<span class="string">'util'</span>)<span class="built_in">.</span><span class="keyword">log</span>(<span class="string">'Timestamped message.'</span>);
</code></pre><h2 id="util-inspect(object[,_options])">util.inspect(object[, options])</h2><p>Return a string representation of <code>object</code>, which is useful for debugging.</p>
<p>An optional <em>options</em> object may be passed that alters certain aspects of the<br>formatted string:</p>
<ul>
<li><p><code>showHidden</code> - if <code>true</code> then the object’s non-enumerable properties will be<br>shown too. Defaults to <code>false</code>.</p>
</li>
<li><p><code>depth</code> - tells <code>inspect</code> how many times to recurse while formatting the<br>object. This is useful for inspecting large complicated objects. Defaults to<br><code>2</code>. To make it recurse indefinitely pass <code>null</code>.</p>
</li>
<li><p><code>colors</code> - if <code>true</code>, then the output will be styled with ANSI color codes.<br>Defaults to <code>false</code>. Colors are customizable, see below.</p>
</li>
<li><p><code>customInspect</code> - if <code>false</code>, then custom <code>inspect(depth, opts)</code> functions<br>defined on the objects being inspected won’t be called. Defaults to <code>true</code>.</p>
</li>
</ul>
<p>Example of inspecting all properties of the <code>util</code> object:</p>
<pre><code><span class="reserved">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

<span class="built_in">console</span>.log(util.inspect(util, { <span class="attribute">showHidden</span>: <span class="literal">true</span>, <span class="attribute">depth</span>: <span class="literal">null</span> }));
</code></pre><p>Values may supply their own custom <code>inspect(depth, opts)</code> functions, when<br>called they receive the current depth in the recursive inspection, as well as<br>the options object passed to <code>util.inspect()</code>.</p>
<h3 id="Customizing_util-inspect_colors">Customizing <code>util.inspect</code> colors</h3><!-- type=misc -->
<p>Color output (if enabled) of <code>util.inspect</code> is customizable globally<br>via <code>util.inspect.styles</code> and <code>util.inspect.colors</code> objects.</p>
<p><code>util.inspect.styles</code> is a map assigning each style a color<br>from <code>util.inspect.colors</code>.<br>Highlighted styles and their default values are:</p>
<ul>
<li><code>number</code> (yellow)</li>
<li><code>boolean</code> (yellow)</li>
<li><code>string</code> (green)</li>
<li><code>date</code> (magenta)</li>
<li><code>regexp</code> (red)</li>
<li><code>null</code> (bold)</li>
<li><code>undefined</code> (grey)</li>
<li><code>special</code> - only function at this time (cyan)</li>
<li><code>name</code> (intentionally no styling)</li>
</ul>
<p>Predefined color codes are: <code>white</code>, <code>grey</code>, <code>black</code>, <code>blue</code>, <code>cyan</code>,<br><code>green</code>, <code>magenta</code>, <code>red</code> and <code>yellow</code>.<br>There are also <code>bold</code>, <code>italic</code>, <code>underline</code> and <code>inverse</code> codes.</p>
<h3 id="Custom_inspect()_function_on_Objects">Custom <code>inspect()</code> function on Objects</h3><!-- type=misc -->
<p>Objects also may define their own <code>inspect(depth)</code> function which <code>util.inspect()</code><br>will invoke and use the result of when inspecting the object:</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

<span class="keyword">var</span> obj = { name: <span class="string">'nate'</span> };
obj.inspect = <span class="function"><span class="keyword">function</span>(<span class="params">depth</span>) </span>{
  <span class="keyword">return</span> <span class="string">'{'</span> + <span class="keyword">this</span>.name + <span class="string">'}'</span>;
};

util.inspect(obj);
  <span class="comment">// "{nate}"</span>
</code></pre><p>You may also return another Object entirely, and the returned String will be<br>formatted according to the returned Object. This is similar to how<br><code>JSON.stringify()</code> works:</p>
<pre><code><span class="keyword">var</span> obj = { foo: <span class="string">'this will not show up in the inspect() output'</span> };
obj.inspect = <span class="function"><span class="keyword">function</span><span class="params">(depth)</span> </span>{
  <span class="keyword">return</span> { bar: <span class="string">'baz'</span> };
};

util.inspect(obj);
  <span class="comment">// "{ bar: 'baz' }"</span>
</code></pre><h2 id="util-isArray(object)">util.isArray(object)</h2><p>Internal alias for Array.isArray.</p>
<p>Returns <code>true</code> if the given “object” is an <code>Array</code>. <code>false</code> otherwise.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

util.isArray([])
  <span class="comment">// true</span>
util.isArray(<span class="keyword">new</span> <span class="built_in">Array</span>)
  <span class="comment">// true</span>
util.isArray({})
  <span class="comment">// false</span>
</code></pre><h2 id="util-isRegExp(object)">util.isRegExp(object)</h2><p>Returns <code>true</code> if the given “object” is a <code>RegExp</code>. <code>false</code> otherwise.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

util.isRegExp(<span class="regexp">/some regexp/</span>)
  <span class="comment">// true</span>
util.isRegExp(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'another regexp'</span>))
  <span class="comment">// true</span>
util.isRegExp({})
  <span class="comment">// false</span>
</code></pre><h2 id="util-isDate(object)">util.isDate(object)</h2><p>Returns <code>true</code> if the given “object” is a <code>Date</code>. <code>false</code> otherwise.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

util.isDate(<span class="keyword">new</span> <span class="built_in">Date</span>())
  <span class="comment">// true</span>
util.isDate(<span class="built_in">Date</span>())
  <span class="comment">// false (without 'new' returns a String)</span>
util.isDate({})
  <span class="comment">// false</span>
</code></pre><h2 id="util-isError(object)">util.isError(object)</h2><p>Returns <code>true</code> if the given “object” is an <code>Error</code>. <code>false</code> otherwise.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);

util.isError(<span class="keyword">new</span> <span class="built_in">Error</span>())
  <span class="comment">// true</span>
util.isError(<span class="keyword">new</span> <span class="built_in">TypeError</span>())
  <span class="comment">// true</span>
util.isError({ name: <span class="string">'Error'</span>, message: <span class="string">'an error occurred'</span> })
  <span class="comment">// false</span>
</code></pre><h2 id="util-inherits(constructor,_superConstructor)">util.inherits(constructor, superConstructor)</h2><p>Inherit the prototype methods from one<br><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/constructor" target="_blank" rel="external">constructor</a><br>into another.  The prototype of <code>constructor</code> will be set to a new<br>object created from <code>superConstructor</code>.</p>
<p>As an additional convenience, <code>superConstructor</code> will be accessible<br>through the <code>constructor.super_</code> property.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">"util"</span>);
<span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">"events"</span>);

<span class="function"><span class="keyword">function</span> <span class="title">MyStream</span>(<span class="params"></span>) </span>{
    events.EventEmitter.call(<span class="keyword">this</span>);
}

util.inherits(MyStream, events.EventEmitter);

MyStream.prototype.write = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
    <span class="keyword">this</span>.emit(<span class="string">"data"</span>, data);
}

<span class="keyword">var</span> stream = <span class="keyword">new</span> MyStream();

<span class="built_in">console</span>.log(stream <span class="keyword">instanceof</span> events.EventEmitter); <span class="comment">// true</span>
<span class="built_in">console</span>.log(MyStream.super_ === events.EventEmitter); <span class="comment">// true</span>

stream.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'Received data: "'</span> + data + <span class="string">'"'</span>);
})
stream.write(<span class="string">"It works!"</span>); <span class="comment">// Received data: "It works!"</span>
</code></pre><h2 id="util-deprecate(function,_string)">util.deprecate(function, string)</h2><p>Marks that a method should not be used any more.</p>
<pre><code>exports.puts = exports.deprecate(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">for</span> (var <span class="built_in">i</span> = <span class="number">0</span>, len = arguments.<span class="built_in">length</span>; <span class="built_in">i</span> &lt; len; ++<span class="built_in">i</span>) <span class="cell">{
    process.stdout.write(arguments[i] + <span class="string">'\n'</span>);
  }</span>
}, <span class="string">'util.puts: Use console.log instead'</span>)
</code></pre><p>It returns a modified function which warns once by default. If<br><code>--no-deprecation</code> is set then this function is a NO-OP. If<br><code>--throw-deprecation</code> is set then the application will throw an exception<br>if the deprecated API is used.</p>
<h2 id="util-debug(string)">util.debug(string)</h2><pre><code>Stability: <span class="number">0</span> - Deprecated: use console.<span class="function"><span class="title">error</span><span class="params">()</span></span> instead.
</code></pre><p>Deprecated predecessor of <code>console.error</code>.</p>
<h2 id="util-error([…])">util.error([…])</h2><pre><code>Stability: <span class="number">0</span> - Deprecated: Use console.<span class="function"><span class="title">error</span><span class="params">()</span></span> instead.
</code></pre><p>Deprecated predecessor of <code>console.error</code>.</p>
<h2 id="util-puts([…])">util.puts([…])</h2><pre><code>Stability: <span class="number">0</span> - Deprecated: Use console.<span class="function"><span class="title">log</span><span class="params">()</span></span> instead.
</code></pre><p>Deprecated predecessor of <code>console.log</code>.</p>
<h2 id="util-print([…])">util.print([…])</h2><pre><code><span class="attribute">Stability</span>: <span class="number">0</span> - <span class="attribute">Deprecated</span>: Use <span class="built_in">`console.log`</span> instead.
</code></pre><p>Deprecated predecessor of <code>console.log</code>.</p>
<h2 id="util-pump(readableStream,_writableStream[,_callback])">util.pump(readableStream, writableStream[, callback])</h2><pre><code>Stability: <span class="number">0</span> - Deprecated: Use readableStream.<span class="function"><span class="title">pipe</span><span class="params">(writableStream)</span></span>
</code></pre><p>Deprecated predecessor of <code>stream.pipe()</code>.</p>
<h1 id="Events"><a id="events">Events</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">4 - API Frozen</span>
</code></pre><!--type=module-->
<p>Many objects in Node emit events: a <code>net.Server</code> emits an event each time<br>a peer connects to it, a <code>fs.readStream</code> emits an event when the file is<br>opened. All objects which emit events are instances of <code>events.EventEmitter</code>.<br>You can access this module by doing: <code>require(&quot;events&quot;);</code></p>
<p>Typically, event names are represented by a camel-cased string, however,<br>there aren’t any strict restrictions on that, as any string will be accepted.</p>
<p>Functions can then be attached to objects, to be executed when an event<br>is emitted. These functions are called <em>listeners</em>. Inside a listener<br>function, <code>this</code> refers to the <code>EventEmitter</code> that the listener was<br>attached to.</p>
<h2 id="Class:_events-EventEmitter">Class: events.EventEmitter</h2><p>To access the EventEmitter class, <code>require(&#39;events&#39;).EventEmitter</code>.</p>
<p>When an <code>EventEmitter</code> instance experiences an error, the typical action is<br>to emit an <code>&#39;error&#39;</code> event.  Error events are treated as a special case in node.<br>If there is no listener for it, then the default action is to print a stack<br>trace and exit the program.</p>
<p>All EventEmitters emit the event <code>&#39;newListener&#39;</code> when new listeners are<br>added and <code>&#39;removeListener&#39;</code> when a listener is removed.</p>
<h3 id="emitter-addListener(event,_listener)">emitter.addListener(event, listener)</h3><h3 id="emitter-on(event,_listener)">emitter.on(event, listener)</h3><p>Adds a listener to the end of the listeners array for the specified <code>event</code>.<br>No checks are made to see if the <code>listener</code> has already been added. Multiple<br>calls passing the same combination of <code>event</code> and <code>listener</code> will result in the<br><code>listener</code> being added multiple times.</p>
<pre><code>server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'someone connected!'</span>);
});
</code></pre><p>Returns emitter, so calls can be chained.</p>
<h3 id="emitter-once(event,_listener)">emitter.once(event, listener)</h3><p>Adds a <strong>one time</strong> listener for the event. This listener is<br>invoked only the next time the event is fired, after which<br>it is removed.</p>
<pre><code>server.once(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Ah, we have our first user!'</span>);
});
</code></pre><p>Returns emitter, so calls can be chained.</p>
<h3 id="emitter-removeListener(event,_listener)">emitter.removeListener(event, listener)</h3><p>Remove a listener from the listener array for the specified event.<br><strong>Caution</strong>: changes array indices in the listener array behind the listener.</p>
<pre><code><span class="keyword">var</span> <span class="keyword">callback</span> = <span class="function"><span class="keyword">function</span><span class="params">(stream)</span> </span>{
  console.log(<span class="string">'someone connected!'</span>);
};
server.on(<span class="string">'connection'</span>, <span class="keyword">callback</span>);
<span class="comment">// ...</span>
server.removeListener(<span class="string">'connection'</span>, <span class="keyword">callback</span>);
</code></pre><p><code>removeListener</code> will remove, at most, one instance of a listener from the<br>listener array. If any single listener has been added multiple times to the<br>listener array for the specified <code>event</code>, then <code>removeListener</code> must be called<br>multiple times to remove each instance.</p>
<p>Returns emitter, so calls can be chained.</p>
<h3 id="emitter-removeAllListeners([event])">emitter.removeAllListeners([event])</h3><p>Removes all listeners, or those of the specified event. It’s not a good idea to<br>remove listeners that were added elsewhere in the code, especially when it’s on<br>an emitter that you didn’t create (e.g. sockets or file streams).</p>
<p>Returns emitter, so calls can be chained.</p>
<h3 id="emitter-setMaxListeners(n)">emitter.setMaxListeners(n)</h3><p>By default EventEmitters will print a warning if more than 10 listeners are<br>added for a particular event. This is a useful default which helps finding<br>memory leaks. Obviously not all Emitters should be limited to 10. This function<br>allows that to be increased. Set to zero for unlimited.</p>
<p>Returns emitter, so calls can be chained.</p>
<h3 id="EventEmitter-defaultMaxListeners">EventEmitter.defaultMaxListeners</h3><p><code>emitter.setMaxListeners(n)</code> sets the maximum on a per-instance basis.<br>This class property lets you set it for <em>all</em> <code>EventEmitter</code> instances,<br>current and future, effective immediately. Use with care.</p>
<p>Note that <code>emitter.setMaxListeners(n)</code> still has precedence over<br><code>EventEmitter.defaultMaxListeners</code>.</p>
<h3 id="emitter-listeners(event)">emitter.listeners(event)</h3><p>Returns an array of listeners for the specified event.</p>
<pre><code>server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'someone connected!'</span>);
});
<span class="built_in">console</span>.log(util.inspect(server.listeners(<span class="string">'connection'</span>))); <span class="comment">// [ [Function] ]</span>
</code></pre><h3 id="emitter-emit(event[,_arg1][,_arg2][,_…])">emitter.emit(event[, arg1][, arg2][, …])</h3><p>Execute each of the listeners in order with the supplied arguments.</p>
<p>Returns <code>true</code> if event had listeners, <code>false</code> otherwise.</p>
<h3 id="Class_Method:_EventEmitter-listenerCount(emitter,_event)">Class Method: EventEmitter.listenerCount(emitter, event)</h3><p>Return the number of listeners for a given event.</p>
<h3 id="Event:_‘newListener’">Event: ‘newListener’</h3><ul>
<li><code>event</code> {String} The event name</li>
<li><code>listener</code> {Function} The event handler function</li>
</ul>
<p>This event is emitted any time a listener is added. When this event is triggered,<br>the listener may not yet have been added to the array of listeners for the <code>event</code>.</p>
<h3 id="Event:_‘removeListener’">Event: ‘removeListener’</h3><ul>
<li><code>event</code> {String} The event name</li>
<li><code>listener</code> {Function} The event handler function</li>
</ul>
<p>This event is emitted any time someone removes a listener.  When this event is triggered,<br>the listener may not yet have been removed from the array of listeners for the <code>event</code>.</p>
<h1 id="Domain"><a id="domain">Domain</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable</span>
</code></pre><p>Domains provide a way to handle multiple different IO operations as a<br>single group.  If any of the event emitters or callbacks registered to a<br>domain emit an <code>error</code> event, or throw an error, then the domain object<br>will be notified, rather than losing the context of the error in the<br><code>process.on(&#39;uncaughtException&#39;)</code> handler, or causing the program to<br>exit immediately with an error code.</p>
<h2 id="Warning:_Don’t_Ignore_Errors!">Warning: Don’t Ignore Errors!</h2><!-- type=misc -->
<p>Domain error handlers are not a substitute for closing down your<br>process when an error occurs.</p>
<p>By the very nature of how <code>throw</code> works in JavaScript, there is almost<br>never any way to safely “pick up where you left off”, without leaking<br>references, or creating some other sort of undefined brittle state.</p>
<p>The safest way to respond to a thrown error is to shut down the<br>process.  Of course, in a normal web server, you might have many<br>connections open, and it is not reasonable to abruptly shut those down<br>because an error was triggered by someone else.</p>
<p>The better approach is send an error response to the request that<br>triggered the error, while letting the others finish in their normal<br>time, and stop listening for new requests in that worker.</p>
<p>In this way, <code>domain</code> usage goes hand-in-hand with the cluster module,<br>since the master process can fork a new worker when a worker<br>encounters an error.  For node programs that scale to multiple<br>machines, the terminating proxy or service registry can take note of<br>the failure, and react accordingly.</p>
<p>For example, this is not a good idea:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag"><span class="keyword">XXX</span></span> WARNING!  BAD IDEA!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="built_in">require</span>(<span class="string">'domain'</span>).create();</span><br><span class="line">d.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The error won't crash the process, but what it does is worse!</span></span><br><span class="line">  <span class="comment">// Though we've prevented abrupt process restarting, we are leaking</span></span><br><span class="line">  <span class="comment">// resources like crazy if this ever happens.</span></span><br><span class="line">  <span class="comment">// This is no better than process.on('uncaughtException')!</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'error, but oh well'</span>, er.message);</span><br><span class="line">&#125;);</span><br><span class="line">d.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    handleRequest(req, res);</span><br><span class="line">  &#125;).listen(PORT);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>By using the context of a domain, and the resilience of separating our<br>program into multiple worker processes, we can react more<br>appropriately, and handle errors with much greater safety.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Much better!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);</span><br><span class="line"><span class="keyword">var</span> PORT = +process.env.PORT || <span class="number">1337</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123;</span><br><span class="line">  <span class="comment">// In real life, you'd probably use more than just 2 workers,</span></span><br><span class="line">  <span class="comment">// and perhaps not put the master and worker in the same file.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// You can also of course get a bit fancier about logging, and</span></span><br><span class="line">  <span class="comment">// implement whatever custom logic you need to prevent DoS</span></span><br><span class="line">  <span class="comment">// attacks and other bad behavior.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// See the options in the cluster documentation.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// The important thing is that the master does very little,</span></span><br><span class="line">  <span class="comment">// increasing our resilience to unexpected errors.</span></span><br><span class="line"></span><br><span class="line">  cluster.fork();</span><br><span class="line">  cluster.fork();</span><br><span class="line"></span><br><span class="line">  cluster.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'disconnect!'</span>);</span><br><span class="line">    cluster.fork();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// the worker</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// This is where we put our bugs!</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> domain = <span class="built_in">require</span>(<span class="string">'domain'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// See the cluster documentation for more details about using</span></span><br><span class="line">  <span class="comment">// worker processes to serve requests.  How it works, caveats, etc.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = domain.create();</span><br><span class="line">    d.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'error'</span>, er.stack);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Note: we're in dangerous territory!</span></span><br><span class="line">      <span class="comment">// By definition, something unexpected occurred,</span></span><br><span class="line">      <span class="comment">// which we probably didn't want.</span></span><br><span class="line">      <span class="comment">// Anything can happen now!  Be very careful!</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// make sure we close down within 30 seconds</span></span><br><span class="line">        <span class="keyword">var</span> killtimer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          process.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">30000</span>);</span><br><span class="line">        <span class="comment">// But don't keep the process open just for that!</span></span><br><span class="line">        killtimer.unref();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// stop taking new requests.</span></span><br><span class="line">        server.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Let the master know we're dead.  This will trigger a</span></span><br><span class="line">        <span class="comment">// 'disconnect' in the cluster master, and then it will fork</span></span><br><span class="line">        <span class="comment">// a new worker.</span></span><br><span class="line">        cluster.worker.disconnect();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// try to send an error to the request that triggered the problem</span></span><br><span class="line">        res.statusCode = <span class="number">500</span>;</span><br><span class="line">        res.setHeader(<span class="string">'content-type'</span>, <span class="string">'text/plain'</span>);</span><br><span class="line">        res.end(<span class="string">'Oops, there was a problem!\n'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (er2) &#123;</span><br><span class="line">        <span class="comment">// oh well, not much we can do at this point.</span></span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'Error sending 500!'</span>, er2.stack);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Because req and res were created before this domain existed,</span></span><br><span class="line">    <span class="comment">// we need to explicitly add them.</span></span><br><span class="line">    <span class="comment">// See the explanation of implicit vs explicit binding below.</span></span><br><span class="line">    d.add(req);</span><br><span class="line">    d.add(res);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now run the handler function in the domain.</span></span><br><span class="line">    d.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      handleRequest(req, res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  server.listen(PORT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This part isn't important.  Just an example routing thing.</span></span><br><span class="line"><span class="comment">// You'd put your fancy application logic here.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(req.url) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/error'</span>:</span><br><span class="line">      <span class="comment">// We do some async stuff, and then...</span></span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Whoops!</span></span><br><span class="line">        flerb.bark();</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      res.end(<span class="string">'ok'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Additions_to_Error_objects">Additions to Error objects</h2><!-- type=misc -->
<p>Any time an Error object is routed through a domain, a few extra fields<br>are added to it.</p>
<ul>
<li><code>error.domain</code> The domain that first handled the error.</li>
<li><code>error.domainEmitter</code> The event emitter that emitted an ‘error’ event<br>with the error object.</li>
<li><code>error.domainBound</code> The callback function which was bound to the<br>domain, and passed an error as its first argument.</li>
<li><code>error.domainThrown</code> A boolean indicating whether the error was<br>thrown, emitted, or passed to a bound callback function.</li>
</ul>
<h2 id="Implicit_Binding">Implicit Binding</h2><!--type=misc-->
<p>If domains are in use, then all <strong>new</strong> EventEmitter objects (including<br>Stream objects, requests, responses, etc.) will be implicitly bound to<br>the active domain at the time of their creation.</p>
<p>Additionally, callbacks passed to lowlevel event loop requests (such as<br>to fs.open, or other callback-taking methods) will automatically be<br>bound to the active domain.  If they throw, then the domain will catch<br>the error.</p>
<p>In order to prevent excessive memory usage, Domain objects themselves<br>are not implicitly added as children of the active domain.  If they<br>were, then it would be too easy to prevent request and response objects<br>from being properly garbage collected.</p>
<p>If you <em>want</em> to nest Domain objects as children of a parent Domain,<br>then you must explicitly add them.</p>
<p>Implicit binding routes thrown errors and <code>&#39;error&#39;</code> events to the<br>Domain’s <code>error</code> event, but does not register the EventEmitter on the<br>Domain, so <code>domain.dispose()</code> will not shut down the EventEmitter.<br>Implicit binding only takes care of thrown errors and <code>&#39;error&#39;</code> events.</p>
<h2 id="Explicit_Binding">Explicit Binding</h2><!--type=misc-->
<p>Sometimes, the domain in use is not the one that ought to be used for a<br>specific event emitter.  Or, the event emitter could have been created<br>in the context of one domain, but ought to instead be bound to some<br>other domain.</p>
<p>For example, there could be one domain in use for an HTTP server, but<br>perhaps we would like to have a separate domain to use for each request.</p>
<p>That is possible via explicit binding.</p>
<p>For example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a top-level domain for the server</span></span><br><span class="line"><span class="keyword">var</span> serverDomain = domain.create();</span><br><span class="line"></span><br><span class="line">serverDomain.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// server is created in the scope of serverDomain</span></span><br><span class="line">  http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// req and res are also created in the scope of serverDomain</span></span><br><span class="line">    <span class="comment">// however, we'd prefer to have a separate domain for each request.</span></span><br><span class="line">    <span class="comment">// create it first thing, and add req and res to it.</span></span><br><span class="line">    <span class="keyword">var</span> reqd = domain.create();</span><br><span class="line">    reqd.add(req);</span><br><span class="line">    reqd.add(res);</span><br><span class="line">    reqd.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'Error'</span>, er, req.url);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.writeHead(<span class="number">500</span>);</span><br><span class="line">        res.end(<span class="string">'Error occurred, sorry.'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'Error sending 500'</span>, er, req.url);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).listen(<span class="number">1337</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="domain-create()">domain.create()</h2><ul>
<li>return: {Domain}</li>
</ul>
<p>Returns a new Domain object.</p>
<h2 id="Class:_Domain">Class: Domain</h2><p>The Domain class encapsulates the functionality of routing errors and<br>uncaught exceptions to the active Domain object.</p>
<p>Domain is a child class of <a href="events.html#events_class_events_eventemitter">EventEmitter</a>.  To handle the errors that it<br>catches, listen to its <code>error</code> event.</p>
<h3 id="domain-run(fn)">domain.run(fn)</h3><ul>
<li><code>fn</code> {Function}</li>
</ul>
<p>Run the supplied function in the context of the domain, implicitly<br>binding all event emitters, timers, and lowlevel requests that are<br>created in that context.</p>
<p>This is the most basic way to use a domain.</p>
<p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d = domain.create();</span><br><span class="line">d.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'Caught error!'</span>, er);</span><br><span class="line">&#125;);</span><br><span class="line">d.run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// simulating some various async stuff</span></span><br><span class="line">      fs.open(<span class="string">'non-existent file'</span>, <span class="string">'r'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er, fd</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (er) <span class="keyword">throw</span> er;</span><br><span class="line">        <span class="comment">// proceed...</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">100</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>In this example, the <code>d.on(&#39;error&#39;)</code> handler will be triggered, rather<br>than crashing the program.</p>
<h3 id="domain-members">domain.members</h3><ul>
<li>{Array}</li>
</ul>
<p>An array of timers and event emitters that have been explicitly added<br>to the domain.</p>
<h3 id="domain-add(emitter)">domain.add(emitter)</h3><ul>
<li><code>emitter</code> {EventEmitter | Timer} emitter or timer to be added to the domain</li>
</ul>
<p>Explicitly adds an emitter to the domain.  If any event handlers called by<br>the emitter throw an error, or if the emitter emits an <code>error</code> event, it<br>will be routed to the domain’s <code>error</code> event, just like with implicit<br>binding.</p>
<p>This also works with timers that are returned from <code>setInterval</code> and<br><code>setTimeout</code>.  If their callback function throws, it will be caught by<br>the domain ‘error’ handler.</p>
<p>If the Timer or EventEmitter was already bound to a domain, it is removed<br>from that one, and bound to this one instead.</p>
<h3 id="domain-remove(emitter)">domain.remove(emitter)</h3><ul>
<li><code>emitter</code> {EventEmitter | Timer} emitter or timer to be removed from the domain</li>
</ul>
<p>The opposite of <code>domain.add(emitter)</code>.  Removes domain handling from the<br>specified emitter.</p>
<h3 id="domain-bind(callback)">domain.bind(callback)</h3><ul>
<li><code>callback</code> {Function} The callback function</li>
<li>return: {Function} The bound function</li>
</ul>
<p>The returned function will be a wrapper around the supplied callback<br>function.  When the returned function is called, any errors that are<br>thrown will be routed to the domain’s <code>error</code> event.</p>
<h4 id="Example">Example</h4><pre><code><span class="keyword">var</span> d = domain.create();

<span class="function"><span class="keyword">function</span> <span class="title">readSomeFile</span>(<span class="params">filename, cb</span>) </span>{
  fs.readFile(filename, <span class="string">'utf8'</span>, d.bind(<span class="function"><span class="keyword">function</span>(<span class="params">er, data</span>) </span>{
    <span class="comment">// if this throws, it will also be passed to the domain</span>
    <span class="keyword">return</span> cb(er, data ? <span class="built_in">JSON</span>.parse(data) : <span class="literal">null</span>);
  }));
}

d.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>{
  <span class="comment">// an error occurred somewhere.</span>
  <span class="comment">// if we throw it now, it will crash the program</span>
  <span class="comment">// with the normal line number and stack message.</span>
});
</code></pre><h3 id="domain-intercept(callback)">domain.intercept(callback)</h3><ul>
<li><code>callback</code> {Function} The callback function</li>
<li>return: {Function} The intercepted function</li>
</ul>
<p>This method is almost identical to <code>domain.bind(callback)</code>.  However, in<br>addition to catching thrown errors, it will also intercept <code>Error</code><br>objects sent as the first argument to the function.</p>
<p>In this way, the common <code>if (er) return callback(er);</code> pattern can be replaced<br>with a single error handler in a single place.</p>
<h4 id="Example-1">Example</h4><pre><code><span class="keyword">var</span> d = domain.create();

<span class="function"><span class="keyword">function</span> <span class="title">readSomeFile</span>(<span class="params">filename, cb</span>) </span>{
  fs.readFile(filename, <span class="string">'utf8'</span>, d.intercept(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
    <span class="comment">// <span class="doctag"><span class="keyword">note</span></span>, the first argument is never passed to the</span>
    <span class="comment">// callback since it is assumed to be the 'Error' argument</span>
    <span class="comment">// and thus intercepted by the domain.</span>

    <span class="comment">// if this throws, it will also be passed to the domain</span>
    <span class="comment">// so the error-handling logic can be moved to the 'error'</span>
    <span class="comment">// event on the domain instead of being repeated throughout</span>
    <span class="comment">// the program.</span>
    <span class="keyword">return</span> cb(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data));
  }));
}

d.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er</span>) </span>{
  <span class="comment">// an error occurred somewhere.</span>
  <span class="comment">// if we throw it now, it will crash the program</span>
  <span class="comment">// with the normal line number and stack message.</span>
});
</code></pre><h3 id="domain-enter()">domain.enter()</h3><p>The <code>enter</code> method is plumbing used by the <code>run</code>, <code>bind</code>, and <code>intercept</code><br>methods to set the active domain. It sets <code>domain.active</code> and <code>process.domain</code><br>to the domain, and implicitly pushes the domain onto the domain stack managed<br>by the domain module (see <code>domain.exit()</code> for details on the domain stack). The<br>call to <code>enter</code> delimits the beginning of a chain of asynchronous calls and I/O<br>operations bound to a domain.</p>
<p>Calling <code>enter</code> changes only the active domain, and does not alter the domain<br>itself. <code>Enter</code> and <code>exit</code> can be called an arbitrary number of times on a<br>single domain.</p>
<p>If the domain on which <code>enter</code> is called has been disposed, <code>enter</code> will return<br>without setting the domain.</p>
<h3 id="domain-exit()">domain.exit()</h3><p>The <code>exit</code> method exits the current domain, popping it off the domain stack.<br>Any time execution is going to switch to the context of a different chain of<br>asynchronous calls, it’s important to ensure that the current domain is exited.<br>The call to <code>exit</code> delimits either the end of or an interruption to the chain<br>of asynchronous calls and I/O operations bound to a domain.</p>
<p>If there are multiple, nested domains bound to the current execution context,<br><code>exit</code> will exit any domains nested within this domain.</p>
<p>Calling <code>exit</code> changes only the active domain, and does not alter the domain<br>itself. <code>Enter</code> and <code>exit</code> can be called an arbitrary number of times on a<br>single domain.</p>
<p>If the domain on which <code>exit</code> is called has been disposed, <code>exit</code> will return<br>without exiting the domain.</p>
<h3 id="domain-dispose()">domain.dispose()</h3><pre><code>Stability: <span class="number">0</span> - Deprecated.  Please recover <span class="keyword">from</span> failed IO actions
explicitly via <span class="keyword">error</span> event handlers <span class="keyword">set</span> <span class="function_start"><span class="keyword">on</span></span> <span class="keyword">the</span> domain.
</code></pre><p>Once <code>dispose</code> has been called, the domain will no longer be used by callbacks<br>bound into the domain via <code>run</code>, <code>bind</code>, or <code>intercept</code>, and a <code>dispose</code> event<br>is emitted.</p>
<h1 id="Buffer"><a id="buffer">Buffer</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>Pure JavaScript is Unicode friendly but not nice to binary data.  When<br>dealing with TCP streams or the file system, it’s necessary to handle octet<br>streams. Node has several strategies for manipulating, creating, and<br>consuming octet streams.</p>
<p>Raw data is stored in instances of the <code>Buffer</code> class. A <code>Buffer</code> is similar<br>to an array of integers but corresponds to a raw memory allocation outside<br>the V8 heap. A <code>Buffer</code> cannot be resized.</p>
<p>The <code>Buffer</code> class is a global, making it very rare that one would need<br>to ever <code>require(&#39;buffer&#39;)</code>.</p>
<p>Converting between Buffers and JavaScript string objects requires an explicit<br>encoding method.  Here are the different string encodings.</p>
<ul>
<li><p><code>&#39;ascii&#39;</code> - for 7 bit ASCII data only.  This encoding method is very fast, and<br>will strip the high bit if set.</p>
</li>
<li><p><code>&#39;utf8&#39;</code> - Multibyte encoded Unicode characters. Many web pages and other<br>document formats use UTF-8.</p>
</li>
<li><p><code>&#39;utf16le&#39;</code> - 2 or 4 bytes, little endian encoded Unicode characters.<br>Surrogate pairs (U+10000 to U+10FFFF) are supported.</p>
</li>
<li><p><code>&#39;ucs2&#39;</code> - Alias of <code>&#39;utf16le&#39;</code>.</p>
</li>
<li><p><code>&#39;base64&#39;</code> - Base64 string encoding.</p>
</li>
<li><p><code>&#39;binary&#39;</code> - A way of encoding raw binary data into strings by using only<br>the first 8 bits of each character. This encoding method is deprecated and<br>should be avoided in favor of <code>Buffer</code> objects where possible. This encoding<br>will be removed in future versions of Node.</p>
</li>
<li><p><code>&#39;hex&#39;</code> - Encode each byte as two hexadecimal characters.</p>
</li>
</ul>
<p>Creating a typed array from a <code>Buffer</code> works with the following caveats:</p>
<ol>
<li><p>The buffer’s memory is copied, not shared.</p>
</li>
<li><p>The buffer’s memory is interpreted as an array, not a byte array.  That is,<br><code>new Uint32Array(new Buffer([1,2,3,4]))</code> creates a 4-element <code>Uint32Array</code><br>with elements <code>[1,2,3,4]</code>, not an <code>Uint32Array</code> with a single element<br><code>[0x1020304]</code> or <code>[0x4030201]</code>.</p>
</li>
</ol>
<p>NOTE: Node.js v0.8 simply retained a reference to the buffer in <code>array.buffer</code><br>instead of cloning it.</p>
<p>While more efficient, it introduces subtle incompatibilities with the typed<br>arrays specification.  <code>ArrayBuffer#slice()</code> makes a copy of the slice while<br><code>Buffer#slice()</code> creates a view.</p>
<h2 id="Class:_Buffer-1">Class: Buffer</h2><p>The Buffer class is a global type for dealing with binary data directly.<br>It can be constructed in a variety of ways.</p>
<h3 id="new_Buffer(size)">new Buffer(size)</h3><ul>
<li><code>size</code> Number</li>
</ul>
<p>Allocates a new buffer of <code>size</code> octets. Note, <code>size</code> must be no more than<br><a href="smalloc.html#smalloc_smalloc_kmaxlength">kMaxLength</a>. Otherwise, a <code>RangeError</code><br>will be thrown here.</p>
<h3 id="new_Buffer(array)">new Buffer(array)</h3><ul>
<li><code>array</code> Array</li>
</ul>
<p>Allocates a new buffer using an <code>array</code> of octets.</p>
<h3 id="new_Buffer(buffer)">new Buffer(buffer)</h3><ul>
<li><code>buffer</code> {Buffer}</li>
</ul>
<p>Copies the passed <code>buffer</code> data onto a new <code>Buffer</code> instance.</p>
<h3 id="new_Buffer(str[,_encoding])">new Buffer(str[, encoding])</h3><ul>
<li><code>str</code> String - string to encode.</li>
<li><code>encoding</code> String - encoding to use, Optional.</li>
</ul>
<p>Allocates a new buffer containing the given <code>str</code>.<br><code>encoding</code> defaults to <code>&#39;utf8&#39;</code>.</p>
<h3 id="Class_Method:_Buffer-isEncoding(encoding)">Class Method: Buffer.isEncoding(encoding)</h3><ul>
<li><code>encoding</code> {String} The encoding string to test</li>
</ul>
<p>Returns true if the <code>encoding</code> is a valid encoding argument, or false<br>otherwise.</p>
<h3 id="Class_Method:_Buffer-isBuffer(obj)">Class Method: Buffer.isBuffer(obj)</h3><ul>
<li><code>obj</code> Object</li>
<li>Return: Boolean</li>
</ul>
<p>Tests if <code>obj</code> is a <code>Buffer</code>.</p>
<h3 id="Class_Method:_Buffer-byteLength(string[,_encoding])">Class Method: Buffer.byteLength(string[, encoding])</h3><ul>
<li><code>string</code> String</li>
<li><code>encoding</code> String, Optional, Default: ‘utf8’</li>
<li>Return: Number</li>
</ul>
<p>Gives the actual byte length of a string. <code>encoding</code> defaults to <code>&#39;utf8&#39;</code>.<br>This is not the same as <code>String.prototype.length</code> since that returns the<br>number of <em>characters</em> in a string.</p>
<p>Example:</p>
<pre><code><span class="built_in">str</span> = <span class="string">'\u00bd + \u00bc = \u00be'</span>;

console.<span class="built_in">log</span>(<span class="built_in">str</span> + <span class="string">": "</span> + <span class="built_in">str</span>.length + <span class="string">" characters, "</span> +
  Buffer.byteLength(<span class="built_in">str</span>, <span class="string">'utf8'</span>) + <span class="string">" bytes"</span>);

<span class="comment">// ½ + ¼ = ¾: 9 characters, 12 bytes</span>
</code></pre><h3 id="Class_Method:_Buffer-concat(list[,_totalLength])">Class Method: Buffer.concat(list[, totalLength])</h3><ul>
<li><code>list</code> {Array} List of Buffer objects to concat</li>
<li><code>totalLength</code> {Number} Total length of the buffers when concatenated</li>
</ul>
<p>Returns a buffer which is the result of concatenating all the buffers in<br>the list together.</p>
<p>If the list has no items, or if the totalLength is 0, then it returns a<br>zero-length buffer.</p>
<p>If the list has exactly one item, then the first item of the list is<br>returned.</p>
<p>If the list has more than one item, then a new Buffer is created.</p>
<p>If totalLength is not provided, it is read from the buffers in the list.<br>However, this adds an additional loop to the function, so it is faster<br>to provide the length explicitly.</p>
<h3 id="Class_Method:_Buffer-compare(buf1,_buf2)">Class Method: Buffer.compare(buf1, buf2)</h3><ul>
<li><code>buf1</code> {Buffer}</li>
<li><code>buf2</code> {Buffer}</li>
</ul>
<p>The same as <a href="#buffer_buf_compare_otherbuffer"><code>buf1.compare(buf2)</code></a>. Useful<br>for sorting an Array of Buffers:</p>
<pre><code><span class="keyword">var</span> arr = [Buffer(<span class="string">'1234'</span>), Buffer(<span class="string">'0123'</span>)];
arr.sort(Buffer.compare);
</code></pre><h3 id="buf-length">buf.length</h3><ul>
<li>Number</li>
</ul>
<p>The size of the buffer in bytes.  Note that this is not necessarily the size<br>of the contents. <code>length</code> refers to the amount of memory allocated for the<br>buffer object.  It does not change when the contents of the buffer are changed.</p>
<pre><code>buf = new Buffer<span class="params">(<span class="number">1234</span>)</span>;

console.<span class="built_in">log</span><span class="params">(buf.length)</span>;
buf.write<span class="params">(<span class="string">"some string"</span>, <span class="number">0</span>, <span class="string">"ascii"</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.length)</span>;

<span class="comment">// 1234</span>
<span class="comment">// 1234</span>
</code></pre><p>While the <code>length</code> property is not immutable, changing the value of <code>length</code><br>can result in undefined and inconsistent behavior. Applications that wish to<br>modify the length of a buffer should therefore treat <code>length</code> as read-only and<br>use <code>buf.slice</code> to create a new buffer.</p>
<pre><code>buf = new Buffer<span class="params">(<span class="number">10</span>)</span>;
buf.write<span class="params">(<span class="string">"abcdefghj"</span>, <span class="number">0</span>, <span class="string">"ascii"</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.length)</span>; <span class="comment">// 10</span>
buf = buf.slice<span class="params">(<span class="number">0</span>,<span class="number">5</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.length)</span>; <span class="comment">// 5</span>
</code></pre><h3 id="buf-write(string[,_offset][,_length][,_encoding])">buf.write(string[, offset][, length][, encoding])</h3><ul>
<li><code>string</code> String - data to be written to buffer</li>
<li><code>offset</code> Number, Optional, Default: 0</li>
<li><code>length</code> Number, Optional, Default: <code>buffer.length - offset</code></li>
<li><code>encoding</code> String, Optional, Default: ‘utf8’</li>
</ul>
<p>Writes <code>string</code> to the buffer at <code>offset</code> using the given encoding.<br><code>offset</code> defaults to <code>0</code>, <code>encoding</code> defaults to <code>&#39;utf8&#39;</code>. <code>length</code> is<br>the number of bytes to write. Returns number of octets written. If <code>buffer</code> did<br>not contain enough space to fit the entire string, it will write a partial<br>amount of the string. <code>length</code> defaults to <code>buffer.length - offset</code>.<br>The method will not write partial characters.</p>
<pre><code>buf = <span class="keyword">new</span> Buffer(<span class="number">256</span>);
<span class="built_in">len</span> = buf.<span class="keyword">write</span>(<span class="string">'\u00bd + \u00bc = \u00be'</span>, <span class="number">0</span>);
console.<span class="built_in">log</span>(<span class="built_in">len</span> + <span class="string">" bytes: "</span> + buf.toString(<span class="string">'utf8'</span>, <span class="number">0</span>, <span class="built_in">len</span>));
</code></pre><h3 id="buf-writeUIntLE(value,_offset,_byteLength[,_noAssert])">buf.writeUIntLE(value, offset, byteLength[, noAssert])</h3><h3 id="buf-writeUIntBE(value,_offset,_byteLength[,_noAssert])">buf.writeUIntBE(value, offset, byteLength[, noAssert])</h3><h3 id="buf-writeIntLE(value,_offset,_byteLength[,_noAssert])">buf.writeIntLE(value, offset, byteLength[, noAssert])</h3><h3 id="buf-writeIntBE(value,_offset,_byteLength[,_noAssert])">buf.writeIntBE(value, offset, byteLength[, noAssert])</h3><ul>
<li><code>value</code> {Number} Bytes to be written to buffer</li>
<li><code>offset</code> {Number} <code>0 &lt;= offset &lt;= buf.length</code></li>
<li><code>byteLength</code> {Number} <code>0 &lt; byteLength &lt;= 6</code></li>
<li><code>noAssert</code> {Boolean} Default: false</li>
<li>Return: {Number}</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified <code>offset</code> and <code>byteLength</code>.<br>Supports up to 48 bits of accuracy. For example:</p>
<pre><code><span class="label">var</span> <span class="keyword">b </span>= new <span class="keyword">Buffer(6);
</span><span class="keyword">b.writeUIntBE(0x1234567890ab, </span><span class="number">0</span>, <span class="number">6</span>)<span class="comment">;</span>
// &lt;<span class="keyword">Buffer </span><span class="number">12</span> <span class="number">34</span> <span class="number">56</span> <span class="number">78</span> <span class="number">90</span> ab&gt;
</code></pre><p>Set <code>noAssert</code> to <code>true</code> to skip validation of <code>value</code> and <code>offset</code>. Defaults<br>to <code>false</code>.</p>
<h3 id="buf-readUIntLE(offset,_byteLength[,_noAssert])">buf.readUIntLE(offset, byteLength[, noAssert])</h3><h3 id="buf-readUIntBE(offset,_byteLength[,_noAssert])">buf.readUIntBE(offset, byteLength[, noAssert])</h3><h3 id="buf-readIntLE(offset,_byteLength[,_noAssert])">buf.readIntLE(offset, byteLength[, noAssert])</h3><h3 id="buf-readIntBE(offset,_byteLength[,_noAssert])">buf.readIntBE(offset, byteLength[, noAssert])</h3><ul>
<li><code>offset</code> {Number} <code>0 &lt;= offset &lt;= buf.length</code></li>
<li><code>byteLength</code> {Number} <code>0 &lt; byteLength &lt;= 6</code></li>
<li><code>noAssert</code> {Boolean} Default: false</li>
<li>Return: {Number}</li>
</ul>
<p>A generalized version of all numeric read methods. Supports up to 48 bits of<br>accuracy. For example:</p>
<pre><code>var b = new Buffer<span class="params">(<span class="number">6</span>)</span>;
b.writeUint16LE<span class="params">(<span class="number">0</span>x90ab, <span class="number">0</span>)</span>;
b.writeUInt32LE<span class="params">(<span class="number">0</span>x12345678, <span class="number">2</span>)</span>;
b.readUIntLE<span class="params">(<span class="number">0</span>, <span class="number">6</span>)</span>.toString<span class="params">(<span class="number">16</span>)</span>;  <span class="comment">// Specify 6 bytes (48 bits)</span>
<span class="comment">// output: '1234567890ab'</span>
</code></pre><p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<h3 id="buf-toString([encoding][,_start][,_end])">buf.toString([encoding][, start][, end])</h3><ul>
<li><code>encoding</code> String, Optional, Default: ‘utf8’</li>
<li><code>start</code> Number, Optional, Default: 0</li>
<li><code>end</code> Number, Optional, Default: <code>buffer.length</code></li>
</ul>
<p>Decodes and returns a string from buffer data encoded using the specified<br>character set encoding. If <code>encoding</code> is <code>undefined</code> or <code>null</code>, then <code>encoding</code><br>defaults to <code>&#39;utf8&#39;. The</code>start<code>and</code>end<code>parameters default to</code>0<code>and</code>buffer.length<code>when</code>undefined`.</p>
<pre><code>buf = new Buffer<span class="params">(<span class="number">26</span>)</span>;
<span class="keyword">for</span> <span class="params">(var i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)</span> {
  buf[i] = i + <span class="number">97</span>; <span class="comment">// 97 is ASCII a</span>
}
buf.toString<span class="params">('ascii')</span>; <span class="comment">// outputs: abcdefghijklmnopqrstuvwxyz</span>
buf.toString<span class="params">('ascii',<span class="number">0</span>,<span class="number">5</span>)</span>; <span class="comment">// outputs: abcde</span>
buf.toString<span class="params">('utf8',<span class="number">0</span>,<span class="number">5</span>)</span>; <span class="comment">// outputs: abcde</span>
buf.toString<span class="params">(<span class="literal">undef</span>ined,<span class="number">0</span>,<span class="number">5</span>)</span>; <span class="comment">// encoding defaults to 'utf8', outputs abcde</span>
</code></pre><p>See <code>buffer.write()</code> example, above.</p>
<h3 id="buf-toJSON()">buf.toJSON()</h3><p>Returns a JSON-representation of the Buffer instance.  <code>JSON.stringify</code><br>implicitly calls this function when stringifying a Buffer instance.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="string">'test'</span>);
<span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(buf);

<span class="built_in">console</span>.log(json);
<span class="comment">// '{"type":"Buffer","data":[116,101,115,116]}'</span>

<span class="keyword">var</span> copy = <span class="built_in">JSON</span>.parse(json, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>{
    <span class="keyword">return</span> value &amp;&amp; value.type === <span class="string">'Buffer'</span>
      ? <span class="keyword">new</span> Buffer(value.data)
      : value;
  });

<span class="built_in">console</span>.log(copy);
<span class="comment">// &lt;Buffer 74 65 73 74&gt;</span>
</code></pre><h3 id="buf[index]">buf[index]</h3><!--type=property-->
<!--name=[index]-->
<p>Get and set the octet at <code>index</code>. The values refer to individual bytes,<br>so the legal range is between <code>0x00</code> and <code>0xFF</code> hex or <code>0</code> and <code>255</code>.</p>
<p>Example: copy an ASCII string into a buffer, one byte at a time:</p>
<pre><code><span class="built_in">str</span> = <span class="string">"node.js"</span>;
buf = new Buffer<span class="params">(str.length)</span>;

<span class="keyword">for</span> <span class="params">(var i = <span class="number">0</span>; i &lt; str.length ; i++)</span> {
  buf[i] = <span class="built_in">str</span>.charCodeAt<span class="params">(i)</span>;
}

console.<span class="built_in">log</span><span class="params">(buf)</span>;

<span class="comment">// node.js</span>
</code></pre><h3 id="buf-equals(otherBuffer)">buf.equals(otherBuffer)</h3><ul>
<li><code>otherBuffer</code> {Buffer}</li>
</ul>
<p>Returns a boolean of whether <code>this</code> and <code>otherBuffer</code> have the same<br>bytes.</p>
<h3 id="buf-compare(otherBuffer)">buf.compare(otherBuffer)</h3><ul>
<li><code>otherBuffer</code> {Buffer}</li>
</ul>
<p>Returns a number indicating whether <code>this</code> comes before or after or is<br>the same as the <code>otherBuffer</code> in sort order.</p>
<h3 id="buf-copy(targetBuffer[,_targetStart][,_sourceStart][,_sourceEnd])">buf.copy(targetBuffer[, targetStart][, sourceStart][, sourceEnd])</h3><ul>
<li><code>targetBuffer</code> Buffer object - Buffer to copy into</li>
<li><code>targetStart</code> Number, Optional, Default: 0</li>
<li><code>sourceStart</code> Number, Optional, Default: 0</li>
<li><code>sourceEnd</code> Number, Optional, Default: <code>buffer.length</code></li>
</ul>
<p>Copies data from a region of this buffer to a region in the target buffer even<br>if the target memory region overlaps with the source. If <code>undefined</code> the<br><code>targetStart</code> and <code>sourceStart</code> parameters default to <code>0</code> while <code>sourceEnd</code><br>defaults to <code>buffer.length</code>.</p>
<p>Example: build two Buffers, then copy <code>buf1</code> from byte 16 through byte 19<br>into <code>buf2</code>, starting at the 8th byte in <code>buf2</code>.</p>
<pre><code><span class="function_or_atom">buf1</span> = <span class="function_or_atom">new</span> <span class="variable">Buffer</span>(<span class="number">26</span>);
<span class="function_or_atom">buf2</span> = <span class="function_or_atom">new</span> <span class="variable">Buffer</span>(<span class="number">26</span>);

<span class="function_or_atom">for</span> (<span class="function_or_atom">var</span> <span class="function_or_atom">i</span> = <span class="number">0</span> ; <span class="function_or_atom">i</span> &lt; <span class="number">26</span> ; <span class="function_or_atom">i</span>++) {
  <span class="function_or_atom">buf1</span>[<span class="function_or_atom">i</span>] = <span class="function_or_atom">i</span> + <span class="number">97</span>; // <span class="number">97</span> <span class="function_or_atom">is</span> <span class="variable">ASCII</span> <span class="function_or_atom">a</span>
  <span class="function_or_atom">buf2</span>[<span class="function_or_atom">i</span>] = <span class="number">33</span>; // <span class="variable">ASCII</span> <span class="exclamation_mark">!</span>
}

<span class="function_or_atom">buf1</span>.<span class="function_or_atom">copy</span>(<span class="function_or_atom">buf2</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">20</span>);
<span class="function_or_atom">console</span>.<span class="function_or_atom">log</span>(<span class="function_or_atom">buf2</span>.<span class="function_or_atom">toString</span>(<span class="string">'ascii'</span>, <span class="number">0</span>, <span class="number">25</span>));

// <span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="function_or_atom">qrst</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span><span class="exclamation_mark">!</span>
</code></pre><p>Example: Build a single buffer, then copy data from one region to an overlapping<br>region in the same buffer</p>
<pre><code>buf = new Buffer<span class="params">(<span class="number">26</span>)</span>;

<span class="keyword">for</span> <span class="params">(var i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)</span> {
  buf[i] = i + <span class="number">97</span>; <span class="comment">// 97 is ASCII a</span>
}

buf.copy<span class="params">(buf, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.toString<span class="params">()</span>)</span>;

<span class="comment">// efghijghijklmnopqrstuvwxyz</span>
</code></pre><h3 id="buf-slice([start][,_end])">buf.slice([start][, end])</h3><ul>
<li><code>start</code> Number, Optional, Default: 0</li>
<li><code>end</code> Number, Optional, Default: <code>buffer.length</code></li>
</ul>
<p>Returns a new buffer which references the same memory as the old, but offset<br>and cropped by the <code>start</code> (defaults to <code>0</code>) and <code>end</code> (defaults to<br><code>buffer.length</code>) indexes.  Negative indexes start from the end of the buffer.</p>
<p><strong>Modifying the new buffer slice will modify memory in the original buffer!</strong></p>
<p>Example: build a Buffer with the ASCII alphabet, take a slice, then modify one<br>byte from the original Buffer.</p>
<pre><code>var buf1 = new Buffer<span class="params">(<span class="number">26</span>)</span>;

<span class="keyword">for</span> <span class="params">(var i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; i++)</span> {
  buf1[i] = i + <span class="number">97</span>; <span class="comment">// 97 is ASCII a</span>
}

var buf2 = buf1.slice<span class="params">(<span class="number">0</span>, <span class="number">3</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf2.toString<span class="params">('ascii', <span class="number">0</span>, buf2.length)</span>)</span>;
buf1[<span class="number">0</span>] = <span class="number">33</span>;
console.<span class="built_in">log</span><span class="params">(buf2.toString<span class="params">('ascii', <span class="number">0</span>, buf2.length)</span>)</span>;

<span class="comment">// abc</span>
<span class="comment">// !bc</span>
</code></pre><h3 id="buf-readUInt8(offset[,_noAssert])">buf.readUInt8(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads an unsigned 8 bit integer from the buffer at the specified offset.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code>var <span class="keyword">buf</span> <span class="keyword">=</span> new Buffer(<span class="number">4</span>);

<span class="keyword">buf</span>[<span class="number">0</span>] <span class="keyword">=</span> <span class="number">0x3</span>;
<span class="keyword">buf</span>[<span class="number">1</span>] <span class="keyword">=</span> <span class="number">0x4</span>;
<span class="keyword">buf</span>[<span class="number">2</span>] <span class="keyword">=</span> <span class="number">0x23</span>;
<span class="keyword">buf</span>[<span class="number">3</span>] <span class="keyword">=</span> <span class="number">0x42</span>;

<span class="keyword">for</span> (ii <span class="keyword">=</span> <span class="number">0</span>; ii <span class="keyword">&lt;</span> <span class="keyword">buf</span><span class="typename">.length</span>; ii<span class="keyword">+</span><span class="keyword">+</span>) <span class="keyword">{</span>
  console<span class="typename">.log</span>(<span class="keyword">buf</span><span class="typename">.readUInt8</span>(ii));
<span class="keyword">}</span>

<span class="comment">// 0x3</span>
<span class="comment">// 0x4</span>
<span class="comment">// 0x23</span>
<span class="comment">// 0x42</span>
</code></pre><h3 id="buf-readUInt16LE(offset[,_noAssert])">buf.readUInt16LE(offset[, noAssert])</h3><h3 id="buf-readUInt16BE(offset[,_noAssert])">buf.readUInt16BE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads an unsigned 16 bit integer from the buffer at the specified offset with<br>specified endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code>var buf = new Buffer<span class="params">(<span class="number">4</span>)</span>;

buf[<span class="number">0</span>] = <span class="number">0</span>x3;
buf[<span class="number">1</span>] = <span class="number">0</span>x4;
buf[<span class="number">2</span>] = <span class="number">0</span>x23;
buf[<span class="number">3</span>] = <span class="number">0</span>x42;

console.<span class="built_in">log</span><span class="params">(buf.readUInt16BE<span class="params">(<span class="number">0</span>)</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.readUInt16LE<span class="params">(<span class="number">0</span>)</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.readUInt16BE<span class="params">(<span class="number">1</span>)</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.readUInt16LE<span class="params">(<span class="number">1</span>)</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.readUInt16BE<span class="params">(<span class="number">2</span>)</span>)</span>;
console.<span class="built_in">log</span><span class="params">(buf.readUInt16LE<span class="params">(<span class="number">2</span>)</span>)</span>;

<span class="comment">// 0x0304</span>
<span class="comment">// 0x0403</span>
<span class="comment">// 0x0423</span>
<span class="comment">// 0x2304</span>
<span class="comment">// 0x2342</span>
<span class="comment">// 0x4223</span>
</code></pre><h3 id="buf-readUInt32LE(offset[,_noAssert])">buf.readUInt32LE(offset[, noAssert])</h3><h3 id="buf-readUInt32BE(offset[,_noAssert])">buf.readUInt32BE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads an unsigned 32 bit integer from the buffer at the specified offset with<br>specified endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code>var buf = new Buffer(4)<span class="comment">;</span>

buf[0] = 0x3<span class="comment">;</span>
buf[1] = 0x4<span class="comment">;</span>
buf[2] = 0x23<span class="comment">;</span>
buf[3] = 0x42<span class="comment">;</span>

console.log(buf.readUInt32BE(0))<span class="comment">;</span>
console.log(buf.readUInt32LE(0))<span class="comment">;</span>

// <span class="number">0x03042342</span>
// <span class="number">0x42230403</span>
</code></pre><h3 id="buf-readInt8(offset[,_noAssert])">buf.readInt8(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads a signed 8 bit integer from the buffer at the specified offset.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.readUInt8</code>, except buffer contents are treated as two’s<br>complement signed values.</p>
<h3 id="buf-readInt16LE(offset[,_noAssert])">buf.readInt16LE(offset[, noAssert])</h3><h3 id="buf-readInt16BE(offset[,_noAssert])">buf.readInt16BE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads a signed 16 bit integer from the buffer at the specified offset with<br>specified endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.readUInt16*</code>, except buffer contents are treated as two’s<br>complement signed values.</p>
<h3 id="buf-readInt32LE(offset[,_noAssert])">buf.readInt32LE(offset[, noAssert])</h3><h3 id="buf-readInt32BE(offset[,_noAssert])">buf.readInt32BE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads a signed 32 bit integer from the buffer at the specified offset with<br>specified endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.readUInt32*</code>, except buffer contents are treated as two’s<br>complement signed values.</p>
<h3 id="buf-readFloatLE(offset[,_noAssert])">buf.readFloatLE(offset[, noAssert])</h3><h3 id="buf-readFloatBE(offset[,_noAssert])">buf.readFloatBE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads a 32 bit float from the buffer at the specified offset with specified<br>endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code><span class="label">var</span> <span class="keyword">buf </span>= new <span class="keyword">Buffer(4);
</span>
<span class="keyword">buf[0] </span>= <span class="number">0x00</span><span class="comment">;</span>
<span class="keyword">buf[1] </span>= <span class="number">0x00</span><span class="comment">;</span>
<span class="keyword">buf[2] </span>= <span class="number">0x80</span><span class="comment">;</span>
<span class="keyword">buf[3] </span>= <span class="number">0x3f</span><span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf.readFloatLE(0));
</span>
// <span class="number">0x01</span>
</code></pre><h3 id="buf-readDoubleLE(offset[,_noAssert])">buf.readDoubleLE(offset[, noAssert])</h3><h3 id="buf-readDoubleBE(offset[,_noAssert])">buf.readDoubleBE(offset[, noAssert])</h3><ul>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
<li>Return: Number</li>
</ul>
<p>Reads a 64 bit double from the buffer at the specified offset with specified<br>endian format.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>offset</code>. This means that <code>offset</code><br>may be beyond the end of the buffer. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code>var buf = new Buffer(8)<span class="comment">;</span>

buf[0] = 0x55<span class="comment">;</span>
buf[1] = 0x55<span class="comment">;</span>
buf[2] = 0x55<span class="comment">;</span>
buf[3] = 0x55<span class="comment">;</span>
buf[4] = 0x55<span class="comment">;</span>
buf[5] = 0x55<span class="comment">;</span>
buf[6] = 0xd5<span class="comment">;</span>
buf[7] = 0x3f<span class="comment">;</span>

console.log(buf.readDoubleLE(0))<span class="comment">;</span>

// <span class="number">0.33333333</span><span class="number">33333333</span>
</code></pre><h3 id="buf-writeUInt8(value,_offset[,_noAssert])">buf.writeUInt8(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset. Note, <code>value</code> must be a<br>valid unsigned 8 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code><span class="label">var</span> <span class="keyword">buf </span>= new <span class="keyword">Buffer(4);
</span><span class="keyword">buf.writeUInt8(0x3, </span><span class="number">0</span>)<span class="comment">;</span>
<span class="keyword">buf.writeUInt8(0x4, </span><span class="number">1</span>)<span class="comment">;</span>
<span class="keyword">buf.writeUInt8(0x23, </span><span class="number">2</span>)<span class="comment">;</span>
<span class="keyword">buf.writeUInt8(0x42, </span><span class="number">3</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
// &lt;<span class="keyword">Buffer </span><span class="number">03</span> <span class="number">04</span> <span class="number">23</span> <span class="number">42</span>&gt;
</code></pre><h3 id="buf-writeUInt16LE(value,_offset[,_noAssert])">buf.writeUInt16LE(value, offset[, noAssert])</h3><h3 id="buf-writeUInt16BE(value,_offset[,_noAssert])">buf.writeUInt16BE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, <code>value</code> must be a valid unsigned 16 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code><span class="label">var</span> <span class="keyword">buf </span>= new <span class="keyword">Buffer(4);
</span><span class="keyword">buf.writeUInt16BE(0xdead, </span><span class="number">0</span>)<span class="comment">;</span>
<span class="keyword">buf.writeUInt16BE(0xbeef, </span><span class="number">2</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
<span class="keyword">buf.writeUInt16LE(0xdead, </span><span class="number">0</span>)<span class="comment">;</span>
<span class="keyword">buf.writeUInt16LE(0xbeef, </span><span class="number">2</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
// &lt;<span class="keyword">Buffer </span>de ad <span class="keyword">be </span>ef&gt;
// &lt;<span class="keyword">Buffer </span>ad de ef <span class="keyword">be&gt;</span>
</code></pre><h3 id="buf-writeUInt32LE(value,_offset[,_noAssert])">buf.writeUInt32LE(value, offset[, noAssert])</h3><h3 id="buf-writeUInt32BE(value,_offset[,_noAssert])">buf.writeUInt32BE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, <code>value</code> must be a valid unsigned 32 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code>var buf = new Buffer<span class="params">(<span class="number">4</span>)</span>;
buf.writeUInt32BE<span class="params">(<span class="number">0</span>xfeedface, <span class="number">0</span>)</span>;

console.<span class="built_in">log</span><span class="params">(buf)</span>;

buf.writeUInt32LE<span class="params">(<span class="number">0</span>xfeedface, <span class="number">0</span>)</span>;

console.<span class="built_in">log</span><span class="params">(buf)</span>;

<span class="comment">// &lt;Buffer fe ed fa ce&gt;</span>
<span class="comment">// &lt;Buffer ce fa ed fe&gt;</span>
</code></pre><h3 id="buf-writeInt8(value,_offset[,_noAssert])">buf.writeInt8(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset. Note, <code>value</code> must be a<br>valid signed 8 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.writeUInt8</code>, except value is written out as a two’s complement<br>signed integer into <code>buffer</code>.</p>
<h3 id="buf-writeInt16LE(value,_offset[,_noAssert])">buf.writeInt16LE(value, offset[, noAssert])</h3><h3 id="buf-writeInt16BE(value,_offset[,_noAssert])">buf.writeInt16BE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, <code>value</code> must be a valid signed 16 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.writeUInt16*</code>, except value is written out as a two’s<br>complement signed integer into <code>buffer</code>.</p>
<h3 id="buf-writeInt32LE(value,_offset[,_noAssert])">buf.writeInt32LE(value, offset[, noAssert])</h3><h3 id="buf-writeInt32BE(value,_offset[,_noAssert])">buf.writeInt32BE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, <code>value</code> must be a valid signed 32 bit integer.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Works as <code>buffer.writeUInt32*</code>, except value is written out as a two’s<br>complement signed integer into <code>buffer</code>.</p>
<h3 id="buf-writeFloatLE(value,_offset[,_noAssert])">buf.writeFloatLE(value, offset[, noAssert])</h3><h3 id="buf-writeFloatBE(value,_offset[,_noAssert])">buf.writeFloatBE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, behavior is unspecified if <code>value</code> is not a 32 bit float.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code><span class="label">var</span> <span class="keyword">buf </span>= new <span class="keyword">Buffer(4);
</span><span class="keyword">buf.writeFloatBE(0xcafebabe, </span><span class="number">0</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
<span class="keyword">buf.writeFloatLE(0xcafebabe, </span><span class="number">0</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
// &lt;<span class="keyword">Buffer </span><span class="number">4</span>f <span class="number">4</span>a fe <span class="keyword">bb&gt;
</span>// &lt;<span class="keyword">Buffer </span><span class="keyword">bb </span>fe <span class="number">4</span>a <span class="number">4</span>f&gt;
</code></pre><h3 id="buf-writeDoubleLE(value,_offset[,_noAssert])">buf.writeDoubleLE(value, offset[, noAssert])</h3><h3 id="buf-writeDoubleBE(value,_offset[,_noAssert])">buf.writeDoubleBE(value, offset[, noAssert])</h3><ul>
<li><code>value</code> Number</li>
<li><code>offset</code> Number</li>
<li><code>noAssert</code> Boolean, Optional, Default: false</li>
</ul>
<p>Writes <code>value</code> to the buffer at the specified offset with specified endian<br>format. Note, <code>value</code> must be a valid 64 bit double.</p>
<p>Set <code>noAssert</code> to true to skip validation of <code>value</code> and <code>offset</code>. This means<br>that <code>value</code> may be too large for the specific function and <code>offset</code> may be<br>beyond the end of the buffer leading to the values being silently dropped. This<br>should not be used unless you are certain of correctness. Defaults to <code>false</code>.</p>
<p>Example:</p>
<pre><code><span class="label">var</span> <span class="keyword">buf </span>= new <span class="keyword">Buffer(8);
</span><span class="keyword">buf.writeDoubleBE(0xdeadbeefcafebabe, </span><span class="number">0</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
<span class="keyword">buf.writeDoubleLE(0xdeadbeefcafebabe, </span><span class="number">0</span>)<span class="comment">;</span>

<span class="label">console.log</span>(<span class="keyword">buf);
</span>
// &lt;<span class="keyword">Buffer </span><span class="number">43</span> eb <span class="literal">d5</span> <span class="keyword">b7 </span>dd f9 <span class="number">5</span>f <span class="literal">d7</span>&gt;
// &lt;<span class="keyword">Buffer </span><span class="literal">d7</span> <span class="number">5</span>f f9 dd <span class="keyword">b7 </span><span class="literal">d5</span> eb <span class="number">43</span>&gt;
</code></pre><h3 id="buf-fill(value[,_offset][,_end])">buf.fill(value[, offset][, end])</h3><ul>
<li><code>value</code></li>
<li><code>offset</code> Number, Optional</li>
<li><code>end</code> Number, Optional</li>
</ul>
<p>Fills the buffer with the specified value. If the <code>offset</code> (defaults to <code>0</code>)<br>and <code>end</code> (defaults to <code>buffer.length</code>) are not given it will fill the entire<br>buffer.</p>
<pre><code><span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="number">50</span>);
b.fill(<span class="string">"h"</span>);
</code></pre><h2 id="buffer-INSPECT_MAX_BYTES">buffer.INSPECT_MAX_BYTES</h2><ul>
<li>Number, Default: 50</li>
</ul>
<p>How many bytes will be returned when <code>buffer.inspect()</code> is called. This can<br>be overridden by user modules.</p>
<p>Note that this is a property on the buffer module returned by<br><code>require(&#39;buffer&#39;)</code>, not on the Buffer global, or a buffer instance.</p>
<h2 id="Class:_SlowBuffer">Class: SlowBuffer</h2><p>Returns an un-pooled <code>Buffer</code>.</p>
<p>In order to avoid the garbage collection overhead of creating many individually<br>allocated Buffers, by default allocations under 4KB are sliced from a single<br>larger allocated object. This approach improves both performance and memory<br>usage since v8 does not need to track and cleanup as many <code>Persistent</code> objects.</p>
<p>In the case where a developer may need to retain a small chunk of memory from a<br>pool for an indeterminate amount of time it may be appropriate to create an<br>un-pooled Buffer instance using SlowBuffer and copy out the relevant bits.</p>
<pre><code><span class="comment">// need to keep around a few small chunks of memory</span>
<span class="keyword">var</span> store = [];

socket.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="keyword">var</span> data = socket.read();
  <span class="comment">// allocate for retained data</span>
  <span class="keyword">var</span> sb = <span class="keyword">new</span> SlowBuffer(<span class="number">10</span>);
  <span class="comment">// copy the data into the new allocation</span>
  data.copy(sb, <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);
  store.push(sb);
});
</code></pre><p>Though this should used sparingly and only be a last resort <em>after</em> a developer<br>has actively observed undue memory retention in their applications.</p>
<h1 id="Stream"><a id="stream">Stream</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable</span>
</code></pre><p>A stream is an abstract interface implemented by various objects in<br>Node.  For example a <a href="http.html#http_http_incomingmessage">request to an HTTP<br>server</a> is a stream, as is<br><a href="process.html#process_process_stdout">stdout</a>. Streams are readable, writable, or both. All streams are<br>instances of <a href="events.html#events_class_events_eventemitter">EventEmitter</a></p>
<p>You can load the Stream base classes by doing <code>require(&#39;stream&#39;)</code>.<br>There are base classes provided for <a href="#stream_class_stream_readable">Readable</a> streams, <a href="#stream_class_stream_writable">Writable</a><br>streams, <a href="#stream_class_stream_duplex">Duplex</a> streams, and <a href="#stream_class_stream_transform">Transform</a> streams.</p>
<p>This document is split up into 3 sections.  The first explains the<br>parts of the API that you need to be aware of to use streams in your<br>programs.  If you never implement a streaming API yourself, you can<br>stop there.</p>
<p>The second section explains the parts of the API that you need to use<br>if you implement your own custom streams yourself.  The API is<br>designed to make this easy for you to do.</p>
<p>The third section goes into more depth about how streams work,<br>including some of the internal mechanisms and functions that you<br>should probably not modify unless you definitely know what you are<br>doing.</p>
<h2 id="API_for_Stream_Consumers">API for Stream Consumers</h2><!--type=misc-->
<p>Streams can be either <a href="#stream_class_stream_readable">Readable</a>, <a href="#stream_class_stream_writable">Writable</a>, or both (<a href="#stream_class_stream_duplex">Duplex</a>).</p>
<p>All streams are EventEmitters, but they also have other custom methods<br>and properties depending on whether they are Readable, Writable, or<br>Duplex.</p>
<p>If a stream is both Readable and Writable, then it implements all of<br>the methods and events below.  So, a <a href="#stream_class_stream_duplex">Duplex</a> or <a href="#stream_class_stream_transform">Transform</a> stream is<br>fully described by this API, though their implementation may be<br>somewhat different.</p>
<p>It is not necessary to implement Stream interfaces in order to consume<br>streams in your programs.  If you <strong>are</strong> implementing streaming<br>interfaces in your own program, please also refer to<br><a href="#stream_api_for_stream_implementors">API for Stream Implementors</a> below.</p>
<p>Almost all Node programs, no matter how simple, use Streams in some<br>way.  Here is an example of using Streams in a Node program:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// req is an http.IncomingMessage, which is a Readable Stream</span></span><br><span class="line">  <span class="comment">// res is an http.ServerResponse, which is a Writable Stream</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">  <span class="comment">// we want to get the data as utf8 strings</span></span><br><span class="line">  <span class="comment">// If you don't set an encoding, then you'll get Buffer objects</span></span><br><span class="line">  req.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Readable streams emit 'data' events once a listener is added</span></span><br><span class="line">  req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    body += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the end event tells you that you have entire body</span></span><br><span class="line">  req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(body);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">      <span class="comment">// uh oh!  bad json!</span></span><br><span class="line">      res.statusCode = <span class="number">400</span>;</span><br><span class="line">      <span class="keyword">return</span> res.end(<span class="string">'error: '</span> + er.message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write back something interesting to the user:</span></span><br><span class="line">    res.write(<span class="keyword">typeof</span> data);</span><br><span class="line">    res.end();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">1337</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $ curl localhost:1337 -d '&#123;&#125;'</span></span><br><span class="line"><span class="comment">// object</span></span><br><span class="line"><span class="comment">// $ curl localhost:1337 -d '"foo"'</span></span><br><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="comment">// $ curl localhost:1337 -d 'not json'</span></span><br><span class="line"><span class="comment">// error: Unexpected token o</span></span><br></pre></td></tr></table></figure>
<h3 id="Class:_stream-Readable">Class: stream.Readable</h3><!--type=class-->
<p>The Readable stream interface is the abstraction for a <em>source</em> of<br>data that you are reading from.  In other words, data comes <em>out</em> of a<br>Readable stream.</p>
<p>A Readable stream will not start emitting data until you indicate that<br>you are ready to receive it.</p>
<p>Readable streams have two “modes”: a <strong>flowing mode</strong> and a <strong>paused<br>mode</strong>.  When in flowing mode, data is read from the underlying system<br>and provided to your program as fast as possible.  In paused mode, you<br>must explicitly call <code>stream.read()</code> to get chunks of data out.<br>Streams start out in paused mode.</p>
<p><strong>Note</strong>: If no data event handlers are attached, and there are no<br><a href="#stream_readable_pipe_destination_options"><code>pipe()</code></a> destinations, and the stream is switched into flowing<br>mode, then data will be lost.</p>
<p>You can switch to flowing mode by doing any of the following:</p>
<ul>
<li>Adding a <a href="#stream_event_data"><code>&#39;data&#39;</code> event</a> handler to listen for data.</li>
<li>Calling the <a href="#stream_readable_resume"><code>resume()</code></a> method to explicitly open the flow.</li>
<li>Calling the <a href="#stream_readable_pipe_destination_options"><code>pipe()</code></a> method to send the data to a <a href="#stream_class_stream_writable">Writable</a>.</li>
</ul>
<p>You can switch back to paused mode by doing either of the following:</p>
<ul>
<li>If there are no pipe destinations, by calling the <a href="#stream_readable_pause"><code>pause()</code></a><br>method.</li>
<li>If there are pipe destinations, by removing any <a href="#stream_event_data"><code>&#39;data&#39;</code> event</a><br>handlers, and removing all pipe destinations by calling the<br><a href="#stream_readable_unpipe_destination"><code>unpipe()</code></a> method.</li>
</ul>
<p>Note that, for backwards compatibility reasons, removing <code>&#39;data&#39;</code><br>event handlers will <strong>not</strong> automatically pause the stream.  Also, if<br>there are piped destinations, then calling <code>pause()</code> will not<br>guarantee that the stream will <em>remain</em> paused once those<br>destinations drain and ask for more data.</p>
<p>Examples of readable streams include:</p>
<ul>
<li><a href="http.html#http_http_incomingmessage">http responses, on the client</a></li>
<li><a href="http.html#http_http_incomingmessage">http requests, on the server</a></li>
<li><a href="fs.html#fs_class_fs_readstream">fs read streams</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
<li><a href="net.html#net_class_net_socket">tcp sockets</a></li>
<li><a href="child_process.html#child_process_child_stdout">child process stdout and stderr</a></li>
<li><a href="process.html#process_process_stdin">process.stdin</a></li>
</ul>
<h4 id="Event:_‘readable’">Event: ‘readable’</h4><p>When a chunk of data can be read from the stream, it will emit a<br><code>&#39;readable&#39;</code> event.</p>
<p>In some cases, listening for a <code>&#39;readable&#39;</code> event will cause some data<br>to be read into the internal buffer from the underlying system, if it<br>hadn’t already.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// there is some data to read now</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Once the internal buffer is drained, a <code>readable</code> event will fire<br>again when more data is available.</p>
<h4 id="Event:_‘data’">Event: ‘data’</h4><ul>
<li><code>chunk</code> {Buffer | String} The chunk of data.</li>
</ul>
<p>Attaching a <code>data</code> event listener to a stream that has not been<br>explicitly paused will switch the stream into flowing mode. Data will<br>then be passed as soon as it is available.</p>
<p>If you just want to get all the data out of the stream as fast as<br>possible, this is the best way to do so.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got %d bytes of data'</span>, chunk.length);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘end’">Event: ‘end’</h4><p>This event fires when there will be no more data to read.</p>
<p>Note that the <code>end</code> event <strong>will not fire</strong> unless the data is<br>completely consumed.  This can be done by switching into flowing mode,<br>or by calling <code>read()</code> repeatedly until you get to the end.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got %d bytes of data'</span>, chunk.length);</span><br><span class="line">&#125;);</span><br><span class="line">readable.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'there will be no more data.'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘close’">Event: ‘close’</h4><p>Emitted when the underlying resource (for example, the backing file<br>descriptor) has been closed. Not all streams will emit this.</p>
<h4 id="Event:_‘error’">Event: ‘error’</h4><ul>
<li>{Error Object}</li>
</ul>
<p>Emitted if there was an error receiving data.</p>
<h4 id="readable-read([size])">readable.read([size])</h4><ul>
<li><code>size</code> {Number} Optional argument to specify how much data to read.</li>
<li>Return {String | Buffer | null}</li>
</ul>
<p>The <code>read()</code> method pulls some data out of the internal buffer and<br>returns it.  If there is no data available, then it will return<br><code>null</code>.</p>
<p>If you pass in a <code>size</code> argument, then it will return that many<br>bytes.  If <code>size</code> bytes are not available, then it will return <code>null</code>.</p>
<p>If you do not specify a <code>size</code> argument, then it will return all the<br>data in the internal buffer.</p>
<p>This method should only be called in paused mode.  In flowing mode,<br>this method is called automatically until the internal buffer is<br>drained.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> chunk;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">null</span> !== (chunk = readable.read())) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'got %d bytes of data'</span>, chunk.length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>If this method returns a data chunk, then it will also trigger the<br>emission of a <a href="#stream_event_data"><code>&#39;data&#39;</code> event</a>.</p>
<h4 id="readable-setEncoding(encoding)">readable.setEncoding(encoding)</h4><ul>
<li><code>encoding</code> {String} The encoding to use.</li>
<li>Return: <code>this</code></li>
</ul>
<p>Call this function to cause the stream to return strings of the<br>specified encoding instead of Buffer objects.  For example, if you do<br><code>readable.setEncoding(&#39;utf8&#39;)</code>, then the output data will be<br>interpreted as UTF-8 data, and returned as strings.  If you do<br><code>readable.setEncoding(&#39;hex&#39;)</code>, then the data will be encoded in<br>hexadecimal string format.</p>
<p>This properly handles multi-byte characters that would otherwise be<br>potentially mangled if you simply pulled the Buffers directly and<br>called <code>buf.toString(encoding)</code> on them.  If you want to read the data<br>as strings, always use this method.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">readable.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  assert.equal(<span class="keyword">typeof</span> chunk, <span class="string">'string'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got %d characters of string data'</span>, chunk.length);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="readable-resume()">readable.resume()</h4><ul>
<li>Return: <code>this</code></li>
</ul>
<p>This method will cause the readable stream to resume emitting <code>data</code><br>events.</p>
<p>This method will switch the stream into flowing mode.  If you do <em>not</em><br>want to consume the data from a stream, but you <em>do</em> want to get to<br>its <code>end</code> event, you can call <a href="#stream_readable_resume"><code>readable.resume()</code></a> to open the flow of<br>data.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.resume();</span><br><span class="line">readable.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got to the end, but did not read anything'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="readable-pause()">readable.pause()</h4><ul>
<li>Return: <code>this</code></li>
</ul>
<p>This method will cause a stream in flowing mode to stop emitting<br><code>data</code> events, switching out of flowing mode.  Any data that becomes<br>available will remain in the internal buffer.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line">readable.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got %d bytes of data'</span>, chunk.length);</span><br><span class="line">  readable.pause();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'there will be no more data for 1 second'</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'now data will start flowing again'</span>);</span><br><span class="line">    readable.resume();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="readable-isPaused()">readable.isPaused()</h4><ul>
<li>Return: <code>Boolean</code></li>
</ul>
<p>This method returns whether or not the <code>readable</code> has been <strong>explicitly</strong><br>paused by client code (using <code>readable.pause()</code> without a corresponding<br><code>readable.resume()</code>).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = <span class="keyword">new</span> stream.Readable</span><br><span class="line"></span><br><span class="line">readable.isPaused() <span class="comment">// === false</span></span><br><span class="line">readable.pause()</span><br><span class="line">readable.isPaused() <span class="comment">// === true</span></span><br><span class="line">readable.resume()</span><br><span class="line">readable.isPaused() <span class="comment">// === false</span></span><br></pre></td></tr></table></figure>
<h4 id="readable-pipe(destination[,_options])">readable.pipe(destination[, options])</h4><ul>
<li><code>destination</code> {<a href="#stream_class_stream_writable">Writable</a> Stream} The destination for writing data</li>
<li><code>options</code> {Object} Pipe options<ul>
<li><code>end</code> {Boolean} End the writer when the reader ends. Default = <code>true</code></li>
</ul>
</li>
</ul>
<p>This method pulls all the data out of a readable stream, and writes it<br>to the supplied destination, automatically managing the flow so that<br>the destination is not overwhelmed by a fast readable stream.</p>
<p>Multiple destinations can be piped to safely.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line"><span class="keyword">var</span> writable = fs.createWriteStream(<span class="string">'file.txt'</span>);</span><br><span class="line"><span class="comment">// All the data from readable goes into 'file.txt'</span></span><br><span class="line">readable.pipe(writable);</span><br></pre></td></tr></table></figure>
<p>This function returns the destination stream, so you can set up pipe<br>chains like so:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r = fs.createReadStream(<span class="string">'file.txt'</span>);</span><br><span class="line"><span class="keyword">var</span> z = zlib.createGzip();</span><br><span class="line"><span class="keyword">var</span> w = fs.createWriteStream(<span class="string">'file.txt.gz'</span>);</span><br><span class="line">r.pipe(z).pipe(w);</span><br></pre></td></tr></table></figure>
<p>For example, emulating the Unix <code>cat</code> command:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.stdin.pipe(process.stdout);</span><br></pre></td></tr></table></figure>
<p>By default <a href="#stream_writable_end_chunk_encoding_callback"><code>end()</code></a> is called on the destination when the source stream<br>emits <code>end</code>, so that <code>destination</code> is no longer writable. Pass <code>{ end:
false }</code> as <code>options</code> to keep the destination stream open.</p>
<p>This keeps <code>writer</code> open so that “Goodbye” can be written at the<br>end.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reader.pipe(writer, &#123; end: <span class="literal">false</span> &#125;);</span><br><span class="line">reader.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  writer.end(<span class="string">'Goodbye\n'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Note that <code>process.stderr</code> and <code>process.stdout</code> are never closed until<br>the process exits, regardless of the specified options.</p>
<h4 id="readable-unpipe([destination])">readable.unpipe([destination])</h4><ul>
<li><code>destination</code> {<a href="#stream_class_stream_writable">Writable</a> Stream} Optional specific stream to unpipe</li>
</ul>
<p>This method will remove the hooks set up for a previous <code>pipe()</code> call.</p>
<p>If the destination is not specified, then all pipes are removed.</p>
<p>If the destination is specified, but no pipe is set up for it, then<br>this is a no-op.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readable = getReadableStreamSomehow();</span><br><span class="line"><span class="keyword">var</span> writable = fs.createWriteStream(<span class="string">'file.txt'</span>);</span><br><span class="line"><span class="comment">// All the data from readable goes into 'file.txt',</span></span><br><span class="line"><span class="comment">// but only for the first second</span></span><br><span class="line">readable.pipe(writable);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'stop writing to file.txt'</span>);</span><br><span class="line">  readable.unpipe(writable);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'manually close the file stream'</span>);</span><br><span class="line">  writable.end();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h4 id="readable-unshift(chunk)">readable.unshift(chunk)</h4><ul>
<li><code>chunk</code> {Buffer | String} Chunk of data to unshift onto the read queue</li>
</ul>
<p>This is useful in certain cases where a stream is being consumed by a<br>parser, which needs to “un-consume” some data that it has<br>optimistically pulled out of the source, so that the stream can be<br>passed on to some other party.</p>
<p>If you find that you must often call <code>stream.unshift(chunk)</code> in your<br>programs, consider implementing a <a href="#stream_class_stream_transform">Transform</a> stream instead.  (See API<br>for Stream Implementors, below.)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pull off a header delimited by \n\n</span></span><br><span class="line"><span class="comment">// use unshift() if we get too much</span></span><br><span class="line"><span class="comment">// Call the callback with (error, header, stream)</span></span><br><span class="line"><span class="keyword">var</span> StringDecoder = <span class="built_in">require</span>(<span class="string">'string_decoder'</span>).StringDecoder;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseHeader</span>(<span class="params">stream, callback</span>) </span>&#123;</span><br><span class="line">  stream.on(<span class="string">'error'</span>, callback);</span><br><span class="line">  stream.on(<span class="string">'readable'</span>, onReadable);</span><br><span class="line">  <span class="keyword">var</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf8'</span>);</span><br><span class="line">  <span class="keyword">var</span> header = <span class="string">''</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onReadable</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> chunk;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">null</span> !== (chunk = stream.read())) &#123;</span><br><span class="line">      <span class="keyword">var</span> str = decoder.write(chunk);</span><br><span class="line">      <span class="keyword">if</span> (str.match(<span class="regexp">/\n\n/</span>)) &#123;</span><br><span class="line">        <span class="comment">// found the header boundary</span></span><br><span class="line">        <span class="keyword">var</span> split = str.split(<span class="regexp">/\n\n/</span>);</span><br><span class="line">        header += split.shift();</span><br><span class="line">        <span class="keyword">var</span> remaining = split.join(<span class="string">'\n\n'</span>);</span><br><span class="line">        <span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(remaining, <span class="string">'utf8'</span>);</span><br><span class="line">        <span class="keyword">if</span> (buf.length)</span><br><span class="line">          stream.unshift(buf);</span><br><span class="line">        stream.removeListener(<span class="string">'error'</span>, callback);</span><br><span class="line">        stream.removeListener(<span class="string">'readable'</span>, onReadable);</span><br><span class="line">        <span class="comment">// now the body of the message can be read from the stream.</span></span><br><span class="line">        callback(<span class="literal">null</span>, header, stream);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// still reading the header.</span></span><br><span class="line">        header += str;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="readable-wrap(stream)">readable.wrap(stream)</h4><ul>
<li><code>stream</code> {Stream} An “old style” readable stream</li>
</ul>
<p>Versions of Node prior to v0.10 had streams that did not implement the<br>entire Streams API as it is today.  (See “Compatibility” below for<br>more information.)</p>
<p>If you are using an older Node library that emits <code>&#39;data&#39;</code> events and<br>has a <a href="#stream_readable_pause"><code>pause()</code></a> method that is advisory only, then you can use the<br><code>wrap()</code> method to create a <a href="#stream_class_stream_readable">Readable</a> stream that uses the old stream<br>as its data source.</p>
<p>You will very rarely ever need to call this function, but it exists<br>as a convenience for interacting with old Node programs and libraries.</p>
<p>For example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> OldReader = <span class="built_in">require</span>(<span class="string">'./old-api-module.js'</span>).OldReader;</span><br><span class="line"><span class="keyword">var</span> oreader = <span class="keyword">new</span> OldReader;</span><br><span class="line"><span class="keyword">var</span> Readable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Readable;</span><br><span class="line"><span class="keyword">var</span> myReader = <span class="keyword">new</span> Readable().wrap(oreader);</span><br><span class="line"></span><br><span class="line">myReader.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  myReader.read(); <span class="comment">// etc.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Class:_stream-Writable">Class: stream.Writable</h3><!--type=class-->
<p>The Writable stream interface is an abstraction for a <em>destination</em><br>that you are writing data <em>to</em>.</p>
<p>Examples of writable streams include:</p>
<ul>
<li><a href="http.html#http_class_http_clientrequest">http requests, on the client</a></li>
<li><a href="http.html#http_class_http_serverresponse">http responses, on the server</a></li>
<li><a href="fs.html#fs_class_fs_writestream">fs write streams</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
<li><a href="net.html#net_class_net_socket">tcp sockets</a></li>
<li><a href="child_process.html#child_process_child_stdin">child process stdin</a></li>
<li><a href="process.html#process_process_stdout">process.stdout</a>, <a href="process.html#process_process_stderr">process.stderr</a></li>
</ul>
<h4 id="writable-write(chunk[,_encoding][,_callback])">writable.write(chunk[, encoding][, callback])</h4><ul>
<li><code>chunk</code> {String | Buffer} The data to write</li>
<li><code>encoding</code> {String} The encoding, if <code>chunk</code> is a String</li>
<li><code>callback</code> {Function} Callback for when this chunk of data is flushed</li>
<li>Returns: {Boolean} True if the data was handled completely.</li>
</ul>
<p>This method writes some data to the underlying system, and calls the<br>supplied callback once the data has been fully handled.</p>
<p>The return value indicates if you should continue writing right now.<br>If the data had to be buffered internally, then it will return<br><code>false</code>.  Otherwise, it will return <code>true</code>.</p>
<p>This return value is strictly advisory.  You MAY continue to write,<br>even if it returns <code>false</code>.  However, writes will be buffered in<br>memory, so it is best not to do this excessively.  Instead, wait for<br>the <code>drain</code> event before writing more data.</p>
<h4 id="Event:_‘drain’">Event: ‘drain’</h4><p>If a <a href="#stream_writable_write_chunk_encoding_callback"><code>writable.write(chunk)</code></a> call returns false, then the <code>drain</code><br>event will indicate when it is appropriate to begin writing more data<br>to the stream.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Write the data to the supplied writable stream 1MM times.</span></span><br><span class="line"><span class="comment">// Be attentive to back-pressure.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeOneMillionTimes</span>(<span class="params">writer, data, encoding, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">1000000</span>;</span><br><span class="line">  write();</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ok = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      i -= <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// last time!</span></span><br><span class="line">        writer.write(data, encoding, callback);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// see if we should continue, or wait</span></span><br><span class="line">        <span class="comment">// don't pass the callback, because we're not done yet.</span></span><br><span class="line">        ok = writer.write(data, encoding);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; ok);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// had to stop early!</span></span><br><span class="line">      <span class="comment">// write some more once it drains</span></span><br><span class="line">      writer.once(<span class="string">'drain'</span>, write);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="writable-cork()">writable.cork()</h4><p>Forces buffering of all writes.</p>
<p>Buffered data will be flushed either at <code>.uncork()</code> or at <code>.end()</code> call.</p>
<h4 id="writable-uncork()">writable.uncork()</h4><p>Flush all data, buffered since <code>.cork()</code> call.</p>
<h4 id="writable-setDefaultEncoding(encoding)">writable.setDefaultEncoding(encoding)</h4><ul>
<li><code>encoding</code> {String} The new default encoding</li>
<li>Return: <code>Boolean</code></li>
</ul>
<p>Sets the default encoding for a writable stream. Returns <code>true</code> if the encoding<br>is valid and is set. Otherwise returns <code>false</code>.</p>
<h4 id="writable-end([chunk][,_encoding][,_callback])">writable.end([chunk][, encoding][, callback])</h4><ul>
<li><code>chunk</code> {String | Buffer} Optional data to write</li>
<li><code>encoding</code> {String} The encoding, if <code>chunk</code> is a String</li>
<li><code>callback</code> {Function} Optional callback for when the stream is finished</li>
</ul>
<p>Call this method when no more data will be written to the stream.  If<br>supplied, the callback is attached as a listener on the <code>finish</code> event.</p>
<p>Calling <a href="#stream_writable_write_chunk_encoding_callback"><code>write()</code></a> after calling <a href="#stream_writable_end_chunk_encoding_callback"><code>end()</code></a> will raise an error.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write 'hello, ' and then end with 'world!'</span></span><br><span class="line"><span class="keyword">var</span> file = fs.createWriteStream(<span class="string">'example.txt'</span>);</span><br><span class="line">file.write(<span class="string">'hello, '</span>);</span><br><span class="line">file.end(<span class="string">'world!'</span>);</span><br><span class="line"><span class="comment">// writing more now is not allowed!</span></span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘finish’">Event: ‘finish’</h4><p>When the <a href="#stream_writable_end_chunk_encoding_callback"><code>end()</code></a> method has been called, and all data has been flushed<br>to the underlying system, this event is emitted.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writer = getWritableStreamSomehow();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i ++) &#123;</span><br><span class="line">  writer.write(<span class="string">'hello, #'</span> + i + <span class="string">'!\n'</span>);</span><br><span class="line">&#125;</span><br><span class="line">writer.end(<span class="string">'this is the end\n'</span>);</span><br><span class="line">writer.on(<span class="string">'finish'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'all writes are now complete.'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘pipe’">Event: ‘pipe’</h4><ul>
<li><code>src</code> {<a href="#stream_class_stream_readable">Readable</a> Stream} source stream that is piping to this writable</li>
</ul>
<p>This is emitted whenever the <code>pipe()</code> method is called on a readable<br>stream, adding this writable to its set of destinations.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writer = getWritableStreamSomehow();</span><br><span class="line"><span class="keyword">var</span> reader = getReadableStreamSomehow();</span><br><span class="line">writer.on(<span class="string">'pipe'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'something is piping into the writer'</span>);</span><br><span class="line">  assert.equal(src, reader);</span><br><span class="line">&#125;);</span><br><span class="line">reader.pipe(writer);</span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘unpipe’">Event: ‘unpipe’</h4><ul>
<li><code>src</code> {<a href="#stream_class_stream_readable">Readable</a> Stream} The source stream that <a href="#stream_readable_unpipe_destination">unpiped</a> this writable</li>
</ul>
<p>This is emitted whenever the <a href="#stream_readable_unpipe_destination"><code>unpipe()</code></a> method is called on a<br>readable stream, removing this writable from its set of destinations.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writer = getWritableStreamSomehow();</span><br><span class="line"><span class="keyword">var</span> reader = getReadableStreamSomehow();</span><br><span class="line">writer.on(<span class="string">'unpipe'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'something has stopped piping into the writer'</span>);</span><br><span class="line">  assert.equal(src, reader);</span><br><span class="line">&#125;);</span><br><span class="line">reader.pipe(writer);</span><br><span class="line">reader.unpipe(writer);</span><br></pre></td></tr></table></figure>
<h4 id="Event:_‘error’-1">Event: ‘error’</h4><ul>
<li>{Error object}</li>
</ul>
<p>Emitted if there was an error when writing or piping data.</p>
<h3 id="Class:_stream-Duplex">Class: stream.Duplex</h3><p>Duplex streams are streams that implement both the <a href="#stream_class_stream_readable">Readable</a> and<br><a href="#stream_class_stream_writable">Writable</a> interfaces.  See above for usage.</p>
<p>Examples of Duplex streams include:</p>
<ul>
<li><a href="net.html#net_class_net_socket">tcp sockets</a></li>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
</ul>
<h3 id="Class:_stream-Transform">Class: stream.Transform</h3><p>Transform streams are <a href="#stream_class_stream_duplex">Duplex</a> streams where the output is in some way<br>computed from the input.  They implement both the <a href="#stream_class_stream_readable">Readable</a> and<br><a href="#stream_class_stream_writable">Writable</a> interfaces.  See above for usage.</p>
<p>Examples of Transform streams include:</p>
<ul>
<li><a href="zlib.html">zlib streams</a></li>
<li><a href="crypto.html">crypto streams</a></li>
</ul>
<h2 id="API_for_Stream_Implementors">API for Stream Implementors</h2><!--type=misc-->
<p>To implement any sort of stream, the pattern is the same:</p>
<ol>
<li>Extend the appropriate parent class in your own subclass.  (The<br><a href="util.html#util_util_inherits_constructor_superconstructor"><code>util.inherits</code></a> method is particularly helpful for this.)</li>
<li>Call the appropriate parent class constructor in your constructor,<br>to be sure that the internal mechanisms are set up properly.</li>
<li>Implement one or more specific methods, as detailed below.</li>
</ol>
<p>The class to extend and the method(s) to implement depend on the sort<br>of stream class you are writing:</p>
<table><br>  <thead><br>    <tr><br>      <th><br>        <p>Use-case</p><br>      </th><br>      <th><br>        <p>Class</p><br>      </th><br>      <th><br>        <p>Method(s) to implement</p><br>      </th><br>    </tr><br>  </thead><br>  <tr><br>    <td><br>      <p>Reading only</p><br>    </td><br>    <td><br>      <p><a href="#stream_class_stream_readable_1">Readable</a></p><br>    </td><br>    <td><br>      <p><code><a href="#stream_readable_read_size_1">_read</a></code></p><br>    </td><br>  </tr><br>  <tr><br>    <td><br>      <p>Writing only</p><br>    </td><br>    <td><br>      <p><a href="#stream_class_stream_writable_1">Writable</a></p><br>    </td><br>    <td><br>      <p><code><a href="#stream_writable_write_chunk_encoding_callback_1">_write</a></code></p><br>    </td><br>  </tr><br>  <tr><br>    <td><br>      <p>Reading and writing</p><br>    </td><br>    <td><br>      <p><a href="#stream_class_stream_duplex_1">Duplex</a></p><br>    </td><br>    <td><br>      <p><code><a href="#stream_readable_read_size_1">_read</a></code>, <code><a href="#stream_writable_write_chunk_encoding_callback_1">_write</a></code></p><br>    </td><br>  </tr><br>  <tr><br>    <td><br>      <p>Operate on written data, then read the result</p><br>    </td><br>    <td><br>      <p><a href="#stream_class_stream_transform_1">Transform</a></p><br>    </td><br>    <td><br>      <p><code>_transform</code>, <code>_flush</code></p><br>    </td><br>  </tr><br></table>

<p>In your implementation code, it is very important to never call the<br>methods described in <a href="#stream_api_for_stream_consumers">API for Stream Consumers</a> above.  Otherwise, you<br>can potentially cause adverse side effects in programs that consume<br>your streaming interfaces.</p>
<h3 id="Class:_stream-Readable-1">Class: stream.Readable</h3><!--type=class-->
<p><code>stream.Readable</code> is an abstract class designed to be extended with an<br>underlying implementation of the <a href="#stream_readable_read_size_1"><code>_read(size)</code></a> method.</p>
<p>Please see above under <a href="#stream_api_for_stream_consumers">API for Stream Consumers</a> for how to consume<br>streams in your programs.  What follows is an explanation of how to<br>implement Readable streams in your programs.</p>
<h4 id="Example:_A_Counting_Stream">Example: A Counting Stream</h4><!--type=example-->
<p>This is a basic example of a Readable stream.  It emits the numerals<br>from 1 to 1,000,000 in ascending order, and then ends.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Readable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Readable;</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line">util.inherits(Counter, Readable);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params">opt</span>) </span>&#123;</span><br><span class="line">  Readable.call(<span class="keyword">this</span>, opt);</span><br><span class="line">  <span class="keyword">this</span>._max = <span class="number">1000000</span>;</span><br><span class="line">  <span class="keyword">this</span>._index = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Counter.prototype._read = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="keyword">this</span>._index++;</span><br><span class="line">  <span class="keyword">if</span> (i &gt; <span class="keyword">this</span>._max)</span><br><span class="line">    <span class="keyword">this</span>.push(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="string">''</span> + i;</span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(str, <span class="string">'ascii'</span>);</span><br><span class="line">    <span class="keyword">this</span>.push(buf);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="Example:_SimpleProtocol_v1_(Sub-optimal)">Example: SimpleProtocol v1 (Sub-optimal)</h4><p>This is similar to the <code>parseHeader</code> function described above, but<br>implemented as a custom stream.  Also, note that this implementation<br>does not convert the incoming data to a string.</p>
<p>However, this would be better implemented as a <a href="#stream_class_stream_transform">Transform</a> stream.  See<br>below for a better implementation.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A parser for a simple data protocol.</span></span><br><span class="line"><span class="comment">// The "header" is a JSON object, followed by 2 \n characters, and</span></span><br><span class="line"><span class="comment">// then a message body.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// <span class="doctag"><span class="keyword">NOTE</span></span>: This can be done more simply as a Transform stream!</span></span><br><span class="line"><span class="comment">// Using Readable directly for this is sub-optimal.  See the</span></span><br><span class="line"><span class="comment">// alternative example below under the Transform section.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Readable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Readable;</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line">util.inherits(SimpleProtocol, Readable);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimpleProtocol</span>(<span class="params">source, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimpleProtocol))</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleProtocol(source, options);</span><br><span class="line"></span><br><span class="line">  Readable.call(<span class="keyword">this</span>, options);</span><br><span class="line">  <span class="keyword">this</span>._inBody = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>._sawFirstCr = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// source is a readable stream, such as a socket or file</span></span><br><span class="line">  <span class="keyword">this</span>._source = source;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  source.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.push(<span class="literal">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// give it a kick whenever the source is readable</span></span><br><span class="line">  <span class="comment">// read(0) will not consume any bytes</span></span><br><span class="line">  source.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.read(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._rawHeader = [];</span><br><span class="line">  <span class="keyword">this</span>.header = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimpleProtocol.prototype._read = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>._inBody) &#123;</span><br><span class="line">    <span class="keyword">var</span> chunk = <span class="keyword">this</span>._source.read();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the source doesn't have data, we don't have data yet.</span></span><br><span class="line">    <span class="keyword">if</span> (chunk === <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.push(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if the chunk has a \n\n</span></span><br><span class="line">    <span class="keyword">var</span> split = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chunk.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (chunk[i] === <span class="number">10</span>) &#123; <span class="comment">// '\n'</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._sawFirstCr) &#123;</span><br><span class="line">          split = i;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>._sawFirstCr = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._sawFirstCr = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (split === -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// still waiting for the \n\n</span></span><br><span class="line">      <span class="comment">// stash the chunk, and try again.</span></span><br><span class="line">      <span class="keyword">this</span>._rawHeader.push(chunk);</span><br><span class="line">      <span class="keyword">this</span>.push(<span class="string">''</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>._inBody = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">var</span> h = chunk.slice(<span class="number">0</span>, split);</span><br><span class="line">      <span class="keyword">this</span>._rawHeader.push(h);</span><br><span class="line">      <span class="keyword">var</span> header = Buffer.concat(<span class="keyword">this</span>._rawHeader).toString();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.header = <span class="built_in">JSON</span>.parse(header);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">        <span class="keyword">this</span>.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'invalid simple protocol data'</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// now, because we got some extra data, unshift the rest</span></span><br><span class="line">      <span class="comment">// back into the read queue so that our consumer will see it.</span></span><br><span class="line">      <span class="keyword">var</span> b = chunk.slice(split);</span><br><span class="line">      <span class="keyword">this</span>.unshift(b);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// and let them know that we are done parsing the header.</span></span><br><span class="line">      <span class="keyword">this</span>.emit(<span class="string">'header'</span>, <span class="keyword">this</span>.header);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// from there on, just provide the data to our consumer.</span></span><br><span class="line">    <span class="comment">// careful not to push(null), since that would indicate EOF.</span></span><br><span class="line">    <span class="keyword">var</span> chunk = <span class="keyword">this</span>._source.read();</span><br><span class="line">    <span class="keyword">if</span> (chunk) <span class="keyword">this</span>.push(chunk);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage:</span></span><br><span class="line"><span class="comment">// var parser = new SimpleProtocol(source);</span></span><br><span class="line"><span class="comment">// Now parser is a readable stream that will emit 'header'</span></span><br><span class="line"><span class="comment">// with the parsed header data.</span></span><br></pre></td></tr></table></figure>
<h4 id="new_stream-Readable([options])">new stream.Readable([options])</h4><ul>
<li><code>options</code> {Object}<ul>
<li><code>highWaterMark</code> {Number} The maximum number of bytes to store in<br>the internal buffer before ceasing to read from the underlying<br>resource.  Default=16kb, or 16 for <code>objectMode</code> streams</li>
<li><code>encoding</code> {String} If specified, then buffers will be decoded to<br>strings using the specified encoding.  Default=null</li>
<li><code>objectMode</code> {Boolean} Whether this stream should behave<br>as a stream of objects. Meaning that stream.read(n) returns<br>a single value instead of a Buffer of size n.  Default=false</li>
</ul>
</li>
</ul>
<p>In classes that extend the Readable class, make sure to call the<br>Readable constructor so that the buffering settings can be properly<br>initialized.</p>
<h4 id="readable-_read(size)">readable._read(size)</h4><ul>
<li><code>size</code> {Number} Number of bytes to read asynchronously</li>
</ul>
<p>Note: <strong>Implement this function, but do NOT call it directly.</strong></p>
<p>This function should NOT be called directly.  It should be implemented<br>by child classes, and only called by the internal Readable class<br>methods.</p>
<p>All Readable stream implementations must provide a <code>_read</code> method to<br>fetch data from the underlying resource.</p>
<p>This method is prefixed with an underscore because it is internal to<br>the class that defines it, and should not be called directly by user<br>programs.  However, you <strong>are</strong> expected to override this method in<br>your own extension classes.</p>
<p>When data is available, put it into the read queue by calling<br><code>readable.push(chunk)</code>.  If <code>push</code> returns false, then you should stop<br>reading.  When <code>_read</code> is called again, you should start pushing more<br>data.</p>
<p>The <code>size</code> argument is advisory.  Implementations where a “read” is a<br>single call that returns data can use this to know how much data to<br>fetch.  Implementations where that is not relevant, such as TCP or<br>TLS, may ignore this argument, and simply provide data whenever it<br>becomes available.  There is no need, for example to “wait” until<br><code>size</code> bytes are available before calling <a href="#stream_readable_push_chunk_encoding"><code>stream.push(chunk)</code></a>.</p>
<h4 id="readable-push(chunk[,_encoding])">readable.push(chunk[, encoding])</h4><ul>
<li><code>chunk</code> {Buffer | null | String} Chunk of data to push into the read queue</li>
<li><code>encoding</code> {String} Encoding of String chunks.  Must be a valid<br>Buffer encoding, such as <code>&#39;utf8&#39;</code> or <code>&#39;ascii&#39;</code></li>
<li>return {Boolean} Whether or not more pushes should be performed</li>
</ul>
<p>Note: <strong>This function should be called by Readable implementors, NOT<br>by consumers of Readable streams.</strong></p>
<p>The <code>_read()</code> function will not be called again until at least one<br><code>push(chunk)</code> call is made.</p>
<p>The <code>Readable</code> class works by putting data into a read queue to be<br>pulled out later by calling the <code>read()</code> method when the <code>&#39;readable&#39;</code><br>event fires.</p>
<p>The <code>push()</code> method will explicitly insert some data into the read<br>queue.  If it is called with <code>null</code> then it will signal the end of the<br>data (EOF).</p>
<p>This API is designed to be as flexible as possible.  For example,<br>you may be wrapping a lower-level source which has some sort of<br>pause/resume mechanism, and a data callback.  In those cases, you<br>could wrap the low-level source object by doing something like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// source is an object with readStop() and readStart() methods,</span></span><br><span class="line"><span class="comment">// and an `ondata` member that gets called when it has data, and</span></span><br><span class="line"><span class="comment">// an `onend` member that gets called when the data is over.</span></span><br><span class="line"></span><br><span class="line">util.inherits(SourceWrapper, Readable);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SourceWrapper</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  Readable.call(<span class="keyword">this</span>, options);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._source = getLowlevelSourceObject();</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Every time there's data, we push it into the internal buffer.</span></span><br><span class="line">  <span class="keyword">this</span>._source.ondata = <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// if push() returns false, then we need to stop reading from source</span></span><br><span class="line">    <span class="keyword">if</span> (!self.push(chunk))</span><br><span class="line">      self._source.readStop();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// When the source ends, we push the EOF-signaling `null` chunk</span></span><br><span class="line">  <span class="keyword">this</span>._source.onend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    self.push(<span class="literal">null</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _read will be called when the stream wants to pull more data in</span></span><br><span class="line"><span class="comment">// the advisory size argument is ignored in this case.</span></span><br><span class="line">SourceWrapper.prototype._read = <span class="function"><span class="keyword">function</span>(<span class="params">size</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._source.readStart();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Class:_stream-Writable-1">Class: stream.Writable</h3><!--type=class-->
<p><code>stream.Writable</code> is an abstract class designed to be extended with an<br>underlying implementation of the <a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write(chunk, encoding, callback)</code></a> method.</p>
<p>Please see above under <a href="#stream_api_for_stream_consumers">API for Stream Consumers</a> for how to consume<br>writable streams in your programs.  What follows is an explanation of<br>how to implement Writable streams in your programs.</p>
<h4 id="new_stream-Writable([options])">new stream.Writable([options])</h4><ul>
<li><code>options</code> {Object}<ul>
<li><code>highWaterMark</code> {Number} Buffer level when <a href="#stream_writable_write_chunk_encoding_callback"><code>write()</code></a> starts<br>returning false. Default=16kb, or 16 for <code>objectMode</code> streams</li>
<li><code>decodeStrings</code> {Boolean} Whether or not to decode strings into<br>Buffers before passing them to <a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write()</code></a>.  Default=true</li>
<li><code>objectMode</code> {Boolean} Whether or not the <code>write(anyObj)</code> is<br>a valid operation. If set you can write arbitrary data instead<br>of only <code>Buffer</code> / <code>String</code> data.  Default=false</li>
</ul>
</li>
</ul>
<p>In classes that extend the Writable class, make sure to call the<br>constructor so that the buffering settings can be properly<br>initialized.</p>
<h4 id="writable-_write(chunk,_encoding,_callback)">writable._write(chunk, encoding, callback)</h4><ul>
<li><code>chunk</code> {Buffer | String} The chunk to be written.  Will always<br>be a buffer unless the <code>decodeStrings</code> option was set to <code>false</code>.</li>
<li><code>encoding</code> {String} If the chunk is a string, then this is the<br>encoding type.  Ignore if chunk is a buffer.  Note that chunk will<br><strong>always</strong> be a buffer unless the <code>decodeStrings</code> option is<br>explicitly set to <code>false</code>.</li>
<li><code>callback</code> {Function} Call this function (optionally with an error<br>argument) when you are done processing the supplied chunk.</li>
</ul>
<p>All Writable stream implementations must provide a <a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write()</code></a><br>method to send data to the underlying resource.</p>
<p>Note: <strong>This function MUST NOT be called directly.</strong>  It should be<br>implemented by child classes, and called by the internal Writable<br>class methods only.</p>
<p>Call the callback using the standard <code>callback(error)</code> pattern to<br>signal that the write completed successfully or with an error.</p>
<p>If the <code>decodeStrings</code> flag is set in the constructor options, then<br><code>chunk</code> may be a string rather than a Buffer, and <code>encoding</code> will<br>indicate the sort of string that it is.  This is to support<br>implementations that have an optimized handling for certain string<br>data encodings.  If you do not explicitly set the <code>decodeStrings</code><br>option to <code>false</code>, then you can safely ignore the <code>encoding</code> argument,<br>and assume that <code>chunk</code> will always be a Buffer.</p>
<p>This method is prefixed with an underscore because it is internal to<br>the class that defines it, and should not be called directly by user<br>programs.  However, you <strong>are</strong> expected to override this method in<br>your own extension classes.</p>
<h3 id="writable-_writev(chunks,_callback)">writable._writev(chunks, callback)</h3><ul>
<li><code>chunks</code> {Array} The chunks to be written.  Each chunk has following<br>format: <code>{ chunk: ..., encoding: ... }</code>.</li>
<li><code>callback</code> {Function} Call this function (optionally with an error<br>argument) when you are done processing the supplied chunks.</li>
</ul>
<p>Note: <strong>This function MUST NOT be called directly.</strong>  It may be<br>implemented by child classes, and called by the internal Writable<br>class methods only.</p>
<p>This function is completely optional to implement. In most cases it is<br>unnecessary.  If implemented, it will be called with all the chunks<br>that are buffered in the write queue.</p>
<h3 id="Class:_stream-Duplex-1">Class: stream.Duplex</h3><!--type=class-->
<p>A “duplex” stream is one that is both Readable and Writable, such as a<br>TCP socket connection.</p>
<p>Note that <code>stream.Duplex</code> is an abstract class designed to be extended<br>with an underlying implementation of the <code>_read(size)</code> and<br><a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write(chunk, encoding, callback)</code></a> methods as you would with a<br>Readable or Writable stream class.</p>
<p>Since JavaScript doesn’t have multiple prototypal inheritance, this<br>class prototypally inherits from Readable, and then parasitically from<br>Writable.  It is thus up to the user to implement both the lowlevel<br><code>_read(n)</code> method as well as the lowlevel<br><a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write(chunk, encoding, callback)</code></a> method on extension duplex classes.</p>
<h4 id="new_stream-Duplex(options)">new stream.Duplex(options)</h4><ul>
<li><code>options</code> {Object} Passed to both Writable and Readable<br>constructors. Also has the following fields:<ul>
<li><code>allowHalfOpen</code> {Boolean} Default=true.  If set to <code>false</code>, then<br>the stream will automatically end the readable side when the<br>writable side ends and vice versa.</li>
<li><code>readableObjectMode</code> {Boolean} Default=false. Sets <code>objectMode</code><br>for readable side of the stream. Has no effect if <code>objectMode</code><br>is <code>true</code>.</li>
<li><code>writableObjectMode</code> {Boolean} Default=false. Sets <code>objectMode</code><br>for writable side of the stream. Has no effect if <code>objectMode</code><br>is <code>true</code>.</li>
</ul>
</li>
</ul>
<p>In classes that extend the Duplex class, make sure to call the<br>constructor so that the buffering settings can be properly<br>initialized.</p>
<h3 id="Class:_stream-Transform-1">Class: stream.Transform</h3><p>A “transform” stream is a duplex stream where the output is causally<br>connected in some way to the input, such as a <a href="zlib.html">zlib</a> stream or a<br><a href="crypto.html">crypto</a> stream.</p>
<p>There is no requirement that the output be the same size as the input,<br>the same number of chunks, or arrive at the same time.  For example, a<br>Hash stream will only ever have a single chunk of output which is<br>provided when the input is ended.  A zlib stream will produce output<br>that is either much smaller or much larger than its input.</p>
<p>Rather than implement the <a href="#stream_readable_read_size_1"><code>_read()</code></a> and <a href="#stream_writable_write_chunk_encoding_callback_1"><code>_write()</code></a> methods, Transform<br>classes must implement the <code>_transform()</code> method, and may optionally<br>also implement the <code>_flush()</code> method.  (See below.)</p>
<h4 id="new_stream-Transform([options])">new stream.Transform([options])</h4><ul>
<li><code>options</code> {Object} Passed to both Writable and Readable<br>constructors.</li>
</ul>
<p>In classes that extend the Transform class, make sure to call the<br>constructor so that the buffering settings can be properly<br>initialized.</p>
<h4 id="transform-_transform(chunk,_encoding,_callback)">transform._transform(chunk, encoding, callback)</h4><ul>
<li><code>chunk</code> {Buffer | String} The chunk to be transformed.  Will always<br>be a buffer unless the <code>decodeStrings</code> option was set to <code>false</code>.</li>
<li><code>encoding</code> {String} If the chunk is a string, then this is the<br>encoding type.  (Ignore if <code>decodeStrings</code> chunk is a buffer.)</li>
<li><code>callback</code> {Function} Call this function (optionally with an error<br>argument and data) when you are done processing the supplied chunk.</li>
</ul>
<p>Note: <strong>This function MUST NOT be called directly.</strong>  It should be<br>implemented by child classes, and called by the internal Transform<br>class methods only.</p>
<p>All Transform stream implementations must provide a <code>_transform</code><br>method to accept input and produce output.</p>
<p><code>_transform</code> should do whatever has to be done in this specific<br>Transform class, to handle the bytes being written, and pass them off<br>to the readable portion of the interface.  Do asynchronous I/O,<br>process things, and so on.</p>
<p>Call <code>transform.push(outputChunk)</code> 0 or more times to generate output<br>from this input chunk, depending on how much data you want to output<br>as a result of this chunk.</p>
<p>Call the callback function only when the current chunk is completely<br>consumed.  Note that there may or may not be output as a result of any<br>particular input chunk. If you supply as the second argument to the<br>it will be passed to push method, in other words the following are<br>equivalent:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">transform.prototype._transform = <span class="function"><span class="keyword">function</span> (<span class="params">data, encoding, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.push(data);</span><br><span class="line">  callback();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transform.prototype._transform = <span class="function"><span class="keyword">function</span> (<span class="params">data, encoding, callback</span>) </span>&#123;</span><br><span class="line">  callback(<span class="literal">null</span>, data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method is prefixed with an underscore because it is internal to<br>the class that defines it, and should not be called directly by user<br>programs.  However, you <strong>are</strong> expected to override this method in<br>your own extension classes.</p>
<h4 id="transform-_flush(callback)">transform._flush(callback)</h4><ul>
<li><code>callback</code> {Function} Call this function (optionally with an error<br>argument) when you are done flushing any remaining data.</li>
</ul>
<p>Note: <strong>This function MUST NOT be called directly.</strong>  It MAY be implemented<br>by child classes, and if so, will be called by the internal Transform<br>class methods only.</p>
<p>In some cases, your transform operation may need to emit a bit more<br>data at the end of the stream.  For example, a <code>Zlib</code> compression<br>stream will store up some internal state so that it can optimally<br>compress the output.  At the end, however, it needs to do the best it<br>can with what is left, so that the data will be complete.</p>
<p>In those cases, you can implement a <code>_flush</code> method, which will be<br>called at the very end, after all the written data is consumed, but<br>before emitting <code>end</code> to signal the end of the readable side.  Just<br>like with <code>_transform</code>, call <code>transform.push(chunk)</code> zero or more<br>times, as appropriate, and call <code>callback</code> when the flush operation is<br>complete.</p>
<p>This method is prefixed with an underscore because it is internal to<br>the class that defines it, and should not be called directly by user<br>programs.  However, you <strong>are</strong> expected to override this method in<br>your own extension classes.</p>
<h4 id="Events:_‘finish’_and_‘end’">Events: ‘finish’ and ‘end’</h4><p>The <a href="#stream_event_finish"><code>finish</code></a> and <a href="#stream_event_end"><code>end</code></a> events are from the parent Writable<br>and Readable classes respectively. The <code>finish</code> event is fired after<br><code>.end()</code> is called and all chunks have been processed by <code>_transform</code>,<br><code>end</code> is fired after all data has been output which is after the callback<br>in <code>_flush</code> has been called.</p>
<h4 id="Example:_SimpleProtocol_parser_v2">Example: <code>SimpleProtocol</code> parser v2</h4><p>The example above of a simple protocol parser can be implemented<br>simply by using the higher level <a href="#stream_class_stream_transform">Transform</a> stream class, similar to<br>the <code>parseHeader</code> and <code>SimpleProtocol v1</code> examples above.</p>
<p>In this example, rather than providing the input as an argument, it<br>would be piped into the parser, which is a more idiomatic Node stream<br>approach.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">var</span> Transform = <span class="built_in">require</span>(<span class="string">'stream'</span>).Transform;</span><br><span class="line">util.inherits(SimpleProtocol, Transform);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimpleProtocol</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimpleProtocol))</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleProtocol(options);</span><br><span class="line"></span><br><span class="line">  Transform.call(<span class="keyword">this</span>, options);</span><br><span class="line">  <span class="keyword">this</span>._inBody = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>._sawFirstCr = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">this</span>._rawHeader = [];</span><br><span class="line">  <span class="keyword">this</span>.header = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimpleProtocol.prototype._transform = <span class="function"><span class="keyword">function</span>(<span class="params">chunk, encoding, done</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>._inBody) &#123;</span><br><span class="line">    <span class="comment">// check if the chunk has a \n\n</span></span><br><span class="line">    <span class="keyword">var</span> split = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chunk.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (chunk[i] === <span class="number">10</span>) &#123; <span class="comment">// '\n'</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._sawFirstCr) &#123;</span><br><span class="line">          split = i;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>._sawFirstCr = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._sawFirstCr = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (split === -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// still waiting for the \n\n</span></span><br><span class="line">      <span class="comment">// stash the chunk, and try again.</span></span><br><span class="line">      <span class="keyword">this</span>._rawHeader.push(chunk);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>._inBody = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">var</span> h = chunk.slice(<span class="number">0</span>, split);</span><br><span class="line">      <span class="keyword">this</span>._rawHeader.push(h);</span><br><span class="line">      <span class="keyword">var</span> header = Buffer.concat(<span class="keyword">this</span>._rawHeader).toString();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.header = <span class="built_in">JSON</span>.parse(header);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">        <span class="keyword">this</span>.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'invalid simple protocol data'</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// and let them know that we are done parsing the header.</span></span><br><span class="line">      <span class="keyword">this</span>.emit(<span class="string">'header'</span>, <span class="keyword">this</span>.header);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// now, because we got some extra data, emit this first.</span></span><br><span class="line">      <span class="keyword">this</span>.push(chunk.slice(split));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// from there on, just provide the data to our consumer as-is.</span></span><br><span class="line">    <span class="keyword">this</span>.push(chunk);</span><br><span class="line">  &#125;</span><br><span class="line">  done();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Usage:</span></span><br><span class="line"><span class="comment">// var parser = new SimpleProtocol();</span></span><br><span class="line"><span class="comment">// source.pipe(parser)</span></span><br><span class="line"><span class="comment">// Now parser is a readable stream that will emit 'header'</span></span><br><span class="line"><span class="comment">// with the parsed header data.</span></span><br></pre></td></tr></table></figure>
<h3 id="Class:_stream-PassThrough">Class: stream.PassThrough</h3><p>This is a trivial implementation of a <a href="#stream_class_stream_transform">Transform</a> stream that simply<br>passes the input bytes across to the output.  Its purpose is mainly<br>for examples and testing, but there are occasionally use cases where<br>it can come in handy as a building block for novel sorts of streams.</p>
<h2 id="Streams:_Under_the_Hood">Streams: Under the Hood</h2><!--type=misc-->
<h3 id="Buffering">Buffering</h3><!--type=misc-->
<p>Both Writable and Readable streams will buffer data on an internal<br>object called <code>_writableState.buffer</code> or <code>_readableState.buffer</code>,<br>respectively.</p>
<p>The amount of data that will potentially be buffered depends on the<br><code>highWaterMark</code> option which is passed into the constructor.</p>
<p>Buffering in Readable streams happens when the implementation calls<br><a href="#stream_readable_push_chunk_encoding"><code>stream.push(chunk)</code></a>.  If the consumer of the Stream does not call<br><code>stream.read()</code>, then the data will sit in the internal queue until it<br>is consumed.</p>
<p>Buffering in Writable streams happens when the user calls<br><a href="#stream_writable_write_chunk_encoding_callback"><code>stream.write(chunk)</code></a> repeatedly, even when <code>write()</code> returns <code>false</code>.</p>
<p>The purpose of streams, especially with the <code>pipe()</code> method, is to<br>limit the buffering of data to acceptable levels, so that sources and<br>destinations of varying speed will not overwhelm the available memory.</p>
<h3 id="stream-read(0)"><code>stream.read(0)</code></h3><p>There are some cases where you want to trigger a refresh of the<br>underlying readable stream mechanisms, without actually consuming any<br>data.  In that case, you can call <code>stream.read(0)</code>, which will always<br>return null.</p>
<p>If the internal read buffer is below the <code>highWaterMark</code>, and the<br>stream is not currently reading, then calling <code>read(0)</code> will trigger<br>a low-level <code>_read</code> call.</p>
<p>There is almost never a need to do this.  However, you will see some<br>cases in Node’s internals where this is done, particularly in the<br>Readable stream class internals.</p>
<h3 id="stream-push(&#39;&#39;)"><code>stream.push(&#39;&#39;)</code></h3><p>Pushing a zero-byte string or Buffer (when not in <a href="#stream_object_mode">Object mode</a>) has an<br>interesting side effect.  Because it <em>is</em> a call to<br><a href="#stream_readable_push_chunk_encoding"><code>stream.push()</code></a>, it will end the <code>reading</code> process.  However, it<br>does <em>not</em> add any data to the readable buffer, so there’s nothing for<br>a user to consume.</p>
<p>Very rarely, there are cases where you have no data to provide now,<br>but the consumer of your stream (or, perhaps, another bit of your own<br>code) will know when to check again, by calling <code>stream.read(0)</code>.  In<br>those cases, you <em>may</em> call <code>stream.push(&#39;&#39;)</code>.</p>
<p>So far, the only use case for this functionality is in the<br><a href="tls.html#tls_class_cryptostream">tls.CryptoStream</a> class, which is deprecated in Node v0.12.  If you<br>find that you have to use <code>stream.push(&#39;&#39;)</code>, please consider another<br>approach, because it almost certainly indicates that something is<br>horribly wrong.</p>
<h3 id="Compatibility_with_Older_Node_Versions">Compatibility with Older Node Versions</h3><!--type=misc-->
<p>In versions of Node prior to v0.10, the Readable stream interface was<br>simpler, but also less powerful and less useful.</p>
<ul>
<li>Rather than waiting for you to call the <code>read()</code> method, <code>&#39;data&#39;</code><br>events would start emitting immediately.  If you needed to do some<br>I/O to decide how to handle data, then you had to store the chunks<br>in some kind of buffer so that they would not be lost.</li>
<li>The <a href="#stream_readable_pause"><code>pause()</code></a> method was advisory, rather than guaranteed.  This<br>meant that you still had to be prepared to receive <code>&#39;data&#39;</code> events<br>even when the stream was in a paused state.</li>
</ul>
<p>In Node v0.10, the Readable class described below was added.  For<br>backwards compatibility with older Node programs, Readable streams<br>switch into “flowing mode” when a <code>&#39;data&#39;</code> event handler is added, or<br>when the <a href="#stream_readable_resume"><code>resume()</code></a> method is called.  The effect is that, even if<br>you are not using the new <code>read()</code> method and <code>&#39;readable&#39;</code> event, you<br>no longer have to worry about losing <code>&#39;data&#39;</code> chunks.</p>
<p>Most programs will continue to function normally.  However, this<br>introduces an edge case in the following conditions:</p>
<ul>
<li>No <a href="#stream_event_data"><code>&#39;data&#39;</code> event</a> handler is added.</li>
<li>The <a href="#stream_readable_resume"><code>resume()</code></a> method is never called.</li>
<li>The stream is not piped to any writable destination.</li>
</ul>
<p>For example, consider the following code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WARNING!  BROKEN!</span></span><br><span class="line">net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// we add an 'end' method, but never consume the data</span></span><br><span class="line">  socket.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// It will never get here.</span></span><br><span class="line">    socket.end(<span class="string">'I got your message (but didnt read it)\n'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;).listen(<span class="number">1337</span>);</span><br></pre></td></tr></table></figure>
<p>In versions of node prior to v0.10, the incoming message data would be<br>simply discarded.  However, in Node v0.10 and beyond, the socket will<br>remain paused forever.</p>
<p>The workaround in this situation is to call the <code>resume()</code> method to<br>start the flow of data:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Workaround</span></span><br><span class="line">net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    socket.end(<span class="string">'I got your message (but didnt read it)\n'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// start the flow of data, discarding it.</span></span><br><span class="line">  socket.resume();</span><br><span class="line"></span><br><span class="line">&#125;).listen(<span class="number">1337</span>);</span><br></pre></td></tr></table></figure>
<p>In addition to new Readable streams switching into flowing mode,<br>pre-v0.10 style streams can be wrapped in a Readable class using the<br><code>wrap()</code> method.</p>
<h3 id="Object_Mode">Object Mode</h3><!--type=misc-->
<p>Normally, Streams operate on Strings and Buffers exclusively.</p>
<p>Streams that are in <strong>object mode</strong> can emit generic JavaScript values<br>other than Buffers and Strings.</p>
<p>A Readable stream in object mode will always return a single item from<br>a call to <code>stream.read(size)</code>, regardless of what the size argument<br>is.</p>
<p>A Writable stream in object mode will always ignore the <code>encoding</code><br>argument to <code>stream.write(data, encoding)</code>.</p>
<p>The special value <code>null</code> still retains its special value for object<br>mode streams.  That is, for object mode readable streams, <code>null</code> as a<br>return value from <code>stream.read()</code> indicates that there is no more<br>data, and <a href="#stream_readable_push_chunk_encoding"><code>stream.push(null)</code></a> will signal the end of stream data<br>(<code>EOF</code>).</p>
<p>No streams in Node core are object mode streams.  This pattern is only<br>used by userland streaming libraries.</p>
<p>You should set <code>objectMode</code> in your stream child class constructor on<br>the options object.  Setting <code>objectMode</code> mid-stream is not safe.</p>
<p>For Duplex streams <code>objectMode</code> can be set exclusively for readable or<br>writable side with <code>readableObjectMode</code> and <code>writableObjectMode</code><br>respectively. These options can be used to implement parsers and<br>serializers with Transform streams.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">var</span> StringDecoder = <span class="built_in">require</span>(<span class="string">'string_decoder'</span>).StringDecoder;</span><br><span class="line"><span class="keyword">var</span> Transform = <span class="built_in">require</span>(<span class="string">'stream'</span>).Transform;</span><br><span class="line">util.inherits(JSONParseStream, Transform);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets \n-delimited JSON string data, and emits the parsed objects</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">JSONParseStream</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> JSONParseStream))</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JSONParseStream();</span><br><span class="line"></span><br><span class="line">  Transform.call(<span class="keyword">this</span>, &#123; readableObjectMode : <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>._buffer = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">this</span>._decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf8'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSONParseStream.prototype._transform = <span class="function"><span class="keyword">function</span>(<span class="params">chunk, encoding, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._buffer += <span class="keyword">this</span>._decoder.write(chunk);</span><br><span class="line">  <span class="comment">// split on newlines</span></span><br><span class="line">  <span class="keyword">var</span> lines = <span class="keyword">this</span>._buffer.split(<span class="regexp">/\r?\n/</span>);</span><br><span class="line">  <span class="comment">// keep the last partial line buffered</span></span><br><span class="line">  <span class="keyword">this</span>._buffer = lines.pop();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> l = <span class="number">0</span>; l &lt; lines.length; l++) &#123;</span><br><span class="line">    <span class="keyword">var</span> line = lines[l];</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(line);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">      <span class="keyword">this</span>.emit(<span class="string">'error'</span>, er);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// push the parsed object out to the readable consumer</span></span><br><span class="line">    <span class="keyword">this</span>.push(obj);</span><br><span class="line">  &#125;</span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">JSONParseStream.prototype._flush = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Just handle any leftover</span></span><br><span class="line">  <span class="keyword">var</span> rem = <span class="keyword">this</span>._buffer.trim();</span><br><span class="line">  <span class="keyword">if</span> (rem) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(rem);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">      <span class="keyword">this</span>.emit(<span class="string">'error'</span>, er);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// push the parsed object out to the readable consumer</span></span><br><span class="line">    <span class="keyword">this</span>.push(obj);</span><br><span class="line">  &#125;</span><br><span class="line">  cb();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="Crypto"><a id="crypto">Crypto</a></h1><pre><code><span class="label">Stability</span>: <span class="number">2</span> - Unstable<span class="comment">; API changes are being discussed for</span>
<span class="label">future</span> versions.  <span class="keyword">Breaking </span>changes will <span class="keyword">be </span>minimized.  See <span class="keyword">below.</span>
</code></pre><p>Use <code>require(&#39;crypto&#39;)</code> to access this module.</p>
<p>The crypto module offers a way of encapsulating secure credentials to be<br>used as part of a secure HTTPS net or http connection.</p>
<p>It also offers a set of wrappers for OpenSSL’s hash, hmac, cipher,<br>decipher, sign and verify methods.</p>
<h2 id="crypto-setEngine(engine[,_flags])">crypto.setEngine(engine[, flags])</h2><p>Load and set engine for some/all OpenSSL functions (selected by flags).</p>
<p><code>engine</code> could be either an id or a path to the to the engine’s shared library.</p>
<p><code>flags</code> is optional and has <code>ENGINE_METHOD_ALL</code> value by default. It could take<br>one of or mix of following flags (defined in <code>constants</code> module):</p>
<ul>
<li><code>ENGINE_METHOD_RSA</code></li>
<li><code>ENGINE_METHOD_DSA</code></li>
<li><code>ENGINE_METHOD_DH</code></li>
<li><code>ENGINE_METHOD_RAND</code></li>
<li><code>ENGINE_METHOD_ECDH</code></li>
<li><code>ENGINE_METHOD_ECDSA</code></li>
<li><code>ENGINE_METHOD_CIPHERS</code></li>
<li><code>ENGINE_METHOD_DIGESTS</code></li>
<li><code>ENGINE_METHOD_STORE</code></li>
<li><code>ENGINE_METHOD_PKEY_METH</code></li>
<li><code>ENGINE_METHOD_PKEY_ASN1_METH</code></li>
<li><code>ENGINE_METHOD_ALL</code></li>
<li><code>ENGINE_METHOD_NONE</code></li>
</ul>
<h2 id="crypto-getCiphers()">crypto.getCiphers()</h2><p>Returns an array with the names of the supported ciphers.</p>
<p>Example:</p>
<pre><code><span class="reserved">var</span> ciphers = crypto.getCiphers();
<span class="built_in">console</span>.log(ciphers); <span class="regexp">//</span> [<span class="string">'AES-128-CBC'</span>, <span class="string">'AES-128-CBC-HMAC-SHA1'</span>, ...]
</code></pre><h2 id="crypto-getHashes()">crypto.getHashes()</h2><p>Returns an array with the names of the supported hash algorithms.</p>
<p>Example:</p>
<pre><code><span class="reserved">var</span> hashes = crypto.getHashes();
<span class="built_in">console</span>.log(hashes); <span class="regexp">//</span> [<span class="string">'sha'</span>, <span class="string">'sha1'</span>, <span class="string">'sha1WithRSAEncryption'</span>, ...]
</code></pre><h2 id="crypto-createCredentials(details)">crypto.createCredentials(details)</h2><pre><code>Stability: 0 - Deprecated. Use [<span class="link_label">tls.createSecureContext</span>][<span class="link_reference"></span>] instead.
</code></pre><p>Creates a credentials object, with the optional details being a<br>dictionary with keys:</p>
<ul>
<li><code>pfx</code> : A string or buffer holding the PFX or PKCS12 encoded private<br>key, certificate and CA certificates</li>
<li><code>key</code> : A string holding the PEM encoded private key</li>
<li><code>passphrase</code> : A string of passphrase for the private key or pfx</li>
<li><code>cert</code> : A string holding the PEM encoded certificate</li>
<li><code>ca</code> : Either a string or list of strings of PEM encoded CA<br>certificates to trust.</li>
<li><code>crl</code> : Either a string or list of strings of PEM encoded CRLs<br>(Certificate Revocation List)</li>
<li><code>ciphers</code>: A string describing the ciphers to use or exclude.<br>Consult<br><a href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT" target="_blank" rel="external">http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT</a><br>for details on the format.</li>
</ul>
<p>If no ‘ca’ details are given, then node.js will use the default<br>publicly trusted list of CAs as given in<br><a href="http://mxr.mozilla.org/mozilla/source/security/nss/lib/ckfw/builtins/certdata.txt" target="_blank" rel="external">http://mxr.mozilla.org/mozilla/source/security/nss/lib/ckfw/builtins/certdata.txt</a>.</p>
<h2 id="crypto-createHash(algorithm)">crypto.createHash(algorithm)</h2><p>Creates and returns a hash object, a cryptographic hash with the given<br>algorithm which can be used to generate hash digests.</p>
<p><code>algorithm</code> is dependent on the available algorithms supported by the<br>version of OpenSSL on the platform. Examples are <code>&#39;sha1&#39;</code>, <code>&#39;md5&#39;</code>,<br><code>&#39;sha256&#39;</code>, <code>&#39;sha512&#39;</code>, etc.  On recent releases, <code>openssl
list-message-digest-algorithms</code> will display the available digest<br>algorithms.</p>
<p>Example: this program that takes the sha1 sum of a file</p>
<pre><code><span class="keyword">var</span> filename = process.argv[<span class="number">2</span>];
<span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> shasum = crypto.createHash(<span class="string">'sha1'</span>);

<span class="keyword">var</span> s = fs.ReadStream(filename);
s.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>{
  shasum.update(d);
});

s.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="keyword">var</span> d = shasum.digest(<span class="string">'hex'</span>);
  <span class="built_in">console</span>.log(d + <span class="string">'  '</span> + filename);
});
</code></pre><h2 id="Class:_Hash">Class: Hash</h2><p>The class for creating hash digests of data.</p>
<p>It is a <a href="stream.html">stream</a> that is both readable and writable.  The<br>written data is used to compute the hash.  Once the writable side of<br>the stream is ended, use the <code>read()</code> method to get the computed hash<br>digest.  The legacy <code>update</code> and <code>digest</code> methods are also supported.</p>
<p>Returned by <code>crypto.createHash</code>.</p>
<h3 id="hash-update(data[,_input_encoding])">hash.update(data[, input_encoding])</h3><p>Updates the hash content with the given <code>data</code>, the encoding of which<br>is given in <code>input_encoding</code> and can be <code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code> or<br><code>&#39;binary&#39;</code>.  If no encoding is provided and the input is a string an<br>encoding of <code>&#39;binary&#39;</code> is enforced. If <code>data</code> is a <code>Buffer</code> then<br><code>input_encoding</code> is ignored.</p>
<p>This can be called many times with new data as it is streamed.</p>
<h3 id="hash-digest([encoding])">hash.digest([encoding])</h3><p>Calculates the digest of all of the passed data to be hashed.  The<br><code>encoding</code> can be <code>&#39;hex&#39;</code>, <code>&#39;binary&#39;</code> or <code>&#39;base64&#39;</code>.  If no encoding<br>is provided, then a buffer is returned.</p>
<p>Note: <code>hash</code> object can not be used after <code>digest()</code> method has been<br>called.</p>
<h2 id="crypto-createHmac(algorithm,_key)">crypto.createHmac(algorithm, key)</h2><p>Creates and returns a hmac object, a cryptographic hmac with the given<br>algorithm and key.</p>
<p>It is a <a href="stream.html">stream</a> that is both readable and writable.  The<br>written data is used to compute the hmac.  Once the writable side of<br>the stream is ended, use the <code>read()</code> method to get the computed<br>digest.  The legacy <code>update</code> and <code>digest</code> methods are also supported.</p>
<p><code>algorithm</code> is dependent on the available algorithms supported by<br>OpenSSL - see createHash above.  <code>key</code> is the hmac key to be used.</p>
<h2 id="Class:_Hmac">Class: Hmac</h2><p>Class for creating cryptographic hmac content.</p>
<p>Returned by <code>crypto.createHmac</code>.</p>
<h3 id="hmac-update(data)">hmac.update(data)</h3><p>Update the hmac content with the given <code>data</code>.  This can be called<br>many times with new data as it is streamed.</p>
<h3 id="hmac-digest([encoding])">hmac.digest([encoding])</h3><p>Calculates the digest of all of the passed data to the hmac.  The<br><code>encoding</code> can be <code>&#39;hex&#39;</code>, <code>&#39;binary&#39;</code> or <code>&#39;base64&#39;</code>.  If no encoding<br>is provided, then a buffer is returned.</p>
<p>Note: <code>hmac</code> object can not be used after <code>digest()</code> method has been<br>called.</p>
<h2 id="crypto-createCipher(algorithm,_password)">crypto.createCipher(algorithm, password)</h2><p>Creates and returns a cipher object, with the given algorithm and<br>password.</p>
<p><code>algorithm</code> is dependent on OpenSSL, examples are <code>&#39;aes192&#39;</code>, etc.  On<br>recent releases, <code>openssl list-cipher-algorithms</code> will display the<br>available cipher algorithms.  <code>password</code> is used to derive key and IV,<br>which must be a <code>&#39;binary&#39;</code> encoded string or a <a href="buffer.html">buffer</a>.</p>
<p>It is a <a href="stream.html">stream</a> that is both readable and writable.  The<br>written data is used to compute the hash.  Once the writable side of<br>the stream is ended, use the <code>read()</code> method to get the enciphered<br>contents.  The legacy <code>update</code> and <code>final</code> methods are also supported.</p>
<p>Note: <code>createCipher</code> derives keys with the OpenSSL function <a href="https://www.openssl.org/docs/crypto/EVP_BytesToKey.html" target="_blank" rel="external">EVP_BytesToKey</a><br>with the digest algorithm set to MD5, one iteration, and no salt. The lack of<br>salt allows dictionary attacks as the same password always creates the same key.<br>The low iteration count and non-cryptographically secure hash algorithm allow<br>passwords to be tested very rapidly.</p>
<p>In line with OpenSSL’s recommendation to use pbkdf2 instead of EVP_BytesToKey it<br>is recommended you derive a key and iv yourself with <a href="#crypto_crypto_pbkdf2_password_salt_iterations_keylen_callback">crypto.pbkdf2</a> and to<br>then use <a href="#crypto_crypto_createcipheriv_algorithm_key_iv">createCipheriv()</a> to create the cipher stream.</p>
<h2 id="crypto-createCipheriv(algorithm,_key,_iv)">crypto.createCipheriv(algorithm, key, iv)</h2><p>Creates and returns a cipher object, with the given algorithm, key and<br>iv.</p>
<p><code>algorithm</code> is the same as the argument to <code>createCipher()</code>.  <code>key</code> is<br>the raw key used by the algorithm.  <code>iv</code> is an <a href="http://en.wikipedia.org/wiki/Initialization_vector" target="_blank" rel="external">initialization<br>vector</a>.</p>
<p><code>key</code> and <code>iv</code> must be <code>&#39;binary&#39;</code> encoded strings or<br><a href="buffer.html">buffers</a>.</p>
<h2 id="Class:_Cipher">Class: Cipher</h2><p>Class for encrypting data.</p>
<p>Returned by <code>crypto.createCipher</code> and <code>crypto.createCipheriv</code>.</p>
<p>Cipher objects are <a href="stream.html">streams</a> that are both readable and<br>writable.  The written plain text data is used to produce the<br>encrypted data on the readable side.  The legacy <code>update</code> and <code>final</code><br>methods are also supported.</p>
<h3 id="cipher-update(data[,_input_encoding][,_output_encoding])">cipher.update(data[, input_encoding][, output_encoding])</h3><p>Updates the cipher with <code>data</code>, the encoding of which is given in<br><code>input_encoding</code> and can be <code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code> or <code>&#39;binary&#39;</code>.  If no<br>encoding is provided, then a buffer is expected.<br>If <code>data</code> is a <code>Buffer</code> then <code>input_encoding</code> is ignored.</p>
<p>The <code>output_encoding</code> specifies the output format of the enciphered<br>data, and can be <code>&#39;binary&#39;</code>, <code>&#39;base64&#39;</code> or <code>&#39;hex&#39;</code>.  If no encoding is<br>provided, then a buffer is returned.</p>
<p>Returns the enciphered contents, and can be called many times with new<br>data as it is streamed.</p>
<h3 id="cipher-final([output_encoding])">cipher.final([output_encoding])</h3><p>Returns any remaining enciphered contents, with <code>output_encoding</code><br>being one of: <code>&#39;binary&#39;</code>, <code>&#39;base64&#39;</code> or <code>&#39;hex&#39;</code>.  If no encoding is<br>provided, then a buffer is returned.</p>
<p>Note: <code>cipher</code> object can not be used after <code>final()</code> method has been<br>called.</p>
<h3 id="cipher-setAutoPadding(auto_padding=true)">cipher.setAutoPadding(auto_padding=true)</h3><p>You can disable automatic padding of the input data to block size. If<br><code>auto_padding</code> is false, the length of the entire input data must be a<br>multiple of the cipher’s block size or <code>final</code> will fail.  Useful for<br>non-standard padding, e.g. using <code>0x0</code> instead of PKCS padding. You<br>must call this before <code>cipher.final</code>.</p>
<h3 id="cipher-getAuthTag()">cipher.getAuthTag()</h3><p>For authenticated encryption modes (currently supported: GCM), this<br>method returns a <code>Buffer</code> that represents the <em>authentication tag</em> that<br>has been computed from the given data. Should be called after<br>encryption has been completed using the <code>final</code> method!</p>
<h3 id="cipher-setAAD(buffer)">cipher.setAAD(buffer)</h3><p>For authenticated encryption modes (currently supported: GCM), this<br>method sets the value used for the additional authenticated data (AAD) input<br>parameter.</p>
<h2 id="crypto-createDecipher(algorithm,_password)">crypto.createDecipher(algorithm, password)</h2><p>Creates and returns a decipher object, with the given algorithm and<br>key.  This is the mirror of the <a href="#crypto_crypto_createcipher_algorithm_password">createCipher()</a> above.</p>
<h2 id="crypto-createDecipheriv(algorithm,_key,_iv)">crypto.createDecipheriv(algorithm, key, iv)</h2><p>Creates and returns a decipher object, with the given algorithm, key<br>and iv.  This is the mirror of the <a href="#crypto_crypto_createcipheriv_algorithm_key_iv">createCipheriv()</a> above.</p>
<h2 id="Class:_Decipher">Class: Decipher</h2><p>Class for decrypting data.</p>
<p>Returned by <code>crypto.createDecipher</code> and <code>crypto.createDecipheriv</code>.</p>
<p>Decipher objects are <a href="stream.html">streams</a> that are both readable and<br>writable.  The written enciphered data is used to produce the<br>plain-text data on the the readable side.  The legacy <code>update</code> and<br><code>final</code> methods are also supported.</p>
<h3 id="decipher-update(data[,_input_encoding][,_output_encoding])">decipher.update(data[, input_encoding][, output_encoding])</h3><p>Updates the decipher with <code>data</code>, which is encoded in <code>&#39;binary&#39;</code>,<br><code>&#39;base64&#39;</code> or <code>&#39;hex&#39;</code>.  If no encoding is provided, then a buffer is<br>expected.<br>If <code>data</code> is a <code>Buffer</code> then <code>input_encoding</code> is ignored.</p>
<p>The <code>output_decoding</code> specifies in what format to return the<br>deciphered plaintext: <code>&#39;binary&#39;</code>, <code>&#39;ascii&#39;</code> or <code>&#39;utf8&#39;</code>.  If no<br>encoding is provided, then a buffer is returned.</p>
<h3 id="decipher-final([output_encoding])">decipher.final([output_encoding])</h3><p>Returns any remaining plaintext which is deciphered, with<br><code>output_encoding</code> being one of: <code>&#39;binary&#39;</code>, <code>&#39;ascii&#39;</code> or <code>&#39;utf8&#39;</code>.  If<br>no encoding is provided, then a buffer is returned.</p>
<p>Note: <code>decipher</code> object can not be used after <code>final()</code> method has been<br>called.</p>
<h3 id="decipher-setAutoPadding(auto_padding=true)">decipher.setAutoPadding(auto_padding=true)</h3><p>You can disable auto padding if the data has been encrypted without<br>standard block padding to prevent <code>decipher.final</code> from checking and<br>removing it. Can only work if the input data’s length is a multiple of<br>the ciphers block size. You must call this before streaming data to<br><code>decipher.update</code>.</p>
<h3 id="decipher-setAuthTag(buffer)">decipher.setAuthTag(buffer)</h3><p>For authenticated encryption modes (currently supported: GCM), this<br>method must be used to pass in the received <em>authentication tag</em>.<br>If no tag is provided or if the ciphertext has been tampered with,<br><code>final</code> will throw, thus indicating that the ciphertext should<br>be discarded due to failed authentication.</p>
<h3 id="decipher-setAAD(buffer)">decipher.setAAD(buffer)</h3><p>For authenticated encryption modes (currently supported: GCM), this<br>method sets the value used for the additional authenticated data (AAD) input<br>parameter.</p>
<h2 id="crypto-createSign(algorithm)">crypto.createSign(algorithm)</h2><p>Creates and returns a signing object, with the given algorithm.  On<br>recent OpenSSL releases, <code>openssl list-public-key-algorithms</code> will<br>display the available signing algorithms. Examples are <code>&#39;RSA-SHA256&#39;</code>.</p>
<h2 id="Class:_Sign">Class: Sign</h2><p>Class for generating signatures.</p>
<p>Returned by <code>crypto.createSign</code>.</p>
<p>Sign objects are writable <a href="stream.html">streams</a>.  The written data is<br>used to generate the signature.  Once all of the data has been<br>written, the <code>sign</code> method will return the signature.  The legacy<br><code>update</code> method is also supported.</p>
<h3 id="sign-update(data)">sign.update(data)</h3><p>Updates the sign object with data.  This can be called many times<br>with new data as it is streamed.</p>
<h3 id="sign-sign(private_key[,_output_format])">sign.sign(private_key[, output_format])</h3><p>Calculates the signature on all the updated data passed through the<br>sign.</p>
<p><code>private_key</code> can be an object or a string. If <code>private_key</code> is a string, it is<br>treated as the key with no passphrase.</p>
<p><code>private_key</code>:</p>
<ul>
<li><code>key</code> : A string holding the PEM encoded private key</li>
<li><code>passphrase</code> : A string of passphrase for the private key</li>
</ul>
<p>Returns the signature in <code>output_format</code> which can be <code>&#39;binary&#39;</code>,<br><code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>. If no encoding is provided, then a buffer is<br>returned.</p>
<p>Note: <code>sign</code> object can not be used after <code>sign()</code> method has been<br>called.</p>
<h2 id="crypto-createVerify(algorithm)">crypto.createVerify(algorithm)</h2><p>Creates and returns a verification object, with the given algorithm.<br>This is the mirror of the signing object above.</p>
<h2 id="Class:_Verify">Class: Verify</h2><p>Class for verifying signatures.</p>
<p>Returned by <code>crypto.createVerify</code>.</p>
<p>Verify objects are writable <a href="stream.html">streams</a>.  The written data<br>is used to validate against the supplied signature.  Once all of the<br>data has been written, the <code>verify</code> method will return true if the<br>supplied signature is valid.  The legacy <code>update</code> method is also<br>supported.</p>
<h3 id="verifier-update(data)">verifier.update(data)</h3><p>Updates the verifier object with data.  This can be called many times<br>with new data as it is streamed.</p>
<h3 id="verifier-verify(object,_signature[,_signature_format])">verifier.verify(object, signature[, signature_format])</h3><p>Verifies the signed data by using the <code>object</code> and <code>signature</code>.<br><code>object</code> is  a string containing a PEM encoded object, which can be<br>one of RSA public key, DSA public key, or X.509 certificate.<br><code>signature</code> is the previously calculated signature for the data, in<br>the <code>signature_format</code> which can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>.<br>If no encoding is specified, then a buffer is expected.</p>
<p>Returns true or false depending on the validity of the signature for<br>the data and public key.</p>
<p>Note: <code>verifier</code> object can not be used after <code>verify()</code> method has been<br>called.</p>
<h2 id="crypto-createDiffieHellman(prime_length[,_generator])">crypto.createDiffieHellman(prime_length[, generator])</h2><p>Creates a Diffie-Hellman key exchange object and generates a prime of<br><code>prime_length</code> bits and using an optional specific numeric <code>generator</code>.<br>If no <code>generator</code> is specified, then <code>2</code> is used.</p>
<h2 id="crypto-createDiffieHellman(prime[,_prime_encoding][,_generator][,_generator_encoding])">crypto.createDiffieHellman(prime[, prime_encoding][, generator][, generator_encoding])</h2><p>Creates a Diffie-Hellman key exchange object using the supplied <code>prime</code> and an<br>optional specific <code>generator</code>.<br><code>generator</code> can be a number, string, or Buffer.<br>If no <code>generator</code> is specified, then <code>2</code> is used.<br><code>prime_encoding</code> and <code>generator_encoding</code> can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>.<br>If no <code>prime_encoding</code> is specified, then a Buffer is expected for <code>prime</code>.<br>If no <code>generator_encoding</code> is specified, then a Buffer is expected for <code>generator</code>.</p>
<h2 id="Class:_DiffieHellman">Class: DiffieHellman</h2><p>The class for creating Diffie-Hellman key exchanges.</p>
<p>Returned by <code>crypto.createDiffieHellman</code>.</p>
<h3 id="diffieHellman-verifyError">diffieHellman.verifyError</h3><p>A bit field containing any warnings and/or errors as a result of a check performed<br>during initialization. The following values are valid for this property<br>(defined in <code>constants</code> module):</p>
<ul>
<li><code>DH_CHECK_P_NOT_SAFE_PRIME</code></li>
<li><code>DH_CHECK_P_NOT_PRIME</code></li>
<li><code>DH_UNABLE_TO_CHECK_GENERATOR</code></li>
<li><code>DH_NOT_SUITABLE_GENERATOR</code></li>
</ul>
<h3 id="diffieHellman-generateKeys([encoding])">diffieHellman.generateKeys([encoding])</h3><p>Generates private and public Diffie-Hellman key values, and returns<br>the public key in the specified encoding. This key should be<br>transferred to the other party. Encoding can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>,<br>or <code>&#39;base64&#39;</code>.  If no encoding is provided, then a buffer is returned.</p>
<h3 id="diffieHellman-computeSecret(other_public_key[,_input_encoding][,_output_encoding])">diffieHellman.computeSecret(other_public_key[, input_encoding][, output_encoding])</h3><p>Computes the shared secret using <code>other_public_key</code> as the other<br>party’s public key and returns the computed shared secret. Supplied<br>key is interpreted using specified <code>input_encoding</code>, and secret is<br>encoded using specified <code>output_encoding</code>. Encodings can be<br><code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If the input encoding is not<br>provided, then a buffer is expected.</p>
<p>If no output encoding is given, then a buffer is returned.</p>
<h3 id="diffieHellman-getPrime([encoding])">diffieHellman.getPrime([encoding])</h3><p>Returns the Diffie-Hellman prime in the specified encoding, which can<br>be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is provided,<br>then a buffer is returned.</p>
<h3 id="diffieHellman-getGenerator([encoding])">diffieHellman.getGenerator([encoding])</h3><p>Returns the Diffie-Hellman generator in the specified encoding, which can<br>be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is provided,<br>then a buffer is returned.</p>
<h3 id="diffieHellman-getPublicKey([encoding])">diffieHellman.getPublicKey([encoding])</h3><p>Returns the Diffie-Hellman public key in the specified encoding, which<br>can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is provided,<br>then a buffer is returned.</p>
<h3 id="diffieHellman-getPrivateKey([encoding])">diffieHellman.getPrivateKey([encoding])</h3><p>Returns the Diffie-Hellman private key in the specified encoding,<br>which can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is<br>provided, then a buffer is returned.</p>
<h3 id="diffieHellman-setPublicKey(public_key[,_encoding])">diffieHellman.setPublicKey(public_key[, encoding])</h3><p>Sets the Diffie-Hellman public key. Key encoding can be <code>&#39;binary&#39;</code>,<br><code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>. If no encoding is provided, then a buffer is<br>expected.</p>
<h3 id="diffieHellman-setPrivateKey(private_key[,_encoding])">diffieHellman.setPrivateKey(private_key[, encoding])</h3><p>Sets the Diffie-Hellman private key. Key encoding can be <code>&#39;binary&#39;</code>,<br><code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>. If no encoding is provided, then a buffer is<br>expected.</p>
<h2 id="crypto-getDiffieHellman(group_name)">crypto.getDiffieHellman(group_name)</h2><p>Creates a predefined Diffie-Hellman key exchange object.  The<br>supported groups are: <code>&#39;modp1&#39;</code>, <code>&#39;modp2&#39;</code>, <code>&#39;modp5&#39;</code> (defined in <a href="http://www.rfc-editor.org/rfc/rfc2412.txt" target="_blank" rel="external">RFC<br>2412</a>) and <code>&#39;modp14&#39;</code>, <code>&#39;modp15&#39;</code>, <code>&#39;modp16&#39;</code>, <code>&#39;modp17&#39;</code>,<br><code>&#39;modp18&#39;</code> (defined in <a href="http://www.rfc-editor.org/rfc/rfc3526.txt" target="_blank" rel="external">RFC 3526</a>).  The returned object mimics the<br>interface of objects created by <a href="#crypto_crypto_creatediffiehellman_prime_encoding">crypto.createDiffieHellman()</a><br>above, but will not allow to change the keys (with<br><a href="#crypto_diffiehellman_setpublickey_public_key_encoding">diffieHellman.setPublicKey()</a> for example).  The advantage of using<br>this routine is that the parties don’t have to generate nor exchange<br>group modulus beforehand, saving both processor and communication<br>time.</p>
<p>Example (obtaining a shared secret):</p>
<pre><code><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);
<span class="keyword">var</span> alice = crypto.getDiffieHellman(<span class="string">'modp5'</span>);
<span class="keyword">var</span> bob = crypto.getDiffieHellman(<span class="string">'modp5'</span>);

alice.generateKeys();
bob.generateKeys();

<span class="keyword">var</span> alice_secret = alice.computeSecret(bob.getPublicKey(), <span class="literal">null</span>, <span class="string">'hex'</span>);
<span class="keyword">var</span> bob_secret = bob.computeSecret(alice.getPublicKey(), <span class="literal">null</span>, <span class="string">'hex'</span>);

<span class="comment">/* alice_secret and bob_secret should be the same */</span>
<span class="built_in">console</span>.log(alice_secret == bob_secret);
</code></pre><h2 id="crypto-createECDH(curve_name)">crypto.createECDH(curve_name)</h2><p>Creates a Elliptic Curve (EC) Diffie-Hellman key exchange object using a<br>predefined curve specified by <code>curve_name</code> string.</p>
<h2 id="Class:_ECDH">Class: ECDH</h2><p>The class for creating EC Diffie-Hellman key exchanges.</p>
<p>Returned by <code>crypto.createECDH</code>.</p>
<h3 id="ECDH-generateKeys([encoding[,_format]])">ECDH.generateKeys([encoding[, format]])</h3><p>Generates private and public EC Diffie-Hellman key values, and returns<br>the public key in the specified format and encoding. This key should be<br>transferred to the other party.</p>
<p>Format specifies point encoding and can be <code>&#39;compressed&#39;</code>, <code>&#39;uncompressed&#39;</code>, or<br><code>&#39;hybrid&#39;</code>. If no format is provided - the point will be returned in<br><code>&#39;uncompressed&#39;</code> format.</p>
<p>Encoding can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is provided,<br>then a buffer is returned.</p>
<h3 id="ECDH-computeSecret(other_public_key[,_input_encoding][,_output_encoding])">ECDH.computeSecret(other_public_key[, input_encoding][, output_encoding])</h3><p>Computes the shared secret using <code>other_public_key</code> as the other<br>party’s public key and returns the computed shared secret. Supplied<br>key is interpreted using specified <code>input_encoding</code>, and secret is<br>encoded using specified <code>output_encoding</code>. Encodings can be<br><code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If the input encoding is not<br>provided, then a buffer is expected.</p>
<p>If no output encoding is given, then a buffer is returned.</p>
<h3 id="ECDH-getPublicKey([encoding[,_format]])">ECDH.getPublicKey([encoding[, format]])</h3><p>Returns the EC Diffie-Hellman public key in the specified encoding and format.</p>
<p>Format specifies point encoding and can be <code>&#39;compressed&#39;</code>, <code>&#39;uncompressed&#39;</code>, or<br><code>&#39;hybrid&#39;</code>. If no format is provided - the point will be returned in<br><code>&#39;uncompressed&#39;</code> format.</p>
<p>Encoding can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is provided,<br>then a buffer is returned.</p>
<h3 id="ECDH-getPrivateKey([encoding])">ECDH.getPrivateKey([encoding])</h3><p>Returns the EC Diffie-Hellman private key in the specified encoding,<br>which can be <code>&#39;binary&#39;</code>, <code>&#39;hex&#39;</code>, or <code>&#39;base64&#39;</code>. If no encoding is<br>provided, then a buffer is returned.</p>
<h3 id="ECDH-setPublicKey(public_key[,_encoding])">ECDH.setPublicKey(public_key[, encoding])</h3><p>Sets the EC Diffie-Hellman public key. Key encoding can be <code>&#39;binary&#39;</code>,<br><code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>. If no encoding is provided, then a buffer is<br>expected.</p>
<h3 id="ECDH-setPrivateKey(private_key[,_encoding])">ECDH.setPrivateKey(private_key[, encoding])</h3><p>Sets the EC Diffie-Hellman private key. Key encoding can be <code>&#39;binary&#39;</code>,<br><code>&#39;hex&#39;</code> or <code>&#39;base64&#39;</code>. If no encoding is provided, then a buffer is<br>expected.</p>
<p>Example (obtaining a shared secret):</p>
<pre><code><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);
<span class="keyword">var</span> alice = crypto.createECDH(<span class="string">'secp256k1'</span>);
<span class="keyword">var</span> bob = crypto.createECDH(<span class="string">'secp256k1'</span>);

alice.generateKeys();
bob.generateKeys();

<span class="keyword">var</span> alice_secret = alice.computeSecret(bob.getPublicKey(), <span class="literal">null</span>, <span class="string">'hex'</span>);
<span class="keyword">var</span> bob_secret = bob.computeSecret(alice.getPublicKey(), <span class="literal">null</span>, <span class="string">'hex'</span>);

<span class="comment">/* alice_secret and bob_secret should be the same */</span>
<span class="built_in">console</span>.log(alice_secret == bob_secret);
</code></pre><h2 id="crypto-pbkdf2(password,_salt,_iterations,_keylen[,_digest],_callback)">crypto.pbkdf2(password, salt, iterations, keylen[, digest], callback)</h2><p>Asynchronous PBKDF2 function.  Applies the selected HMAC digest function<br>(default: SHA1) to derive a key of the requested length from the password,<br>salt and number of iterations.  The callback gets two arguments:<br><code>(err, derivedKey)</code>.</p>
<p>Example:</p>
<pre><code>crypto.pbkdf2(<span class="string">'secret'</span>, <span class="string">'salt'</span>, <span class="number">4096</span>, <span class="number">512</span>, <span class="string">'sha256'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, key</span>) </span>{
  <span class="keyword">if</span> (err)
    <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(key.toString(<span class="string">'hex'</span>));  <span class="comment">// 'c5e478d...1469e50'</span>
});
</code></pre><p>You can get a list of supported digest functions with<br><a href="#crypto_crypto_gethashes">crypto.getHashes()</a>.</p>
<h2 id="crypto-pbkdf2Sync(password,_salt,_iterations,_keylen[,_digest])">crypto.pbkdf2Sync(password, salt, iterations, keylen[, digest])</h2><p>Synchronous PBKDF2 function.  Returns derivedKey or throws error.</p>
<h2 id="crypto-randomBytes(size[,_callback])">crypto.randomBytes(size[, callback])</h2><p>Generates cryptographically strong pseudo-random data. Usage:</p>
<pre><code><span class="comment">// async</span>
crypto.randomBytes(<span class="number">256</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ex, buf</span>) </span>{
  <span class="keyword">if</span> (ex) <span class="keyword">throw</span> ex;
  <span class="built_in">console</span>.log(<span class="string">'Have %d bytes of random data: %s'</span>, buf.length, buf);
});

<span class="comment">// sync</span>
<span class="keyword">try</span> {
  <span class="keyword">var</span> buf = crypto.randomBytes(<span class="number">256</span>);
  <span class="built_in">console</span>.log(<span class="string">'Have %d bytes of random data: %s'</span>, buf.length, buf);
} <span class="keyword">catch</span> (ex) {
  <span class="comment">// handle error</span>
  <span class="comment">// most likely, entropy sources are drained</span>
}
</code></pre><p>NOTE: Will throw error or invoke callback with error, if there is not enough<br>accumulated entropy to generate cryptographically strong data. In other words,<br><code>crypto.randomBytes</code> without callback will not block even if all entropy sources<br>are drained.</p>
<h2 id="crypto-pseudoRandomBytes(size[,_callback])">crypto.pseudoRandomBytes(size[, callback])</h2><p>Generates <em>non</em>-cryptographically strong pseudo-random data. The data<br>returned will be unique if it is sufficiently long, but is not<br>necessarily unpredictable. For this reason, the output of this<br>function should never be used where unpredictability is important,<br>such as in the generation of encryption keys.</p>
<p>Usage is otherwise identical to <code>crypto.randomBytes</code>.</p>
<h2 id="Class:_Certificate">Class: Certificate</h2><p>The class used for working with signed public key &amp; challenges. The most<br>common usage for this series of functions is when dealing with the <code>&lt;keygen&gt;</code><br>element. <a href="http://www.openssl.org/docs/apps/spkac.html" target="_blank" rel="external">http://www.openssl.org/docs/apps/spkac.html</a></p>
<p>Returned by <code>crypto.Certificate</code>.</p>
<h3 id="Certificate-verifySpkac(spkac)">Certificate.verifySpkac(spkac)</h3><p>Returns true of false based on the validity of the SPKAC.</p>
<h3 id="Certificate-exportChallenge(spkac)">Certificate.exportChallenge(spkac)</h3><p>Exports the encoded public key from the supplied SPKAC.</p>
<h3 id="Certificate-exportPublicKey(spkac)">Certificate.exportPublicKey(spkac)</h3><p>Exports the encoded challenge associated with the SPKAC.</p>
<h2 id="crypto-publicEncrypt(public_key,_buffer)">crypto.publicEncrypt(public_key, buffer)</h2><p>Encrypts <code>buffer</code> with <code>public_key</code>. Only RSA is currently supported.</p>
<p><code>public_key</code> can be an object or a string. If <code>public_key</code> is a string, it is<br>treated as the key with no passphrase and will use <code>RSA_PKCS1_OAEP_PADDING</code>.</p>
<p><code>public_key</code>:</p>
<ul>
<li><code>key</code> : A string holding the PEM encoded private key</li>
<li><code>padding</code> : An optional padding value, one of the following:<ul>
<li><code>constants.RSA_NO_PADDING</code></li>
<li><code>constants.RSA_PKCS1_PADDING</code></li>
<li><code>constants.RSA_PKCS1_OAEP_PADDING</code></li>
</ul>
</li>
</ul>
<p>NOTE: All paddings are defined in <code>constants</code> module.</p>
<h2 id="crypto-privateDecrypt(private_key,_buffer)">crypto.privateDecrypt(private_key, buffer)</h2><p>Decrypts <code>buffer</code> with <code>private_key</code>.</p>
<p><code>private_key</code> can be an object or a string. If <code>private_key</code> is a string, it is<br>treated as the key with no passphrase and will use <code>RSA_PKCS1_OAEP_PADDING</code>.</p>
<p><code>private_key</code>:</p>
<ul>
<li><code>key</code> : A string holding the PEM encoded private key</li>
<li><code>passphrase</code> : An optional string of passphrase for the private key</li>
<li><code>padding</code> : An optional padding value, one of the following:<ul>
<li><code>constants.RSA_NO_PADDING</code></li>
<li><code>constants.RSA_PKCS1_PADDING</code></li>
<li><code>constants.RSA_PKCS1_OAEP_PADDING</code></li>
</ul>
</li>
</ul>
<p>NOTE: All paddings are defined in <code>constants</code> module.</p>
<h2 id="crypto-DEFAULT_ENCODING">crypto.DEFAULT_ENCODING</h2><p>The default encoding to use for functions that can take either strings<br>or buffers.  The default value is <code>&#39;buffer&#39;</code>, which makes it default<br>to using Buffer objects.  This is here to make the crypto module more<br>easily compatible with legacy programs that expected <code>&#39;binary&#39;</code> to be<br>the default encoding.</p>
<p>Note that new programs will probably expect buffers, so only use this<br>as a temporary measure.</p>
<h2 id="Recent_API_Changes">Recent API Changes</h2><p>The Crypto module was added to Node before there was the concept of a<br>unified Stream API, and before there were Buffer objects for handling<br>binary data.</p>
<p>As such, the streaming classes don’t have the typical methods found on<br>other Node classes, and many methods accepted and returned<br>Binary-encoded strings by default rather than Buffers.  This was<br>changed to use Buffers by default instead.</p>
<p>This is a breaking change for some use cases, but not all.</p>
<p>For example, if you currently use the default arguments to the Sign<br>class, and then pass the results to the Verify class, without ever<br>inspecting the data, then it will continue to work as before.  Where<br>you once got a binary string and then presented the binary string to<br>the Verify object, you’ll now get a Buffer, and present the Buffer to<br>the Verify object.</p>
<p>However, if you were doing things with the string data that will not<br>work properly on Buffers (such as, concatenating them, storing in<br>databases, etc.), or you are passing binary strings to the crypto<br>functions without an encoding argument, then you will need to start<br>providing encoding arguments to specify which encoding you’d like to<br>use.  To switch to the previous style of using binary strings by<br>default, set the <code>crypto.DEFAULT_ENCODING</code> field to ‘binary’.  Note<br>that new programs will probably expect buffers, so only use this as a<br>temporary measure.</p>
<h1 id="TLS_(SSL)"><a id="tls">TLS (SSL)</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>Use <code>require(&#39;tls&#39;)</code> to access this module.</p>
<p>The <code>tls</code> module uses OpenSSL to provide Transport Layer Security and/or<br>Secure Socket Layer: encrypted stream communication.</p>
<p>TLS/SSL is a public/private key infrastructure. Each client and each<br>server must have a private key. A private key is created like this:</p>
<pre><code>openssl genrsa -out ryans-key<span class="class">.pem</span> <span class="number">2048</span>
</code></pre><p>All servers and some clients need to have a certificate. Certificates are public<br>keys signed by a Certificate Authority or self-signed. The first step to<br>getting a certificate is to create a “Certificate Signing Request” (CSR)<br>file. This is done with:</p>
<pre><code>openssl req -<span class="keyword">new</span> -sha256 -<span class="variable">key</span> ryans-<span class="variable">key</span>.pem -out ryans-csr.pem
</code></pre><p>To create a self-signed certificate with the CSR, do this:</p>
<pre><code>openssl x509 -req -<span class="keyword">in</span> ryans-csr<span class="class">.pem</span> -signkey ryans-key<span class="class">.pem</span> -out ryans-cert.pem
</code></pre><p>Alternatively you can send the CSR to a Certificate Authority for signing.</p>
<p>For Perfect Forward Secrecy, it is required to generate Diffie-Hellman<br>parameters:</p>
<pre><code>openssl dhparam -outform PEM -out dhparam<span class="class">.pem</span> <span class="number">2048</span>
</code></pre><p>To create .pfx or .p12, do this:</p>
<pre><code>openssl pkcs12 -export -<span class="keyword">in</span> agent5-cert<span class="class">.pem</span> -inkey agent5-key<span class="class">.pem</span> \
    -certfile ca-cert<span class="class">.pem</span> -out agent5.pfx
</code></pre><ul>
<li><code>in</code>:  certificate</li>
<li><code>inkey</code>: private key</li>
<li><code>certfile</code>: all CA certs concatenated in one file like<br><code>cat ca1-cert.pem ca2-cert.pem &gt; ca-cert.pem</code></li>
</ul>
<h2 id="Protocol_support">Protocol support</h2><p>Node.js is compiled with SSLv2 and SSLv3 protocol support by default, but these<br>protocols are <strong>disabled</strong>. They are considered insecure and could be easily<br>compromised as was shown by <a href="https://access.redhat.com/articles/1232123" target="_blank" rel="external">CVE-2014-3566</a>. However, in some situations, it<br>may cause problems with legacy clients/servers (such as Internet Explorer 6).<br>If you wish to enable SSLv2 or SSLv3, run node with the <code>--enable-ssl2</code> or<br><code>--enable-ssl3</code> flag respectively.  In future versions of Node.js SSLv2 and<br>SSLv3 will not be compiled in by default.</p>
<p>There is a way to force node into using SSLv3 or SSLv2 only mode by explicitly<br>specifying <code>secureProtocol</code> to <code>&#39;SSLv3_method&#39;</code> or <code>&#39;SSLv2_method&#39;</code>.</p>
<p>The default protocol method Node.js uses is <code>SSLv23_method</code> which would be more<br>accurately named <code>AutoNegotiate_method</code>. This method will try and negotiate<br>from the highest level down to whatever the client supports.  To provide a<br>secure default, Node.js (since v0.10.33) explicitly disables the use of SSLv3<br>and SSLv2 by setting the <code>secureOptions</code> to be<br><code>SSL_OP_NO_SSLv3|SSL_OP_NO_SSLv2</code> (again, unless you have passed<br><code>--enable-ssl3</code>, or <code>--enable-ssl2</code>, or <code>SSLv3_method</code> as <code>secureProtocol</code>).</p>
<p>If you have set <code>secureOptions</code> to anything, we will not override your<br>options.</p>
<p>The ramifications of this behavior change:</p>
<ul>
<li>If your application is behaving as a secure server, clients who are <code>SSLv3</code><br>only will now not be able to appropriately negotiate a connection and will be<br>refused. In this case your server will emit a <code>clientError</code> event. The error<br>message will include <code>&#39;wrong version number&#39;</code>.</li>
<li>If your application is behaving as a secure client and communicating with a<br>server that doesn’t support methods more secure than SSLv3 then your connection<br>won’t be able to negotiate and will fail. In this case your client will emit a<br>an <code>error</code> event. The error message will include <code>&#39;wrong version number&#39;</code>.</li>
</ul>
<h2 id="Client-initiated_renegotiation_attack_mitigation">Client-initiated renegotiation attack mitigation</h2><!-- type=misc -->
<p>The TLS protocol lets the client renegotiate certain aspects of the TLS session.<br>Unfortunately, session renegotiation requires a disproportional amount of<br>server-side resources, which makes it a potential vector for denial-of-service<br>attacks.</p>
<p>To mitigate this, renegotiations are limited to three times every 10 minutes. An<br>error is emitted on the <a href="#tls_class_tls_tlssocket">tls.TLSSocket</a> instance when the threshold is<br>exceeded. The limits are configurable:</p>
<ul>
<li><p><code>tls.CLIENT_RENEG_LIMIT</code>: renegotiation limit, default is 3.</p>
</li>
<li><p><code>tls.CLIENT_RENEG_WINDOW</code>: renegotiation window in seconds, default is<br>10 minutes.</p>
</li>
</ul>
<p>Don’t change the defaults unless you know what you are doing.</p>
<p>To test your server, connect to it with <code>openssl s_client -connect address:port</code><br>and tap <code>R&lt;CR&gt;</code> (that’s the letter <code>R</code> followed by a carriage return) a few<br>times.</p>
<h2 id="NPN_and_SNI">NPN and SNI</h2><!-- type=misc -->
<p>NPN (Next Protocol Negotiation) and SNI (Server Name Indication) are TLS<br>handshake extensions allowing you:</p>
<ul>
<li>NPN - to use one TLS server for multiple protocols (HTTP, SPDY)</li>
<li>SNI - to use one TLS server for multiple hostnames with different SSL<br>certificates.</li>
</ul>
<h2 id="Perfect_Forward_Secrecy">Perfect Forward Secrecy</h2><!-- type=misc -->
<p>The term “<a href="http://en.wikipedia.org/wiki/Perfect_forward_secrecy" target="_blank" rel="external">Forward Secrecy</a>“ or “Perfect Forward Secrecy” describes a feature of<br>key-agreement (i.e. key-exchange) methods. Practically it means that even if the<br>private key of a (your) server is compromised, communication can only be<br>decrypted by eavesdroppers if they manage to obtain the key-pair specifically<br>generated for each session.</p>
<p>This is achieved by randomly generating a key pair for key-agreement on every<br>handshake (in contrary to the same key for all sessions). Methods implementing<br>this technique, thus offering Perfect Forward Secrecy, are called “ephemeral”.</p>
<p>Currently two methods are commonly used to achieve Perfect Forward Secrecy (note<br>the character “E” appended to the traditional abbreviations):</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="external">DHE</a> - An ephemeral version of the Diffie Hellman key-agreement protocol.</li>
<li><a href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman" target="_blank" rel="external">ECDHE</a> - An ephemeral version of the Elliptic Curve Diffie Hellman<br>key-agreement protocol.</li>
</ul>
<p>Ephemeral methods may have some performance drawbacks, because key generation<br>is expensive.</p>
<h2 id="Modifying_the_Default_Cipher_Suite">Modifying the Default Cipher Suite</h2><p>Node.js is built with a default suite of enabled and disabled ciphers.<br>Currently, the default cipher suite is:</p>
<pre><code><span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA384</span><span class="symbol">:DHE-RSA-AES256-SHA384</span><span class="symbol">:ECDHE-RSA-AES256-SHA256</span><span class="symbol">:</span>
<span class="constant">DHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA256</span><span class="symbol">:ECDHE-RSA-AES128-SHA256</span><span class="symbol">:DHE-RSA-AES128-SHA256</span><span class="symbol">:</span>
<span class="constant">HIGH</span><span class="symbol">:</span>!<span class="symbol">aNULL:</span>!<span class="symbol">eNULL:</span>!<span class="constant">EXPORT</span><span class="symbol">:</span>!<span class="constant">DES</span><span class="symbol">:</span>!<span class="constant">RC4</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!<span class="constant">PSK</span><span class="symbol">:</span>!<span class="constant">SRP</span><span class="symbol">:</span>!<span class="constant">CAMELLIA</span>
</code></pre><p>This default can be overridden entirely using the <code>--cipher-list</code> command line<br>switch or <code>NODE_CIPHER_LIST</code> environment variable. For instance:</p>
<pre><code>node --cipher-list=<span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA384</span><span class="symbol">:DHE-RSA-AES256-SHA384</span>
</code></pre><p>Setting the environment variable would have the same effect:</p>
<pre><code><span class="constant">NODE_CIPHER_LIST</span>=<span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA384</span><span class="symbol">:DHE-RSA-AES256-SHA384</span>
</code></pre><p>CAUTION: The default cipher suite has been carefully selected to reflect current<br>security best practices and risk mitigation. Changing the default cipher suite<br>can have a significant impact on the security of an application. The<br><code>--cipher-list</code> and <code>NODE_CIPHER_LIST</code> options should only be used if<br>absolutely necessary.</p>
<h3 id="Using_Legacy_Default_Cipher_Suite">Using Legacy Default Cipher Suite</h3><p>It is possible for the built-in default cipher suite to change from one release<br>of Node.js to another. For instance, v0.10.38 uses a different default than<br>v0.12.2. Such changes can cause issues with applications written to assume<br>certain specific defaults. To help buffer applications against such changes,<br>the <code>--enable-legacy-cipher-list</code> command line switch or <code>NODE_LEGACY_CIPHER_LIST</code><br>environment variable can be set to specify a specific preset default:</p>
<pre><code><span class="comment"># Use the v0.10.38 defaults</span>
node <span class="variable">--enable-legacy-cipher-list=</span>v0.<span class="number">10.38</span>
// <span class="constant">or</span>
<span class="variable">NODE_LEGACY_CIPHER_LIST=</span>v0.<span class="number">10.38</span>

<span class="comment"># Use the v0.12.2 defaults</span>
node <span class="variable">--enable-legacy-cipher-list=</span>v0.<span class="number">12.2</span>
// <span class="constant">or</span>
<span class="variable">NODE_LEGACY_CIPHER_LIST=</span>v0.<span class="number">12.2</span>
</code></pre><p>Currently, the values supported for the <code>enable-legacy-cipher-list</code> switch and<br><code>NODE_LEGACY_CIPHER_LIST</code> environment variable include:</p>
<pre><code>v<span class="number">0</span>.<span class="number">10.38</span> - <span class="constant">To</span> enable the default cipher suite used <span class="keyword">in</span> v<span class="number">0</span>.<span class="number">10.38</span>

  <span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES128</span>-<span class="constant">SHA256</span><span class="symbol">:AES128-GCM-SHA256</span><span class="symbol">:RC4</span><span class="symbol">:HIGH</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!<span class="symbol">aNULL:</span>!<span class="constant">EDH</span>

v<span class="number">0</span>.<span class="number">10.39</span> - <span class="constant">To</span> enable the default cipher suite used <span class="keyword">in</span> v<span class="number">0</span>.<span class="number">10.39</span>

  <span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES128</span>-<span class="constant">SHA256</span><span class="symbol">:AES128-GCM-SHA256</span><span class="symbol">:HIGH</span><span class="symbol">:</span>!<span class="constant">RC4</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!<span class="symbol">aNULL:</span>!<span class="constant">EDH</span>

v<span class="number">0</span>.<span class="number">12.2</span> - <span class="constant">To</span> enable the default cipher suite used <span class="keyword">in</span> v<span class="number">0</span>.<span class="number">12.2</span>

  <span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES128</span>-<span class="constant">SHA256</span><span class="symbol">:DHE-RSA-AES128-SHA256</span><span class="symbol">:AES128-GCM-SHA256</span><span class="symbol">:RC4</span><span class="symbol">:</span>
  <span class="constant">HIGH</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!aNULL

v.<span class="number">0</span>.<span class="number">12.3</span> - <span class="constant">To</span> enable the default cipher suite used <span class="keyword">in</span> v<span class="number">0</span>.<span class="number">12.3</span>

  <span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES128</span>-<span class="constant">SHA256</span><span class="symbol">:DHE-RSA-AES128-SHA256</span><span class="symbol">:AES128-GCM-SHA256</span><span class="symbol">:HIGH</span><span class="symbol">:</span>
  !<span class="constant">RC4</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!aNULL
</code></pre><p>These legacy cipher suites are also made available for use via the<br><code>getLegacyCiphers()</code> method:</p>
<pre><code><span class="reserved">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);
<span class="built_in">console</span>.log(tls.getLegacyCiphers(<span class="string">'v0.10.38'</span>));
</code></pre><p>CAUTION: Changes to the default cipher suite are typically made in order to<br>strengthen the default security for applications running within Node.js.<br>Reverting back to the defaults used by older releases can weaken the security<br>of your applications. The legacy cipher suites should only be used if absolutely<br>necessary.</p>
<h2 id="tls-getCiphers()">tls.getCiphers()</h2><p>Returns an array with the names of the supported SSL ciphers.</p>
<p>Example:</p>
<pre><code><span class="reserved">var</span> ciphers = tls.getCiphers();
<span class="built_in">console</span>.log(ciphers); <span class="regexp">//</span> [<span class="string">'AES128-SHA'</span>, <span class="string">'AES256-SHA'</span>, ...]
</code></pre><h2 id="tls-getLegacyCiphers(version)">tls.getLegacyCiphers(version)</h2><p>Returns the legacy default cipher suite for the specified Node.js release.</p>
<p>Example:<br>    var cipher_suite = tls.getLegacyCiphers(‘v0.10.38’);</p>
<h2 id="tls-createServer(options[,_secureConnectionListener])">tls.createServer(options[, secureConnectionListener])</h2><p>Creates a new <a href="#tls_class_tls_server">tls.Server</a>.  The <code>connectionListener</code> argument is<br>automatically set as a listener for the <a href="#tls_event_secureconnection">secureConnection</a> event.  The<br><code>options</code> object has these possibilities:</p>
<ul>
<li><p><code>pfx</code>: A string or <code>Buffer</code> containing the private key, certificate and<br>CA certs of the server in PFX or PKCS12 format. (Mutually exclusive with<br>the <code>key</code>, <code>cert</code> and <code>ca</code> options.)</p>
</li>
<li><p><code>key</code>: A string or <code>Buffer</code> containing the private key of the server in<br>PEM format. (Could be an array of keys). (Required)</p>
</li>
<li><p><code>passphrase</code>: A string of passphrase for the private key or pfx.</p>
</li>
<li><p><code>cert</code>: A string or <code>Buffer</code> containing the certificate key of the server in<br>PEM format. (Could be an array of certs). (Required)</p>
</li>
<li><p><code>ca</code>: An array of strings or <code>Buffer</code>s of trusted certificates in PEM<br>format. If this is omitted several well known “root” CAs will be used,<br>like VeriSign. These are used to authorize connections.</p>
</li>
<li><p><code>crl</code> : Either a string or list of strings of PEM encoded CRLs (Certificate<br>Revocation List)</p>
</li>
<li><p><code>ciphers</code>: A string describing the ciphers to use or exclude, separated by<br><code>:</code>. The default cipher suite is:</p>
<pre><code><span class="constant">ECDHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA384</span><span class="symbol">:DHE-RSA-AES256-SHA384</span><span class="symbol">:ECDHE-RSA-AES256-SHA256</span><span class="symbol">:</span>
<span class="constant">DHE</span>-<span class="constant">RSA</span>-<span class="constant">AES256</span>-<span class="constant">SHA256</span><span class="symbol">:ECDHE-RSA-AES128-SHA256</span><span class="symbol">:DHE-RSA-AES128-SHA256</span><span class="symbol">:</span>
<span class="constant">HIGH</span><span class="symbol">:</span>!<span class="symbol">aNULL:</span>!<span class="symbol">eNULL:</span>!<span class="constant">EXPORT</span><span class="symbol">:</span>!<span class="constant">DES</span><span class="symbol">:</span>!<span class="constant">RC4</span><span class="symbol">:</span>!<span class="constant">MD5</span><span class="symbol">:</span>!<span class="constant">PSK</span><span class="symbol">:</span>!<span class="constant">SRP</span><span class="symbol">:</span>!<span class="constant">CAMELLIA</span>
</code></pre><p>The default cipher suite prefers ECDHE and DHE ciphers for Perfect Forward<br>secrecy, while offering <em>some</em> backward compatibility. Old clients which<br>rely on insecure and deprecated RC4 or DES-based ciphers (like Internet<br>Explorer 6) aren’t able to complete the handshake with the default<br>configuration. If you absolutely must support these clients, the<br><a href="https://wiki.mozilla.org/Security/Server_Side_TLS" target="_blank" rel="external">TLS recommendations</a> may offer a compatible cipher suite. For more details<br>on the format, see the <a href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT" target="_blank" rel="external">OpenSSL cipher list format documentation</a>.</p>
</li>
<li><p><code>ecdhCurve</code>: A string describing a named curve to use for ECDH key agreement<br>or false to disable ECDH.</p>
<p>Defaults to <code>prime256v1</code>. Consult <a href="http://www.rfc-editor.org/rfc/rfc4492.txt" target="_blank" rel="external">RFC 4492</a> for more details.</p>
</li>
<li><p><code>dhparam</code>: DH parameter file to use for DHE key agreement. Use<br><code>openssl dhparam</code> command to create it. If the file is invalid to<br>load, it is silently discarded.</p>
</li>
<li><p><code>handshakeTimeout</code>: Abort the connection if the SSL/TLS handshake does not<br>finish in this many milliseconds. The default is 120 seconds.</p>
<p>A <code>&#39;clientError&#39;</code> is emitted on the <code>tls.Server</code> object whenever a handshake<br>times out.</p>
</li>
<li><p><code>honorCipherOrder</code> : When choosing a cipher, use the server’s preferences<br>instead of the client preferences. Default: <code>true</code>.</p>
<p>Although, this option is disabled by default, it is <em>recommended</em> that you<br>use this option in conjunction with the <code>ciphers</code> option to mitigate<br>BEAST attacks.</p>
<p>Note: If SSLv2 is used, the server will send its list of preferences to the<br>client, and the client chooses the cipher.  Support for SSLv2 is disabled<br>unless node.js was configured with <code>./configure --with-sslv2</code>.</p>
</li>
<li><p><code>requestCert</code>: If <code>true</code> the server will request a certificate from<br>clients that connect and attempt to verify that certificate. Default:<br><code>false</code>.</p>
</li>
<li><p><code>rejectUnauthorized</code>: If <code>true</code> the server will reject any connection<br>which is not authorized with the list of supplied CAs. This option only<br>has an effect if <code>requestCert</code> is <code>true</code>. Default: <code>false</code>.</p>
</li>
<li><p><code>checkServerIdentity(servername, cert)</code>: Provide an override for checking<br>server’s hostname against the certificate. Should return an error if verification<br>fails. Return <code>undefined</code> if passing.</p>
</li>
<li><p><code>NPNProtocols</code>: An array or <code>Buffer</code> of possible NPN protocols. (Protocols<br>should be ordered by their priority).</p>
</li>
<li><p><code>SNICallback(servername, cb)</code>: A function that will be called if client<br>supports SNI TLS extension. Two argument will be passed to it: <code>servername</code>,<br>and <code>cb</code>. <code>SNICallback</code> should invoke <code>cb(null, ctx)</code>, where <code>ctx</code> is a<br>SecureContext instance.<br>(You can use <code>tls.createSecureContext(...)</code> to get proper<br>SecureContext). If <code>SNICallback</code> wasn’t provided - default callback with<br>high-level API will be used (see below).</p>
</li>
<li><p><code>sessionTimeout</code>: An integer specifying the seconds after which TLS<br>session identifiers and TLS session tickets created by the server are<br>timed out. See <a href="http://www.openssl.org/docs/ssl/SSL_CTX_set_timeout.html" target="_blank" rel="external">SSL_CTX_set_timeout</a> for more details.</p>
</li>
<li><p><code>ticketKeys</code>: A 48-byte <code>Buffer</code> instance consisting of 16-byte prefix,<br>16-byte hmac key, 16-byte AES key. You could use it to accept tls session<br>tickets on multiple instances of tls server.</p>
<p>NOTE: Automatically shared between <code>cluster</code> module workers.</p>
</li>
<li><p><code>sessionIdContext</code>: A string containing an opaque identifier for session<br>resumption. If <code>requestCert</code> is <code>true</code>, the default is MD5 hash value<br>generated from command-line. Otherwise, the default is not provided.</p>
</li>
<li><p><code>secureProtocol</code>: The SSL method to use, e.g. <code>SSLv3_method</code> to force<br>SSL version 3. The possible values depend on your installation of<br>OpenSSL and are defined in the constant <a href="http://www.openssl.org/docs/ssl/ssl.html#DEALING_WITH_PROTOCOL_METHODS" target="_blank" rel="external">SSL_METHODS</a>.</p>
</li>
<li><p><code>secureOptions</code>: Set server options. For example, to disable the SSLv3<br>protocol set the <code>SSL_OP_NO_SSLv3</code> flag. See <a href="https://www.openssl.org/docs/ssl/SSL_CTX_set_options.html" target="_blank" rel="external">SSL_CTX_set_options</a><br>for all available options.</p>
</li>
</ul>
<p>Here is a simple example echo server:</p>
<pre><code><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  key: fs.readFileSync(<span class="string">'server-key.pem'</span>),
  cert: fs.readFileSync(<span class="string">'server-cert.pem'</span>),

  <span class="comment">// This is necessary only if using the client certificate authentication.</span>
  requestCert: <span class="literal">true</span>,

  <span class="comment">// This is necessary only if the client uses the self-signed certificate.</span>
  ca: [ fs.readFileSync(<span class="string">'client-cert.pem'</span>) ]
};

<span class="keyword">var</span> server = tls.createServer(options, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'server connected'</span>,
              socket.authorized ? <span class="string">'authorized'</span> : <span class="string">'unauthorized'</span>);
  socket.write(<span class="string">"welcome!\n"</span>);
  socket.setEncoding(<span class="string">'utf8'</span>);
  socket.pipe(socket);
});
server.listen(<span class="number">8000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'server bound'</span>);
});
</code></pre><p>Or</p>
<pre><code><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  pfx: fs.readFileSync(<span class="string">'server.pfx'</span>),

  <span class="comment">// This is necessary only if using the client certificate authentication.</span>
  requestCert: <span class="literal">true</span>,

};

<span class="keyword">var</span> server = tls.createServer(options, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'server connected'</span>,
              socket.authorized ? <span class="string">'authorized'</span> : <span class="string">'unauthorized'</span>);
  socket.write(<span class="string">"welcome!\n"</span>);
  socket.setEncoding(<span class="string">'utf8'</span>);
  socket.pipe(socket);
});
server.listen(<span class="number">8000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'server bound'</span>);
});
</code></pre><p>You can test this server by connecting to it with <code>openssl s_client</code>:</p>
<pre><code><span class="tag">openssl</span> <span class="tag">s_client</span> <span class="tag">-connect</span> 127<span class="class">.0</span><span class="class">.0</span><span class="class">.1</span><span class="pseudo">:8000</span>
</code></pre><h2 id="tls-connect(options[,_callback])">tls.connect(options[, callback])</h2><h2 id="tls-connect(port[,_host][,_options][,_callback])">tls.connect(port[, host][, options][, callback])</h2><p>Creates a new client connection to the given <code>port</code> and <code>host</code> (old API) or<br><code>options.port</code> and <code>options.host</code>. (If <code>host</code> is omitted, it defaults to<br><code>localhost</code>.) <code>options</code> should be an object which specifies:</p>
<ul>
<li><p><code>host</code>: Host the client should connect to</p>
</li>
<li><p><code>port</code>: Port the client should connect to</p>
</li>
<li><p><code>socket</code>: Establish secure connection on a given socket rather than<br>creating a new socket. If this option is specified, <code>host</code> and <code>port</code><br>are ignored.</p>
</li>
<li><p><code>path</code>: Creates unix socket connection to path. If this option is<br>specified, <code>host</code> and <code>port</code> are ignored.</p>
</li>
<li><p><code>pfx</code>: A string or <code>Buffer</code> containing the private key, certificate and<br>CA certs of the client in PFX or PKCS12 format.</p>
</li>
<li><p><code>key</code>: A string or <code>Buffer</code> containing the private key of the client in<br>PEM format. (Could be an array of keys).</p>
</li>
<li><p><code>passphrase</code>: A string of passphrase for the private key or pfx.</p>
</li>
<li><p><code>cert</code>: A string or <code>Buffer</code> containing the certificate key of the client in<br>PEM format. (Could be an array of certs).</p>
</li>
<li><p><code>ca</code>: An array of strings or <code>Buffer</code>s of trusted certificates in PEM<br>format. If this is omitted several well known “root” CAs will be used,<br>like VeriSign. These are used to authorize connections.</p>
</li>
<li><p><code>rejectUnauthorized</code>: If <code>true</code>, the server certificate is verified against<br>the list of supplied CAs. An <code>&#39;error&#39;</code> event is emitted if verification<br>fails; <code>err.code</code> contains the OpenSSL error code. Default: <code>true</code>.</p>
</li>
<li><p><code>NPNProtocols</code>: An array of strings or <code>Buffer</code>s containing supported NPN<br>protocols. <code>Buffer</code>s should have following format: <code>0x05hello0x05world</code>,<br>where first byte is next protocol name’s length. (Passing array should<br>usually be much simpler: <code>[&#39;hello&#39;, &#39;world&#39;]</code>.)</p>
</li>
<li><p><code>servername</code>: Servername for SNI (Server Name Indication) TLS extension.</p>
</li>
<li><p><code>secureProtocol</code>: The SSL method to use, e.g. <code>SSLv3_method</code> to force<br>SSL version 3. The possible values depend on your installation of<br>OpenSSL and are defined in the constant <a href="http://www.openssl.org/docs/ssl/ssl.html#DEALING_WITH_PROTOCOL_METHODS" target="_blank" rel="external">SSL_METHODS</a>.</p>
</li>
<li><p><code>session</code>: A <code>Buffer</code> instance, containing TLS session.</p>
</li>
</ul>
<p>The <code>callback</code> parameter will be added as a listener for the<br><a href="#tls_event_secureconnect">‘secureConnect’</a> event.</p>
<p><code>tls.connect()</code> returns a <a href="#tls_class_tls_tlssocket">tls.TLSSocket</a> object.</p>
<p>Here is an example of a client of echo server as described previously:</p>
<pre><code><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  <span class="comment">// These are necessary only if using the client certificate authentication</span>
  key: fs.readFileSync(<span class="string">'client-key.pem'</span>),
  cert: fs.readFileSync(<span class="string">'client-cert.pem'</span>),

  <span class="comment">// This is necessary only if the server uses the self-signed certificate</span>
  ca: [ fs.readFileSync(<span class="string">'server-cert.pem'</span>) ]
};

<span class="keyword">var</span> socket = tls.connect(<span class="number">8000</span>, options, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'client connected'</span>,
              socket.authorized ? <span class="string">'authorized'</span> : <span class="string">'unauthorized'</span>);
  process.stdin.pipe(socket);
  process.stdin.resume();
});
socket.setEncoding(<span class="string">'utf8'</span>);
socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(data);
});
socket.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  server.close();
});
</code></pre><p>Or</p>
<pre><code><span class="keyword">var</span> tls = <span class="built_in">require</span>(<span class="string">'tls'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  pfx: fs.readFileSync(<span class="string">'client.pfx'</span>)
};

<span class="keyword">var</span> socket = tls.connect(<span class="number">8000</span>, options, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'client connected'</span>,
              socket.authorized ? <span class="string">'authorized'</span> : <span class="string">'unauthorized'</span>);
  process.stdin.pipe(socket);
  process.stdin.resume();
});
socket.setEncoding(<span class="string">'utf8'</span>);
socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(data);
});
socket.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  server.close();
});
</code></pre><h2 id="Class:_tls-TLSSocket">Class: tls.TLSSocket</h2><p>Wrapper for instance of <a href="net.html#net_class_net_socket">net.Socket</a>, replaces internal socket read/write<br>routines to perform transparent encryption/decryption of incoming/outgoing data.</p>
<h2 id="new_tls-TLSSocket(socket,_options)">new tls.TLSSocket(socket, options)</h2><p>Construct a new TLSSocket object from existing TCP socket.</p>
<p><code>socket</code> is an instance of <a href="net.html#net_class_net_socket">net.Socket</a></p>
<p><code>options</code> is an object that might contain following properties:</p>
<ul>
<li><p><code>secureContext</code>: An optional TLS context object from<br> <code>tls.createSecureContext( ... )</code></p>
</li>
<li><p><code>isServer</code>: If true - TLS socket will be instantiated in server-mode</p>
</li>
<li><p><code>server</code>: An optional <a href="net.html#net_class_net_server">net.Server</a> instance</p>
</li>
<li><p><code>requestCert</code>: Optional, see <a href="#tls_tls_createsecurepair_credentials_isserver_requestcert_rejectunauthorized">tls.createSecurePair</a></p>
</li>
<li><p><code>rejectUnauthorized</code>: Optional, see <a href="#tls_tls_createsecurepair_credentials_isserver_requestcert_rejectunauthorized">tls.createSecurePair</a></p>
</li>
<li><p><code>NPNProtocols</code>: Optional, see <a href="#tls_tls_createserver_options_secureconnectionlistener">tls.createServer</a></p>
</li>
<li><p><code>SNICallback</code>: Optional, see <a href="#tls_tls_createserver_options_secureconnectionlistener">tls.createServer</a></p>
</li>
<li><p><code>session</code>: Optional, a <code>Buffer</code> instance, containing TLS session</p>
</li>
<li><p><code>requestOCSP</code>: Optional, if <code>true</code> - OCSP status request extension would<br>be added to client hello, and <code>OCSPResponse</code> event will be emitted on socket<br>before establishing secure communication</p>
</li>
</ul>
<h2 id="tls-createSecureContext(details)">tls.createSecureContext(details)</h2><p>Creates a credentials object, with the optional details being a<br>dictionary with keys:</p>
<ul>
<li><code>pfx</code> : A string or buffer holding the PFX or PKCS12 encoded private<br>key, certificate and CA certificates</li>
<li><code>key</code> : A string holding the PEM encoded private key</li>
<li><code>passphrase</code> : A string of passphrase for the private key or pfx</li>
<li><code>cert</code> : A string holding the PEM encoded certificate</li>
<li><code>ca</code> : Either a string or list of strings of PEM encoded CA<br>certificates to trust.</li>
<li><code>crl</code> : Either a string or list of strings of PEM encoded CRLs<br>(Certificate Revocation List)</li>
<li><code>ciphers</code>: A string describing the ciphers to use or exclude.<br>Consult<br><a href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT" target="_blank" rel="external">http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT</a><br>for details on the format.</li>
<li><code>honorCipherOrder</code> : When choosing a cipher, use the server’s preferences<br>instead of the client preferences. For further details see <code>tls</code> module<br>documentation.</li>
</ul>
<p>If no ‘ca’ details are given, then node.js will use the default<br>publicly trusted list of CAs as given in<br><a href="http://mxr.mozilla.org/mozilla/source/security/nss/lib/ckfw/builtins/certdata.txt" target="_blank" rel="external">http://mxr.mozilla.org/mozilla/source/security/nss/lib/ckfw/builtins/certdata.txt</a>.</p>
<h2 id="tls-createSecurePair([context][,_isServer][,_requestCert][,_rejectUnauthorized])">tls.createSecurePair([context][, isServer][, requestCert][, rejectUnauthorized])</h2><p>Creates a new secure pair object with two streams, one of which reads/writes<br>encrypted data, and one reads/writes cleartext data.<br>Generally the encrypted one is piped to/from an incoming encrypted data stream,<br>and the cleartext one is used as a replacement for the initial encrypted stream.</p>
<ul>
<li><p><code>credentials</code>: A secure context object from tls.createSecureContext( … )</p>
</li>
<li><p><code>isServer</code>: A boolean indicating whether this tls connection should be<br>opened as a server or a client.</p>
</li>
<li><p><code>requestCert</code>: A boolean indicating whether a server should request a<br>certificate from a connecting client. Only applies to server connections.</p>
</li>
<li><p><code>rejectUnauthorized</code>: A boolean indicating whether a server should<br>automatically reject clients with invalid certificates. Only applies to<br>servers with <code>requestCert</code> enabled.</p>
</li>
</ul>
<p><code>tls.createSecurePair()</code> returns a SecurePair object with <code>cleartext</code> and<br><code>encrypted</code> stream properties.</p>
<p>NOTE: <code>cleartext</code> has the same APIs as <a href="#tls_class_tls_tlssocket">tls.TLSSocket</a></p>
<h2 id="Class:_SecurePair">Class: SecurePair</h2><p>Returned by tls.createSecurePair.</p>
<h3 id="Event:_‘secure’">Event: ‘secure’</h3><p>The event is emitted from the SecurePair once the pair has successfully<br>established a secure connection.</p>
<p>Similarly to the checking for the server ‘secureConnection’ event,<br>pair.cleartext.authorized should be checked to confirm whether the certificate<br>used properly authorized.</p>
<h2 id="Class:_tls-Server">Class: tls.Server</h2><p>This class is a subclass of <code>net.Server</code> and has the same methods on it.<br>Instead of accepting just raw TCP connections, this accepts encrypted<br>connections using TLS or SSL.</p>
<h3 id="Event:_‘secureConnection’">Event: ‘secureConnection’</h3><p><code>function (tlsSocket) {}</code></p>
<p>This event is emitted after a new connection has been successfully<br>handshaked. The argument is an instance of <a href="#tls_class_tls_tlssocket">tls.TLSSocket</a>. It has all the<br>common stream methods and events.</p>
<p><code>socket.authorized</code> is a boolean value which indicates if the<br>client has verified by one of the supplied certificate authorities for the<br>server. If <code>socket.authorized</code> is false, then<br><code>socket.authorizationError</code> is set to describe how authorization<br>failed. Implied but worth mentioning: depending on the settings of the TLS<br>server, you unauthorized connections may be accepted.<br><code>socket.npnProtocol</code> is a string containing selected NPN protocol.<br><code>socket.servername</code> is a string containing servername requested with<br>SNI.</p>
<h3 id="Event:_‘clientError’">Event: ‘clientError’</h3><p><code>function (exception, tlsSocket) { }</code></p>
<p>When a client connection emits an ‘error’ event before secure connection is<br>established - it will be forwarded here.</p>
<p><code>tlsSocket</code> is the <a href="#tls_class_tls_tlssocket">tls.TLSSocket</a> that the error originated from.</p>
<h3 id="Event:_‘newSession’">Event: ‘newSession’</h3><p><code>function (sessionId, sessionData, callback) { }</code></p>
<p>Emitted on creation of TLS session. May be used to store sessions in external<br>storage. <code>callback</code> must be invoked eventually, otherwise no data will be<br>sent or received from secure connection.</p>
<p>NOTE: adding this event listener will have an effect only on connections<br>established after addition of event listener.</p>
<h3 id="Event:_‘resumeSession’">Event: ‘resumeSession’</h3><p><code>function (sessionId, callback) { }</code></p>
<p>Emitted when client wants to resume previous TLS session. Event listener may<br>perform lookup in external storage using given <code>sessionId</code>, and invoke<br><code>callback(null, sessionData)</code> once finished. If session can’t be resumed<br>(i.e. doesn’t exist in storage) one may call <code>callback(null, null)</code>. Calling<br><code>callback(err)</code> will terminate incoming connection and destroy socket.</p>
<p>NOTE: adding this event listener will have an effect only on connections<br>established after addition of event listener.</p>
<h3 id="Event:_‘OCSPRequest’">Event: ‘OCSPRequest’</h3><p><code>function (certificate, issuer, callback) { }</code></p>
<p>Emitted when the client sends a certificate status request. You could parse<br>server’s current certificate to obtain OCSP url and certificate id, and after<br>obtaining OCSP response invoke <code>callback(null, resp)</code>, where <code>resp</code> is a<br><code>Buffer</code> instance. Both <code>certificate</code> and <code>issuer</code> are a <code>Buffer</code><br>DER-representations of the primary and issuer’s certificates. They could be used<br>to obtain OCSP certificate id and OCSP endpoint url.</p>
<p>Alternatively, <code>callback(null, null)</code> could be called, meaning that there is no<br>OCSP response.</p>
<p>Calling <code>callback(err)</code> will result in a <code>socket.destroy(err)</code> call.</p>
<p>Typical flow:</p>
<ol>
<li>Client connects to server and sends <code>OCSPRequest</code> to it (via status info<br>extension in ClientHello.)</li>
<li>Server receives request and invokes <code>OCSPRequest</code> event listener if present</li>
<li>Server grabs OCSP url from either <code>certificate</code> or <code>issuer</code> and performs an<br><a href="http://en.wikipedia.org/wiki/OCSP_stapling" target="_blank" rel="external">OCSP request</a> to the CA</li>
<li>Server receives <code>OCSPResponse</code> from CA and sends it back to client via<br><code>callback</code> argument</li>
<li>Client validates the response and either destroys socket or performs a<br>handshake.</li>
</ol>
<p>NOTE: <code>issuer</code> could be null, if the certificate is self-signed or if the issuer<br>is not in the root certificates list. (You could provide an issuer via <code>ca</code><br>option.)</p>
<p>NOTE: adding this event listener will have an effect only on connections<br>established after addition of event listener.</p>
<p>NOTE: you may want to use some npm module like <a href="http://npmjs.org/package/asn1.js" target="_blank" rel="external">asn1.js</a> to parse the<br>certificates.</p>
<h3 id="server-listen(port[,_host][,_callback])">server.listen(port[, host][, callback])</h3><p>Begin accepting connections on the specified <code>port</code> and <code>host</code>.  If the<br><code>host</code> is omitted, the server will accept connections directed to any<br>IPv4 address (<code>INADDR_ANY</code>).</p>
<p>This function is asynchronous. The last parameter <code>callback</code> will be called<br>when the server has been bound.</p>
<p>See <code>net.Server</code> for more information.</p>
<h3 id="server-close()">server.close()</h3><p>Stops the server from accepting new connections. This function is<br>asynchronous, the server is finally closed when the server emits a <code>&#39;close&#39;</code><br>event.</p>
<h3 id="server-address()">server.address()</h3><p>Returns the bound address, the address family name and port of the<br>server as reported by the operating system.  See <a href="net.html#net_server_address">net.Server.address()</a> for<br>more information.</p>
<h3 id="server-addContext(hostname,_context)">server.addContext(hostname, context)</h3><p>Add secure context that will be used if client request’s SNI hostname is<br>matching passed <code>hostname</code> (wildcards can be used). <code>context</code> can contain<br><code>key</code>, <code>cert</code>, <code>ca</code> and/or any other properties from <code>tls.createSecureContext</code><br><code>options</code> argument.</p>
<h3 id="server-maxConnections">server.maxConnections</h3><p>Set this property to reject connections when the server’s connection count<br>gets high.</p>
<h3 id="server-connections">server.connections</h3><p>The number of concurrent connections on the server.</p>
<h2 id="Class:_CryptoStream">Class: CryptoStream</h2><pre><code><span class="attribute">Stability</span>: <span class="string">0 - Deprecated. Use tls.TLSSocket instead.</span>
</code></pre><p>This is an encrypted stream.</p>
<h3 id="cryptoStream-bytesWritten">cryptoStream.bytesWritten</h3><p>A proxy to the underlying socket’s bytesWritten accessor, this will return<br>the total bytes written to the socket, <em>including the TLS overhead</em>.</p>
<h2 id="Class:_tls-TLSSocket-1">Class: tls.TLSSocket</h2><p>This is a wrapped version of <a href="net.html#net_class_net_socket">net.Socket</a> that does transparent encryption<br>of written data and all required TLS negotiation.</p>
<p>This instance implements a duplex <a href="stream.html#stream_stream">Stream</a> interfaces.  It has all the<br>common stream methods and events.</p>
<h3 id="Event:_‘secureConnect’">Event: ‘secureConnect’</h3><p>This event is emitted after a new connection has been successfully handshaked.<br>The listener will be called no matter if the server’s certificate was<br>authorized or not. It is up to the user to test <code>tlsSocket.authorized</code><br>to see if the server certificate was signed by one of the specified CAs.<br>If <code>tlsSocket.authorized === false</code> then the error can be found in<br><code>tlsSocket.authorizationError</code>. Also if NPN was used - you can check<br><code>tlsSocket.npnProtocol</code> for negotiated protocol.</p>
<h3 id="Event:_‘OCSPResponse’">Event: ‘OCSPResponse’</h3><p><code>function (response) { }</code></p>
<p>This event will be emitted if <code>requestOCSP</code> option was set. <code>response</code> is a<br>buffer object, containing server’s OCSP response.</p>
<p>Traditionally, the <code>response</code> is a signed object from the server’s CA that<br>contains information about server’s certificate revocation status.</p>
<h3 id="tlsSocket-encrypted">tlsSocket.encrypted</h3><p>Static boolean value, always <code>true</code>. May be used to distinguish TLS sockets<br>from regular ones.</p>
<h3 id="tlsSocket-authorized">tlsSocket.authorized</h3><p>A boolean that is <code>true</code> if the peer certificate was signed by one of the<br>specified CAs, otherwise <code>false</code></p>
<h3 id="tlsSocket-authorizationError">tlsSocket.authorizationError</h3><p>The reason why the peer’s certificate has not been verified. This property<br>becomes available only when <code>tlsSocket.authorized === false</code>.</p>
<h3 id="tlsSocket-getPeerCertificate([_detailed_])">tlsSocket.getPeerCertificate([ detailed ])</h3><p>Returns an object representing the peer’s certificate. The returned object has<br>some properties corresponding to the field of the certificate. If <code>detailed</code><br>argument is <code>true</code> - the full chain with <code>issuer</code> property will be returned,<br>if <code>false</code> - only the top certificate without <code>issuer</code> property.</p>
<p>Example:</p>
<pre><code>{ subject:
   { C: <span class="string">'UK'</span>,
     ST: <span class="string">'Acknack Ltd'</span>,
     L: <span class="string">'Rhys Jones'</span>,
     O: <span class="string">'node.js'</span>,
     OU: <span class="string">'Test TLS Certificate'</span>,
     <span class="literal">CN</span>: <span class="string">'localhost'</span> },
  issuerInfo:
   { C: <span class="string">'UK'</span>,
     ST: <span class="string">'Acknack Ltd'</span>,
     L: <span class="string">'Rhys Jones'</span>,
     O: <span class="string">'node.js'</span>,
     OU: <span class="string">'Test TLS Certificate'</span>,
     <span class="literal">CN</span>: <span class="string">'localhost'</span> },
  issuer:
   { <span class="attribute">...</span> another certificate <span class="attribute">...</span> },
  raw: <span class="subst">&lt;</span> RAW DER buffer <span class="subst">&gt;</span>,
  valid_from: <span class="string">'Nov 11 09:52:22 2009 GMT'</span>,
  valid_to: <span class="string">'Nov  6 09:52:22 2029 GMT'</span>,
  fingerprint: <span class="string">'2A:7A:C2:DD:E5:F9:CC:53:72:35:99:7A:02:5A:71:38:52:EC:8A:DF'</span>,
  serialNumber: <span class="string">'B9B0D332A1AA5635'</span> }
</code></pre><p>If the peer does not provide a certificate, it returns <code>null</code> or an empty<br>object.</p>
<h3 id="tlsSocket-getCipher()">tlsSocket.getCipher()</h3><p>Returns an object representing the cipher name and the SSL/TLS<br>protocol version of the current connection.</p>
<p>Example:<br>{ name: ‘AES256-SHA’, version: ‘TLSv1/SSLv3’ }</p>
<p>See SSL_CIPHER_get_name() and SSL_CIPHER_get_version() in<br><a href="http://www.openssl.org/docs/ssl/ssl.html#DEALING_WITH_CIPHERS" target="_blank" rel="external">http://www.openssl.org/docs/ssl/ssl.html#DEALING_WITH_CIPHERS</a> for more<br>information.</p>
<h3 id="tlsSocket-renegotiate(options,_callback)">tlsSocket.renegotiate(options, callback)</h3><p>Initiate TLS renegotiation process. The <code>options</code> may contain the following<br>fields: <code>rejectUnauthorized</code>, <code>requestCert</code> (See <a href="#tls_tls_createserver_options_secureconnectionlistener">tls.createServer</a><br>for details). <code>callback(err)</code> will be executed with <code>null</code> as <code>err</code>,<br>once the renegotiation is successfully completed.</p>
<p>NOTE: Can be used to request peer’s certificate after the secure connection<br>has been established.</p>
<p>ANOTHER NOTE: When running as the server, socket will be destroyed<br>with an error after <code>handshakeTimeout</code> timeout.</p>
<h3 id="tlsSocket-setMaxSendFragment(size)">tlsSocket.setMaxSendFragment(size)</h3><p>Set maximum TLS fragment size (default and maximum value is: <code>16384</code>, minimum<br>is: <code>512</code>). Returns <code>true</code> on success, <code>false</code> otherwise.</p>
<p>Smaller fragment size decreases buffering latency on the client: large<br>fragments are buffered by the TLS layer until the entire fragment is received<br>and its integrity is verified; large fragments can span multiple roundtrips,<br>and their processing can be delayed due to packet loss or reordering. However,<br>smaller fragments add extra TLS framing bytes and CPU overhead, which may<br>decrease overall server throughput.</p>
<h3 id="tlsSocket-getSession()">tlsSocket.getSession()</h3><p>Return ASN.1 encoded TLS session or <code>undefined</code> if none was negotiated. Could<br>be used to speed up handshake establishment when reconnecting to the server.</p>
<h3 id="tlsSocket-getTLSTicket()">tlsSocket.getTLSTicket()</h3><p>NOTE: Works only with client TLS sockets. Useful only for debugging, for<br>session reuse provide <code>session</code> option to <code>tls.connect</code>.</p>
<p>Return TLS session ticket or <code>undefined</code> if none was negotiated.</p>
<h3 id="tlsSocket-address()">tlsSocket.address()</h3><p>Returns the bound address, the address family name and port of the<br>underlying socket as reported by the operating system. Returns an<br>object with three properties, e.g.<br><code>{ port: 12346, family: &#39;IPv4&#39;, address: &#39;127.0.0.1&#39; }</code></p>
<h3 id="tlsSocket-remoteAddress">tlsSocket.remoteAddress</h3><p>The string representation of the remote IP address. For example,<br><code>&#39;74.125.127.100&#39;</code> or <code>&#39;2001:4860:a005::68&#39;</code>.</p>
<h3 id="tlsSocket-remoteFamily">tlsSocket.remoteFamily</h3><p>The string representation of the remote IP family. <code>&#39;IPv4&#39;</code> or <code>&#39;IPv6&#39;</code>.</p>
<h3 id="tlsSocket-remotePort">tlsSocket.remotePort</h3><p>The numeric representation of the remote port. For example, <code>443</code>.</p>
<h3 id="tlsSocket-localAddress">tlsSocket.localAddress</h3><p>The string representation of the local IP address.</p>
<h3 id="tlsSocket-localPort">tlsSocket.localPort</h3><p>The numeric representation of the local port.</p>
<h1 id="StringDecoder"><a id="string_decoder">StringDecoder</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>To use this module, do <code>require(&#39;string_decoder&#39;)</code>. StringDecoder decodes a<br>buffer to a string. It is a simple interface to <code>buffer.toString()</code> but provides<br>additional support for utf8.</p>
<pre><code><span class="reserved">var</span> StringDecoder = <span class="built_in">require</span>(<span class="string">'string_decoder'</span>).StringDecoder;
<span class="reserved">var</span> decoder = <span class="keyword">new</span> StringDecoder(<span class="string">'utf8'</span>);

<span class="reserved">var</span> cent = <span class="keyword">new</span> Buffer([<span class="number">0xC2</span>, <span class="number">0xA2</span>]);
<span class="built_in">console</span>.log(decoder.write(cent));

<span class="reserved">var</span> euro = <span class="keyword">new</span> Buffer([<span class="number">0xE2</span>, <span class="number">0x82</span>, <span class="number">0xAC</span>]);
<span class="built_in">console</span>.log(decoder.write(euro));
</code></pre><h2 id="Class:_StringDecoder">Class: StringDecoder</h2><p>Accepts a single argument, <code>encoding</code> which defaults to <code>utf8</code>.</p>
<h3 id="decoder-write(buffer)">decoder.write(buffer)</h3><p>Returns a decoded string.</p>
<h3 id="decoder-end()">decoder.end()</h3><p>Returns any trailing bytes that were left in the buffer.</p>
<h1 id="File_System"><a id="fs">File System</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><!--name=fs-->
<p>File I/O is provided by simple wrappers around standard POSIX functions.  To<br>use this module do <code>require(&#39;fs&#39;)</code>. All the methods have asynchronous and<br>synchronous forms.</p>
<p>The asynchronous form always take a completion callback as its last argument.<br>The arguments passed to the completion callback depend on the method, but the<br>first argument is always reserved for an exception. If the operation was<br>completed successfully, then the first argument will be <code>null</code> or <code>undefined</code>.</p>
<p>When using the synchronous form any exceptions are immediately thrown.<br>You can use try/catch to handle exceptions or allow them to bubble up.</p>
<p>Here is an example of the asynchronous version:</p>
<pre><code><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

fs.unlink(<span class="string">'/tmp/hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(<span class="string">'successfully deleted /tmp/hello'</span>);
});
</code></pre><p>Here is the synchronous version:</p>
<pre><code><span class="reserved">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

fs.unlinkSync(<span class="string">'/tmp/hello'</span>);
<span class="built_in">console</span>.log(<span class="string">'successfully deleted /tmp/hello'</span>);
</code></pre><p>With the asynchronous methods there is no guaranteed ordering. So the<br>following is prone to error:</p>
<pre><code>fs.rename(<span class="string">'/tmp/hello'</span>, <span class="string">'/tmp/world'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(<span class="string">'renamed complete'</span>);
});
fs.stat(<span class="string">'/tmp/world'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(<span class="string">'stats: '</span> + <span class="built_in">JSON</span>.stringify(stats));
});
</code></pre><p>It could be that <code>fs.stat</code> is executed before <code>fs.rename</code>.<br>The correct way to do this is to chain the callbacks.</p>
<pre><code>fs.rename(<span class="string">'/tmp/hello'</span>, <span class="string">'/tmp/world'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  fs.stat(<span class="string">'/tmp/world'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>{
    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
    <span class="built_in">console</span>.log(<span class="string">'stats: '</span> + <span class="built_in">JSON</span>.stringify(stats));
  });
});
</code></pre><p>In busy processes, the programmer is <em>strongly encouraged</em> to use the<br>asynchronous versions of these calls. The synchronous versions will block<br>the entire process until they complete—halting all connections.</p>
<p>Relative path to filename can be used, remember however that this path will be<br>relative to <code>process.cwd()</code>.</p>
<p>Most fs functions let you omit the callback argument. If you do, a default<br>callback is used that rethrows errors. To get a trace to the original call<br>site, set the NODE_DEBUG environment variable:</p>
<pre><code>$ cat <span class="keyword">script</span>.js
function bad() {
  require('fs').readFile('/');
}
bad();

$ env NODE_DEBUG=fs node <span class="keyword">script</span>.js
fs.js:<span class="number">66</span>
        throw err;
              ^
Error: EISDIR, <span class="command">read</span>
    <span class="keyword">at</span> rethrow (fs.js:<span class="number">61</span>:<span class="number">21</span>)
    <span class="keyword">at</span> maybeCallback (fs.js:<span class="number">79</span>:<span class="number">42</span>)
    <span class="keyword">at</span> Object.fs.readFile (fs.js:<span class="number">153</span>:<span class="number">18</span>)
    <span class="keyword">at</span> bad (/path/<span class="keyword">to</span>/<span class="keyword">script</span>.js:<span class="number">2</span>:<span class="number">17</span>)
    <span class="keyword">at</span> Object.&lt;anonymous&gt; (/path/<span class="keyword">to</span>/<span class="keyword">script</span>.js:<span class="number">5</span>:<span class="number">1</span>)
    &lt;etc.&gt;
</code></pre><h2 id="fs-rename(oldPath,_newPath,_callback)">fs.rename(oldPath, newPath, callback)</h2><p>Asynchronous rename(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-renameSync(oldPath,_newPath)">fs.renameSync(oldPath, newPath)</h2><p>Synchronous rename(2). Returns <code>undefined</code>.</p>
<h2 id="fs-ftruncate(fd,_len,_callback)">fs.ftruncate(fd, len, callback)</h2><p>Asynchronous ftruncate(2). No arguments other than a possible exception are<br>given to the completion callback.</p>
<h2 id="fs-ftruncateSync(fd,_len)">fs.ftruncateSync(fd, len)</h2><p>Synchronous ftruncate(2). Returns <code>undefined</code>.</p>
<h2 id="fs-truncate(path,_len,_callback)">fs.truncate(path, len, callback)</h2><p>Asynchronous truncate(2). No arguments other than a possible exception are<br>given to the completion callback. A file descriptor can also be passed as the<br>first argument. In this case, <code>fs.ftruncate()</code> is called.</p>
<h2 id="fs-truncateSync(path,_len)">fs.truncateSync(path, len)</h2><p>Synchronous truncate(2). Returns <code>undefined</code>.</p>
<h2 id="fs-chown(path,_uid,_gid,_callback)">fs.chown(path, uid, gid, callback)</h2><p>Asynchronous chown(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-chownSync(path,_uid,_gid)">fs.chownSync(path, uid, gid)</h2><p>Synchronous chown(2). Returns <code>undefined</code>.</p>
<h2 id="fs-fchown(fd,_uid,_gid,_callback)">fs.fchown(fd, uid, gid, callback)</h2><p>Asynchronous fchown(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-fchownSync(fd,_uid,_gid)">fs.fchownSync(fd, uid, gid)</h2><p>Synchronous fchown(2). Returns <code>undefined</code>.</p>
<h2 id="fs-lchown(path,_uid,_gid,_callback)">fs.lchown(path, uid, gid, callback)</h2><p>Asynchronous lchown(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-lchownSync(path,_uid,_gid)">fs.lchownSync(path, uid, gid)</h2><p>Synchronous lchown(2). Returns <code>undefined</code>.</p>
<h2 id="fs-chmod(path,_mode,_callback)">fs.chmod(path, mode, callback)</h2><p>Asynchronous chmod(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-chmodSync(path,_mode)">fs.chmodSync(path, mode)</h2><p>Synchronous chmod(2). Returns <code>undefined</code>.</p>
<h2 id="fs-fchmod(fd,_mode,_callback)">fs.fchmod(fd, mode, callback)</h2><p>Asynchronous fchmod(2). No arguments other than a possible exception<br>are given to the completion callback.</p>
<h2 id="fs-fchmodSync(fd,_mode)">fs.fchmodSync(fd, mode)</h2><p>Synchronous fchmod(2). Returns <code>undefined</code>.</p>
<h2 id="fs-lchmod(path,_mode,_callback)">fs.lchmod(path, mode, callback)</h2><p>Asynchronous lchmod(2). No arguments other than a possible exception<br>are given to the completion callback.</p>
<p>Only available on Mac OS X.</p>
<h2 id="fs-lchmodSync(path,_mode)">fs.lchmodSync(path, mode)</h2><p>Synchronous lchmod(2). Returns <code>undefined</code>.</p>
<h2 id="fs-stat(path,_callback)">fs.stat(path, callback)</h2><p>Asynchronous stat(2). The callback gets two arguments <code>(err, stats)</code> where<br><code>stats</code> is a <a href="#fs_class_fs_stats">fs.Stats</a> object.  See the <a href="#fs_class_fs_stats">fs.Stats</a><br>section below for more information.</p>
<h2 id="fs-lstat(path,_callback)">fs.lstat(path, callback)</h2><p>Asynchronous lstat(2). The callback gets two arguments <code>(err, stats)</code> where<br><code>stats</code> is a <code>fs.Stats</code> object. <code>lstat()</code> is identical to <code>stat()</code>, except that if<br><code>path</code> is a symbolic link, then the link itself is stat-ed, not the file that it<br>refers to.</p>
<h2 id="fs-fstat(fd,_callback)">fs.fstat(fd, callback)</h2><p>Asynchronous fstat(2). The callback gets two arguments <code>(err, stats)</code> where<br><code>stats</code> is a <code>fs.Stats</code> object. <code>fstat()</code> is identical to <code>stat()</code>, except that<br>the file to be stat-ed is specified by the file descriptor <code>fd</code>.</p>
<h2 id="fs-statSync(path)">fs.statSync(path)</h2><p>Synchronous stat(2). Returns an instance of <code>fs.Stats</code>.</p>
<h2 id="fs-lstatSync(path)">fs.lstatSync(path)</h2><p>Synchronous lstat(2). Returns an instance of <code>fs.Stats</code>.</p>
<h2 id="fs-fstatSync(fd)">fs.fstatSync(fd)</h2><p>Synchronous fstat(2). Returns an instance of <code>fs.Stats</code>.</p>
<h2 id="fs-link(srcpath,_dstpath,_callback)">fs.link(srcpath, dstpath, callback)</h2><p>Asynchronous link(2). No arguments other than a possible exception are given to<br>the completion callback.</p>
<h2 id="fs-linkSync(srcpath,_dstpath)">fs.linkSync(srcpath, dstpath)</h2><p>Synchronous link(2). Returns <code>undefined</code>.</p>
<h2 id="fs-symlink(srcpath,_dstpath[,_type],_callback)">fs.symlink(srcpath, dstpath[, type], callback)</h2><p>Asynchronous symlink(2). No arguments other than a possible exception are given<br>to the completion callback.<br>The <code>type</code> argument can be set to <code>&#39;dir&#39;</code>, <code>&#39;file&#39;</code>, or <code>&#39;junction&#39;</code> (default<br>is <code>&#39;file&#39;</code>) and is only available on Windows (ignored on other platforms).<br>Note that Windows junction points require the destination path to be absolute.  When using<br><code>&#39;junction&#39;</code>, the <code>destination</code> argument will automatically be normalized to absolute path.</p>
<h2 id="fs-symlinkSync(srcpath,_dstpath[,_type])">fs.symlinkSync(srcpath, dstpath[, type])</h2><p>Synchronous symlink(2). Returns <code>undefined</code>.</p>
<h2 id="fs-readlink(path,_callback)">fs.readlink(path, callback)</h2><p>Asynchronous readlink(2). The callback gets two arguments <code>(err,
linkString)</code>.</p>
<h2 id="fs-readlinkSync(path)">fs.readlinkSync(path)</h2><p>Synchronous readlink(2). Returns the symbolic link’s string value.</p>
<h2 id="fs-realpath(path[,_cache],_callback)">fs.realpath(path[, cache], callback)</h2><p>Asynchronous realpath(2). The <code>callback</code> gets two arguments <code>(err,
resolvedPath)</code>. May use <code>process.cwd</code> to resolve relative paths. <code>cache</code> is an<br>object literal of mapped paths that can be used to force a specific path<br>resolution or avoid additional <code>fs.stat</code> calls for known real paths.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> cache = {<span class="string">'/etc'</span>:<span class="string">'/private/etc'</span>};
fs.realpath(<span class="string">'/etc/passwd'</span>, cache, <span class="function"><span class="keyword">function</span> (<span class="params">err, resolvedPath</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(resolvedPath);
});
</code></pre><h2 id="fs-realpathSync(path[,_cache])">fs.realpathSync(path[, cache])</h2><p>Synchronous realpath(2). Returns the resolved path.</p>
<h2 id="fs-unlink(path,_callback)">fs.unlink(path, callback)</h2><p>Asynchronous unlink(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-unlinkSync(path)">fs.unlinkSync(path)</h2><p>Synchronous unlink(2). Returns <code>undefined</code>.</p>
<h2 id="fs-rmdir(path,_callback)">fs.rmdir(path, callback)</h2><p>Asynchronous rmdir(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-rmdirSync(path)">fs.rmdirSync(path)</h2><p>Synchronous rmdir(2). Returns <code>undefined</code>.</p>
<h2 id="fs-mkdir(path[,_mode],_callback)">fs.mkdir(path[, mode], callback)</h2><p>Asynchronous mkdir(2). No arguments other than a possible exception are given<br>to the completion callback. <code>mode</code> defaults to <code>0777</code>.</p>
<h2 id="fs-mkdirSync(path[,_mode])">fs.mkdirSync(path[, mode])</h2><p>Synchronous mkdir(2). Returns <code>undefined</code>.</p>
<h2 id="fs-readdir(path,_callback)">fs.readdir(path, callback)</h2><p>Asynchronous readdir(3).  Reads the contents of a directory.<br>The callback gets two arguments <code>(err, files)</code> where <code>files</code> is an array of<br>the names of the files in the directory excluding <code>&#39;.&#39;</code> and <code>&#39;..&#39;</code>.</p>
<h2 id="fs-readdirSync(path)">fs.readdirSync(path)</h2><p>Synchronous readdir(3). Returns an array of filenames excluding <code>&#39;.&#39;</code> and<br><code>&#39;..&#39;</code>.</p>
<h2 id="fs-close(fd,_callback)">fs.close(fd, callback)</h2><p>Asynchronous close(2).  No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-closeSync(fd)">fs.closeSync(fd)</h2><p>Synchronous close(2). Returns <code>undefined</code>.</p>
<h2 id="fs-open(path,_flags[,_mode],_callback)">fs.open(path, flags[, mode], callback)</h2><p>Asynchronous file open. See open(2). <code>flags</code> can be:</p>
<ul>
<li><p><code>&#39;r&#39;</code> - Open file for reading.<br>An exception occurs if the file does not exist.</p>
</li>
<li><p><code>&#39;r+&#39;</code> - Open file for reading and writing.<br>An exception occurs if the file does not exist.</p>
</li>
<li><p><code>&#39;rs&#39;</code> - Open file for reading in synchronous mode. Instructs the operating<br>system to bypass the local file system cache.</p>
<p>This is primarily useful for opening files on NFS mounts as it allows you to<br>skip the potentially stale local cache. It has a very real impact on I/O<br>performance so don’t use this flag unless you need it.</p>
<p>Note that this doesn’t turn <code>fs.open()</code> into a synchronous blocking call.<br>If that’s what you want then you should be using <code>fs.openSync()</code></p>
</li>
<li><p><code>&#39;rs+&#39;</code> - Open file for reading and writing, telling the OS to open it<br>synchronously. See notes for <code>&#39;rs&#39;</code> about using this with caution.</p>
</li>
<li><p><code>&#39;w&#39;</code> - Open file for writing.<br>The file is created (if it does not exist) or truncated (if it exists).</p>
</li>
<li><p><code>&#39;wx&#39;</code> - Like <code>&#39;w&#39;</code> but fails if <code>path</code> exists.</p>
</li>
<li><p><code>&#39;w+&#39;</code> - Open file for reading and writing.<br>The file is created (if it does not exist) or truncated (if it exists).</p>
</li>
<li><p><code>&#39;wx+&#39;</code> - Like <code>&#39;w+&#39;</code> but fails if <code>path</code> exists.</p>
</li>
<li><p><code>&#39;a&#39;</code> - Open file for appending.<br>The file is created if it does not exist.</p>
</li>
<li><p><code>&#39;ax&#39;</code> - Like <code>&#39;a&#39;</code> but fails if <code>path</code> exists.</p>
</li>
<li><p><code>&#39;a+&#39;</code> - Open file for reading and appending.<br>The file is created if it does not exist.</p>
</li>
<li><p><code>&#39;ax+&#39;</code> - Like <code>&#39;a+&#39;</code> but fails if <code>path</code> exists.</p>
</li>
</ul>
<p><code>mode</code> sets the file mode (permission and sticky bits), but only if the file was<br>created. It defaults to <code>0666</code>, readable and writeable.</p>
<p>The callback gets two arguments <code>(err, fd)</code>.</p>
<p>The exclusive flag <code>&#39;x&#39;</code> (<code>O_EXCL</code> flag in open(2)) ensures that <code>path</code> is newly<br>created. On POSIX systems, <code>path</code> is considered to exist even if it is a symlink<br>to a non-existent file. The exclusive flag may or may not work with network file<br>systems.</p>
<p>On Linux, positional writes don’t work when the file is opened in append mode.<br>The kernel ignores the position argument and always appends the data to<br>the end of the file.</p>
<h2 id="fs-openSync(path,_flags[,_mode])">fs.openSync(path, flags[, mode])</h2><p>Synchronous version of <code>fs.open()</code>. Returns an integer representing the file<br>descriptor.</p>
<h2 id="fs-utimes(path,_atime,_mtime,_callback)">fs.utimes(path, atime, mtime, callback)</h2><p>Change file timestamps of the file referenced by the supplied path.</p>
<h2 id="fs-utimesSync(path,_atime,_mtime)">fs.utimesSync(path, atime, mtime)</h2><p>Synchronous version of <code>fs.utimes()</code>. Returns <code>undefined</code>.</p>
<h2 id="fs-futimes(fd,_atime,_mtime,_callback)">fs.futimes(fd, atime, mtime, callback)</h2><p>Change the file timestamps of a file referenced by the supplied file<br>descriptor.</p>
<h2 id="fs-futimesSync(fd,_atime,_mtime)">fs.futimesSync(fd, atime, mtime)</h2><p>Synchronous version of <code>fs.futimes()</code>. Returns <code>undefined</code>.</p>
<h2 id="fs-fsync(fd,_callback)">fs.fsync(fd, callback)</h2><p>Asynchronous fsync(2). No arguments other than a possible exception are given<br>to the completion callback.</p>
<h2 id="fs-fsyncSync(fd)">fs.fsyncSync(fd)</h2><p>Synchronous fsync(2). Returns <code>undefined</code>.</p>
<h2 id="fs-write(fd,_buffer,_offset,_length[,_position],_callback)">fs.write(fd, buffer, offset, length[, position], callback)</h2><p>Write <code>buffer</code> to the file specified by <code>fd</code>.</p>
<p><code>offset</code> and <code>length</code> determine the part of the buffer to be written.</p>
<p><code>position</code> refers to the offset from the beginning of the file where this data<br>should be written. If <code>typeof position !== &#39;number&#39;</code>, the data will be written<br>at the current position. See pwrite(2).</p>
<p>The callback will be given three arguments <code>(err, written, buffer)</code> where<br><code>written</code> specifies how many <em>bytes</em> were written from <code>buffer</code>.</p>
<p>Note that it is unsafe to use <code>fs.write</code> multiple times on the same file<br>without waiting for the callback. For this scenario,<br><code>fs.createWriteStream</code> is strongly recommended.</p>
<p>On Linux, positional writes don’t work when the file is opened in append mode.<br>The kernel ignores the position argument and always appends the data to<br>the end of the file.</p>
<h2 id="fs-write(fd,_data[,_position[,_encoding]],_callback)">fs.write(fd, data[, position[, encoding]], callback)</h2><p>Write <code>data</code> to the file specified by <code>fd</code>.  If <code>data</code> is not a Buffer instance<br>then the value will be coerced to a string.</p>
<p><code>position</code> refers to the offset from the beginning of the file where this data<br>should be written. If <code>typeof position !== &#39;number&#39;</code> the data will be written at<br>the current position. See pwrite(2).</p>
<p><code>encoding</code> is the expected string encoding.</p>
<p>The callback will receive the arguments <code>(err, written, string)</code> where <code>written</code><br>specifies how many <em>bytes</em> the passed string required to be written. Note that<br>bytes written is not the same as string characters. See<br><a href="buffer.html#buffer_class_method_buffer_bytelength_string_encoding">Buffer.byteLength</a>.</p>
<p>Unlike when writing <code>buffer</code>, the entire string must be written. No substring<br>may be specified. This is because the byte offset of the resulting data may not<br>be the same as the string offset.</p>
<p>Note that it is unsafe to use <code>fs.write</code> multiple times on the same file<br>without waiting for the callback. For this scenario,<br><code>fs.createWriteStream</code> is strongly recommended.</p>
<p>On Linux, positional writes don’t work when the file is opened in append mode.<br>The kernel ignores the position argument and always appends the data to<br>the end of the file.</p>
<h2 id="fs-writeSync(fd,_buffer,_offset,_length[,_position])">fs.writeSync(fd, buffer, offset, length[, position])</h2><h2 id="fs-writeSync(fd,_data[,_position[,_encoding]])">fs.writeSync(fd, data[, position[, encoding]])</h2><p>Synchronous versions of <code>fs.write()</code>. Returns the number of bytes written.</p>
<h2 id="fs-read(fd,_buffer,_offset,_length,_position,_callback)">fs.read(fd, buffer, offset, length, position, callback)</h2><p>Read data from the file specified by <code>fd</code>.</p>
<p><code>buffer</code> is the buffer that the data will be written to.</p>
<p><code>offset</code> is the offset in the buffer to start writing at.</p>
<p><code>length</code> is an integer specifying the number of bytes to read.</p>
<p><code>position</code> is an integer specifying where to begin reading from in the file.<br>If <code>position</code> is <code>null</code>, data will be read from the current file position.</p>
<p>The callback is given the three arguments, <code>(err, bytesRead, buffer)</code>.</p>
<h2 id="fs-readSync(fd,_buffer,_offset,_length,_position)">fs.readSync(fd, buffer, offset, length, position)</h2><p>Synchronous version of <code>fs.read</code>. Returns the number of <code>bytesRead</code>.</p>
<h2 id="fs-readFile(filename[,_options],_callback)">fs.readFile(filename[, options], callback)</h2><ul>
<li><code>filename</code> {String}</li>
<li><code>options</code> {Object}<ul>
<li><code>encoding</code> {String | Null} default = <code>null</code></li>
<li><code>flag</code> {String} default = <code>&#39;r&#39;</code></li>
</ul>
</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Asynchronously reads the entire contents of a file. Example:</p>
<pre><code>fs.readFile(<span class="string">'/etc/passwd'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(data);
});
</code></pre><p>The callback is passed two arguments <code>(err, data)</code>, where <code>data</code> is the<br>contents of the file.</p>
<p>If no encoding is specified, then the raw buffer is returned.</p>
<h2 id="fs-readFileSync(filename[,_options])">fs.readFileSync(filename[, options])</h2><p>Synchronous version of <code>fs.readFile</code>. Returns the contents of the <code>filename</code>.</p>
<p>If the <code>encoding</code> option is specified then this function returns a<br>string. Otherwise it returns a buffer.</p>
<h2 id="fs-writeFile(filename,_data[,_options],_callback)">fs.writeFile(filename, data[, options], callback)</h2><ul>
<li><code>filename</code> {String}</li>
<li><code>data</code> {String | Buffer}</li>
<li><code>options</code> {Object}<ul>
<li><code>encoding</code> {String | Null} default = <code>&#39;utf8&#39;</code></li>
<li><code>mode</code> {Number} default = <code>438</code> (aka <code>0666</code> in Octal)</li>
<li><code>flag</code> {String} default = <code>&#39;w&#39;</code></li>
</ul>
</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Asynchronously writes data to a file, replacing the file if it already exists.<br><code>data</code> can be a string or a buffer.</p>
<p>The <code>encoding</code> option is ignored if <code>data</code> is a buffer. It defaults<br>to <code>&#39;utf8&#39;</code>.</p>
<p>Example:</p>
<pre><code>fs.writeFile(<span class="string">'message.txt'</span>, <span class="string">'Hello Node'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(<span class="string">'It\'s saved!'</span>);
});
</code></pre><h2 id="fs-writeFileSync(filename,_data[,_options])">fs.writeFileSync(filename, data[, options])</h2><p>The synchronous version of <code>fs.writeFile</code>. Returns <code>undefined</code>.</p>
<h2 id="fs-appendFile(filename,_data[,_options],_callback)">fs.appendFile(filename, data[, options], callback)</h2><ul>
<li><code>filename</code> {String}</li>
<li><code>data</code> {String | Buffer}</li>
<li><code>options</code> {Object}<ul>
<li><code>encoding</code> {String | Null} default = <code>&#39;utf8&#39;</code></li>
<li><code>mode</code> {Number} default = <code>438</code> (aka <code>0666</code> in Octal)</li>
<li><code>flag</code> {String} default = <code>&#39;a&#39;</code></li>
</ul>
</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Asynchronously append data to a file, creating the file if it not yet exists.<br><code>data</code> can be a string or a buffer.</p>
<p>Example:</p>
<pre><code>fs.appendFile(<span class="string">'message.txt'</span>, <span class="string">'data to append'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;
  <span class="built_in">console</span>.log(<span class="string">'The "data to append" was appended to file!'</span>);
});
</code></pre><h2 id="fs-appendFileSync(filename,_data[,_options])">fs.appendFileSync(filename, data[, options])</h2><p>The synchronous version of <code>fs.appendFile</code>. Returns <code>undefined</code>.</p>
<h2 id="fs-watchFile(filename[,_options],_listener)">fs.watchFile(filename[, options], listener)</h2><pre><code>Stability: <span class="number">2</span> - Unstable.  Use fs<span class="class">.watch</span> instead, <span class="keyword">if</span> possible.
</code></pre><p>Watch for changes on <code>filename</code>. The callback <code>listener</code> will be called each<br>time the file is accessed.</p>
<p>The second argument is optional. The <code>options</code> if provided should be an object<br>containing two members a boolean, <code>persistent</code>, and <code>interval</code>. <code>persistent</code><br>indicates whether the process should continue to run as long as files are<br>being watched. <code>interval</code> indicates how often the target should be polled,<br>in milliseconds. The default is <code>{ persistent: true, interval: 5007 }</code>.</p>
<p>The <code>listener</code> gets two arguments the current stat object and the previous<br>stat object:</p>
<pre><code>fs.watchFile(<span class="string">'message.text'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">curr, prev</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'the current mtime is: '</span> + curr.mtime);
  <span class="built_in">console</span>.log(<span class="string">'the previous mtime was: '</span> + prev.mtime);
});
</code></pre><p>These stat objects are instances of <code>fs.Stat</code>.</p>
<p>If you want to be notified when the file was modified, not just accessed<br>you need to compare <code>curr.mtime</code> and <code>prev.mtime</code>.</p>
<h2 id="fs-unwatchFile(filename[,_listener])">fs.unwatchFile(filename[, listener])</h2><pre><code>Stability: <span class="number">2</span> - Unstable.  Use fs<span class="class">.watch</span> instead, <span class="keyword">if</span> possible.
</code></pre><p>Stop watching for changes on <code>filename</code>. If <code>listener</code> is specified, only that<br>particular listener is removed. Otherwise, <em>all</em> listeners are removed and you<br>have effectively stopped watching <code>filename</code>.</p>
<p>Calling <code>fs.unwatchFile()</code> with a filename that is not being watched is a<br>no-op, not an error.</p>
<h2 id="fs-watch(filename[,_options][,_listener])">fs.watch(filename[, options][, listener])</h2><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable.</span>
</code></pre><p>Watch for changes on <code>filename</code>, where <code>filename</code> is either a file or a<br>directory.  The returned object is a <a href="#fs_class_fs_fswatcher">fs.FSWatcher</a>.</p>
<p>The second argument is optional. The <code>options</code> if provided should be an object.<br>The supported boolean members are <code>persistent</code> and <code>recursive</code>. <code>persistent</code><br>indicates whether the process should continue to run as long as files are being<br>watched. <code>recursive</code> indicates whether all subdirectories should be watched, or<br>only the current directory. This applies when a directory is specified, and only<br>on supported platforms (See Caveats below).</p>
<p>The default is <code>{ persistent: true, recursive: false }</code>.</p>
<p>The listener callback gets two arguments <code>(event, filename)</code>.  <code>event</code> is either<br>‘rename’ or ‘change’, and <code>filename</code> is the name of the file which triggered<br>the event.</p>
<h3 id="Caveats">Caveats</h3><!--type=misc-->
<p>The <code>fs.watch</code> API is not 100% consistent across platforms, and is<br>unavailable in some situations.</p>
<p>The recursive option is currently supported on OS X. Only FSEvents supports this<br>type of file watching so it is unlikely any additional platforms will be added<br>soon.</p>
<h4 id="Availability">Availability</h4><!--type=misc-->
<p>This feature depends on the underlying operating system providing a way<br>to be notified of filesystem changes.</p>
<ul>
<li>On Linux systems, this uses <code>inotify</code>.</li>
<li>On BSD systems, this uses <code>kqueue</code>.</li>
<li>On OS X, this uses <code>kqueue</code> for files and ‘FSEvents’ for directories.</li>
<li>On SunOS systems (including Solaris and SmartOS), this uses <code>event ports</code>.</li>
<li>On Windows systems, this feature depends on <code>ReadDirectoryChangesW</code>.</li>
</ul>
<p>If the underlying functionality is not available for some reason, then<br><code>fs.watch</code> will not be able to function.  For example, watching files or<br>directories on network file systems (NFS, SMB, etc.) often doesn’t work<br>reliably or at all.</p>
<p>You can still use <code>fs.watchFile</code>, which uses stat polling, but it is slower and<br>less reliable.</p>
<h4 id="Filename_Argument">Filename Argument</h4><!--type=misc-->
<p>Providing <code>filename</code> argument in the callback is not supported<br>on every platform (currently it’s only supported on Linux and Windows).  Even<br>on supported platforms <code>filename</code> is not always guaranteed to be provided.<br>Therefore, don’t assume that <code>filename</code> argument is always provided in the<br>callback, and have some fallback logic if it is null.</p>
<pre><code>fs.watch(<span class="string">'somedir'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event, filename</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'event is: '</span> + event);
  <span class="keyword">if</span> (filename) {
    <span class="built_in">console</span>.log(<span class="string">'filename provided: '</span> + filename);
  } <span class="keyword">else</span> {
    <span class="built_in">console</span>.log(<span class="string">'filename not provided'</span>);
  }
});
</code></pre><h2 id="fs-exists(path,_callback)">fs.exists(path, callback)</h2><p>Test whether or not the given path exists by checking with the file system.<br>Then call the <code>callback</code> argument with either true or false.  Example:</p>
<pre><code><span class="transposed_variable">fs.</span><span class="built_in">exists</span>(<span class="string">'/etc/passwd'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(exists)</span> {</span>
  <span class="transposed_variable">util.</span>debug(<span class="built_in">exists</span> ? <span class="string">"it'</span>s there<span class="string">" : "</span>no passwd!<span class="string">");
});</span>
</code></pre><p><code>fs.exists()</code> is an anachronism and exists only for historical reasons.<br>There should almost never be a reason to use it in your own code.</p>
<p>In particular, checking if a file exists before opening it is an anti-pattern<br>that leaves you vulnerable to race conditions: another process may remove the<br>file between the calls to <code>fs.exists()</code> and <code>fs.open()</code>.  Just open the file<br>and handle the error when it’s not there.</p>
<p><code>fs.exists()</code> will be deprecated.</p>
<h2 id="fs-existsSync(path)">fs.existsSync(path)</h2><p>Synchronous version of <code>fs.exists()</code>. Returns <code>true</code> if the file exists,<br><code>false</code> otherwise.</p>
<p><code>fs.existsSync()</code> will be deprecated.</p>
<h2 id="fs-access(path[,_mode],_callback)">fs.access(path[, mode], callback)</h2><p>Tests a user’s permissions for the file specified by <code>path</code>. <code>mode</code> is an<br>optional integer that specifies the accessibility checks to be performed. The<br>following constants define the possible values of <code>mode</code>. It is possible to<br>create a mask consisting of the bitwise OR of two or more values.</p>
<ul>
<li><code>fs.F_OK</code> - File is visible to the calling process. This is useful for<br>determining if a file exists, but says nothing about <code>rwx</code> permissions.<br>Default if no <code>mode</code> is specified.</li>
<li><code>fs.R_OK</code> - File can be read by the calling process.</li>
<li><code>fs.W_OK</code> - File can be written by the calling process.</li>
<li><code>fs.X_OK</code> - File can be executed by the calling process. This has no effect<br>on Windows (will behave like <code>fs.F_OK</code>).</li>
</ul>
<p>The final argument, <code>callback</code>, is a callback function that is invoked with<br>a possible error argument. If any of the accessibility checks fail, the error<br>argument will be populated. The following example checks if the file<br><code>/etc/passwd</code> can be read and written by the current process.</p>
<pre><code>fs.access(<span class="string">'/etc/passwd'</span>, fs.R_OK | fs.W_OK, <span class="function"><span class="keyword">function</span><span class="params">(err)</span></span> {
  util.<span class="built_in">debug</span>(err ? <span class="string">'no access!'</span> : <span class="string">'can read/write'</span>);
});
</code></pre><h2 id="fs-accessSync(path[,_mode])">fs.accessSync(path[, mode])</h2><p>Synchronous version of <code>fs.access</code>. This throws if any accessibility checks<br>fail, and does nothing otherwise.</p>
<h2 id="Class:_fs-Stats">Class: fs.Stats</h2><p>Objects returned from <code>fs.stat()</code>, <code>fs.lstat()</code> and <code>fs.fstat()</code> and their<br>synchronous counterparts are of this type.</p>
<ul>
<li><code>stats.isFile()</code></li>
<li><code>stats.isDirectory()</code></li>
<li><code>stats.isBlockDevice()</code></li>
<li><code>stats.isCharacterDevice()</code></li>
<li><code>stats.isSymbolicLink()</code> (only valid with  <code>fs.lstat()</code>)</li>
<li><code>stats.isFIFO()</code></li>
<li><code>stats.isSocket()</code></li>
</ul>
<p>For a regular file <code>util.inspect(stats)</code> would return a string very<br>similar to this:</p>
<pre><code>{ <span class="attribute">dev</span>: <span class="number">2114</span>,
  <span class="attribute">ino</span>: <span class="number">48064969</span>,
  <span class="attribute">mode</span>: <span class="number">33188</span>,
  <span class="attribute">nlink</span>: <span class="number">1</span>,
  <span class="attribute">uid</span>: <span class="number">85</span>,
  <span class="attribute">gid</span>: <span class="number">100</span>,
  <span class="attribute">rdev</span>: <span class="number">0</span>,
  <span class="attribute">size</span>: <span class="number">527</span>,
  <span class="attribute">blksize</span>: <span class="number">4096</span>,
  <span class="attribute">blocks</span>: <span class="number">8</span>,
  <span class="attribute">atime</span>: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT,
  <span class="attribute">mtime</span>: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT,
  <span class="attribute">ctime</span>: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT,
  <span class="attribute">birthtime</span>: Mon, <span class="number">10</span> Oct <span class="number">2011</span> <span class="number">23</span>:<span class="number">24</span>:<span class="number">11</span> GMT }
</code></pre><p>Please note that <code>atime</code>, <code>mtime</code>, <code>birthtime</code>, and <code>ctime</code> are<br>instances of <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="external">Date</a> object and to compare the values of<br>these objects you should use appropriate methods. For most general<br>uses <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/getTime" target="_blank" rel="external">getTime()</a> will return the number of<br>milliseconds elapsed since <em>1 January 1970 00:00:00 UTC</em> and this<br>integer should be sufficient for any comparison, however there are<br>additional methods which can be used for displaying fuzzy information.<br>More details can be found in the <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="external">MDN JavaScript Reference</a><br>page.</p>
<h3 id="Stat_Time_Values">Stat Time Values</h3><p>The times in the stat object have the following semantics:</p>
<ul>
<li><code>atime</code> “Access Time” - Time when file data last accessed.  Changed<br>by the <code>mknod(2)</code>, <code>utimes(2)</code>, and <code>read(2)</code> system calls.</li>
<li><code>mtime</code> “Modified Time” - Time when file data last modified.<br>Changed by the <code>mknod(2)</code>, <code>utimes(2)</code>, and <code>write(2)</code> system calls.</li>
<li><code>ctime</code> “Change Time” - Time when file status was last changed<br>(inode data modification).  Changed by the <code>chmod(2)</code>, <code>chown(2)</code>,<br><code>link(2)</code>, <code>mknod(2)</code>, <code>rename(2)</code>, <code>unlink(2)</code>, <code>utimes(2)</code>,<br><code>read(2)</code>, and <code>write(2)</code> system calls.</li>
<li><code>birthtime</code> “Birth Time” -  Time of file creation. Set once when the<br>file is created.  On filesystems where birthtime is not available,<br>this field may instead hold either the <code>ctime</code> or<br><code>1970-01-01T00:00Z</code> (ie, unix epoch timestamp <code>0</code>).  On Darwin and<br>other FreeBSD variants, also set if the <code>atime</code> is explicitly set to<br>an earlier value than the current <code>birthtime</code> using the <code>utimes(2)</code><br>system call.</li>
</ul>
<p>Prior to Node v0.12, the <code>ctime</code> held the <code>birthtime</code> on Windows<br>systems.  Note that as of v0.12, <code>ctime</code> is not “creation time”, and<br>on Unix systems, it never was.</p>
<h2 id="fs-createReadStream(path[,_options])">fs.createReadStream(path[, options])</h2><p>Returns a new ReadStream object (See <code>Readable Stream</code>).</p>
<p><code>options</code> is an object with the following defaults:</p>
<pre><code>{ <span class="attribute">flags</span>: <span class="string">'r'</span>,
  <span class="attribute">encoding</span>: null,
  <span class="attribute">fd</span>: null,
  <span class="attribute">mode</span>: <span class="number">0666</span>,
  <span class="attribute">autoClose</span>: true
}
</code></pre><p><code>options</code> can include <code>start</code> and <code>end</code> values to read a range of bytes from<br>the file instead of the entire file.  Both <code>start</code> and <code>end</code> are inclusive and<br>start at 0. The <code>encoding</code> can be <code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code>, or <code>&#39;base64&#39;</code>.</p>
<p>If <code>fd</code> is specified, <code>ReadStream</code> will ignore the <code>path</code> argument and will use<br>the specified file descriptor. This means that no <code>open</code> event will be emitted.</p>
<p>If <code>autoClose</code> is false, then the file descriptor won’t be closed, even if<br>there’s an error.  It is your responsibility to close it and make sure<br>there’s no file descriptor leak.  If <code>autoClose</code> is set to true (default<br>behavior), on <code>error</code> or <code>end</code> the file descriptor will be closed<br>automatically.</p>
<p>An example to read the last 10 bytes of a file which is 100 bytes long:</p>
<pre><code><span class="tag">fs</span><span class="class">.createReadStream</span>(<span class="string">'sample.txt'</span>, {<span class="attribute">start</span>: <span class="number">90</span>, <span class="attribute">end</span>: <span class="number">99</span>});
</code></pre><h2 id="Class:_fs-ReadStream">Class: fs.ReadStream</h2><p><code>ReadStream</code> is a <a href="stream.html#stream_class_stream_readable">Readable Stream</a>.</p>
<h3 id="Event:_‘open’">Event: ‘open’</h3><ul>
<li><code>fd</code> {Integer} file descriptor used by the ReadStream.</li>
</ul>
<p>Emitted when the ReadStream’s file is opened.</p>
<h2 id="fs-createWriteStream(path[,_options])">fs.createWriteStream(path[, options])</h2><p>Returns a new WriteStream object (See <code>Writable Stream</code>).</p>
<p><code>options</code> is an object with the following defaults:</p>
<pre><code>{ <span class="attribute">flags</span>: <span class="string">'w'</span>,
  <span class="attribute">encoding</span>: null,
  <span class="attribute">fd</span>: null,
  <span class="attribute">mode</span>: <span class="number">0666</span> }
</code></pre><p><code>options</code> may also include a <code>start</code> option to allow writing data at<br>some position past the beginning of the file.  Modifying a file rather<br>than replacing it may require a <code>flags</code> mode of <code>r+</code> rather than the<br>default mode <code>w</code>.</p>
<p>Like <code>ReadStream</code> above, if <code>fd</code> is specified, <code>WriteStream</code> will ignore the<br><code>path</code> argument and will use the specified file descriptor. This means that no<br><code>open</code> event will be emitted.</p>
<h2 id="Class:_fs-WriteStream">Class: fs.WriteStream</h2><p><code>WriteStream</code> is a <a href="stream.html#stream_class_stream_writable">Writable Stream</a>.</p>
<h3 id="Event:_‘open’-1">Event: ‘open’</h3><ul>
<li><code>fd</code> {Integer} file descriptor used by the WriteStream.</li>
</ul>
<p>Emitted when the WriteStream’s file is opened.</p>
<h3 id="file-bytesWritten">file.bytesWritten</h3><p>The number of bytes written so far. Does not include data that is still queued<br>for writing.</p>
<h2 id="Class:_fs-FSWatcher">Class: fs.FSWatcher</h2><p>Objects returned from <code>fs.watch()</code> are of this type.</p>
<h3 id="watcher-close()">watcher.close()</h3><p>Stop watching for changes on the given <code>fs.FSWatcher</code>.</p>
<h3 id="Event:_‘change’">Event: ‘change’</h3><ul>
<li><code>event</code> {String} The type of fs change</li>
<li><code>filename</code> {String} The filename that changed (if relevant/available)</li>
</ul>
<p>Emitted when something changes in a watched directory or file.<br>See more details in <a href="#fs_fs_watch_filename_options_listener">fs.watch</a>.</p>
<h3 id="Event:_‘error’-2">Event: ‘error’</h3><ul>
<li><code>error</code> {Error object}</li>
</ul>
<p>Emitted when an error occurs.</p>
<h1 id="Path"><a id="path">Path</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>This module contains utilities for handling and transforming file<br>paths.  Almost all these methods perform only string transformations.<br>The file system is not consulted to check whether paths are valid.</p>
<p>Use <code>require(&#39;path&#39;)</code> to use this module.  The following methods are provided:</p>
<h2 id="path-normalize(p)">path.normalize(p)</h2><p>Normalize a string path, taking care of <code>&#39;..&#39;</code> and <code>&#39;.&#39;</code> parts.</p>
<p>When multiple slashes are found, they’re replaced by a single one;<br>when the path contains a trailing slash, it is preserved.<br>On Windows backslashes are used.</p>
<p>Example:</p>
<pre><code>path.<span class="function"><span class="title">normalize</span><span class="params">(<span class="string">'/foo/bar//baz/asdf/quux/..'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'/foo/bar/baz/asdf'</span>
</code></pre><h2 id="path-join([path1][,_path2][,_…])">path.join([path1][, path2][, …])</h2><p>Join all arguments together and normalize the resulting path.</p>
<p>Arguments must be strings.  In v0.8, non-string arguments were<br>silently ignored.  In v0.10 and up, an exception is thrown.</p>
<p>Example:</p>
<pre><code>path.<span class="function"><span class="title">join</span><span class="params">(<span class="string">'/foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz/asdf'</span>, <span class="string">'quux'</span>, <span class="string">'..'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'/foo/bar/baz/asdf'</span>

path.<span class="function"><span class="title">join</span><span class="params">(<span class="string">'foo'</span>, {}, <span class="string">'bar'</span>)</span></span>
<span class="comment">// throws exception</span>
TypeError: Arguments to path<span class="class">.join</span> must be strings
</code></pre><h2 id="path-resolve([from_…],_to)">path.resolve([from …], to)</h2><p>Resolves <code>to</code> to an absolute path.</p>
<p>If <code>to</code> isn’t already absolute <code>from</code> arguments are prepended in right to left<br>order, until an absolute path is found. If after using all <code>from</code> paths still<br>no absolute path is found, the current working directory is used as well. The<br>resulting path is normalized, and trailing slashes are removed unless the path<br>gets resolved to the root directory. Non-string <code>from</code> arguments are ignored.</p>
<p>Another way to think of it is as a sequence of <code>cd</code> commands in a shell.</p>
<pre><code>path.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'foo/bar'</span>, <span class="string">'/tmp/file/'</span>, <span class="string">'..'</span>, <span class="string">'a/../subfile'</span>)</span></span>
</code></pre><p>Is similar to:</p>
<pre><code><span class="keyword">cd</span> foo/bar
<span class="keyword">cd</span> /tmp/<span class="keyword">file</span>/
<span class="keyword">cd</span> ..
<span class="keyword">cd</span> a/../subfile
<span class="keyword">pwd</span>
</code></pre><p>The difference is that the different paths don’t need to exist and may also be<br>files.</p>
<p>Examples:</p>
<pre><code>path.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'/foo/bar'</span>, <span class="string">'./baz'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'/foo/bar/baz'</span>

path.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'/foo/bar'</span>, <span class="string">'/tmp/file/'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'/tmp/file'</span>

path.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'wwwroot'</span>, <span class="string">'static_files/png/'</span>, <span class="string">'../gif/image.gif'</span>)</span></span>
<span class="comment">// if currently in /home/myself/node, it returns</span>
<span class="string">'/home/myself/node/wwwroot/static_files/gif/image.gif'</span>
</code></pre><h2 id="path-isAbsolute(path)">path.isAbsolute(path)</h2><p>Determines whether <code>path</code> is an absolute path. An absolute path will always<br>resolve to the same location, regardless of the working directory.</p>
<p>Posix examples:</p>
<pre><code>path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'/foo/bar'</span>)</span></span> <span class="comment">// true</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'/baz/..'</span>)</span></span>  <span class="comment">// true</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'qux/'</span>)</span></span>     <span class="comment">// false</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'.'</span>)</span></span>        <span class="comment">// false</span>
</code></pre><p>Windows examples:</p>
<pre><code>path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'//server'</span>)</span></span>  <span class="comment">// true</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'C:/foo/..'</span>)</span></span> <span class="comment">// true</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'bar\\baz'</span>)</span></span>   <span class="comment">// false</span>
path.<span class="function"><span class="title">isAbsolute</span><span class="params">(<span class="string">'.'</span>)</span></span>         <span class="comment">// false</span>
</code></pre><h2 id="path-relative(from,_to)">path.relative(from, to)</h2><p>Solve the relative path from <code>from</code> to <code>to</code>.</p>
<p>At times we have two absolute paths, and we need to derive the relative<br>path from one to the other.  This is actually the reverse transform of<br><code>path.resolve</code>, which means we see that:</p>
<pre><code>path.<span class="built_in">resolve</span>(<span class="built_in">from</span>, path.<span class="built_in">relative</span>(<span class="built_in">from</span>, <span class="built_in">to</span>)) == path.<span class="built_in">resolve</span>(<span class="built_in">to</span>)
</code></pre><p>Examples:</p>
<pre><code>path.<span class="function"><span class="title">relative</span><span class="params">(<span class="string">'C:\\orandea\\test\\aaa'</span>, <span class="string">'C:\\orandea\\impl\\bbb'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'..\\..\\impl\\bbb'</span>

path.<span class="function"><span class="title">relative</span><span class="params">(<span class="string">'/data/orandea/test/aaa'</span>, <span class="string">'/data/orandea/impl/bbb'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'../../impl/bbb'</span>
</code></pre><h2 id="path-dirname(p)">path.dirname(p)</h2><p>Return the directory name of a path.  Similar to the Unix <code>dirname</code> command.</p>
<p>Example:</p>
<pre><code>path.<span class="function"><span class="title">dirname</span><span class="params">(<span class="string">'/foo/bar/baz/asdf/quux'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'/foo/bar/baz/asdf'</span>
</code></pre><h2 id="path-basename(p[,_ext])">path.basename(p[, ext])</h2><p>Return the last portion of a path.  Similar to the Unix <code>basename</code> command.</p>
<p>Example:</p>
<pre><code>path.<span class="function"><span class="title">basename</span><span class="params">(<span class="string">'/foo/bar/baz/asdf/quux.html'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'quux.html'</span>

path.<span class="function"><span class="title">basename</span><span class="params">(<span class="string">'/foo/bar/baz/asdf/quux.html'</span>, <span class="string">'.html'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'quux'</span>
</code></pre><h2 id="path-extname(p)">path.extname(p)</h2><p>Return the extension of the path, from the last ‘.’ to end of string<br>in the last portion of the path.  If there is no ‘.’ in the last portion<br>of the path or the first character of it is ‘.’, then it returns<br>an empty string.  Examples:</p>
<pre><code>path.<span class="function"><span class="title">extname</span><span class="params">(<span class="string">'index.html'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'.html'</span>

path.<span class="function"><span class="title">extname</span><span class="params">(<span class="string">'index.coffee.md'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'.md'</span>

path.<span class="function"><span class="title">extname</span><span class="params">(<span class="string">'index.'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">'.'</span>

path.<span class="function"><span class="title">extname</span><span class="params">(<span class="string">'index'</span>)</span></span>
<span class="comment">// returns</span>
<span class="string">''</span>
</code></pre><h2 id="path-sep">path.sep</h2><p>The platform-specific file separator. <code>&#39;\\&#39;</code> or <code>&#39;/&#39;</code>.</p>
<p>An example on *nix:</p>
<pre><code><span class="string">'foo/bar/baz'</span>.<span class="function"><span class="title">split</span><span class="params">(path.sep)</span></span>
<span class="comment">// returns</span>
[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]
</code></pre><p>An example on Windows:</p>
<pre><code><span class="string">'foo\\bar\\baz'</span>.<span class="function"><span class="title">split</span><span class="params">(path.sep)</span></span>
<span class="comment">// returns</span>
[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]
</code></pre><h2 id="path-delimiter">path.delimiter</h2><p>The platform-specific path delimiter, <code>;</code> or <code>&#39;:&#39;</code>.</p>
<p>An example on *nix:</p>
<pre><code>console.log(process.env.<span class="constant">PATH)</span>
/<span class="regexp">/ '/usr</span><span class="regexp">/bin:/bin</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/sbin</span><span class="symbol">:/usr/local/bin<span class="string">'

process.env.PATH.split(path.delimiter)
// returns
['</span>/usr/bin<span class="string">', '</span>/bin<span class="string">', '</span>/usr/sbin<span class="string">', '</span>/sbin<span class="string">', '</span>/usr/local/bin<span class="string">']</span></span>
</code></pre><p>An example on Windows:</p>
<pre><code>console.<span class="function"><span class="title">log</span><span class="params">(process.env.PATH)</span></span>
<span class="comment">// 'C:\Windows\system32;C:\Windows;C:\Program Files\nodejs\'</span>

process<span class="class">.env</span><span class="class">.PATH</span><span class="class">.split</span>(path.delimiter)
<span class="comment">// returns</span>
[<span class="string">'C:\\Windows\\system32'</span>, <span class="string">'C:\\Windows'</span>, <span class="string">'C:\\Program Files\\nodejs\\'</span>]
</code></pre><h2 id="path-parse(pathString)">path.parse(pathString)</h2><p>Returns an object from a path string.</p>
<p>An example on *nix:</p>
<pre><code><span class="tag">path</span><span class="class">.parse</span>(<span class="string">'/home/user/dir/file.txt'</span>)
<span class="comment">// returns</span>
{
    <span class="attribute">root </span>: <span class="string">"/"</span>,
    <span class="attribute">dir </span>: <span class="string">"/home/user/dir"</span>,
    <span class="attribute">base </span>: <span class="string">"file.txt"</span>,
    <span class="attribute">ext </span>: <span class="string">".txt"</span>,
    <span class="attribute">name </span>: <span class="string">"file"</span>
}
</code></pre><p>An example on Windows:</p>
<pre><code><span class="tag">path</span><span class="class">.parse</span>(<span class="string">'C:\\path\\dir\\index.html'</span>)
<span class="comment">// returns</span>
{
    <span class="attribute">root </span>: <span class="string">"C:\\"</span>,
    <span class="attribute">dir </span>: <span class="string">"C:\\path\\dir"</span>,
    <span class="attribute">base </span>: <span class="string">"index.html"</span>,
    <span class="attribute">ext </span>: <span class="string">".html"</span>,
    <span class="attribute">name </span>: <span class="string">"index"</span>
}
</code></pre><h2 id="path-format(pathObject)">path.format(pathObject)</h2><p>Returns a path string from an object, the opposite of <code>path.parse</code> above.</p>
<pre><code>path.format({
    <span class="string">root :</span> <span class="string">"/"</span>,
    <span class="string">dir :</span> <span class="string">"/home/user/dir"</span>,
    <span class="string">base :</span> <span class="string">"file.txt"</span>,
    <span class="string">ext :</span> <span class="string">".txt"</span>,
    <span class="string">name :</span> <span class="string">"file"</span>
})
<span class="comment">// returns</span>
<span class="string">'/home/user/dir/file.txt'</span>
</code></pre><h2 id="path-posix">path.posix</h2><p>Provide access to aforementioned <code>path</code> methods but always interact in a posix<br>compatible way.</p>
<h2 id="path-win32">path.win32</h2><p>Provide access to aforementioned <code>path</code> methods but always interact in a win32<br>compatible way.</p>
<h1 id="net"><a id="net">net</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>The <code>net</code> module provides you with an asynchronous network wrapper. It contains<br>methods for creating both servers and clients (called streams). You can include<br>this module with <code>require(&#39;net&#39;);</code></p>
<h2 id="net-createServer([options][,_connectionListener])">net.createServer([options][, connectionListener])</h2><p>Creates a new TCP server. The <code>connectionListener</code> argument is<br>automatically set as a listener for the <a href="#net_event_connection">‘connection’</a> event.</p>
<p><code>options</code> is an object with the following defaults:</p>
<pre><code><span class="collection">{
  allowHalfOpen: <span class="literal">false</span>,
  pauseOnConnect: <span class="literal">false</span>
}</span>
</code></pre><p>If <code>allowHalfOpen</code> is <code>true</code>, then the socket won’t automatically send a FIN<br>packet when the other end of the socket sends a FIN packet. The socket becomes<br>non-readable, but still writable. You should call the <code>end()</code> method explicitly.<br>See <a href="#net_event_end">‘end’</a> event for more information.</p>
<p>If <code>pauseOnConnect</code> is <code>true</code>, then the socket associated with each incoming<br>connection will be paused, and no data will be read from its handle. This allows<br>connections to be passed between processes without any data being read by the<br>original process. To begin reading data from a paused socket, call <code>resume()</code>.</p>
<p>Here is an example of an echo server which listens for connections<br>on port 8124:</p>
<pre><code><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);
<span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>{ <span class="comment">//'connection' listener</span>
  <span class="built_in">console</span>.log(<span class="string">'client connected'</span>);
  c.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'client disconnected'</span>);
  });
  c.write(<span class="string">'hello\r\n'</span>);
  c.pipe(c);
});
server.listen(<span class="number">8124</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{ <span class="comment">//'listening' listener</span>
  <span class="built_in">console</span>.log(<span class="string">'server bound'</span>);
});
</code></pre><p>Test this by using <code>telnet</code>:</p>
<pre><code><span class="title">telnet</span> localhost <span class="number">8124</span>
</code></pre><p>To listen on the socket <code>/tmp/echo.sock</code> the third line from the last would<br>just be changed to</p>
<pre><code>server.listen(<span class="string">'/tmp/echo.sock'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">//'listening' listener</span>
</code></pre><p>Use <code>nc</code> to connect to a UNIX domain socket server:</p>
<pre><code>nc -U /tmp/<span class="keyword">echo</span>.sock
</code></pre><h2 id="net-connect(options[,_connectionListener])">net.connect(options[, connectionListener])</h2><h2 id="net-createConnection(options[,_connectionListener])">net.createConnection(options[, connectionListener])</h2><p>A factory method, which returns a new <a href="#net_class_net_socket">‘net.Socket’</a><br>and connects to the supplied address and port.</p>
<p>When the socket is established, the <a href="#net_event_connect">‘connect’</a> event will be emitted.</p>
<p>Has the same events as <a href="#net_class_net_socket">‘net.Socket’</a>.</p>
<p>For TCP sockets, <code>options</code> argument should be an object which specifies:</p>
<ul>
<li><p><code>port</code>: Port the client should connect to (Required).</p>
</li>
<li><p><code>host</code>: Host the client should connect to. Defaults to <code>&#39;localhost&#39;</code>.</p>
</li>
<li><p><code>localAddress</code>: Local interface to bind to for network connections.</p>
</li>
<li><p><code>localPort</code>: Local port to bind to for network connections.</p>
</li>
<li><p><code>family</code> : Version of IP stack. Defaults to <code>4</code>.</p>
</li>
</ul>
<p>For local domain sockets, <code>options</code> argument should be an object which<br>specifies:</p>
<ul>
<li><code>path</code>: Path the client should connect to (Required).</li>
</ul>
<p>Common options are:</p>
<ul>
<li><code>allowHalfOpen</code>: if <code>true</code>, the socket won’t automatically send<br>a FIN packet when the other end of the socket sends a FIN packet.<br>Defaults to <code>false</code>.  See <a href="#net_event_end">‘end’</a> event for more information.</li>
</ul>
<p>The <code>connectListener</code> parameter will be added as an listener for the<br><a href="#net_event_connect">‘connect’</a> event.</p>
<p>Here is an example of a client of echo server as described previously:</p>
<pre><code><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);
<span class="keyword">var</span> client = net.connect({port: <span class="number">8124</span>},
    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{ <span class="comment">//'connect' listener</span>
  <span class="built_in">console</span>.log(<span class="string">'connected to server!'</span>);
  client.write(<span class="string">'world!\r\n'</span>);
});
client.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(data.toString());
  client.end();
});
client.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'disconnected from server'</span>);
});
</code></pre><p>To connect on the socket <code>/tmp/echo.sock</code> the second line would just be<br>changed to</p>
<pre><code>var client = <span class="winutils">net</span>.connect({<span class="built_in">path</span>: '/tmp/<span class="keyword">echo</span>.sock'});
</code></pre><h2 id="net-connect(port[,_host][,_connectListener])">net.connect(port[, host][, connectListener])</h2><h2 id="net-createConnection(port[,_host][,_connectListener])">net.createConnection(port[, host][, connectListener])</h2><p>Creates a TCP connection to <code>port</code> on <code>host</code>. If <code>host</code> is omitted,<br><code>&#39;localhost&#39;</code> will be assumed.<br>The <code>connectListener</code> parameter will be added as an listener for the<br><a href="#net_event_connect">‘connect’</a> event.</p>
<p>Is a factory method which returns a new <a href="#net_class_net_socket">‘net.Socket’</a>.</p>
<h2 id="net-connect(path[,_connectListener])">net.connect(path[, connectListener])</h2><h2 id="net-createConnection(path[,_connectListener])">net.createConnection(path[, connectListener])</h2><p>Creates unix socket connection to <code>path</code>.<br>The <code>connectListener</code> parameter will be added as an listener for the<br><a href="#net_event_connect">‘connect’</a> event.</p>
<p>A factory method which returns a new <a href="#net_class_net_socket">‘net.Socket’</a>.</p>
<h2 id="Class:_net-Server">Class: net.Server</h2><p>This class is used to create a TCP or local server.</p>
<h3 id="server-listen(port[,_host][,_backlog][,_callback])">server.listen(port[, host][, backlog][, callback])</h3><p>Begin accepting connections on the specified <code>port</code> and <code>host</code>.  If the<br><code>host</code> is omitted, the server will accept connections directed to any<br>IPv4 address (<code>INADDR_ANY</code>). A port value of zero will assign a random port.</p>
<p>Backlog is the maximum length of the queue of pending connections.<br>The actual length will be determined by your OS through sysctl settings such as<br><code>tcp_max_syn_backlog</code> and <code>somaxconn</code> on linux. The default value of this<br>parameter is 511 (not 512).</p>
<p>This function is asynchronous.  When the server has been bound,<br><a href="net.html#net_event_listening">‘listening’</a> event will be emitted.  The last parameter <code>callback</code><br>will be added as an listener for the <a href="net.html#net_event_listening">‘listening’</a> event.</p>
<p>One issue some users run into is getting <code>EADDRINUSE</code> errors. This means that<br>another server is already running on the requested port. One way of handling this<br>would be to wait a second and then try again. This can be done with</p>
<pre><code>server.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>{
  <span class="keyword">if</span> (e.code == <span class="string">'EADDRINUSE'</span>) {
    <span class="built_in">console</span>.log(<span class="string">'Address in use, retrying...'</span>);
    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
      server.close();
      server.listen(PORT, HOST);
    }, <span class="number">1000</span>);
  }
});
</code></pre><p>(Note: All sockets in Node set <code>SO_REUSEADDR</code> already)</p>
<h3 id="server-listen(path[,_callback])">server.listen(path[, callback])</h3><ul>
<li><code>path</code> {String}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Start a local socket server listening for connections on the given <code>path</code>.</p>
<p>This function is asynchronous.  When the server has been bound,<br><a href="net.html#net_event_listening">‘listening’</a> event will be emitted.  The last parameter <code>callback</code><br>will be added as an listener for the <a href="net.html#net_event_listening">‘listening’</a> event.</p>
<p>On UNIX, the local domain is usually known as the UNIX domain. The path is a<br>filesystem path name. It is subject to the same naming conventions and<br>permissions checks as would be done on file creation, will be visible in the<br>filesystem, and will <em>persist until unlinked</em>.</p>
<p>On Windows, the local domain is implemented using a named pipe. The path <em>must</em><br>refer to an entry in <code>\\?\pipe\</code> or <code>\\.\pipe\</code>. Any characters are permitted,<br>but the latter may do some processing of pipe names, such as resolving <code>..</code><br>sequences. Despite appearances, the pipe name space is flat.  Pipes will <em>not<br>persist</em>, they are removed when the last reference to them is closed. Do not<br>forget javascript string escaping requires paths to be specified with<br>double-backslashes, such as:</p>
<pre><code>net.<span class="function"><span class="title">createServer</span><span class="params">()</span></span>.listen(
    path.<span class="function"><span class="title">join</span><span class="params">(<span class="string">'\\\\?\\pipe'</span>, process.cwd()</span></span>, <span class="string">'myctl'</span>))
</code></pre><h3 id="server-listen(handle[,_callback])">server.listen(handle[, callback])</h3><ul>
<li><code>handle</code> {Object}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>The <code>handle</code> object can be set to either a server or socket (anything<br>with an underlying <code>_handle</code> member), or a <code>{fd: &lt;n&gt;}</code> object.</p>
<p>This will cause the server to accept connections on the specified<br>handle, but it is presumed that the file descriptor or handle has<br>already been bound to a port or domain socket.</p>
<p>Listening on a file descriptor is not supported on Windows.</p>
<p>This function is asynchronous.  When the server has been bound,<br><a href="net.html#net_event_listening">‘listening’</a> event will be emitted.<br>the last parameter <code>callback</code> will be added as an listener for the<br><a href="net.html#net_event_listening">‘listening’</a> event.</p>
<h3 id="server-listen(options[,_callback])">server.listen(options[, callback])</h3><ul>
<li><code>options</code> {Object} - Required. Supports the following properties:<ul>
<li><code>port</code> {Number} - Optional.</li>
<li><code>host</code> {String} - Optional.</li>
<li><code>backlog</code> {Number} - Optional.</li>
<li><code>path</code> {String} - Optional.</li>
<li><code>exclusive</code> {Boolean} - Optional.</li>
</ul>
</li>
<li><code>callback</code> {Function} - Optional.</li>
</ul>
<p>The <code>port</code>, <code>host</code>, and <code>backlog</code> properties of <code>options</code>, as well as the<br>optional callback function, behave as they do on a call to<br><a href="#net_server_listen_port_host_backlog_callback">server.listen(port, [host], [backlog], [callback])
</a>. Alternatively, the <code>path</code><br>option can be used to specify a UNIX socket.</p>
<p>If <code>exclusive</code> is <code>false</code> (default), then cluster workers will use the same<br>underlying handle, allowing connection handling duties to be shared. When<br><code>exclusive</code> is <code>true</code>, the handle is not shared, and attempted port sharing<br>results in an error. An example which listens on an exclusive port is<br>shown below.</p>
<pre><code><span class="tag">server</span><span class="class">.listen</span>({
  <span class="attribute">host</span>: <span class="string">'localhost'</span>,
  <span class="attribute">port</span>: <span class="number">80</span>,
  <span class="attribute">exclusive</span>: true
});
</code></pre><h3 id="server-close([callback])">server.close([callback])</h3><p>Stops the server from accepting new connections and keeps existing<br>connections. This function is asynchronous, the server is finally<br>closed when all connections are ended and the server emits a <code>&#39;close&#39;</code><br>event. Optionally, you can pass a callback to listen for the <code>&#39;close&#39;</code><br>event. If present, the callback is invoked with any potential error<br>as the first and only argument.</p>
<h3 id="server-address()-1">server.address()</h3><p>Returns the bound address, the address family name and port of the server<br>as reported by the operating system.<br>Useful to find which port was assigned when giving getting an OS-assigned address.<br>Returns an object with three properties, e.g.<br><code>{ port: 12346, family: &#39;IPv4&#39;, address: &#39;127.0.0.1&#39; }</code></p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>{
  socket.end(<span class="string">"goodbye\n"</span>);
});

<span class="comment">// grab a random port.</span>
server.listen(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  address = server.address();
  <span class="built_in">console</span>.log(<span class="string">"opened server on %j"</span>, address);
});
</code></pre><p>Don’t call <code>server.address()</code> until the <code>&#39;listening&#39;</code> event has been emitted.</p>
<h3 id="server-unref()">server.unref()</h3><p>Calling <code>unref</code> on a server will allow the program to exit if this is the only<br>active server in the event system. If the server is already <code>unref</code>d calling<br><code>unref</code> again will have no effect.</p>
<h3 id="server-ref()">server.ref()</h3><p>Opposite of <code>unref</code>, calling <code>ref</code> on a previously <code>unref</code>d server will <em>not</em><br>let the program exit if it’s the only server left (the default behavior). If<br>the server is <code>ref</code>d calling <code>ref</code> again will have no effect.</p>
<h3 id="server-maxConnections-1">server.maxConnections</h3><p>Set this property to reject connections when the server’s connection count gets<br>high.</p>
<p>It is not recommended to use this option once a socket has been sent to a child<br>with <code>child_process.fork()</code>.</p>
<h3 id="server-connections-1">server.connections</h3><p>This function is <strong>deprecated</strong>; please use <a href="#net_server_getconnections_callback">server.getConnections()</a> instead.<br>The number of concurrent connections on the server.</p>
<p>This becomes <code>null</code> when sending a socket to a child with<br><code>child_process.fork()</code>. To poll forks and get current number of active<br>connections use asynchronous <code>server.getConnections</code> instead.</p>
<h3 id="server-getConnections(callback)">server.getConnections(callback)</h3><p>Asynchronously get the number of concurrent connections on the server. Works<br>when sockets were sent to forks.</p>
<p>Callback should take two arguments <code>err</code> and <code>count</code>.</p>
<p><code>net.Server</code> is an <a href="events.html#events_class_events_eventemitter">EventEmitter</a> with the following events:</p>
<h3 id="Event:_‘listening’">Event: ‘listening’</h3><p>Emitted when the server has been bound after calling <code>server.listen</code>.</p>
<h3 id="Event:_‘connection’">Event: ‘connection’</h3><ul>
<li>{Socket object} The connection object</li>
</ul>
<p>Emitted when a new connection is made. <code>socket</code> is an instance of<br><code>net.Socket</code>.</p>
<h3 id="Event:_‘close’-1">Event: ‘close’</h3><p>Emitted when the server closes. Note that if connections exist, this<br>event is not emitted until all connections are ended.</p>
<h3 id="Event:_‘error’-3">Event: ‘error’</h3><ul>
<li>{Error Object}</li>
</ul>
<p>Emitted when an error occurs.  The <code>&#39;close&#39;</code> event will be called directly<br>following this event.  See example in discussion of <code>server.listen</code>.</p>
<h2 id="Class:_net-Socket">Class: net.Socket</h2><p>This object is an abstraction of a TCP or local socket.  <code>net.Socket</code><br>instances implement a duplex Stream interface.  They can be created by the<br>user and used as a client (with <code>connect()</code>) or they can be created by Node<br>and passed to the user through the <code>&#39;connection&#39;</code> event of a server.</p>
<h3 id="new_net-Socket([options])">new net.Socket([options])</h3><p>Construct a new socket object.</p>
<p><code>options</code> is an object with the following defaults:</p>
<pre><code>{ <span class="string">fd:</span> <span class="literal">null</span>
<span class="label">  allowHalfOpen:</span> <span class="literal">false</span>,
<span class="label">  readable:</span> <span class="literal">false</span>,
<span class="label">  writable:</span> <span class="literal">false</span>
}
</code></pre><p><code>fd</code> allows you to specify the existing file descriptor of socket.<br>Set <code>readable</code> and/or <code>writable</code> to <code>true</code> to allow reads and/or writes on this<br>socket (NOTE: Works only when <code>fd</code> is passed).<br>About <code>allowHalfOpen</code>, refer to <code>createServer()</code> and <code>&#39;end&#39;</code> event.</p>
<h3 id="socket-connect(port[,_host][,_connectListener])">socket.connect(port[, host][, connectListener])</h3><h3 id="socket-connect(path[,_connectListener])">socket.connect(path[, connectListener])</h3><p>Opens the connection for a given socket. If <code>port</code> and <code>host</code> are given,<br>then the socket will be opened as a TCP socket, if <code>host</code> is omitted,<br><code>localhost</code> will be assumed. If a <code>path</code> is given, the socket will be<br>opened as a unix socket to that path.</p>
<p>Normally this method is not needed, as <code>net.createConnection</code> opens the<br>socket. Use this only if you are implementing a custom Socket.</p>
<p>This function is asynchronous. When the <a href="#net_event_connect">‘connect’</a> event is emitted the<br>socket is established. If there is a problem connecting, the <code>&#39;connect&#39;</code> event<br>will not be emitted, the <code>&#39;error&#39;</code> event will be emitted with the exception.</p>
<p>The <code>connectListener</code> parameter will be added as an listener for the<br><a href="#net_event_connect">‘connect’</a> event.</p>
<h3 id="socket-bufferSize">socket.bufferSize</h3><p><code>net.Socket</code> has the property that <code>socket.write()</code> always works. This is to<br>help users get up and running quickly. The computer cannot always keep up<br>with the amount of data that is written to a socket - the network connection<br>simply might be too slow. Node will internally queue up the data written to a<br>socket and send it out over the wire when it is possible. (Internally it is<br>polling on the socket’s file descriptor for being writable).</p>
<p>The consequence of this internal buffering is that memory may grow. This<br>property shows the number of characters currently buffered to be written.<br>(Number of characters is approximately equal to the number of bytes to be<br>written, but the buffer may contain strings, and the strings are lazily<br>encoded, so the exact number of bytes is not known.)</p>
<p>Users who experience large or growing <code>bufferSize</code> should attempt to<br>“throttle” the data flows in their program with <code>pause()</code> and <code>resume()</code>.</p>
<h3 id="socket-setEncoding([encoding])">socket.setEncoding([encoding])</h3><p>Set the encoding for the socket as a Readable Stream. See<br><a href="stream.html#stream_stream_setencoding_encoding">stream.setEncoding()</a> for more information.</p>
<h3 id="socket-write(data[,_encoding][,_callback])">socket.write(data[, encoding][, callback])</h3><p>Sends data on the socket. The second parameter specifies the encoding in the<br>case of a string—it defaults to UTF8 encoding.</p>
<p>Returns <code>true</code> if the entire data was flushed successfully to the kernel<br>buffer. Returns <code>false</code> if all or part of the data was queued in user memory.<br><code>&#39;drain&#39;</code> will be emitted when the buffer is again free.</p>
<p>The optional <code>callback</code> parameter will be executed when the data is finally<br>written out - this may not be immediately.</p>
<h3 id="socket-end([data][,_encoding])">socket.end([data][, encoding])</h3><p>Half-closes the socket. i.e., it sends a FIN packet. It is possible the<br>server will still send some data.</p>
<p>If <code>data</code> is specified, it is equivalent to calling<br><code>socket.write(data, encoding)</code> followed by <code>socket.end()</code>.</p>
<h3 id="socket-destroy()">socket.destroy()</h3><p>Ensures that no more I/O activity happens on this socket. Only necessary in<br>case of errors (parse error or so).</p>
<h3 id="socket-pause()">socket.pause()</h3><p>Pauses the reading of data. That is, <code>&#39;data&#39;</code> events will not be emitted.<br>Useful to throttle back an upload.</p>
<h3 id="socket-resume()">socket.resume()</h3><p>Resumes reading after a call to <code>pause()</code>.</p>
<h3 id="socket-setTimeout(timeout[,_callback])">socket.setTimeout(timeout[, callback])</h3><p>Sets the socket to timeout after <code>timeout</code> milliseconds of inactivity on<br>the socket. By default <code>net.Socket</code> do not have a timeout.</p>
<p>When an idle timeout is triggered the socket will receive a <code>&#39;timeout&#39;</code><br>event but the connection will not be severed. The user must manually <code>end()</code><br>or <code>destroy()</code> the socket.</p>
<p>If <code>timeout</code> is 0, then the existing idle timeout is disabled.</p>
<p>The optional <code>callback</code> parameter will be added as a one time listener for the<br><code>&#39;timeout&#39;</code> event.</p>
<h3 id="socket-setNoDelay([noDelay])">socket.setNoDelay([noDelay])</h3><p>Disables the Nagle algorithm. By default TCP connections use the Nagle<br>algorithm, they buffer data before sending it off. Setting <code>true</code> for<br><code>noDelay</code> will immediately fire off data each time <code>socket.write()</code> is called.<br><code>noDelay</code> defaults to <code>true</code>.</p>
<h3 id="socket-setKeepAlive([enable][,_initialDelay])">socket.setKeepAlive([enable][, initialDelay])</h3><p>Enable/disable keep-alive functionality, and optionally set the initial<br>delay before the first keepalive probe is sent on an idle socket.<br><code>enable</code> defaults to <code>false</code>.</p>
<p>Set <code>initialDelay</code> (in milliseconds) to set the delay between the last<br>data packet received and the first keepalive probe. Setting 0 for<br>initialDelay will leave the value unchanged from the default<br>(or previous) setting. Defaults to <code>0</code>.</p>
<h3 id="socket-address()">socket.address()</h3><p>Returns the bound address, the address family name and port of the<br>socket as reported by the operating system. Returns an object with<br>three properties, e.g.<br><code>{ port: 12346, family: &#39;IPv4&#39;, address: &#39;127.0.0.1&#39; }</code></p>
<h3 id="socket-unref()">socket.unref()</h3><p>Calling <code>unref</code> on a socket will allow the program to exit if this is the only<br>active socket in the event system. If the socket is already <code>unref</code>d calling<br><code>unref</code> again will have no effect.</p>
<h3 id="socket-ref()">socket.ref()</h3><p>Opposite of <code>unref</code>, calling <code>ref</code> on a previously <code>unref</code>d socket will <em>not</em><br>let the program exit if it’s the only socket left (the default behavior). If<br>the socket is <code>ref</code>d calling <code>ref</code> again will have no effect.</p>
<h3 id="socket-remoteAddress">socket.remoteAddress</h3><p>The string representation of the remote IP address. For example,<br><code>&#39;74.125.127.100&#39;</code> or <code>&#39;2001:4860:a005::68&#39;</code>.</p>
<h3 id="socket-remoteFamily">socket.remoteFamily</h3><p>The string representation of the remote IP family. <code>&#39;IPv4&#39;</code> or <code>&#39;IPv6&#39;</code>.</p>
<h3 id="socket-remotePort">socket.remotePort</h3><p>The numeric representation of the remote port. For example,<br><code>80</code> or <code>21</code>.</p>
<h3 id="socket-localAddress">socket.localAddress</h3><p>The string representation of the local IP address the remote client is<br>connecting on. For example, if you are listening on <code>&#39;0.0.0.0&#39;</code> and the<br>client connects on <code>&#39;192.168.1.1&#39;</code>, the value would be <code>&#39;192.168.1.1&#39;</code>.</p>
<h3 id="socket-localPort">socket.localPort</h3><p>The numeric representation of the local port. For example,<br><code>80</code> or <code>21</code>.</p>
<h3 id="socket-bytesRead">socket.bytesRead</h3><p>The amount of received bytes.</p>
<h3 id="socket-bytesWritten">socket.bytesWritten</h3><p>The amount of bytes sent.</p>
<p><code>net.Socket</code> instances are <a href="events.html#events_class_events_eventemitter">EventEmitter</a> with the following events:</p>
<h3 id="Event:_‘lookup’">Event: ‘lookup’</h3><p>Emitted after resolving the hostname but before connecting.<br>Not applicable to UNIX sockets.</p>
<ul>
<li><code>err</code> {Error | Null} The error object.  See <a href="dns.html#dns_dns_lookup_domain_family_callback">dns.lookup()</a>.</li>
<li><code>address</code> {String} The IP address.</li>
<li><code>family</code> {String | Null} The address type.  See <a href="dns.html#dns_dns_lookup_domain_family_callback">dns.lookup()</a>.</li>
</ul>
<h3 id="Event:_‘connect’">Event: ‘connect’</h3><p>Emitted when a socket connection is successfully established.<br>See <code>connect()</code>.</p>
<h3 id="Event:_‘data’-1">Event: ‘data’</h3><ul>
<li>{Buffer object}</li>
</ul>
<p>Emitted when data is received.  The argument <code>data</code> will be a <code>Buffer</code> or<br><code>String</code>.  Encoding of data is set by <code>socket.setEncoding()</code>.<br>(See the <a href="stream.html#stream_class_stream_readable">Readable Stream</a> section for more information.)</p>
<p>Note that the <strong>data will be lost</strong> if there is no listener when a <code>Socket</code><br>emits a <code>&#39;data&#39;</code> event.</p>
<h3 id="Event:_‘end’-1">Event: ‘end’</h3><p>Emitted when the other end of the socket sends a FIN packet.</p>
<p>By default (<code>allowHalfOpen == false</code>) the socket will destroy its file<br>descriptor  once it has written out its pending write queue.  However, by<br>setting <code>allowHalfOpen == true</code> the socket will not automatically <code>end()</code><br>its side allowing the user to write arbitrary amounts of data, with the<br>caveat that the user is required to <code>end()</code> their side now.</p>
<h3 id="Event:_‘timeout’">Event: ‘timeout’</h3><p>Emitted if the socket times out from inactivity. This is only to notify that<br>the socket has been idle. The user must manually close the connection.</p>
<p>See also: <code>socket.setTimeout()</code></p>
<h3 id="Event:_‘drain’-1">Event: ‘drain’</h3><p>Emitted when the write buffer becomes empty. Can be used to throttle uploads.</p>
<p>See also: the return values of <code>socket.write()</code></p>
<h3 id="Event:_‘error’-4">Event: ‘error’</h3><ul>
<li>{Error object}</li>
</ul>
<p>Emitted when an error occurs.  The <code>&#39;close&#39;</code> event will be called directly<br>following this event.</p>
<h3 id="Event:_‘close’-2">Event: ‘close’</h3><ul>
<li><code>had_error</code> {Boolean} true if the socket had a transmission error</li>
</ul>
<p>Emitted once the socket is fully closed. The argument <code>had_error</code> is a boolean<br>which says if the socket was closed due to a transmission error.</p>
<h2 id="net-isIP(input)">net.isIP(input)</h2><p>Tests if input is an IP address. Returns 0 for invalid strings,<br>returns 4 for IP version 4 addresses, and returns 6 for IP version 6 addresses.</p>
<h2 id="net-isIPv4(input)">net.isIPv4(input)</h2><p>Returns true if input is a version 4 IP address, otherwise returns false.</p>
<h2 id="net-isIPv6(input)">net.isIPv6(input)</h2><p>Returns true if input is a version 6 IP address, otherwise returns false.</p>
<h1 id="UDP_/_Datagram_Sockets"><a id="dgram">UDP / Datagram Sockets</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><!-- name=dgram -->
<p>Datagram sockets are available through <code>require(&#39;dgram&#39;)</code>.</p>
<p>Important note: the behavior of <code>dgram.Socket#bind()</code> has changed in v0.10<br>and is always asynchronous now.  If you have code that looks like this:</p>
<pre><code>var s = dgram.createSocket('udp4')<span class="comment">;</span>
s.bind(1234)<span class="comment">;</span>
s.addMembership('<span class="number">224.0.0.114</span>')<span class="comment">;</span>
</code></pre><p>You have to change it to this:</p>
<pre><code><span class="keyword">var</span> s = dgram.createSocket(<span class="string">'udp4'</span>);
s.bind(<span class="number">1234</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  s.addMembership(<span class="string">'224.0.0.114'</span>);
});
</code></pre><h2 id="dgram-createSocket(type[,_callback])">dgram.createSocket(type[, callback])</h2><ul>
<li><code>type</code> String. Either ‘udp4’ or ‘udp6’</li>
<li><code>callback</code> Function. Attached as a listener to <code>message</code> events.<br>Optional</li>
<li>Returns: Socket object</li>
</ul>
<p>Creates a datagram Socket of the specified types.  Valid types are <code>udp4</code><br>and <code>udp6</code>.</p>
<p>Takes an optional callback which is added as a listener for <code>message</code> events.</p>
<p>Call <code>socket.bind()</code> if you want to receive datagrams. <code>socket.bind()</code> will<br>bind to the “all interfaces” address on a random port (it does the right thing<br>for both <code>udp4</code> and <code>udp6</code> sockets). You can then retrieve the address and port<br>with <code>socket.address().address</code> and <code>socket.address().port</code>.</p>
<h2 id="dgram-createSocket(options[,_callback])">dgram.createSocket(options[, callback])</h2><ul>
<li><code>options</code> Object</li>
<li><code>callback</code> Function. Attached as a listener to <code>message</code> events.</li>
<li>Returns: Socket object</li>
</ul>
<p>The <code>options</code> object should contain a <code>type</code> field of either <code>udp4</code> or <code>udp6</code><br>and an optional boolean <code>reuseAddr</code> field.</p>
<p>When <code>reuseAddr</code> is true <code>socket.bind()</code> will reuse the address, even if<br>another process has already bound a socket on it. <code>reuseAddr</code> defaults to<br><code>false</code>.</p>
<p>Takes an optional callback which is added as a listener for <code>message</code> events.</p>
<p>Call <code>socket.bind()</code> if you want to receive datagrams. <code>socket.bind()</code> will<br>bind to the “all interfaces” address on a random port (it does the right thing<br>for both <code>udp4</code> and <code>udp6</code> sockets). You can then retrieve the address and port<br>with <code>socket.address().address</code> and <code>socket.address().port</code>.</p>
<h2 id="Class:_dgram-Socket">Class: dgram.Socket</h2><p>The dgram Socket class encapsulates the datagram functionality.  It<br>should be created via <code>dgram.createSocket(...)</code></p>
<h3 id="Event:_‘message’">Event: ‘message’</h3><ul>
<li><code>msg</code> Buffer object. The message</li>
<li><code>rinfo</code> Object. Remote address information</li>
</ul>
<p>Emitted when a new datagram is available on a socket.  <code>msg</code> is a <code>Buffer</code> and<br><code>rinfo</code> is an object with the sender’s address information:</p>
<pre><code>socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(msg, rinfo)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">'Received %d bytes from %s:%d\n'</span>,
              msg.<span class="built_in">length</span>, rinfo.address, rinfo.port);
});
</code></pre><h3 id="Event:_‘listening’-1">Event: ‘listening’</h3><p>Emitted when a socket starts listening for datagrams.  This happens as soon as UDP sockets<br>are created.</p>
<h3 id="Event:_‘close’-3">Event: ‘close’</h3><p>Emitted when a socket is closed with <code>close()</code>.  No new <code>message</code> events will be emitted<br>on this socket.</p>
<h3 id="Event:_‘error’-5">Event: ‘error’</h3><ul>
<li><code>exception</code> Error object</li>
</ul>
<p>Emitted when an error occurs.</p>
<h3 id="socket-send(buf,_offset,_length,_port,_address[,_callback])">socket.send(buf, offset, length, port, address[, callback])</h3><ul>
<li><code>buf</code> Buffer object or string.  Message to be sent</li>
<li><code>offset</code> Integer. Offset in the buffer where the message starts.</li>
<li><code>length</code> Integer. Number of bytes in the message.</li>
<li><code>port</code> Integer. Destination port.</li>
<li><code>address</code> String. Destination hostname or IP address.</li>
<li><code>callback</code> Function. Called when the message has been sent. Optional.</li>
</ul>
<p>For UDP sockets, the destination port and address must be specified.  A string<br>may be supplied for the <code>address</code> parameter, and it will be resolved with DNS.</p>
<p>If the address is omitted or is an empty string, <code>&#39;0.0.0.0&#39;</code> or <code>&#39;::0&#39;</code> is used<br>instead.  Depending on the network configuration, those defaults may or may not<br>work; it’s best to be explicit about the destination address.</p>
<p>If the socket has not been previously bound with a call to <code>bind</code>, it gets<br>assigned a random port number and is bound to the “all interfaces” address<br>(<code>&#39;0.0.0.0&#39;</code> for <code>udp4</code> sockets, <code>&#39;::0&#39;</code> for <code>udp6</code> sockets.)</p>
<p>An optional callback may be specified to detect DNS errors or for determining<br>when it’s safe to reuse the <code>buf</code> object.  Note that DNS lookups delay the time<br>to send for at least one tick.  The only way to know for sure that the datagram<br>has been sent is by using a callback.</p>
<p>With consideration for multi-byte characters, <code>offset</code> and <code>length</code> will<br>be calculated with respect to<br><a href="buffer.html#buffer_class_method_buffer_bytelength_string_encoding">byte length</a><br>and not the character position.</p>
<p>Example of sending a UDP packet to a random port on <code>localhost</code>;</p>
<pre><code><span class="keyword">var</span> dgram = <span class="built_in">require</span>(<span class="string">'dgram'</span>);
<span class="keyword">var</span> message = <span class="keyword">new</span> Buffer(<span class="string">"Some bytes"</span>);
<span class="keyword">var</span> client = dgram.createSocket(<span class="string">"udp4"</span>);
client.send(message, <span class="number">0</span>, message.length, <span class="number">41234</span>, <span class="string">"localhost"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
  client.close();
});
</code></pre><p><strong>A Note about UDP datagram size</strong></p>
<p>The maximum size of an <code>IPv4/v6</code> datagram depends on the <code>MTU</code> (<em>Maximum Transmission Unit</em>)<br>and on the <code>Payload Length</code> field size.</p>
<ul>
<li><p>The <code>Payload Length</code> field is <code>16 bits</code> wide, which means that a normal payload<br>cannot be larger than 64K octets including internet header and data<br>(65,507 bytes = 65,535 − 8 bytes UDP header − 20 bytes IP header);<br>this is generally true for loopback interfaces, but such long datagrams<br>are impractical for most hosts and networks.</p>
</li>
<li><p>The <code>MTU</code> is the largest size a given link layer technology can support for datagrams.<br>For any link, <code>IPv4</code> mandates a minimum <code>MTU</code> of <code>68</code> octets, while the recommended <code>MTU</code><br>for IPv4 is <code>576</code> (typically recommended as the <code>MTU</code> for dial-up type applications),<br>whether they arrive whole or in fragments.</p>
<p>For <code>IPv6</code>, the minimum <code>MTU</code> is <code>1280</code> octets, however, the mandatory minimum<br>fragment reassembly buffer size is <code>1500</code> octets.<br>The value of <code>68</code> octets is very small, since most current link layer technologies have<br>a minimum <code>MTU</code> of <code>1500</code> (like Ethernet).</p>
</li>
</ul>
<p>Note that it’s impossible to know in advance the MTU of each link through which<br>a packet might travel, and that generally sending a datagram greater than<br>the (receiver) <code>MTU</code> won’t work (the packet gets silently dropped, without<br>informing the source that the data did not reach its intended recipient).</p>
<h3 id="socket-bind(port[,_address][,_callback])">socket.bind(port[, address][, callback])</h3><ul>
<li><code>port</code> Integer</li>
<li><code>address</code> String, Optional</li>
<li><code>callback</code> Function with no parameters, Optional. Callback when<br>binding is done.</li>
</ul>
<p>For UDP sockets, listen for datagrams on a named <code>port</code> and optional<br><code>address</code>. If <code>address</code> is not specified, the OS will try to listen on<br>all addresses.  After binding is done, a “listening” event is emitted<br>and the <code>callback</code>(if specified) is called. Specifying both a<br>“listening” event listener and <code>callback</code> is not harmful but not very<br>useful.</p>
<p>A bound datagram socket keeps the node process running to receive<br>datagrams.</p>
<p>If binding fails, an “error” event is generated. In rare case (e.g.<br>binding a closed socket), an <code>Error</code> may be thrown by this method.</p>
<p>Example of a UDP server listening on port 41234:</p>
<pre><code><span class="keyword">var</span> dgram = <span class="built_in">require</span>(<span class="string">"dgram"</span>);

<span class="keyword">var</span> server = dgram.createSocket(<span class="string">"udp4"</span>);

server.on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">"server error:\n"</span> + err.stack);
  server.close();
});

server.on(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">msg, rinfo</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">"server got: "</span> + msg + <span class="string">" from "</span> +
    rinfo.address + <span class="string">":"</span> + rinfo.port);
});

server.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
  <span class="keyword">var</span> address = server.address();
  <span class="built_in">console</span>.log(<span class="string">"server listening "</span> +
      address.address + <span class="string">":"</span> + address.port);
});

server.bind(<span class="number">41234</span>);
<span class="comment">// server listening 0.0.0.0:41234</span>
</code></pre><h3 id="socket-bind(options[,_callback])">socket.bind(options[, callback])</h3><ul>
<li><code>options</code> {Object} - Required. Supports the following properties:<ul>
<li><code>port</code> {Number} - Required.</li>
<li><code>address</code> {String} - Optional.</li>
<li><code>exclusive</code> {Boolean} - Optional.</li>
</ul>
</li>
<li><code>callback</code> {Function} - Optional.</li>
</ul>
<p>The <code>port</code> and <code>address</code> properties of <code>options</code>, as well as the optional<br>callback function, behave as they do on a call to<br><a href="#dgram_socket_bind_port_address_callback">socket.bind(port, [address], [callback])
</a>.</p>
<p>If <code>exclusive</code> is <code>false</code> (default), then cluster workers will use the same<br>underlying handle, allowing connection handling duties to be shared. When<br><code>exclusive</code> is <code>true</code>, the handle is not shared, and attempted port sharing<br>results in an error. An example which listens on an exclusive port is<br>shown below.</p>
<pre><code><span class="tag">socket</span><span class="class">.bind</span>({
  <span class="attribute">address</span>: <span class="string">'localhost'</span>,
  <span class="attribute">port</span>: <span class="number">8000</span>,
  <span class="attribute">exclusive</span>: true
});
</code></pre><h3 id="socket-close()">socket.close()</h3><p>Close the underlying socket and stop listening for data on it.</p>
<h3 id="socket-address()-1">socket.address()</h3><p>Returns an object containing the address information for a socket.  For UDP sockets,<br>this object will contain <code>address</code> , <code>family</code> and <code>port</code>.</p>
<h3 id="socket-setBroadcast(flag)">socket.setBroadcast(flag)</h3><ul>
<li><code>flag</code> Boolean</li>
</ul>
<p>Sets or clears the <code>SO_BROADCAST</code> socket option.  When this option is set, UDP packets<br>may be sent to a local interface’s broadcast address.</p>
<h3 id="socket-setTTL(ttl)">socket.setTTL(ttl)</h3><ul>
<li><code>ttl</code> Integer</li>
</ul>
<p>Sets the <code>IP_TTL</code> socket option.  TTL stands for “Time to Live,” but in this context it<br>specifies the number of IP hops that a packet is allowed to go through.  Each router or<br>gateway that forwards a packet decrements the TTL.  If the TTL is decremented to 0 by a<br>router, it will not be forwarded.  Changing TTL values is typically done for network<br>probes or when multicasting.</p>
<p>The argument to <code>setTTL()</code> is a number of hops between 1 and 255.  The default on most<br>systems is 64.</p>
<h3 id="socket-setMulticastTTL(ttl)">socket.setMulticastTTL(ttl)</h3><ul>
<li><code>ttl</code> Integer</li>
</ul>
<p>Sets the <code>IP_MULTICAST_TTL</code> socket option.  TTL stands for “Time to Live,” but in this<br>context it specifies the number of IP hops that a packet is allowed to go through,<br>specifically for multicast traffic.  Each router or gateway that forwards a packet<br>decrements the TTL. If the TTL is decremented to 0 by a router, it will not be forwarded.</p>
<p>The argument to <code>setMulticastTTL()</code> is a number of hops between 0 and 255.  The default on most<br>systems is 1.</p>
<h3 id="socket-setMulticastLoopback(flag)">socket.setMulticastLoopback(flag)</h3><ul>
<li><code>flag</code> Boolean</li>
</ul>
<p>Sets or clears the <code>IP_MULTICAST_LOOP</code> socket option.  When this option is set, multicast<br>packets will also be received on the local interface.</p>
<h3 id="socket-addMembership(multicastAddress[,_multicastInterface])">socket.addMembership(multicastAddress[, multicastInterface])</h3><ul>
<li><code>multicastAddress</code> String</li>
<li><code>multicastInterface</code> String, Optional</li>
</ul>
<p>Tells the kernel to join a multicast group with <code>IP_ADD_MEMBERSHIP</code> socket option.</p>
<p>If <code>multicastInterface</code> is not specified, the OS will try to add membership to all valid<br>interfaces.</p>
<h3 id="socket-dropMembership(multicastAddress[,_multicastInterface])">socket.dropMembership(multicastAddress[, multicastInterface])</h3><ul>
<li><code>multicastAddress</code> String</li>
<li><code>multicastInterface</code> String, Optional</li>
</ul>
<p>Opposite of <code>addMembership</code> - tells the kernel to leave a multicast group with<br><code>IP_DROP_MEMBERSHIP</code> socket option. This is automatically called by the kernel<br>when the socket is closed or process terminates, so most apps will never need to call<br>this.</p>
<p>If <code>multicastInterface</code> is not specified, the OS will try to drop membership to all valid<br>interfaces.</p>
<h3 id="socket-unref()-1">socket.unref()</h3><p>Calling <code>unref</code> on a socket will allow the program to exit if this is the only<br>active socket in the event system. If the socket is already <code>unref</code>d calling<br><code>unref</code> again will have no effect.</p>
<h3 id="socket-ref()-1">socket.ref()</h3><p>Opposite of <code>unref</code>, calling <code>ref</code> on a previously <code>unref</code>d socket will <em>not</em><br>let the program exit if it’s the only socket left (the default behavior). If<br>the socket is <code>ref</code>d calling <code>ref</code> again will have no effect.</p>
<h1 id="DNS"><a id="dns">DNS</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>Use <code>require(&#39;dns&#39;)</code> to access this module.</p>
<p>This module contains functions that belong to two different categories:</p>
<p>1) Functions that use the underlying operating system facilities to perform<br>name resolution, and that do not necessarily do any network communication.<br>This category contains only one function: <code>dns.lookup</code>. <strong>Developers looking<br>to perform name resolution in the same way that other applications on the same<br>operating system behave should use <code>dns.lookup</code>.</strong></p>
<p>Here is an example that does a lookup of <code>www.google.com</code>.</p>
<pre><code><span class="keyword">var</span> dns = <span class="built_in">require</span>(<span class="string">'dns'</span>);

dns.lookup(<span class="string">'www.google.com'</span>, <span class="function"><span class="keyword">function</span> <span class="title">onLookup</span>(<span class="params">err, addresses, family</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'addresses:'</span>, addresses);
});
</code></pre><p>2) Functions that connect to an actual DNS server to perform name resolution,<br>and that <em>always</em> use the network to perform DNS queries. This category<br>contains all functions in the <code>dns</code> module but <code>dns.lookup</code>. These functions<br>do not use the same set of configuration files than what <code>dns.lookup</code> uses.<br>For instance, <em>they do not use the configuration from <code>/etc/hosts</code></em>. These<br>functions should be used by developers who do not want to use the underlying<br>operating system’s facilities for name resolution, and instead want to<br><em>always</em> perform DNS queries.</p>
<p>Here is an example which resolves <code>&#39;www.google.com&#39;</code> then reverse<br>resolves the IP addresses which are returned.</p>
<pre><code><span class="keyword">var</span> dns = <span class="built_in">require</span>(<span class="string">'dns'</span>);

dns.resolve4(<span class="string">'www.google.com'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, addresses</span>) </span>{
  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;

  <span class="built_in">console</span>.log(<span class="string">'addresses: '</span> + <span class="built_in">JSON</span>.stringify(addresses));

  addresses.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>{
    dns.reverse(a, <span class="function"><span class="keyword">function</span> (<span class="params">err, hostnames</span>) </span>{
      <span class="keyword">if</span> (err) {
        <span class="keyword">throw</span> err;
      }

      <span class="built_in">console</span>.log(<span class="string">'reverse for '</span> + a + <span class="string">': '</span> + <span class="built_in">JSON</span>.stringify(hostnames));
    });
  });
});
</code></pre><p>There are subtle consequences in choosing one or another, please consult the<br><a href="#dns_implementation_considerations">Implementation considerations section</a><br>for more information.</p>
<h2 id="dns-lookup(hostname[,_options],_callback)">dns.lookup(hostname[, options], callback)</h2><p>Resolves a hostname (e.g. <code>&#39;google.com&#39;</code>) into the first found A (IPv4) or<br>AAAA (IPv6) record. <code>options</code> can be an object or integer. If <code>options</code> is<br>not provided, then IP v4 and v6 addresses are both valid. If <code>options</code> is<br>an integer, then it must be <code>4</code> or <code>6</code>.</p>
<p>Alternatively, <code>options</code> can be an object containing two properties,<br><code>family</code> and <code>hints</code>. Both properties are optional. If <code>family</code> is provided,<br>it must be the integer <code>4</code> or <code>6</code>. If <code>family</code> is not provided then IP v4<br>and v6 addresses are accepted. The <code>hints</code> field, if present, should be one<br>or more of the supported <code>getaddrinfo</code> flags. If <code>hints</code> is not provided,<br>then no flags are passed to <code>getaddrinfo</code>. Multiple flags can be passed<br>through <code>hints</code> by logically <code>OR</code>ing their values. An example usage of<br><code>options</code> is shown below.</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attribute">family</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attribute">hints</span>: dns.ADDRCONFIG | dns.V4MAPPED</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>See <a href="#dns_supported_getaddrinfo_flags">supported <code>getaddrinfo</code> flags</a> below for<br>more information on supported flags.</p>
<p>The callback has arguments <code>(err, address, family)</code>.  The <code>address</code> argument<br>is a string representation of a IP v4 or v6 address. The <code>family</code> argument<br>is either the integer 4 or 6 and denotes the family of <code>address</code> (not<br>necessarily the value initially passed to <code>lookup</code>).</p>
<p>On error, <code>err</code> is an <code>Error</code> object, where <code>err.code</code> is the error code.<br>Keep in mind that <code>err.code</code> will be set to <code>&#39;ENOENT&#39;</code> not only when<br>the hostname does not exist but also when the lookup fails in other ways<br>such as no available file descriptors.</p>
<p><code>dns.lookup</code> doesn’t necessarily have anything to do with the DNS protocol.<br>It’s only an operating system facility that can associate name with addresses,<br>and vice versa.</p>
<p>Its implementation can have subtle but important consequences on the behavior<br>of any Node.js program. Please take some time to consult the <a href="#dns_implementation_considerations">Implementation<br>considerations section</a> before using it.</p>
<h1 id="dns-lookupService(address,_port,_callback)">dns.lookupService(address, port, callback)</h1><p>Resolves the given address and port into a hostname and service using<br><code>getnameinfo</code>.</p>
<p>The callback has arguments <code>(err, hostname, service)</code>. The <code>hostname</code> and<br><code>service</code> arguments are strings (e.g. <code>&#39;localhost&#39;</code> and <code>&#39;http&#39;</code> respectively).</p>
<p>On error, <code>err</code> is an <code>Error</code> object, where <code>err.code</code> is the error code.</p>
<h2 id="dns-resolve(hostname[,_rrtype],_callback)">dns.resolve(hostname[, rrtype], callback)</h2><p>Resolves a hostname (e.g. <code>&#39;google.com&#39;</code>) into an array of the record types<br>specified by rrtype.</p>
<p>Valid rrtypes are:</p>
<ul>
<li><code>&#39;A&#39;</code> (IPV4 addresses, default)</li>
<li><code>&#39;AAAA&#39;</code> (IPV6 addresses)</li>
<li><code>&#39;MX&#39;</code> (mail exchange records)</li>
<li><code>&#39;TXT&#39;</code> (text records)</li>
<li><code>&#39;SRV&#39;</code> (SRV records)</li>
<li><code>&#39;PTR&#39;</code> (used for reverse IP lookups)</li>
<li><code>&#39;NS&#39;</code> (name server records)</li>
<li><code>&#39;CNAME&#39;</code> (canonical name records)</li>
<li><code>&#39;SOA&#39;</code> (start of authority record)</li>
</ul>
<p>The callback has arguments <code>(err, addresses)</code>.  The type of each item<br>in <code>addresses</code> is determined by the record type, and described in the<br>documentation for the corresponding lookup methods below.</p>
<p>On error, <code>err</code> is an <code>Error</code> object, where <code>err.code</code> is<br>one of the error codes listed below.</p>
<h2 id="dns-resolve4(hostname,_callback)">dns.resolve4(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for IPv4 queries (<code>A</code> records).<br><code>addresses</code> is an array of IPv4 addresses (e.g.<br><code>[&#39;74.125.79.104&#39;, &#39;74.125.79.105&#39;, &#39;74.125.79.106&#39;]</code>).</p>
<h2 id="dns-resolve6(hostname,_callback)">dns.resolve6(hostname, callback)</h2><p>The same as <code>dns.resolve4()</code> except for IPv6 queries (an <code>AAAA</code> query).</p>
<h2 id="dns-resolveMx(hostname,_callback)">dns.resolveMx(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for mail exchange queries (<code>MX</code> records).</p>
<p><code>addresses</code> is an array of MX records, each with a priority and an exchange<br>attribute (e.g. <code>[{&#39;priority&#39;: 10, &#39;exchange&#39;: &#39;mx.example.com&#39;},...]</code>).</p>
<h2 id="dns-resolveTxt(hostname,_callback)">dns.resolveTxt(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for text queries (<code>TXT</code> records).<br><code>addresses</code> is an 2-d array of the text records available for <code>hostname</code> (e.g.,<br><code>[ [&#39;v=spf1 ip4:0.0.0.0 &#39;, &#39;~all&#39; ] ]</code>). Each sub-array contains TXT chunks of<br>one record. Depending on the use case, the could be either joined together or<br>treated separately.</p>
<h2 id="dns-resolveSrv(hostname,_callback)">dns.resolveSrv(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for service records (<code>SRV</code> records).<br><code>addresses</code> is an array of the SRV records available for <code>hostname</code>. Properties<br>of SRV records are priority, weight, port, and name (e.g.,<br><code>[{&#39;priority&#39;: 10, &#39;weight&#39;: 5, &#39;port&#39;: 21223, &#39;name&#39;: &#39;service.example.com&#39;}, ...]</code>).</p>
<h2 id="dns-resolveSoa(hostname,_callback)">dns.resolveSoa(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for start of authority record queries<br>(<code>SOA</code> record).</p>
<p><code>addresses</code> is an object with the following structure:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attribute">nsname</span>: <span class="string">'ns.example.com'</span>,</span><br><span class="line">  <span class="attribute">hostmaster</span>: <span class="string">'root.example.com'</span>,</span><br><span class="line">  <span class="attribute">serial</span>: <span class="number">2013101809</span>,</span><br><span class="line">  <span class="attribute">refresh</span>: <span class="number">10000</span>,</span><br><span class="line">  <span class="attribute">retry</span>: <span class="number">2400</span>,</span><br><span class="line">  <span class="attribute">expire</span>: <span class="number">604800</span>,</span><br><span class="line">  <span class="attribute">minttl</span>: <span class="number">3600</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dns-resolveNs(hostname,_callback)">dns.resolveNs(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for name server records (<code>NS</code> records).<br><code>addresses</code> is an array of the name server records available for <code>hostname</code><br>(e.g., <code>[&#39;ns1.example.com&#39;, &#39;ns2.example.com&#39;]</code>).</p>
<h2 id="dns-resolveCname(hostname,_callback)">dns.resolveCname(hostname, callback)</h2><p>The same as <code>dns.resolve()</code>, but only for canonical name records (<code>CNAME</code><br>records). <code>addresses</code> is an array of the canonical name records available for<br><code>hostname</code> (e.g., <code>[&#39;bar.example.com&#39;]</code>).</p>
<h2 id="dns-reverse(ip,_callback)">dns.reverse(ip, callback)</h2><p>Reverse resolves an ip address to an array of hostnames.</p>
<p>The callback has arguments <code>(err, hostnames)</code>.</p>
<p>On error, <code>err</code> is an <code>Error</code> object, where <code>err.code</code> is<br>one of the error codes listed below.</p>
<h2 id="dns-getServers()">dns.getServers()</h2><p>Returns an array of IP addresses as strings that are currently being used for<br>resolution</p>
<h2 id="dns-setServers(servers)">dns.setServers(servers)</h2><p>Given an array of IP addresses as strings, set them as the servers to use for<br>resolving</p>
<p>If you specify a port with the address it will be stripped, as the underlying<br>library doesn’t support that.</p>
<p>This will throw if you pass invalid input.</p>
<h2 id="Error_codes">Error codes</h2><p>Each DNS query can return one of the following error codes:</p>
<ul>
<li><code>dns.NODATA</code>: DNS server returned answer with no data.</li>
<li><code>dns.FORMERR</code>: DNS server claims query was misformatted.</li>
<li><code>dns.SERVFAIL</code>: DNS server returned general failure.</li>
<li><code>dns.NOTFOUND</code>: Domain name not found.</li>
<li><code>dns.NOTIMP</code>: DNS server does not implement requested operation.</li>
<li><code>dns.REFUSED</code>: DNS server refused query.</li>
<li><code>dns.BADQUERY</code>: Misformatted DNS query.</li>
<li><code>dns.BADNAME</code>: Misformatted hostname.</li>
<li><code>dns.BADFAMILY</code>: Unsupported address family.</li>
<li><code>dns.BADRESP</code>: Misformatted DNS reply.</li>
<li><code>dns.CONNREFUSED</code>: Could not contact DNS servers.</li>
<li><code>dns.TIMEOUT</code>: Timeout while contacting DNS servers.</li>
<li><code>dns.EOF</code>: End of file.</li>
<li><code>dns.FILE</code>: Error reading file.</li>
<li><code>dns.NOMEM</code>: Out of memory.</li>
<li><code>dns.DESTRUCTION</code>: Channel is being destroyed.</li>
<li><code>dns.BADSTR</code>: Misformatted string.</li>
<li><code>dns.BADFLAGS</code>: Illegal flags specified.</li>
<li><code>dns.NONAME</code>: Given hostname is not numeric.</li>
<li><code>dns.BADHINTS</code>: Illegal hints flags specified.</li>
<li><code>dns.NOTINITIALIZED</code>: c-ares library initialization not yet performed.</li>
<li><code>dns.LOADIPHLPAPI</code>: Error loading iphlpapi.dll.</li>
<li><code>dns.ADDRGETNETWORKPARAMS</code>: Could not find GetNetworkParams function.</li>
<li><code>dns.CANCELLED</code>: DNS query cancelled.</li>
</ul>
<h2 id="Supported_getaddrinfo_flags">Supported getaddrinfo flags</h2><p>The following flags can be passed as hints to <code>dns.lookup</code>.</p>
<ul>
<li><code>dns.ADDRCONFIG</code>: Returned address types are determined by the types<br>of addresses supported by the current system. For example, IPv4 addresses<br>are only returned if the current system has at least one IPv4 address<br>configured. Loopback addresses are not considered.</li>
<li><code>dns.V4MAPPED</code>: If the IPv6 family was specified, but no IPv6 addresses were<br>found, then return IPv4 mapped IPv6 addresses. Note that it is not supported<br>on some operating systems (e.g FreeBSD 10.1).</li>
</ul>
<h2 id="Implementation_considerations">Implementation considerations</h2><p>Although <code>dns.lookup</code> and <code>dns.resolve*/dns.reverse</code> functions have the same<br>goal of associating a network name with a network address (or vice versa),<br>their behavior is quite different. These differences can have subtle but<br>significant consequences on the behavior of Node.js programs.</p>
<h3 id="dns-lookup">dns.lookup</h3><p>Under the hood, <code>dns.lookup</code> uses the same operating system facilities as most<br>other programs. For instance, <code>dns.lookup</code> will almost always resolve a given<br>name the same way as the <code>ping</code> command. On most POSIX-like operating systems,<br>the behavior of the <code>dns.lookup</code> function can be tweaked by changing settings<br>in <code>nsswitch.conf(5)</code> and/or <code>resolv.conf(5)</code>, but be careful that changing<br>these files will change the behavior of all other programs running on the same<br>operating system.</p>
<p>Though the call will be asynchronous from JavaScript’s perspective, it is<br>implemented as a synchronous call to <code>getaddrinfo(3)</code> that runs on libuv’s<br>threadpool. Because libuv’s threadpool has a fixed size, it means that if for<br>whatever reason the call to <code>getaddrinfo(3)</code> takes a long time, other<br>operations that could run on libuv’s threadpool (such as filesystem<br>operations) will experience degraded performance. In order to mitigate this<br>issue, one potential solution is to increase the size of libuv’s threadpool by<br>setting the ‘UV_THREADPOOL_SIZE’ environment variable to a value greater than<br>4 (its current default value). For more information on libuv’s threadpool, see<br><a href="http://docs.libuv.org/en/latest/threadpool.html" target="_blank" rel="external">the official libuv<br>documentation</a>.</p>
<h3 id="dns-resolve,_functions_starting_with_dns-resolve_and_dns-reverse">dns.resolve, functions starting with dns.resolve and dns.reverse</h3><p>These functions are implemented quite differently than <code>dns.lookup</code>. They do<br>not use <code>getaddrinfo(3)</code> and they <em>always</em> perform a DNS query on the network.<br>This network communication is always done asynchronously, and does not use<br>libuv’s threadpool.</p>
<p>As a result, these functions cannot have the same negative impact on other<br>processing that happens on libuv’s threadpool that <code>dns.lookup</code> can have.</p>
<p>They do not use the same set of configuration files than what <code>dns.lookup</code><br>uses. For instance, <em>they do not use the configuration from <code>/etc/hosts</code></em>.</p>
<h1 id="HTTP"><a id="http">HTTP</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>To use the HTTP server and client one must <code>require(&#39;http&#39;)</code>.</p>
<p>The HTTP interfaces in Node are designed to support many features<br>of the protocol which have been traditionally difficult to use.<br>In particular, large, possibly chunk-encoded, messages. The interface is<br>careful to never buffer entire requests or responses—the<br>user is able to stream data.</p>
<p>HTTP message headers are represented by an object like this:</p>
<pre><code>{ <span class="symbol">'content</span>-length': <span class="char">'123'</span>,
  <span class="symbol">'content</span>-type': <span class="symbol">'text</span>/plain',
  <span class="symbol">'connection'</span>: <span class="symbol">'keep</span>-alive',
  <span class="symbol">'host'</span>: <span class="symbol">'mysite</span>.com',
  <span class="symbol">'accept'</span>: <span class="char">'*/*'</span> }
</code></pre><p>Keys are lowercased. Values are not modified.</p>
<p>In order to support the full spectrum of possible HTTP applications, Node’s<br>HTTP API is very low-level. It deals with stream handling and message<br>parsing only. It parses a message into headers and body but it does not<br>parse the actual headers or the body.</p>
<p>Defined headers that allow multiple values are concatenated with a <code>,</code><br>character, except for the <code>set-cookie</code> and <code>cookie</code> headers which are<br>represented as an array of values.  Headers such as <code>content-length</code><br>which can only have a single value are parsed accordingly, and only a<br>single value is represented on the parsed object.</p>
<p>The raw headers as they were received are retained in the <code>rawHeaders</code><br>property, which is an array of <code>[key, value, key2, value2, ...]</code>.  For<br>example, the previous message header object might have a <code>rawHeaders</code><br>list like the following:</p>
<pre><code>[ 'ConTent-Length', '<span class="number">123456</span>',
  'content-LENGTH', '<span class="number">123</span>',
  'content-type', 'text/plain',
  'CONNECTION', 'keep-alive',
  'Host', 'mysite.com',
  'accepT', '*/*' ]
</code></pre><h2 id="http-METHODS">http.METHODS</h2><ul>
<li>{Array}</li>
</ul>
<p>A list of the HTTP methods that are supported by the parser.</p>
<h2 id="http-STATUS_CODES">http.STATUS_CODES</h2><ul>
<li>{Object}</li>
</ul>
<p>A collection of all the standard HTTP response status codes, and the<br>short description of each.  For example, <code>http.STATUS_CODES[404] === &#39;Not
Found&#39;</code>.</p>
<h2 id="http-createServer([requestListener])">http.createServer([requestListener])</h2><p>Returns a new instance of <a href="#http_class_http_server">http.Server</a>.</p>
<p>The <code>requestListener</code> is a function which is automatically<br>added to the <code>&#39;request&#39;</code> event.</p>
<h2 id="http-createClient([port][,_host])">http.createClient([port][, host])</h2><p>This function is <strong>deprecated</strong>; please use <a href="http.html#http_http_request_options_callback">http.request()</a> instead.<br>Constructs a new HTTP client. <code>port</code> and <code>host</code> refer to the server to be<br>connected to.</p>
<h2 id="Class:_http-Server">Class: http.Server</h2><p>This is an <a href="events.html#events_class_events_eventemitter">EventEmitter</a> with the following events:</p>
<h3 id="Event:_‘request’">Event: ‘request’</h3><p><code>function (request, response) { }</code></p>
<p>Emitted each time there is a request. Note that there may be multiple requests<br>per connection (in the case of keep-alive connections).<br> <code>request</code> is an instance of <a href="#http_http_incomingmessage">http.IncomingMessage</a> and <code>response</code> is<br>an instance of <a href="#http_class_http_serverresponse">http.ServerResponse</a>.</p>
<h3 id="Event:_‘connection’-1">Event: ‘connection’</h3><p><code>function (socket) { }</code></p>
<p>When a new TCP stream is established. <code>socket</code> is an object of type<br><code>net.Socket</code>. Usually users will not want to access this event. In<br>particular, the socket will not emit <code>readable</code> events because of how<br>the protocol parser attaches to the socket. The <code>socket</code> can also be<br>accessed at <code>request.connection</code>.</p>
<h3 id="Event:_‘close’-4">Event: ‘close’</h3><p><code>function () { }</code></p>
<p>Emitted when the server closes.</p>
<h3 id="Event:_‘checkContinue’">Event: ‘checkContinue’</h3><p><code>function (request, response) { }</code></p>
<p>Emitted each time a request with an http Expect: 100-continue is received.<br>If this event isn’t listened for, the server will automatically respond<br>with a 100 Continue as appropriate.</p>
<p>Handling this event involves calling <a href="#http_response_writecontinue">response.writeContinue()</a> if the client<br>should continue to send the request body, or generating an appropriate HTTP<br>response (e.g., 400 Bad Request) if the client should not continue to send the<br>request body.</p>
<p>Note that when this event is emitted and handled, the <code>request</code> event will<br>not be emitted.</p>
<h3 id="Event:_‘connect’-1">Event: ‘connect’</h3><p><code>function (request, socket, head) { }</code></p>
<p>Emitted each time a client requests a http CONNECT method. If this event isn’t<br>listened for, then clients requesting a CONNECT method will have their<br>connections closed.</p>
<ul>
<li><code>request</code> is the arguments for the http request, as it is in the request<br>event.</li>
<li><code>socket</code> is the network socket between the server and client.</li>
<li><code>head</code> is an instance of Buffer, the first packet of the tunneling stream,<br>this may be empty.</li>
</ul>
<p>After this event is emitted, the request’s socket will not have a <code>data</code><br>event listener, meaning you will need to bind to it in order to handle data<br>sent to the server on that socket.</p>
<h3 id="Event:_‘upgrade’">Event: ‘upgrade’</h3><p><code>function (request, socket, head) { }</code></p>
<p>Emitted each time a client requests a http upgrade. If this event isn’t<br>listened for, then clients requesting an upgrade will have their connections<br>closed.</p>
<ul>
<li><code>request</code> is the arguments for the http request, as it is in the request<br>event.</li>
<li><code>socket</code> is the network socket between the server and client.</li>
<li><code>head</code> is an instance of Buffer, the first packet of the upgraded stream,<br>this may be empty.</li>
</ul>
<p>After this event is emitted, the request’s socket will not have a <code>data</code><br>event listener, meaning you will need to bind to it in order to handle data<br>sent to the server on that socket.</p>
<h3 id="Event:_‘clientError’-1">Event: ‘clientError’</h3><p><code>function (exception, socket) { }</code></p>
<p>If a client connection emits an ‘error’ event, it will be forwarded here.</p>
<p><code>socket</code> is the <code>net.Socket</code> object that the error originated from.</p>
<h3 id="server-listen(port[,_hostname][,_backlog][,_callback])">server.listen(port[, hostname][, backlog][, callback])</h3><p>Begin accepting connections on the specified port and hostname.  If the<br>hostname is omitted, the server will accept connections directed to any<br>IPv4 address (<code>INADDR_ANY</code>).</p>
<p>To listen to a unix socket, supply a filename instead of port and hostname.</p>
<p>Backlog is the maximum length of the queue of pending connections.<br>The actual length will be determined by your OS through sysctl settings such as<br><code>tcp_max_syn_backlog</code> and <code>somaxconn</code> on linux. The default value of this<br>parameter is 511 (not 512).</p>
<p>This function is asynchronous. The last parameter <code>callback</code> will be added as<br>a listener for the <a href="net.html#net_event_listening">‘listening’</a> event.  See also <a href="net.html#net_server_listen_port_host_backlog_callback">net.Server.listen(port)</a>.</p>
<h3 id="server-listen(path[,_callback])-1">server.listen(path[, callback])</h3><p>Start a UNIX socket server listening for connections on the given <code>path</code>.</p>
<p>This function is asynchronous. The last parameter <code>callback</code> will be added as<br>a listener for the <a href="net.html#net_event_listening">‘listening’</a> event.  See also <a href="net.html#net_server_listen_path_callback">net.Server.listen(path)</a>.</p>
<h3 id="server-listen(handle[,_callback])-1">server.listen(handle[, callback])</h3><ul>
<li><code>handle</code> {Object}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>The <code>handle</code> object can be set to either a server or socket (anything<br>with an underlying <code>_handle</code> member), or a <code>{fd: &lt;n&gt;}</code> object.</p>
<p>This will cause the server to accept connections on the specified<br>handle, but it is presumed that the file descriptor or handle has<br>already been bound to a port or domain socket.</p>
<p>Listening on a file descriptor is not supported on Windows.</p>
<p>This function is asynchronous. The last parameter <code>callback</code> will be added as<br>a listener for the <a href="net.html#event_listening_">‘listening’</a> event.<br>See also <a href="net.html#net_server_listen_handle_callback">net.Server.listen()</a>.</p>
<h3 id="server-close([callback])-1">server.close([callback])</h3><p>Stops the server from accepting new connections.  See <a href="net.html#net_server_close_callback">net.Server.close()</a>.</p>
<h3 id="server-maxHeadersCount">server.maxHeadersCount</h3><p>Limits maximum incoming headers count, equal to 1000 by default. If set to 0 -<br>no limit will be applied.</p>
<h3 id="server-setTimeout(msecs,_callback)">server.setTimeout(msecs, callback)</h3><ul>
<li><code>msecs</code> {Number}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Sets the timeout value for sockets, and emits a <code>&#39;timeout&#39;</code> event on<br>the Server object, passing the socket as an argument, if a timeout<br>occurs.</p>
<p>If there is a <code>&#39;timeout&#39;</code> event listener on the Server object, then it<br>will be called with the timed-out socket as an argument.</p>
<p>By default, the Server’s timeout value is 2 minutes, and sockets are<br>destroyed automatically if they time out.  However, if you assign a<br>callback to the Server’s <code>&#39;timeout&#39;</code> event, then you are responsible<br>for handling socket timeouts.</p>
<h3 id="server-timeout">server.timeout</h3><ul>
<li>{Number} Default = 120000 (2 minutes)</li>
</ul>
<p>The number of milliseconds of inactivity before a socket is presumed<br>to have timed out.</p>
<p>Note that the socket timeout logic is set up on connection, so<br>changing this value only affects <em>new</em> connections to the server, not<br>any existing connections.</p>
<p>Set to 0 to disable any kind of automatic timeout behavior on incoming<br>connections.</p>
<h2 id="Class:_http-ServerResponse">Class: http.ServerResponse</h2><p>This object is created internally by a HTTP server—not by the user. It is<br>passed as the second parameter to the <code>&#39;request&#39;</code> event.</p>
<p>The response implements the <a href="stream.html#stream_class_stream_writable">Writable Stream</a> interface. This is an<br><a href="events.html#events_class_events_eventemitter">EventEmitter</a> with the following events:</p>
<h3 id="Event:_‘close’-5">Event: ‘close’</h3><p><code>function () { }</code></p>
<p>Indicates that the underlying connection was terminated before<br><a href="#http_response_end_data_encoding">response.end()</a> was called or able to flush.</p>
<h3 id="Event:_‘finish’-1">Event: ‘finish’</h3><p><code>function () { }</code></p>
<p>Emitted when the response has been sent. More specifically, this event is<br>emitted when the last segment of the response headers and body have been<br>handed off to the operating system for transmission over the network. It<br>does not imply that the client has received anything yet.</p>
<p>After this event, no more events will be emitted on the response object.</p>
<h3 id="response-writeContinue()">response.writeContinue()</h3><p>Sends a HTTP/1.1 100 Continue message to the client, indicating that<br>the request body should be sent. See the <a href="#http_event_checkcontinue">‘checkContinue’</a> event on <code>Server</code>.</p>
<h3 id="response-writeHead(statusCode[,_statusMessage][,_headers])">response.writeHead(statusCode[, statusMessage][, headers])</h3><p>Sends a response header to the request. The status code is a 3-digit HTTP<br>status code, like <code>404</code>. The last argument, <code>headers</code>, are the response headers.<br>Optionally one can give a human-readable <code>statusMessage</code> as the second<br>argument.</p>
<p>Example:</p>
<pre><code>var body = <span class="symbol">'hello</span> world';
response.writeHead(<span class="number">200</span>, {
  <span class="symbol">'Content</span>-<span class="type">Length'</span>: body.length,
  <span class="symbol">'Content</span>-<span class="type">Type'</span>: <span class="symbol">'text</span>/plain' });
</code></pre><p>This method must only be called once on a message and it must<br>be called before <a href="#http_response_end_data_encoding">response.end()</a> is called.</p>
<p>If you call <a href="#http_response_write_chunk_encoding">response.write()</a> or <a href="#http_response_end_data_encoding">response.end()</a> before calling this, the<br>implicit/mutable headers will be calculated and call this function for you.</p>
<p>Note that Content-Length is given in bytes not characters. The above example<br>works because the string <code>&#39;hello world&#39;</code> contains only single byte characters.<br>If the body contains higher coded characters then <code>Buffer.byteLength()</code><br>should be used to determine the number of bytes in a given encoding.<br>And Node does not check whether Content-Length and the length of the body<br>which has been transmitted are equal or not.</p>
<h3 id="response-setTimeout(msecs,_callback)">response.setTimeout(msecs, callback)</h3><ul>
<li><code>msecs</code> {Number}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Sets the Socket’s timeout value to <code>msecs</code>.  If a callback is<br>provided, then it is added as a listener on the <code>&#39;timeout&#39;</code> event on<br>the response object.</p>
<p>If no <code>&#39;timeout&#39;</code> listener is added to the request, the response, or<br>the server, then sockets are destroyed when they time out.  If you<br>assign a handler on the request, the response, or the server’s<br><code>&#39;timeout&#39;</code> events, then it is your responsibility to handle timed out<br>sockets.</p>
<h3 id="response-statusCode">response.statusCode</h3><p>When using implicit headers (not calling <a href="#http_response_writehead_statuscode_reasonphrase_headers">response.writeHead()</a> explicitly),<br>this property controls the status code that will be sent to the client when<br>the headers get flushed.</p>
<p>Example:</p>
<pre><code>response.statusCode = 404<span class="comment">;</span>
</code></pre><p>After response header was sent to the client, this property indicates the<br>status code which was sent out.</p>
<h3 id="response-statusMessage">response.statusMessage</h3><p>When using implicit headers (not calling <code>response.writeHead()</code> explicitly), this property<br>controls the status message that will be sent to the client when the headers get<br>flushed. If this is left as <code>undefined</code> then the standard message for the status<br>code will be used.</p>
<p>Example:</p>
<pre><code>response.statusMessage = <span class="symbol">'Not</span> found';
</code></pre><p>After response header was sent to the client, this property indicates the<br>status message which was sent out.</p>
<h3 id="response-setHeader(name,_value)">response.setHeader(name, value)</h3><p>Sets a single header value for implicit headers.  If this header already exists<br>in the to-be-sent headers, its value will be replaced.  Use an array of strings<br>here if you need to send multiple headers with the same name.</p>
<p>Example:</p>
<pre><code>response.setHeader<span class="params">(<span class="string">"Content-Type"</span>, <span class="string">"text/html"</span>)</span>;
</code></pre><p>or</p>
<pre><code>response.setHeader<span class="params">(<span class="string">"Set-Cookie"</span>, [<span class="string">"type=ninja"</span>, <span class="string">"language=javascript"</span>])</span>;
</code></pre><h3 id="response-headersSent">response.headersSent</h3><p>Boolean (read-only). True if headers were sent, false otherwise.</p>
<h3 id="response-sendDate">response.sendDate</h3><p>When true, the Date header will be automatically generated and sent in<br>the response if it is not already present in the headers. Defaults to true.</p>
<p>This should only be disabled for testing; HTTP requires the Date header<br>in responses.</p>
<h3 id="response-getHeader(name)">response.getHeader(name)</h3><p>Reads out a header that’s already been queued but not sent to the client.  Note<br>that the name is case insensitive.  This can only be called before headers get<br>implicitly flushed.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> contentType = response.getHeader(<span class="symbol">'content</span>-<span class="class"><span class="keyword">type</span>');</span>
</code></pre><h3 id="response-removeHeader(name)">response.removeHeader(name)</h3><p>Removes a header that’s queued for implicit sending.</p>
<p>Example:</p>
<pre><code>response.removeHeader<span class="params">(<span class="string">"Content-Encoding"</span>)</span>;
</code></pre><h3 id="response-write(chunk[,_encoding][,_callback])">response.write(chunk[, encoding][, callback])</h3><p>If this method is called and <a href="#http_response_writehead_statuscode_reasonphrase_headers">response.writeHead()</a> has not been called,<br>it will switch to implicit header mode and flush the implicit headers.</p>
<p>This sends a chunk of the response body. This method may<br>be called multiple times to provide successive parts of the body.</p>
<p><code>chunk</code> can be a string or a buffer. If <code>chunk</code> is a string,<br>the second parameter specifies how to encode it into a byte stream.<br>By default the <code>encoding</code> is <code>&#39;utf8&#39;</code>. The last parameter <code>callback</code><br>will be called when this chunk of data is flushed.</p>
<p><strong>Note</strong>: This is the raw HTTP body and has nothing to do with<br>higher-level multi-part body encodings that may be used.</p>
<p>The first time <code>response.write()</code> is called, it will send the buffered<br>header information and the first body to the client. The second time<br><code>response.write()</code> is called, Node assumes you’re going to be streaming<br>data, and sends that separately. That is, the response is buffered up to the<br>first chunk of body.</p>
<p>Returns <code>true</code> if the entire data was flushed successfully to the kernel<br>buffer. Returns <code>false</code> if all or part of the data was queued in user memory.<br><code>&#39;drain&#39;</code> will be emitted when the buffer is free again.</p>
<h3 id="response-addTrailers(headers)">response.addTrailers(headers)</h3><p>This method adds HTTP trailing headers (a header but at the end of the<br>message) to the response.</p>
<p>Trailers will <strong>only</strong> be emitted if chunked encoding is used for the<br>response; if it is not (e.g., if the request was HTTP/1.0), they will<br>be silently discarded.</p>
<p>Note that HTTP requires the <code>Trailer</code> header to be sent if you intend to<br>emit trailers, with a list of the header fields in its value. E.g.,</p>
<pre><code>response.writeHead(<span class="number">200</span>, { <span class="symbol">'Content</span>-<span class="type">Type'</span>: <span class="symbol">'text</span>/plain',
                          <span class="symbol">'Trailer'</span>: <span class="symbol">'Content</span>-<span class="type">MD5'</span> });
response.write(fileData);
response.addTrailers({<span class="symbol">'Content</span>-<span class="type">MD5'</span>: <span class="string">"7895bf4b8828b55ceaf47747b4bca667"</span>});
response.<span class="keyword">end</span><span class="literal">()</span>;
</code></pre><h3 id="response-end([data][,_encoding][,_callback])">response.end([data][, encoding][, callback])</h3><p>This method signals to the server that all of the response headers and body<br>have been sent; that server should consider this message complete.<br>The method, <code>response.end()</code>, MUST be called on each<br>response.</p>
<p>If <code>data</code> is specified, it is equivalent to calling<br><code>response.write(data, encoding)</code> followed by <code>response.end(callback)</code>.</p>
<p>If <code>callback</code> is specified, it will be called when the response stream<br>is finished.</p>
<h2 id="http-request(options[,_callback])">http.request(options[, callback])</h2><p>Node maintains several connections per server to make HTTP requests.<br>This function allows one to transparently issue requests.</p>
<p><code>options</code> can be an object or a string. If <code>options</code> is a string, it is<br>automatically parsed with <a href="url.html#url_url_parse_urlstr_parsequerystring_slashesdenotehost">url.parse()</a>.</p>
<p>Options:</p>
<ul>
<li><code>host</code>: A domain name or IP address of the server to issue the request to.<br>Defaults to <code>&#39;localhost&#39;</code>.</li>
<li><code>hostname</code>: To support <code>url.parse()</code> <code>hostname</code> is preferred over <code>host</code></li>
<li><code>port</code>: Port of remote server. Defaults to 80.</li>
<li><code>localAddress</code>: Local interface to bind for network connections.</li>
<li><code>socketPath</code>: Unix Domain Socket (use one of host:port or socketPath)</li>
<li><code>method</code>: A string specifying the HTTP request method. Defaults to <code>&#39;GET&#39;</code>.</li>
<li><code>path</code>: Request path. Defaults to <code>&#39;/&#39;</code>. Should include query string if any.<br>E.G. <code>&#39;/index.html?page=12&#39;</code>. An exception is thrown when the request path<br>contains illegal characters. Currently, only spaces are rejected but that<br>may change in the future.</li>
<li><code>headers</code>: An object containing request headers.</li>
<li><code>auth</code>: Basic authentication i.e. <code>&#39;user:password&#39;</code> to compute an<br>Authorization header.</li>
<li><code>agent</code>: Controls <a href="#https_class_https_agent">Agent</a> behavior. When an Agent is used request will<br>default to <code>Connection: keep-alive</code>. Possible values:<ul>
<li><code>undefined</code> (default): use <a href="#http_http_globalagent">global Agent</a> for this host and port.</li>
<li><code>Agent</code> object: explicitly use the passed in <code>Agent</code>.</li>
<li><code>false</code>: opts out of connection pooling with an Agent, defaults request to<br><code>Connection: close</code>.</li>
</ul>
</li>
<li><code>keepAlive</code>: {Boolean} Keep sockets around in a pool to be used<br>by other requests in the future. Default = <code>false</code></li>
<li><code>keepAliveMsecs</code>: {Integer} When using HTTP KeepAlive, how often to<br>send TCP KeepAlive packets over sockets being kept alive.  Default =<br><code>1000</code>.  Only relevant if <code>keepAlive</code> is set to <code>true</code>.</li>
</ul>
<p>The optional <code>callback</code> parameter will be added as a one time listener for<br>the <a href="#http_event_response">‘response’</a> event.</p>
<p><code>http.request()</code> returns an instance of the <a href="#http_class_http_clientrequest">http.ClientRequest</a><br>class. The <code>ClientRequest</code> instance is a writable stream. If one needs to<br>upload a file with a POST request, then write to the <code>ClientRequest</code> object.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> postData = querystring.stringify({
  <span class="string">'msg'</span> : <span class="string">'Hello World!'</span>
});

<span class="keyword">var</span> options = {
  hostname: <span class="string">'www.google.com'</span>,
  port: <span class="number">80</span>,
  path: <span class="string">'/upload'</span>,
  method: <span class="string">'POST'</span>,
  headers: {
    <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,
    <span class="string">'Content-Length'</span>: postData.length
  }
};

<span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'STATUS: '</span> + res.statusCode);
  <span class="built_in">console</span>.log(<span class="string">'HEADERS: '</span> + <span class="built_in">JSON</span>.stringify(res.headers));
  res.setEncoding(<span class="string">'utf8'</span>);
  res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);
  });
});

req.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'problem with request: '</span> + e.message);
});

<span class="comment">// write data to request body</span>
req.write(postData);
req.end();
</code></pre><p>Note that in the example <code>req.end()</code> was called. With <code>http.request()</code> one<br>must always call <code>req.end()</code> to signify that you’re done with the request -<br>even if there is no data being written to the request body.</p>
<p>If any error is encountered during the request (be that with DNS resolution,<br>TCP level errors, or actual HTTP parse errors) an <code>&#39;error&#39;</code> event is emitted<br>on the returned request object.</p>
<p>There are a few special headers that should be noted.</p>
<ul>
<li><p>Sending a ‘Connection: keep-alive’ will notify Node that the connection to<br>the server should be persisted until the next request.</p>
</li>
<li><p>Sending a ‘Content-length’ header will disable the default chunked encoding.</p>
</li>
<li><p>Sending an ‘Expect’ header will immediately send the request headers.<br>Usually, when sending ‘Expect: 100-continue’, you should both set a timeout<br>and listen for the <code>continue</code> event. See RFC2616 Section 8.2.3 for more<br>information.</p>
</li>
<li><p>Sending an Authorization header will override using the <code>auth</code> option<br>to compute basic authentication.</p>
</li>
</ul>
<h2 id="http-get(options[,_callback])">http.get(options[, callback])</h2><p>Since most requests are GET requests without bodies, Node provides this<br>convenience method. The only difference between this method and <code>http.request()</code><br>is that it sets the method to GET and calls <code>req.end()</code> automatically.</p>
<p>Example:</p>
<pre><code>http.<span class="built_in">get</span>(<span class="string">"http://www.google.com/index.html"</span>, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">"Got response: "</span> + <span class="keyword">res</span>.statusCode);
}).<span class="keyword">on</span>(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">"Got error: "</span> + <span class="keyword">e</span>.message);
});
</code></pre><h2 id="Class:_http-Agent">Class: http.Agent</h2><p>The HTTP Agent is used for pooling sockets used in HTTP client<br>requests.</p>
<p>The HTTP Agent also defaults client requests to using<br>Connection:keep-alive. If no pending HTTP requests are waiting on a<br>socket to become free the socket is closed. This means that Node’s<br>pool has the benefit of keep-alive when under load but still does not<br>require developers to manually close the HTTP clients using<br>KeepAlive.</p>
<p>If you opt into using HTTP KeepAlive, you can create an Agent object<br>with that flag set to <code>true</code>.  (See the <a href="#http_new_agent_options">constructor<br>options</a> below.)  Then, the Agent will keep<br>unused sockets in a pool for later use.  They will be explicitly<br>marked so as to not keep the Node process running.  However, it is<br>still a good idea to explicitly <a href="#http_agent_destroy"><code>destroy()</code></a><br>KeepAlive agents when they are no longer in use, so that the Sockets<br>will be shut down.</p>
<p>Sockets are removed from the agent’s pool when the socket emits either<br>a “close” event or a special “agentRemove” event. This means that if<br>you intend to keep one HTTP request open for a long time and don’t<br>want it to stay in the pool you can do something along the lines of:</p>
<pre><code>http.<span class="keyword">get</span>(options, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>{
  <span class="comment">// Do stuff</span>
}).on(<span class="string">"socket"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(socket)</span> </span>{
  socket.emit(<span class="string">"agentRemove"</span>);
});
</code></pre><p>Alternatively, you could just opt out of pooling entirely using<br><code>agent:false</code>:</p>
<pre><code>http.<span class="keyword">get</span>({
  hostname: <span class="string">'localhost'</span>,
  port: <span class="number">80</span>,
  path: <span class="string">'/'</span>,
  agent: <span class="literal">false</span>  <span class="comment">// create a new agent just for this one request</span>
}, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span> </span>{
  <span class="comment">// Do stuff with response</span>
})
</code></pre><h3 id="new_Agent([options])">new Agent([options])</h3><ul>
<li><code>options</code> {Object} Set of configurable options to set on the agent.<br>Can have the following fields:<ul>
<li><code>keepAlive</code> {Boolean} Keep sockets around in a pool to be used by<br>other requests in the future. Default = <code>false</code></li>
<li><code>keepAliveMsecs</code> {Integer} When using HTTP KeepAlive, how often<br>to send TCP KeepAlive packets over sockets being kept alive.<br>Default = <code>1000</code>.  Only relevant if <code>keepAlive</code> is set to <code>true</code>.</li>
<li><code>maxSockets</code> {Number} Maximum number of sockets to allow per<br>host.  Default = <code>Infinity</code>.</li>
<li><code>maxFreeSockets</code> {Number} Maximum number of sockets to leave open<br>in a free state.  Only relevant if <code>keepAlive</code> is set to <code>true</code>.<br>Default = <code>256</code>.</li>
</ul>
</li>
</ul>
<p>The default <code>http.globalAgent</code> that is used by <code>http.request</code> has all<br>of these values set to their respective defaults.</p>
<p>To configure any of them, you must create your own <code>Agent</code> object.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> keepAliveAgent = <span class="keyword">new</span> http.Agent(&#123; keepAlive: <span class="literal">true</span> &#125;);</span><br><span class="line">options.agent = keepAliveAgent;</span><br><span class="line">http.request(options, onResponseCallback);</span><br></pre></td></tr></table></figure>
<h3 id="agent-maxSockets">agent.maxSockets</h3><p>By default set to Infinity. Determines how many concurrent sockets the agent<br>can have open per origin. Origin is either a ‘host:port’ or<br>‘host:port:localAddress’ combination.</p>
<h3 id="agent-maxFreeSockets">agent.maxFreeSockets</h3><p>By default set to 256.  For Agents supporting HTTP KeepAlive, this<br>sets the maximum number of sockets that will be left open in the free<br>state.</p>
<h3 id="agent-sockets">agent.sockets</h3><p>An object which contains arrays of sockets currently in use by the<br>Agent.  Do not modify.</p>
<h3 id="agent-freeSockets">agent.freeSockets</h3><p>An object which contains arrays of sockets currently awaiting use by<br>the Agent when HTTP KeepAlive is used.  Do not modify.</p>
<h3 id="agent-requests">agent.requests</h3><p>An object which contains queues of requests that have not yet been assigned to<br>sockets. Do not modify.</p>
<h3 id="agent-destroy()">agent.destroy()</h3><p>Destroy any sockets that are currently in use by the agent.</p>
<p>It is usually not necessary to do this.  However, if you are using an<br>agent with KeepAlive enabled, then it is best to explicitly shut down<br>the agent when you know that it will no longer be used.  Otherwise,<br>sockets may hang open for quite a long time before the server<br>terminates them.</p>
<h3 id="agent-getName(options)">agent.getName(options)</h3><p>Get a unique name for a set of request options, to determine whether a<br>connection can be reused.  In the http agent, this returns<br><code>host:port:localAddress</code>.  In the https agent, the name includes the<br>CA, cert, ciphers, and other HTTPS/TLS-specific options that determine<br>socket reusability.</p>
<h2 id="http-globalAgent">http.globalAgent</h2><p>Global instance of Agent which is used as the default for all http client<br>requests.</p>
<h2 id="Class:_http-ClientRequest">Class: http.ClientRequest</h2><p>This object is created internally and returned from <code>http.request()</code>.  It<br>represents an <em>in-progress</em> request whose header has already been queued.  The<br>header is still mutable using the <code>setHeader(name, value)</code>, <code>getHeader(name)</code>,<br><code>removeHeader(name)</code> API.  The actual header will be sent along with the first<br>data chunk or when closing the connection.</p>
<p>To get the response, add a listener for <code>&#39;response&#39;</code> to the request object.<br><code>&#39;response&#39;</code> will be emitted from the request object when the response<br>headers have been received.  The <code>&#39;response&#39;</code> event is executed with one<br>argument which is an instance of <a href="#http_http_incomingmessage">http.IncomingMessage</a>.</p>
<p>During the <code>&#39;response&#39;</code> event, one can add listeners to the<br>response object; particularly to listen for the <code>&#39;data&#39;</code> event.</p>
<p>If no <code>&#39;response&#39;</code> handler is added, then the response will be<br>entirely discarded.  However, if you add a <code>&#39;response&#39;</code> event handler,<br>then you <strong>must</strong> consume the data from the response object, either by<br>calling <code>response.read()</code> whenever there is a <code>&#39;readable&#39;</code> event, or<br>by adding a <code>&#39;data&#39;</code> handler, or by calling the <code>.resume()</code> method.<br>Until the data is consumed, the <code>&#39;end&#39;</code> event will not fire.  Also, until<br>the data is read it will consume memory that can eventually lead to a<br>‘process out of memory’ error.</p>
<p>Note: Node does not check whether Content-Length and the length of the body<br>which has been transmitted are equal or not.</p>
<p>The request implements the <a href="stream.html#stream_class_stream_writable">Writable Stream</a> interface. This is an<br><a href="events.html#events_class_events_eventemitter">EventEmitter</a> with the following events:</p>
<h3 id="Event:_‘response’">Event: ‘response’</h3><p><code>function (response) { }</code></p>
<p>Emitted when a response is received to this request. This event is emitted only<br>once. The <code>response</code> argument will be an instance of <a href="#http_http_incomingmessage">http.IncomingMessage</a>.</p>
<p>Options:</p>
<ul>
<li><code>host</code>: A domain name or IP address of the server to issue the request to.</li>
<li><code>port</code>: Port of remote server.</li>
<li><code>socketPath</code>: Unix Domain Socket (use one of host:port or socketPath)</li>
</ul>
<h3 id="Event:_‘socket’">Event: ‘socket’</h3><p><code>function (socket) { }</code></p>
<p>Emitted after a socket is assigned to this request.</p>
<h3 id="Event:_‘connect’-2">Event: ‘connect’</h3><p><code>function (response, socket, head) { }</code></p>
<p>Emitted each time a server responds to a request with a CONNECT method. If this<br>event isn’t being listened for, clients receiving a CONNECT method will have<br>their connections closed.</p>
<p>A client server pair that show you how to listen for the <code>connect</code> event.</p>
<pre><code><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);
<span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);

<span class="comment">// Create an HTTP tunneling proxy</span>
<span class="keyword">var</span> proxy = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'okay'</span>);
});
proxy.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, cltSocket, head</span>) </span>{
  <span class="comment">// connect to an origin server</span>
  <span class="keyword">var</span> srvUrl = url.parse(<span class="string">'http://'</span> + req.url);
  <span class="keyword">var</span> srvSocket = net.connect(srvUrl.port, srvUrl.hostname, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    cltSocket.write(<span class="string">'HTTP/1.1 200 Connection Established\r\n'</span> +
                    <span class="string">'Proxy-agent: Node-Proxy\r\n'</span> +
                    <span class="string">'\r\n'</span>);
    srvSocket.write(head);
    srvSocket.pipe(cltSocket);
    cltSocket.pipe(srvSocket);
  });
});

<span class="comment">// now that proxy is running</span>
proxy.listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{

  <span class="comment">// make a request to a tunneling proxy</span>
  <span class="keyword">var</span> options = {
    port: <span class="number">1337</span>,
    hostname: <span class="string">'127.0.0.1'</span>,
    method: <span class="string">'CONNECT'</span>,
    path: <span class="string">'www.google.com:80'</span>
  };

  <span class="keyword">var</span> req = http.request(options);
  req.end();

  req.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res, socket, head</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'got connected!'</span>);

    <span class="comment">// make a request over an HTTP tunnel</span>
    socket.write(<span class="string">'GET / HTTP/1.1\r\n'</span> +
                 <span class="string">'Host: www.google.com:80\r\n'</span> +
                 <span class="string">'Connection: close\r\n'</span> +
                 <span class="string">'\r\n'</span>);
    socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>{
      <span class="built_in">console</span>.log(chunk.toString());
    });
    socket.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      proxy.close();
    });
  });
});
</code></pre><h3 id="Event:_‘upgrade’-1">Event: ‘upgrade’</h3><p><code>function (response, socket, head) { }</code></p>
<p>Emitted each time a server responds to a request with an upgrade. If this<br>event isn’t being listened for, clients receiving an upgrade header will have<br>their connections closed.</p>
<p>A client server pair that show you how to listen for the <code>upgrade</code> event.</p>
<pre><code><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="comment">// Create an HTTP server</span>
<span class="keyword">var</span> srv = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'okay'</span>);
});
srv.on(<span class="string">'upgrade'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, socket, head</span>) </span>{
  socket.write(<span class="string">'HTTP/1.1 101 Web Socket Protocol Handshake\r\n'</span> +
               <span class="string">'Upgrade: WebSocket\r\n'</span> +
               <span class="string">'Connection: Upgrade\r\n'</span> +
               <span class="string">'\r\n'</span>);

  socket.pipe(socket); <span class="comment">// echo back</span>
});

<span class="comment">// now that server is running</span>
srv.listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{

  <span class="comment">// make a request</span>
  <span class="keyword">var</span> options = {
    port: <span class="number">1337</span>,
    hostname: <span class="string">'127.0.0.1'</span>,
    headers: {
      <span class="string">'Connection'</span>: <span class="string">'Upgrade'</span>,
      <span class="string">'Upgrade'</span>: <span class="string">'websocket'</span>
    }
  };

  <span class="keyword">var</span> req = http.request(options);
  req.end();

  req.on(<span class="string">'upgrade'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res, socket, upgradeHead</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'got upgraded!'</span>);
    socket.end();
    process.exit(<span class="number">0</span>);
  });
});
</code></pre><h3 id="Event:_‘continue’">Event: ‘continue’</h3><p><code>function () { }</code></p>
<p>Emitted when the server sends a ‘100 Continue’ HTTP response, usually because<br>the request contained ‘Expect: 100-continue’. This is an instruction that<br>the client should send the request body.</p>
<h3 id="request-flushHeaders()">request.flushHeaders()</h3><p>Flush the request headers.</p>
<p>For efficiency reasons, node.js normally buffers the request headers until you<br>call <code>request.end()</code> or write the first chunk of request data.  It then tries<br>hard to pack the request headers and data into a single TCP packet.</p>
<p>That’s usually what you want (it saves a TCP round-trip) but not when the first<br>data isn’t sent until possibly much later.  <code>request.flush()</code> lets you bypass<br>the optimization and kickstart the request.</p>
<h3 id="request-write(chunk[,_encoding][,_callback])">request.write(chunk[, encoding][, callback])</h3><p>Sends a chunk of the body.  By calling this method<br>many times, the user can stream a request body to a<br>server—in that case it is suggested to use the<br><code>[&#39;Transfer-Encoding&#39;, &#39;chunked&#39;]</code> header line when<br>creating the request.</p>
<p>The <code>chunk</code> argument should be a <a href="buffer.html#buffer_buffer">Buffer</a> or a string.</p>
<p>The <code>encoding</code> argument is optional and only applies when <code>chunk</code> is a string.<br>Defaults to <code>&#39;utf8&#39;</code>.</p>
<p>The <code>callback</code> argument is optional and will be called when this chunk of data<br>is flushed.</p>
<h3 id="request-end([data][,_encoding][,_callback])">request.end([data][, encoding][, callback])</h3><p>Finishes sending the request. If any parts of the body are<br>unsent, it will flush them to the stream. If the request is<br>chunked, this will send the terminating <code>&#39;0\r\n\r\n&#39;</code>.</p>
<p>If <code>data</code> is specified, it is equivalent to calling<br><code>request.write(data, encoding)</code> followed by <code>request.end(callback)</code>.</p>
<p>If <code>callback</code> is specified, it will be called when the request stream<br>is finished.</p>
<h3 id="request-abort()">request.abort()</h3><p>Aborts a request.  (New since v0.3.8.)</p>
<h3 id="request-setTimeout(timeout[,_callback])">request.setTimeout(timeout[, callback])</h3><p>Once a socket is assigned to this request and is connected<br><a href="net.html#net_socket_settimeout_timeout_callback">socket.setTimeout()</a> will be called.</p>
<h3 id="request-setNoDelay([noDelay])">request.setNoDelay([noDelay])</h3><p>Once a socket is assigned to this request and is connected<br><a href="net.html#net_socket_setnodelay_nodelay">socket.setNoDelay()</a> will be called.</p>
<h3 id="request-setSocketKeepAlive([enable][,_initialDelay])">request.setSocketKeepAlive([enable][, initialDelay])</h3><p>Once a socket is assigned to this request and is connected<br><a href="net.html#net_socket_setkeepalive_enable_initialdelay">socket.setKeepAlive()</a> will be called.</p>
<h2 id="http-IncomingMessage">http.IncomingMessage</h2><p>An <code>IncomingMessage</code> object is created by <a href="#http_class_http_server">http.Server</a> or<br><a href="#http_class_http_clientrequest">http.ClientRequest</a> and passed as the first argument to the <code>&#39;request&#39;</code><br>and <code>&#39;response&#39;</code> event respectively. It may be used to access response status,<br>headers and data.</p>
<p>It implements the <a href="stream.html#stream_class_stream_readable">Readable Stream</a> interface, as well as the<br>following additional events, methods, and properties.</p>
<h3 id="Event:_‘close’-6">Event: ‘close’</h3><p><code>function () { }</code></p>
<p>Indicates that the underlying connection was closed.<br>Just like <code>&#39;end&#39;</code>, this event occurs only once per response.</p>
<h3 id="message-httpVersion">message.httpVersion</h3><p>In case of server request, the HTTP version sent by the client. In the case of<br>client response, the HTTP version of the connected-to server.<br>Probably either <code>&#39;1.1&#39;</code> or <code>&#39;1.0&#39;</code>.</p>
<p>Also <code>response.httpVersionMajor</code> is the first integer and<br><code>response.httpVersionMinor</code> is the second.</p>
<h3 id="message-headers">message.headers</h3><p>The request/response headers object.</p>
<p>Read only map of header names and values. Header names are lower-cased.<br>Example:</p>
<pre><code><span class="comment">// Prints something like:</span>
<span class="comment">//</span>
<span class="comment">// { 'user-agent': 'curl/7.22.0',</span>
<span class="comment">//   host: '127.0.0.1:8000',</span>
<span class="comment">//   accept: '*/*' }</span>
console.<span class="built_in">log</span><span class="params">(request.headers)</span>;
</code></pre><h3 id="message-rawHeaders">message.rawHeaders</h3><p>The raw request/response headers list exactly as they were received.</p>
<p>Note that the keys and values are in the same list.  It is <em>not</em> a<br>list of tuples.  So, the even-numbered offsets are key values, and the<br>odd-numbered offsets are the associated values.</p>
<p>Header names are not lowercased, and duplicates are not merged.</p>
<pre><code><span class="comment">// Prints something like:</span>
<span class="comment">//</span>
<span class="comment">// [ 'user-agent',</span>
<span class="comment">//   'this is invalid because there can be only one',</span>
<span class="comment">//   'User-Agent',</span>
<span class="comment">//   'curl/7.22.0',</span>
<span class="comment">//   'Host',</span>
<span class="comment">//   '127.0.0.1:8000',</span>
<span class="comment">//   'ACCEPT',</span>
<span class="comment">//   '*/*' ]</span>
console.<span class="built_in">log</span><span class="params">(request.rawHeaders)</span>;
</code></pre><h3 id="message-trailers">message.trailers</h3><p>The request/response trailers object. Only populated at the ‘end’ event.</p>
<h3 id="message-rawTrailers">message.rawTrailers</h3><p>The raw request/response trailer keys and values exactly as they were<br>received.  Only populated at the ‘end’ event.</p>
<h3 id="message-setTimeout(msecs,_callback)">message.setTimeout(msecs, callback)</h3><ul>
<li><code>msecs</code> {Number}</li>
<li><code>callback</code> {Function}</li>
</ul>
<p>Calls <code>message.connection.setTimeout(msecs, callback)</code>.</p>
<h3 id="message-method">message.method</h3><p><strong>Only valid for request obtained from <a href="#http_class_http_server">http.Server</a>.</strong></p>
<p>The request method as a string. Read only. Example:<br><code>&#39;GET&#39;</code>, <code>&#39;DELETE&#39;</code>.</p>
<h3 id="message-url">message.url</h3><p><strong>Only valid for request obtained from <a href="#http_class_http_server">http.Server</a>.</strong></p>
<p>Request URL string. This contains only the URL that is<br>present in the actual HTTP request. If the request is:</p>
<pre><code>GET /status?name=ryan HTTP/1.1<span class="command">\r</span><span class="command">\n</span>
Accept: text/plain<span class="command">\r</span><span class="command">\n</span>
<span class="command">\r</span><span class="command">\n</span>
</code></pre><p>Then <code>request.url</code> will be:</p>
<pre><code><span class="string">'/status?name=ryan'</span>
</code></pre><p>If you would like to parse the URL into its parts, you can use<br><code>require(&#39;url&#39;).parse(request.url)</code>.  Example:</p>
<pre><code><span class="tag">node</span>&gt; <span class="tag">require</span>(<span class="string">'url'</span>)<span class="class">.parse</span>(<span class="string">'/status?name=ryan'</span>)
{ <span class="attribute">href</span>: <span class="string">'/status?name=ryan'</span>,
  <span class="attribute">search</span>: <span class="string">'?name=ryan'</span>,
  <span class="attribute">query</span>: <span class="string">'name=ryan'</span>,
  <span class="attribute">pathname</span>: <span class="string">'/status'</span> }
</code></pre><p>If you would like to extract the params from the query string,<br>you can use the <code>require(&#39;querystring&#39;).parse</code> function, or pass<br><code>true</code> as the second argument to <code>require(&#39;url&#39;).parse</code>.  Example:</p>
<pre><code>node&gt; require(<span class="string">'url'</span>).parse(<span class="string">'/status?name=ryan'</span>, <span class="literal">true</span>)
{ <span class="string">href:</span> <span class="string">'/status?name=ryan'</span>,
<span class="label">  search:</span> <span class="string">'?name=ryan'</span>,
<span class="label">  query:</span> { <span class="string">name:</span> <span class="string">'ryan'</span> },
<span class="label">  pathname:</span> <span class="string">'/status'</span> }
</code></pre><h3 id="message-statusCode">message.statusCode</h3><p><strong>Only valid for response obtained from <code>http.ClientRequest</code>.</strong></p>
<p>The 3-digit HTTP response status code. E.G. <code>404</code>.</p>
<h3 id="message-statusMessage">message.statusMessage</h3><p><strong>Only valid for response obtained from <code>http.ClientRequest</code>.</strong></p>
<p>The HTTP response status message (reason phrase). E.G. <code>OK</code> or <code>Internal Server Error</code>.</p>
<h3 id="message-socket">message.socket</h3><p>The <code>net.Socket</code> object associated with the connection.</p>
<p>With HTTPS support, use request.connection.verifyPeer() and<br>request.connection.getPeerCertificate() to obtain the client’s<br>authentication details.</p>
<h1 id="HTTPS"><a id="https"> HTTPS</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>HTTPS is the HTTP protocol over TLS/SSL. In Node this is implemented as a<br>separate module.</p>
<h2 id="Class:_https-Server">Class: https.Server</h2><p>This class is a subclass of <code>tls.Server</code> and emits events same as<br><code>http.Server</code>. See <code>http.Server</code> for more information.</p>
<h3 id="server-setTimeout(msecs,_callback)-1">server.setTimeout(msecs, callback)</h3><p>See <a href="http.html#http_server_settimeout_msecs_callback">http.Server#setTimeout()</a>.</p>
<h3 id="server-timeout-1">server.timeout</h3><p>See <a href="http.html#http_server_timeout">http.Server#timeout</a>.</p>
<h2 id="https-createServer(options[,_requestListener])">https.createServer(options[, requestListener])</h2><p>Returns a new HTTPS web server object. The <code>options</code> is similar to<br><a href="tls.html#tls_tls_createserver_options_secureconnectionlistener">tls.createServer()</a>.  The <code>requestListener</code> is a function which is<br>automatically added to the <code>&#39;request&#39;</code> event.</p>
<p>Example:</p>
<pre><code><span class="comment">// curl -k https://localhost:8000/</span>
<span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  key: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-key.pem'</span>),
  cert: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-cert.pem'</span>)
};

https.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
  res.writeHead(<span class="number">200</span>);
  res.end(<span class="string">"hello world\n"</span>);
}).listen(<span class="number">8000</span>);
</code></pre><p>Or</p>
<pre><code><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">var</span> options = {
  pfx: fs.readFileSync(<span class="string">'server.pfx'</span>)
};

https.createServer(options, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
  res.writeHead(<span class="number">200</span>);
  res.end(<span class="string">"hello world\n"</span>);
}).listen(<span class="number">8000</span>);
</code></pre><h3 id="server-listen(port[,_host][,_backlog][,_callback])-1">server.listen(port[, host][, backlog][, callback])</h3><h3 id="server-listen(path[,_callback])-2">server.listen(path[, callback])</h3><h3 id="server-listen(handle[,_callback])-2">server.listen(handle[, callback])</h3><p>See <a href="http.html#http_server_listen_port_hostname_backlog_callback">http.listen()</a> for details.</p>
<h3 id="server-close([callback])-2">server.close([callback])</h3><p>See <a href="http.html#http_server_close_callback">http.close()</a> for details.</p>
<h2 id="https-request(options,_callback)">https.request(options, callback)</h2><p>Makes a request to a secure web server.</p>
<p><code>options</code> can be an object or a string. If <code>options</code> is a string, it is<br>automatically parsed with <a href="url.html#url.parse">url.parse()</a>.</p>
<p>All options from <a href="http.html#http_http_request_options_callback">http.request()</a> are valid.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);

<span class="keyword">var</span> options = {
  hostname: <span class="string">'encrypted.google.com'</span>,
  port: <span class="number">443</span>,
  path: <span class="string">'/'</span>,
  method: <span class="string">'GET'</span>
};

<span class="keyword">var</span> req = https.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">"statusCode: "</span>, res.statusCode);
  <span class="built_in">console</span>.log(<span class="string">"headers: "</span>, res.headers);

  res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>{
    process.stdout.write(d);
  });
});
req.end();

req.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>{
  <span class="built_in">console</span>.error(e);
});
</code></pre><p>The options argument has the following options</p>
<ul>
<li><code>host</code>: A domain name or IP address of the server to issue the request to.<br>Defaults to <code>&#39;localhost&#39;</code>.</li>
<li><code>hostname</code>: To support <code>url.parse()</code> <code>hostname</code> is preferred over <code>host</code></li>
<li><code>port</code>: Port of remote server. Defaults to 443.</li>
<li><code>method</code>: A string specifying the HTTP request method. Defaults to <code>&#39;GET&#39;</code>.</li>
<li><code>path</code>: Request path. Defaults to <code>&#39;/&#39;</code>. Should include query string if any.<br>E.G. <code>&#39;/index.html?page=12&#39;</code></li>
<li><code>headers</code>: An object containing request headers.</li>
<li><code>auth</code>: Basic authentication i.e. <code>&#39;user:password&#39;</code> to compute an<br>Authorization header.</li>
<li><code>agent</code>: Controls <a href="#https_class_https_agent">Agent</a> behavior. When an Agent is used request will<br>default to <code>Connection: keep-alive</code>. Possible values:<ul>
<li><code>undefined</code> (default): use <a href="#https_https_globalagent">globalAgent</a> for this host and port.</li>
<li><code>Agent</code> object: explicitly use the passed in <code>Agent</code>.</li>
<li><code>false</code>: opts out of connection pooling with an Agent, defaults request to<br><code>Connection: close</code>.</li>
</ul>
</li>
</ul>
<p>The following options from <a href="tls.html#tls_tls_connect_options_callback">tls.connect()</a> can also be specified. However, a<br><a href="#https_https_globalagent">globalAgent</a> silently ignores these.</p>
<ul>
<li><code>pfx</code>: Certificate, Private key and CA certificates to use for SSL. Default <code>null</code>.</li>
<li><code>key</code>: Private key to use for SSL. Default <code>null</code>.</li>
<li><code>passphrase</code>: A string of passphrase for the private key or pfx. Default <code>null</code>.</li>
<li><code>cert</code>: Public x509 certificate to use. Default <code>null</code>.</li>
<li><code>ca</code>: An authority certificate or array of authority certificates to check<br>the remote host against.</li>
<li><code>ciphers</code>: A string describing the ciphers to use or exclude. Consult<br><a href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT" target="_blank" rel="external">http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT</a> for<br>details on the format.</li>
<li><code>rejectUnauthorized</code>: If <code>true</code>, the server certificate is verified against<br>the list of supplied CAs. An <code>&#39;error&#39;</code> event is emitted if verification<br>fails. Verification happens at the connection level, <em>before</em> the HTTP<br>request is sent. Default <code>true</code>.</li>
<li><code>secureProtocol</code>: The SSL method to use, e.g. <code>TLSv1_method</code> to force<br>TLS version 1. The possible values depend on your installation of<br>OpenSSL and are defined in the constant <a href="http://www.openssl.org/docs/ssl/ssl.html#DEALING_WITH_PROTOCOL_METHODS" target="_blank" rel="external">SSL_METHODS</a>.</li>
</ul>
<p>In order to specify these options, use a custom <code>Agent</code>.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> options = {
  hostname: <span class="string">'encrypted.google.com'</span>,
  port: <span class="number">443</span>,
  path: <span class="string">'/'</span>,
  method: <span class="string">'GET'</span>,
  key: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-key.pem'</span>),
  cert: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-cert.pem'</span>)
};
options.agent = <span class="keyword">new</span> https.Agent(options);

<span class="keyword">var</span> req = https.request(options, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>{
  ...
}
</code></pre><p>Or does not use an <code>Agent</code>.</p>
<p>Example:</p>
<pre><code><span class="keyword">var</span> options = {
  hostname: <span class="string">'encrypted.google.com'</span>,
  port: <span class="number">443</span>,
  path: <span class="string">'/'</span>,
  method: <span class="string">'GET'</span>,
  key: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-key.pem'</span>),
  cert: fs.readFileSync(<span class="string">'test/fixtures/keys/agent2-cert.pem'</span>),
  agent: <span class="literal">false</span>
};

<span class="keyword">var</span> req = https.request(options, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>{
  ...
}
</code></pre><h2 id="https-get(options,_callback)">https.get(options, callback)</h2><p>Like <code>http.get()</code> but for HTTPS.</p>
<p><code>options</code> can be an object or a string. If <code>options</code> is a string, it is<br>automatically parsed with <a href="url.html#url.parse">url.parse()</a>.</p>
<p>Example:</p>
<pre><code>var https = require(<span class="string">'https'</span>);

https.<span class="built_in">get</span>(<span class="string">'https://encrypted.google.com/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">"statusCode: "</span>, <span class="keyword">res</span>.statusCode);
  console.<span class="built_in">log</span>(<span class="string">"headers: "</span>, <span class="keyword">res</span>.headers);

  <span class="keyword">res</span>.<span class="keyword">on</span>(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
    process.stdout.<span class="keyword">write</span>(<span class="keyword">d</span>);
  });

}).<span class="keyword">on</span>(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  console.error(<span class="keyword">e</span>);
});
</code></pre><h2 id="Class:_https-Agent">Class: https.Agent</h2><p>An Agent object for HTTPS similar to <a href="http.html#http_class_http_agent">http.Agent</a>.  See <a href="#https_https_request_options_callback">https.request()</a><br>for more information.</p>
<h2 id="https-globalAgent">https.globalAgent</h2><p>Global instance of <a href="#https_class_https_agent">https.Agent</a> for all HTTPS client requests.</p>
<h1 id="URL"><a id="url">URL</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>This module has utilities for URL resolution and parsing.<br>Call <code>require(&#39;url&#39;)</code> to use it.</p>
<p>Parsed URL objects have some or all of the following fields, depending on<br>whether or not they exist in the URL string. Any parts that are not in the URL<br>string will not be in the parsed object. Examples are shown for the URL</p>
<p><code>&#39;http://user:pass@host.com:8080/p/a/t/h?query=string#hash&#39;</code></p>
<ul>
<li><p><code>href</code>: The full URL that was originally parsed. Both the protocol and host are lowercased.</p>
<p>  Example: <code>&#39;http://user:pass@host.com:8080/p/a/t/h?query=string#hash&#39;</code></p>
</li>
<li><p><code>protocol</code>: The request protocol, lowercased.</p>
<p>  Example: <code>&#39;http:&#39;</code></p>
</li>
<li><p><code>slashes</code>: The protocol requires slashes after the colon</p>
<p>  Example: true or false</p>
</li>
<li><p><code>host</code>: The full lowercased host portion of the URL, including port<br>information.</p>
<p>  Example: <code>&#39;host.com:8080&#39;</code></p>
</li>
<li><p><code>auth</code>: The authentication information portion of a URL.</p>
<p>  Example: <code>&#39;user:pass&#39;</code></p>
</li>
<li><p><code>hostname</code>: Just the lowercased hostname portion of the host.</p>
<p>  Example: <code>&#39;host.com&#39;</code></p>
</li>
<li><p><code>port</code>: The port number portion of the host.</p>
<p>  Example: <code>&#39;8080&#39;</code></p>
</li>
<li><p><code>pathname</code>: The path section of the URL, that comes after the host and<br>before the query, including the initial slash if present.</p>
<p>  Example: <code>&#39;/p/a/t/h&#39;</code></p>
</li>
<li><p><code>search</code>: The ‘query string’ portion of the URL, including the leading<br>question mark.</p>
<p>  Example: <code>&#39;?query=string&#39;</code></p>
</li>
<li><p><code>path</code>: Concatenation of <code>pathname</code> and <code>search</code>.</p>
<p>  Example: <code>&#39;/p/a/t/h?query=string&#39;</code></p>
</li>
<li><p><code>query</code>: Either the ‘params’ portion of the query string, or a<br>querystring-parsed object.</p>
<p>  Example: <code>&#39;query=string&#39;</code> or <code>{&#39;query&#39;:&#39;string&#39;}</code></p>
</li>
<li><p><code>hash</code>: The ‘fragment’ portion of the URL including the pound-sign.</p>
<p>  Example: <code>&#39;#hash&#39;</code></p>
</li>
</ul>
<p>The following methods are provided by the URL module:</p>
<h2 id="url-parse(urlStr[,_parseQueryString][,_slashesDenoteHost])">url.parse(urlStr[, parseQueryString][, slashesDenoteHost])</h2><p>Take a URL string, and return an object.</p>
<p>Pass <code>true</code> as the second argument to also parse the query string using the<br><code>querystring</code> module. If <code>true</code> then the <code>query</code> property will always be<br>assigned an object, and the <code>search</code> property will always be a (possibly<br>empty) string.  Defaults to <code>false</code>.</p>
<p>Pass <code>true</code> as the third argument to treat <code>//foo/bar</code> as<br><code>{ host: &#39;foo&#39;, pathname: &#39;/bar&#39; }</code> rather than<br><code>{ pathname: &#39;//foo/bar&#39; }</code>. Defaults to <code>false</code>.</p>
<h2 id="url-format(urlObj)">url.format(urlObj)</h2><p>Take a parsed URL object, and return a formatted URL string.</p>
<p>Here’s how the formatting process works:</p>
<ul>
<li><code>href</code> will be ignored.</li>
<li><code>protocol</code> is treated the same with or without the trailing <code>:</code> (colon).<ul>
<li>The protocols <code>http</code>, <code>https</code>, <code>ftp</code>, <code>gopher</code>, <code>file</code> will be<br>postfixed with <code>://</code> (colon-slash-slash).</li>
<li>All other protocols <code>mailto</code>, <code>xmpp</code>, <code>aim</code>, <code>sftp</code>, <code>foo</code>, etc will<br>be postfixed with <code>:</code> (colon)</li>
</ul>
</li>
<li><code>slashes</code> set to <code>true</code> if the protocol requires <code>://</code> (colon-slash-slash)<ul>
<li>Only needs to be set for protocols not previously listed as requiring<br>slashes, such as <code>mongodb://localhost:8000/</code></li>
</ul>
</li>
<li><code>auth</code> will be used if present.</li>
<li><code>hostname</code> will only be used if <code>host</code> is absent.</li>
<li><code>port</code> will only be used if <code>host</code> is absent.</li>
<li><code>host</code> will be used in place of <code>hostname</code> and <code>port</code></li>
<li><code>pathname</code> is treated the same with or without the leading <code>/</code> (slash).</li>
<li><code>search</code> will be used in place of <code>query</code>.<ul>
<li>It is treated the same with or without the leading <code>?</code> (question mark)</li>
</ul>
</li>
<li><code>query</code> (object; see <code>querystring</code>) will only be used if <code>search</code> is absent.</li>
<li><code>hash</code> is treated the same with or without the leading <code>#</code> (pound sign, anchor).</li>
</ul>
<h2 id="url-resolve(from,_to)">url.resolve(from, to)</h2><p>Take a base URL, and a href URL, and resolve them as a browser would for<br>an anchor tag.  Examples:</p>
<pre><code>url.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'/one/two/three'</span>, <span class="string">'four'</span>)</span></span>         <span class="comment">// '/one/two/four'</span>
url.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>)</span></span>    <span class="comment">// 'http://example.com/one'</span>
url.<span class="function"><span class="title">resolve</span><span class="params">(<span class="string">'http://example.com/one'</span>, <span class="string">'/two'</span>)</span></span> <span class="comment">// 'http://example.com/two'</span>
</code></pre><h1 id="Query_String"><a id="querystring">Query String</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><!--name=querystring-->
<p>This module provides utilities for dealing with query strings.<br>It provides the following methods:</p>
<h2 id="querystring-stringify(obj[,_sep][,_eq][,_options])">querystring.stringify(obj[, sep][, eq][, options])</h2><p>Serialize an object to a query string.<br>Optionally override the default separator (<code>&#39;&amp;&#39;</code>) and assignment (<code>&#39;=&#39;</code>)<br>characters.</p>
<p>Options object may contain <code>encodeURIComponent</code> property (<code>querystring.escape</code> by default),<br>it can be used to encode string with <code>non-utf8</code> encoding if necessary.</p>
<p>Example:</p>
<pre><code>querystring.stringify({ <span class="string">foo:</span> <span class="string">'bar'</span>, <span class="string">baz:</span> [<span class="string">'qux'</span>, <span class="string">'quux'</span>], <span class="string">corge:</span> <span class="string">''</span> })
<span class="comment">// returns</span>
<span class="string">'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge='</span>

querystring.stringify({<span class="string">foo:</span> <span class="string">'bar'</span>, <span class="string">baz:</span> <span class="string">'qux'</span>}, <span class="string">';'</span>, <span class="string">':'</span>)
<span class="comment">// returns</span>
<span class="string">'foo:bar;baz:qux'</span>

<span class="comment">// Suppose gbkEncodeURIComponent function already exists,</span>
<span class="comment">// it can encode string with `gbk` encoding</span>
querystring.stringify({ <span class="string">w:</span> <span class="string">'中文'</span>, <span class="string">foo:</span> <span class="string">'bar'</span> }, <span class="literal">null</span>, <span class="literal">null</span>,
  { <span class="string">encodeURIComponent:</span> gbkEncodeURIComponent })
<span class="comment">// returns</span>
<span class="string">'w=%D6%D0%CE%C4&amp;foo=bar'</span>
</code></pre><h2 id="querystring-parse(str[,_sep][,_eq][,_options])">querystring.parse(str[, sep][, eq][, options])</h2><p>Deserialize a query string to an object.<br>Optionally override the default separator (<code>&#39;&amp;&#39;</code>) and assignment (<code>&#39;=&#39;</code>)<br>characters.</p>
<p>Options object may contain <code>maxKeys</code> property (equal to 1000 by default), it’ll<br>be used to limit processed keys. Set it to 0 to remove key count limitation.</p>
<p>Options object may contain <code>decodeURIComponent</code> property (<code>querystring.unescape</code> by default),<br>it can be used to decode a <code>non-utf8</code> encoding string if necessary.</p>
<p>Example:</p>
<pre><code>querystring.parse(<span class="string">'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge'</span>)
<span class="comment">// returns</span>
{ <span class="string">foo:</span> <span class="string">'bar'</span>, <span class="string">baz:</span> [<span class="string">'qux'</span>, <span class="string">'quux'</span>], <span class="string">corge:</span> <span class="string">''</span> }

<span class="comment">// Suppose gbkDecodeURIComponent function already exists,</span>
<span class="comment">// it can decode `gbk` encoding string</span>
querystring.parse(<span class="string">'w=%D6%D0%CE%C4&amp;foo=bar'</span>, <span class="literal">null</span>, <span class="literal">null</span>,
  { <span class="string">decodeURIComponent:</span> gbkDecodeURIComponent })
<span class="comment">// returns</span>
{ <span class="string">w:</span> <span class="string">'中文'</span>, <span class="string">foo:</span> <span class="string">'bar'</span> }
</code></pre><h2 id="querystring-escape">querystring.escape</h2><p>The escape function used by <code>querystring.stringify</code>,<br>provided so that it could be overridden if necessary.</p>
<h2 id="querystring-unescape">querystring.unescape</h2><p>The unescape function used by <code>querystring.parse</code>,<br>provided so that it could be overridden if necessary.</p>
<p>It will try to use <code>decodeURIComponent</code> in the first place,<br>but if that fails it falls back to a safer equivalent that<br>doesn’t throw on malformed URLs.</p>
<h1 id="punycode"><a id="punycode">punycode</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable</span>
</code></pre><p><a href="http://mths.be/punycode" target="_blank" rel="external">Punycode.js</a> is bundled with Node.js v0.6.2+. Use<br><code>require(&#39;punycode&#39;)</code> to access it. (To use it with other Node.js versions,<br>use npm to install the <code>punycode</code> module first.)</p>
<h2 id="punycode-decode(string)">punycode.decode(string)</h2><p>Converts a Punycode string of ASCII-only symbols to a string of Unicode symbols.</p>
<pre><code><span class="comment">// decode domain name parts</span>
punycode.decode(<span class="string">'maana-pta'</span>); <span class="comment">// 'mañana'</span>
punycode.decode(<span class="string">'--dqo34k'</span>); <span class="comment">// '☃-⌘'</span>
</code></pre><h2 id="punycode-encode(string)">punycode.encode(string)</h2><p>Converts a string of Unicode symbols to a Punycode string of ASCII-only symbols.</p>
<pre><code><span class="comment">// encode domain name parts</span>
punycode.<span class="keyword">encode</span>('<span class="keyword">ma</span>ñana'); <span class="comment">// 'maana-pta'</span>
punycode.<span class="keyword">encode</span>('☃-⌘'); <span class="comment">// '--dqo34k'</span>
</code></pre><h2 id="punycode-toUnicode(domain)">punycode.toUnicode(domain)</h2><p>Converts a Punycode string representing a domain name to Unicode. Only the<br>Punycoded parts of the domain name will be converted, i.e. it doesn’t matter if<br>you call it on a string that has already been converted to Unicode.</p>
<pre><code><span class="comment">// decode domain names</span>
punycode.toUnicode(<span class="string">'xn--maana-pta.com'</span>); <span class="comment">// 'mañana.com'</span>
punycode.toUnicode(<span class="string">'xn----dqo34k.com'</span>); <span class="comment">// '☃-⌘.com'</span>
</code></pre><h2 id="punycode-toASCII(domain)">punycode.toASCII(domain)</h2><p>Converts a Unicode string representing a domain name to Punycode. Only the<br>non-ASCII parts of the domain name will be converted, i.e. it doesn’t matter if<br>you call it with a domain that’s already in ASCII.</p>
<pre><code><span class="comment">// encode domain names</span>
punycode.toASCII(<span class="string">'mañana.com'</span>); <span class="comment">// 'xn--maana-pta.com'</span>
punycode.toASCII(<span class="string">'☃-⌘.com'</span>); <span class="comment">// 'xn----dqo34k.com'</span>
</code></pre><h2 id="punycode-ucs2">punycode.ucs2</h2><h3 id="punycode-ucs2-decode(string)">punycode.ucs2.decode(string)</h3><p>Creates an array containing the numeric code point values of each Unicode<br>symbol in the string. While <a href="http://mathiasbynens.be/notes/javascript-encoding" target="_blank" rel="external">JavaScript uses UCS-2<br>internally</a>, this function<br>will convert a pair of surrogate halves (each of which UCS-2 exposes as<br>separate characters) into a single code point, matching UTF-16.</p>
<pre><code>punycode.ucs2.decode(<span class="string">'abc'</span>); <span class="comment">// [0x61, 0x62, 0x63]</span>
<span class="comment">// surrogate pair for U+1D306 tetragram for centre:</span>
punycode.ucs2.decode(<span class="string">'\uD834\uDF06'</span>); <span class="comment">// [0x1D306]</span>
</code></pre><h3 id="punycode-ucs2-encode(codePoints)">punycode.ucs2.encode(codePoints)</h3><p>Creates a string based on an array of numeric code point values.</p>
<pre><code>punycode.ucs2.encode([<span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>]); <span class="regexp">//</span> <span class="string">'abc'</span>
punycode.ucs2.encode([<span class="number">0x1D306</span>]); <span class="regexp">//</span> <span class="string">'\uD834\uDF06'</span>
</code></pre><h2 id="punycode-version">punycode.version</h2><p>A string representing the current Punycode.js version number.</p>
<h1 id="Readline"><a id="readline">Readline</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable</span>
</code></pre><p>To use this module, do <code>require(&#39;readline&#39;)</code>. Readline allows reading of a<br>stream (such as <code>process.stdin</code>) on a line-by-line basis.</p>
<p>Note that once you’ve invoked this module, your node program will not<br>terminate until you’ve closed the interface. Here’s how to allow your<br>program to gracefully exit:</p>
<pre><code><span class="keyword">var</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>);

<span class="keyword">var</span> rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

rl.question(<span class="string">"What do you think of node.js? "</span>, <span class="function"><span class="keyword">function</span>(<span class="params">answer</span>) </span>{
  <span class="comment">// <span class="doctag">TODO</span>: Log the answer in a database</span>
  <span class="built_in">console</span>.log(<span class="string">"Thank you for your valuable feedback:"</span>, answer);

  rl.close();
});
</code></pre><h2 id="readline-createInterface(options)">readline.createInterface(options)</h2><p>Creates a readline <code>Interface</code> instance. Accepts an “options” Object that takes<br>the following values:</p>
<ul>
<li><p><code>input</code> - the readable stream to listen to (Required).</p>
</li>
<li><p><code>output</code> - the writable stream to write readline data to (Optional).</p>
</li>
<li><p><code>completer</code> - an optional function that is used for Tab autocompletion. See<br>below for an example of using this.</p>
</li>
<li><p><code>terminal</code> - pass <code>true</code> if the <code>input</code> and <code>output</code> streams should be<br>treated like a TTY, and have ANSI/VT100 escape codes written to it.<br>Defaults to checking <code>isTTY</code> on the <code>output</code> stream upon instantiation.</p>
</li>
</ul>
<p>The <code>completer</code> function is given the current line entered by the user, and<br>is supposed to return an Array with 2 entries:</p>
<ol>
<li><p>An Array with matching entries for the completion.</p>
</li>
<li><p>The substring that was used for the matching.</p>
</li>
</ol>
<p>Which ends up looking something like:<br><code>[[substr1, substr2, ...], originalsubstring]</code>.</p>
<p>Example:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">completer</span><span class="params">(line)</span> </span>{
  <span class="keyword">var</span> completions = <span class="string">'.help .error .exit .quit .q'</span>.split(<span class="string">' '</span>)
  <span class="keyword">var</span> hits = completions.filter(<span class="function"><span class="keyword">function</span><span class="params">(c)</span> </span>{ <span class="keyword">return</span> c.indexOf(line) == <span class="number">0</span> })
  <span class="comment">// show all completions if none found</span>
  <span class="keyword">return</span> [hits.length ? hits : completions, line]
}
</code></pre><p>Also <code>completer</code> can be run in async mode if it accepts two arguments:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">completer</span><span class="params">(linePartial, callback)</span> </span>{
  <span class="keyword">callback</span>(<span class="literal">null</span>, [[<span class="string">'123'</span>], linePartial]);
}
</code></pre><p><code>createInterface</code> is commonly used with <code>process.stdin</code> and<br><code>process.stdout</code> in order to accept user input:</p>
<pre><code><span class="keyword">var</span> readline = require(<span class="string">'readline'</span>);
<span class="keyword">var</span> rl = readline.createInterface({
  input: process.<span class="keyword">stdin</span>,
  output: process.<span class="keyword">stdout</span>
});
</code></pre><p>Once you have a readline instance, you most commonly listen for the<br><code>&quot;line&quot;</code> event.</p>
<p>If <code>terminal</code> is <code>true</code> for this instance then the <code>output</code> stream will get<br>the best compatibility if it defines an <code>output.columns</code> property, and fires<br>a <code>&quot;resize&quot;</code> event on the <code>output</code> if/when the columns ever change<br>(<code>process.stdout</code> does this automatically when it is a TTY).</p>
<h2 id="Class:_Interface">Class: Interface</h2><p>The class that represents a readline interface with an input and output<br>stream.</p>
<h3 id="rl-setPrompt(prompt)">rl.setPrompt(prompt)</h3><p>Sets the prompt, for example when you run <code>node</code> on the command line, you see<br><code>&gt;</code>, which is node’s prompt.</p>
<h3 id="rl-prompt([preserveCursor])">rl.prompt([preserveCursor])</h3><p>Readies readline for input from the user, putting the current <code>setPrompt</code><br>options on a new line, giving the user a new spot to write. Set <code>preserveCursor</code><br>to <code>true</code> to prevent the cursor placement being reset to <code>0</code>.</p>
<p>This will also resume the <code>input</code> stream used with <code>createInterface</code> if it has<br>been paused.</p>
<p>If <code>output</code> is set to <code>null</code> or <code>undefined</code> when calling <code>createInterface</code>, the<br>prompt is not written.</p>
<h3 id="rl-question(query,_callback)">rl.question(query, callback)</h3><p>Prepends the prompt with <code>query</code> and invokes <code>callback</code> with the user’s<br>response. Displays the query to the user, and then invokes <code>callback</code><br>with the user’s response after it has been typed.</p>
<p>This will also resume the <code>input</code> stream used with <code>createInterface</code> if<br>it has been paused.</p>
<p>If <code>output</code> is set to <code>null</code> or <code>undefined</code> when calling <code>createInterface</code>,<br>nothing is displayed.</p>
<p>Example usage:</p>
<pre><code><span class="keyword">interface</span>.question(<span class="string">'What is your favorite food?'</span>, <span class="function"><span class="keyword">function</span><span class="params">(answer)</span> <span class="comment">{
  console.log('Oh, so your favorite food is ' + answer);
}</span>);</span>
</code></pre><h3 id="rl-pause()">rl.pause()</h3><p>Pauses the readline <code>input</code> stream, allowing it to be resumed later if needed.</p>
<p>Note that this doesn’t immediately pause the stream of events. Several events may be emitted after calling <code>pause</code>, including <code>line</code>.</p>
<h3 id="rl-resume()">rl.resume()</h3><p>Resumes the readline <code>input</code> stream.</p>
<h3 id="rl-close()">rl.close()</h3><p>Closes the <code>Interface</code> instance, relinquishing control on the <code>input</code> and<br><code>output</code> streams. The “close” event will also be emitted.</p>
<h3 id="rl-write(data[,_key])">rl.write(data[, key])</h3><p>Writes <code>data</code> to <code>output</code> stream, unless <code>output</code> is set to <code>null</code> or<br><code>undefined</code> when calling <code>createInterface</code>. <code>key</code> is an object literal to<br>represent a key sequence; available if the terminal is a TTY.</p>
<p>This will also resume the <code>input</code> stream if it has been paused.</p>
<p>Example:</p>
<pre><code>rl.<span class="keyword">write</span>(<span class="string">'Delete me!'</span>);
<span class="comment">// Simulate ctrl+u to delete the line written previously</span>
rl.<span class="keyword">write</span>(<span class="keyword">null</span>, {ctrl: <span class="keyword">true</span>, name: <span class="string">'u'</span>});
</code></pre><h2 id="Events-1">Events</h2><h3 id="Event:_‘line’">Event: ‘line’</h3><p><code>function (line) {}</code></p>
<p>Emitted whenever the <code>input</code> stream receives a <code>\n</code>, usually received when the<br>user hits enter, or return. This is a good hook to listen for user input.</p>
<p>Example of listening for <code>line</code>:</p>
<pre><code>rl.<span class="keyword">on</span>(<span class="string">'line'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(cmd)</span> <span class="comment">{
  console.log('You just typed: '+cmd);
}</span>);</span>
</code></pre><h3 id="Event:_‘pause’">Event: ‘pause’</h3><p><code>function () {}</code></p>
<p>Emitted whenever the <code>input</code> stream is paused.</p>
<p>Also emitted whenever the <code>input</code> stream is not paused and receives the<br><code>SIGCONT</code> event. (See events <code>SIGTSTP</code> and <code>SIGCONT</code>)</p>
<p>Example of listening for <code>pause</code>:</p>
<pre><code>rl.on(<span class="string">'pause'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Readline paused.'</span>);
});
</code></pre><h3 id="Event:_‘resume’">Event: ‘resume’</h3><p><code>function () {}</code></p>
<p>Emitted whenever the <code>input</code> stream is resumed.</p>
<p>Example of listening for <code>resume</code>:</p>
<pre><code>rl.on(<span class="string">'resume'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Readline resumed.'</span>);
});
</code></pre><h3 id="Event:_‘close’-7">Event: ‘close’</h3><p><code>function () {}</code></p>
<p>Emitted when <code>close()</code> is called.</p>
<p>Also emitted when the <code>input</code> stream receives its “end” event. The <code>Interface</code><br>instance should be considered “finished” once this is emitted. For example, when<br>the <code>input</code> stream receives <code>^D</code>, respectively known as <code>EOT</code>.</p>
<p>This event is also called if there is no <code>SIGINT</code> event listener present when<br>the <code>input</code> stream receives a <code>^C</code>, respectively known as <code>SIGINT</code>.</p>
<h3 id="Event:_‘SIGINT’">Event: ‘SIGINT’</h3><p><code>function () {}</code></p>
<p>Emitted whenever the <code>input</code> stream receives a <code>^C</code>, respectively known as<br><code>SIGINT</code>. If there is no <code>SIGINT</code> event listener present when the <code>input</code><br>stream receives a <code>SIGINT</code>, <code>pause</code> will be triggered.</p>
<p>Example of listening for <code>SIGINT</code>:</p>
<pre><code>rl.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  rl.question(<span class="string">'Are you sure you want to exit?'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">answer</span>) </span>{
    <span class="keyword">if</span> (answer.match(<span class="regexp">/^y(es)?$/i</span>)) rl.pause();
  });
});
</code></pre><h3 id="Event:_‘SIGTSTP’">Event: ‘SIGTSTP’</h3><p><code>function () {}</code></p>
<p><strong>This does not work on Windows.</strong></p>
<p>Emitted whenever the <code>input</code> stream receives a <code>^Z</code>, respectively known as<br><code>SIGTSTP</code>. If there is no <code>SIGTSTP</code> event listener present when the <code>input</code><br>stream receives a <code>SIGTSTP</code>, the program will be sent to the background.</p>
<p>When the program is resumed with <code>fg</code>, the <code>pause</code> and <code>SIGCONT</code> events will be<br>emitted. You can use either to resume the stream.</p>
<p>The <code>pause</code> and <code>SIGCONT</code> events will not be triggered if the stream was paused<br>before the program was sent to the background.</p>
<p>Example of listening for <code>SIGTSTP</code>:</p>
<pre><code>rl.on(<span class="string">'SIGTSTP'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="comment">// This will override SIGTSTP and prevent the program from going to the</span>
  <span class="comment">// background.</span>
  <span class="built_in">console</span>.log(<span class="string">'Caught SIGTSTP.'</span>);
});
</code></pre><h3 id="Event:_‘SIGCONT’">Event: ‘SIGCONT’</h3><p><code>function () {}</code></p>
<p><strong>This does not work on Windows.</strong></p>
<p>Emitted whenever the <code>input</code> stream is sent to the background with <code>^Z</code>,<br>respectively known as <code>SIGTSTP</code>, and then continued with <code>fg(1)</code>. This event<br>only emits if the stream was not paused before sending the program to the<br>background.</p>
<p>Example of listening for <code>SIGCONT</code>:</p>
<pre><code>rl.on(<span class="string">'SIGCONT'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="comment">// `prompt` will automatically resume the stream</span>
  rl.prompt();
});
</code></pre><h2 id="Example:_Tiny_CLI">Example: Tiny CLI</h2><p>Here’s an example of how to use all these together to craft a tiny command<br>line interface:</p>
<pre><code><span class="keyword">var</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>),
    rl = readline.createInterface(process.stdin, process.stdout);

rl.setPrompt(<span class="string">'OHAI&gt; '</span>);
rl.prompt();

rl.on(<span class="string">'line'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">line</span>) </span>{
  <span class="keyword">switch</span>(line.trim()) {
    <span class="keyword">case</span> <span class="string">'hello'</span>:
      <span class="built_in">console</span>.log(<span class="string">'world!'</span>);
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      <span class="built_in">console</span>.log(<span class="string">'Say what? I might have heard `'</span> + line.trim() + <span class="string">'`'</span>);
      <span class="keyword">break</span>;
  }
  rl.prompt();
}).on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'Have a great day!'</span>);
  process.exit(<span class="number">0</span>);
});
</code></pre><h2 id="readline-cursorTo(stream,_x,_y)">readline.cursorTo(stream, x, y)</h2><p>Move cursor to the specified position in a given TTY stream.</p>
<h2 id="readline-moveCursor(stream,_dx,_dy)">readline.moveCursor(stream, dx, dy)</h2><p>Move cursor relative to it’s current position in a given TTY stream.</p>
<h2 id="readline-clearLine(stream,_dir)">readline.clearLine(stream, dir)</h2><p>Clears current line of given TTY stream in a specified direction.<br><code>dir</code> should have one of following values:</p>
<ul>
<li><code>-1</code> - to the left from cursor</li>
<li><code>1</code> - to the right from cursor</li>
<li><code>0</code> - the entire line</li>
</ul>
<h2 id="readline-clearScreenDown(stream)">readline.clearScreenDown(stream)</h2><p>Clears the screen from the current position of the cursor down.</p>
<h1 id="Executing_JavaScript"><a id="vm">Executing JavaScript</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><!--name=vm-->
<p>You can access this module with:</p>
<pre><code><span class="reserved">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);
</code></pre><p>JavaScript code can be compiled and run immediately or compiled, saved, and run<br>later.</p>
<h2 id="vm-runInThisContext(code[,_options])">vm.runInThisContext(code[, options])</h2><p><code>vm.runInThisContext()</code> compiles <code>code</code>, runs it and returns the result. Running<br>code does not have access to local scope, but does have access to the current<br><code>global</code> object.</p>
<p>Example of using <code>vm.runInThisContext</code> and <code>eval</code> to run the same code:</p>
<pre><code>var <span class="built_in">local</span>Var = <span class="string">'initial value'</span>;

var vmResult = vm.runInThisContext(<span class="string">'localVar = "vm";'</span>);
console.log(<span class="string">'vmResult: '</span>, vmResult);
console.log(<span class="string">'localVar: '</span>, <span class="built_in">local</span>Var);

var <span class="built_in">eval</span>Result = <span class="built_in">eval</span>(<span class="string">'localVar = "eval";'</span>);
console.log(<span class="string">'evalResult: '</span>, <span class="built_in">eval</span>Result);
console.log(<span class="string">'localVar: '</span>, <span class="built_in">local</span>Var);

// vmResult: <span class="string">'vm'</span>, <span class="built_in">local</span>Var: <span class="string">'initial value'</span>
// <span class="built_in">eval</span>Result: <span class="string">'eval'</span>, <span class="built_in">local</span>Var: <span class="string">'eval'</span>
</code></pre><p><code>vm.runInThisContext</code> does not have access to the local scope, so <code>localVar</code> is<br>unchanged. <code>eval</code> does have access to the local scope, so <code>localVar</code> is changed.</p>
<p>In this way <code>vm.runInThisContext</code> is much like an <a href="http://es5.github.io/#x10.4.2" target="_blank" rel="external">indirect <code>eval</code> call</a>,<br>e.g. <code>(0,eval)(&#39;code&#39;)</code>. However, it also has the following additional options:</p>
<ul>
<li><code>filename</code>: allows you to control the filename that shows up in any stack<br>traces produced.</li>
<li><code>displayErrors</code>: whether or not to print any errors to stderr, with the<br>line of code that caused them highlighted, before throwing an exception.<br>Will capture both syntax errors from compiling <code>code</code> and runtime errors<br>thrown by executing the compiled code. Defaults to <code>true</code>.</li>
<li><code>timeout</code>: a number of milliseconds to execute <code>code</code> before terminating<br>execution. If execution is terminated, an <code>Error</code> will be thrown.</li>
</ul>
<h2 id="vm-createContext([sandbox])">vm.createContext([sandbox])</h2><p>If given a <code>sandbox</code> object, will “contextify” that sandbox so that it can be<br>used in calls to <code>vm.runInContext</code> or <code>script.runInContext</code>. Inside scripts run<br>as such, <code>sandbox</code> will be the global object, retaining all its existing<br>properties but also having the built-in objects and functions any standard<br><a href="http://es5.github.io/#x15.1" target="_blank" rel="external">global object</a> has. Outside of scripts run by the vm module, <code>sandbox</code> will<br>be unchanged.</p>
<p>If not given a sandbox object, returns a new, empty contextified sandbox object<br>you can use.</p>
<p>This function is useful for creating a sandbox that can be used to run multiple<br>scripts, e.g. if you were emulating a web browser it could be used to create a<br>single sandbox representing a window’s global object, then run all <code>&lt;script&gt;</code><br>tags together inside that sandbox.</p>
<h2 id="vm-isContext(sandbox)">vm.isContext(sandbox)</h2><p>Returns whether or not a sandbox object has been contextified by calling<br><code>vm.createContext</code> on it.</p>
<h2 id="vm-runInContext(code,_contextifiedSandbox[,_options])">vm.runInContext(code, contextifiedSandbox[, options])</h2><p><code>vm.runInContext</code> compiles <code>code</code>, then runs it in <code>contextifiedSandbox</code> and<br>returns the result. Running code does not have access to local scope. The<br><code>contextifiedSandbox</code> object must have been previously contextified via<br><code>vm.createContext</code>; it will be used as the global object for <code>code</code>.</p>
<p><code>vm.runInContext</code> takes the same options as <code>vm.runInThisContext</code>.</p>
<p>Example: compile and execute different scripts in a single existing context.</p>
<pre><code><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);
<span class="keyword">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);

<span class="keyword">var</span> sandbox = { globalVar: <span class="number">1</span> };
vm.createContext(sandbox);

<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) {
    vm.runInContext(<span class="string">'globalVar *= 2;'</span>, sandbox);
}
<span class="built_in">console</span>.log(util.inspect(sandbox));

<span class="comment">// { globalVar: 1024 }</span>
</code></pre><p>Note that running untrusted code is a tricky business requiring great care.<br><code>vm.runInContext</code> is quite useful, but safely running untrusted code requires a<br>separate process.</p>
<h2 id="vm-runInNewContext(code[,_sandbox][,_options])">vm.runInNewContext(code[, sandbox][, options])</h2><p><code>vm.runInNewContext</code> compiles <code>code</code>, contextifies <code>sandbox</code> if passed or<br>creates a new contextified sandbox if it’s omitted, and then runs the code with<br>the sandbox as the global object and returns the result.</p>
<p><code>vm.runInNewContext</code> takes the same options as <code>vm.runInThisContext</code>.</p>
<p>Example: compile and execute code that increments a global variable and sets a<br>new one. These globals are contained in the sandbox.</p>
<pre><code>var util = require('util');
var vm = require('vm'),

var sandbox = {
  <span class="keyword">animal</span>: 'cat',
  count: 2
};

vm.runInNewContext('count += 1; name = <span class="string">"kitty"</span>', sandbox);
console.log(util.inspect(sandbox));

// { <span class="keyword">animal</span>: 'cat', count: 3, name: 'kitty' }
</code></pre><p>Note that running untrusted code is a tricky business requiring great care.<br><code>vm.runInNewContext</code> is quite useful, but safely running untrusted code requires<br>a separate process.</p>
<h2 id="vm-runInDebugContext(code)">vm.runInDebugContext(code)</h2><p><code>vm.runInDebugContext</code> compiles and executes <code>code</code> inside the V8 debug context.<br>The primary use case is to get access to the V8 debug object:</p>
<pre><code><span class="keyword">var</span> Debug = vm.runInDebugContext(<span class="string">'Debug'</span>);
Debug.scripts().forEach(<span class="function"><span class="keyword">function</span>(<span class="params">script</span>) </span>{ <span class="built_in">console</span>.log(script.name); });
</code></pre><p>Note that the debug context and object are intrinsically tied to V8’s debugger<br>implementation and may change (or even get removed) without prior warning.</p>
<p>The debug object can also be exposed with the <code>--expose_debug_as=</code> switch.</p>
<h2 id="Class:_Script">Class: Script</h2><p>A class for holding precompiled scripts, and running them in specific sandboxes.</p>
<h3 id="new_vm-Script(code,_options)">new vm.Script(code, options)</h3><p>Creating a new <code>Script</code> compiles <code>code</code> but does not run it. Instead, the<br>created <code>vm.Script</code> object represents this compiled code. This script can be run<br>later many times using methods below. The returned script is not bound to any<br>global object. It is bound before each run, just for that run.</p>
<p>The options when creating a script are:</p>
<ul>
<li><code>filename</code>: allows you to control the filename that shows up in any stack<br>traces produced from this script.</li>
<li><code>displayErrors</code>: whether or not to print any errors to stderr, with the<br>line of code that caused them highlighted, before throwing an exception.<br>Applies only to syntax errors compiling the code; errors while running the<br>code are controlled by the options to the script’s methods.</li>
</ul>
<h3 id="script-runInThisContext([options])">script.runInThisContext([options])</h3><p>Similar to <code>vm.runInThisContext</code> but a method of a precompiled <code>Script</code> object.<br><code>script.runInThisContext</code> runs <code>script</code>‘s compiled code and returns the result.<br>Running code does not have access to local scope, but does have access to the<br>current <code>global</code> object.</p>
<p>Example of using <code>script.runInThisContext</code> to compile code once and run it<br>multiple times:</p>
<pre><code><span class="reserved">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);

<span class="built_in">global</span>.globalVar = <span class="number">0</span>;

<span class="reserved">var</span> script = <span class="keyword">new</span> vm.Script(<span class="string">'globalVar += 1'</span>, { <span class="attribute">filename</span>: <span class="string">'myfile.vm'</span> });

<span class="keyword">for</span> (<span class="reserved">var</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {
  script.runInThisContext();
}

<span class="built_in">console</span>.log(globalVar);

<span class="regexp">//</span> <span class="number">1000</span>
</code></pre><p>The options for running a script are:</p>
<ul>
<li><code>displayErrors</code>: whether or not to print any runtime errors to stderr, with<br>the line of code that caused them highlighted, before throwing an exception.<br>Applies only to runtime errors executing the code; it is impossible to create<br>a <code>Script</code> instance with syntax errors, as the constructor will throw.</li>
<li><code>timeout</code>: a number of milliseconds to execute the script before terminating<br>execution. If execution is terminated, an <code>Error</code> will be thrown.</li>
</ul>
<h3 id="script-runInContext(contextifiedSandbox[,_options])">script.runInContext(contextifiedSandbox[, options])</h3><p>Similar to <code>vm.runInContext</code> but a method of a precompiled <code>Script</code> object.<br><code>script.runInContext</code> runs <code>script</code>‘s compiled code in <code>contextifiedSandbox</code><br>and returns the result. Running code does not have access to local scope.</p>
<p><code>script.runInContext</code> takes the same options as <code>script.runInThisContext</code>.</p>
<p>Example: compile code that increments a global variable and sets one, then<br>execute the code multiple times. These globals are contained in the sandbox.</p>
<pre><code>var util = require('util');
var vm = require('vm');

var sandbox = {
  <span class="keyword">animal</span>: 'cat',
  count: 2
};

var script = new vm.Script('count += 1; name = <span class="string">"kitty"</span>');

for (var i = 0; i &lt; 10; ++i) {
  script.runInContext(sandbox);
}

console.log(util.inspect(sandbox));

// { <span class="keyword">animal</span>: 'cat', count: 12, name: 'kitty' }
</code></pre><p>Note that running untrusted code is a tricky business requiring great care.<br><code>script.runInContext</code> is quite useful, but safely running untrusted code<br>requires a separate process.</p>
<h3 id="script-runInNewContext([sandbox][,_options])">script.runInNewContext([sandbox][, options])</h3><p>Similar to <code>vm.runInNewContext</code> but a method of a precompiled <code>Script</code> object.<br><code>script.runInNewContext</code> contextifies <code>sandbox</code> if passed or creates a new<br>contextified sandbox if it’s omitted, and then runs <code>script</code>‘s compiled code<br>with the sandbox as the global object and returns the result. Running code does<br>not have access to local scope.</p>
<p><code>script.runInNewContext</code> takes the same options as <code>script.runInThisContext</code>.</p>
<p>Example: compile code that sets a global variable, then execute the code<br>multiple times in different contexts. These globals are set on and contained in<br>the sandboxes.</p>
<pre><code><span class="reserved">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);
<span class="reserved">var</span> vm = <span class="built_in">require</span>(<span class="string">'vm'</span>);

<span class="reserved">var</span> sandboxes = [{}, {}, {}];

<span class="reserved">var</span> script = <span class="keyword">new</span> vm.Script(<span class="string">'globalVar = "set"'</span>);

sandboxes.forEach(<span class="reserved">function</span> (sandbox) {
  script.runInNewContext(sandbox);
});

<span class="built_in">console</span>.log(util.inspect(sandboxes));

<span class="regexp">//</span> [{ <span class="attribute">globalVar</span>: <span class="string">'set'</span> }, { <span class="attribute">globalVar</span>: <span class="string">'set'</span> }, { <span class="attribute">globalVar</span>: <span class="string">'set'</span> }]
</code></pre><p>Note that running untrusted code is a tricky business requiring great care.<br><code>script.runInNewContext</code> is quite useful, but safely running untrusted code<br>requires a separate process.</p>
<h1 id="Child_Process"><a id="child_process">Child Process</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>Node provides a tri-directional <code>popen(3)</code> facility through the<br><code>child_process</code> module.</p>
<p>It is possible to stream data through a child’s <code>stdin</code>, <code>stdout</code>, and<br><code>stderr</code> in a fully non-blocking way.  (Note that some programs use<br>line-buffered I/O internally.  That doesn’t affect node.js but it means<br>data you send to the child process may not be immediately consumed.)</p>
<p>To create a child process use <code>require(&#39;child_process&#39;).spawn()</code> or<br><code>require(&#39;child_process&#39;).fork()</code>.  The semantics of each are slightly<br>different, and explained <a href="#child_process_asynchronous_process_creation">below</a>.</p>
<p>For scripting purposes you may find the<br><a href="#child_process_synchronous_process_creation">synchronous counterparts</a> more<br>convenient.</p>
<h2 id="Class:_ChildProcess">Class: ChildProcess</h2><p><code>ChildProcess</code> is an <a href="events.html#events_class_events_eventemitter">EventEmitter</a>.</p>
<p>Child processes always have three streams associated with them. <code>child.stdin</code>,<br><code>child.stdout</code>, and <code>child.stderr</code>.  These may be shared with the stdio<br>streams of the parent process, or they may be separate stream objects<br>which can be piped to and from.</p>
<p>The ChildProcess class is not intended to be used directly.  Use the<br><code>spawn()</code>, <code>exec()</code>, <code>execFile()</code>, or <code>fork()</code> methods to create a Child<br>Process instance.</p>
<h3 id="Event:_‘error’-6">Event:  ‘error’</h3><ul>
<li><code>err</code> {Error Object} the error.</li>
</ul>
<p>Emitted when:</p>
<ol>
<li>The process could not be spawned, or</li>
<li>The process could not be killed, or</li>
<li>Sending a message to the child process failed for whatever reason.</li>
</ol>
<p>Note that the <code>exit</code>-event may or may not fire after an error has occurred. If<br>you are listening on both events to fire a function, remember to guard against<br>calling your function twice.</p>
<p>See also <a href="#child_process_child_kill_signal"><code>ChildProcess#kill()</code></a> and<br><a href="#child_process_child_send_message_sendhandle"><code>ChildProcess#send()</code></a>.</p>
<h3 id="Event:_‘exit’-1">Event:  ‘exit’</h3><ul>
<li><code>code</code> {Number} the exit code, if it exited normally.</li>
<li><code>signal</code> {String} the signal passed to kill the child process, if it<br>was killed by the parent.</li>
</ul>
<p>This event is emitted after the child process ends. If the process terminated<br>normally, <code>code</code> is the final exit code of the process, otherwise <code>null</code>. If<br>the process terminated due to receipt of a signal, <code>signal</code> is the string name<br>of the signal, otherwise <code>null</code>.</p>
<p>Note that the child process stdio streams might still be open.</p>
<p>Also, note that node establishes signal handlers for <code>&#39;SIGINT&#39;</code> and <code>&#39;SIGTERM</code>‘,<br>so it will not terminate due to receipt of those signals, it will exit.</p>
<p>See <code>waitpid(2)</code>.</p>
<h3 id="Event:_‘close’-8">Event: ‘close’</h3><ul>
<li><code>code</code> {Number} the exit code, if it exited normally.</li>
<li><code>signal</code> {String} the signal passed to kill the child process, if it<br>was killed by the parent.</li>
</ul>
<p>This event is emitted when the stdio streams of a child process have all<br>terminated.  This is distinct from ‘exit’, since multiple processes<br>might share the same stdio streams.</p>
<h3 id="Event:_‘disconnect’">Event: ‘disconnect’</h3><p>This event is emitted after calling the <code>.disconnect()</code> method in the parent<br>or in the child. After disconnecting it is no longer possible to send messages,<br>and the <code>.connected</code> property is false.</p>
<h3 id="Event:_‘message’-1">Event: ‘message’</h3><ul>
<li><code>message</code> {Object} a parsed JSON object or primitive value</li>
<li><code>sendHandle</code> {Handle object} a Socket or Server object</li>
</ul>
<p>Messages send by <code>.send(message, [sendHandle])</code> are obtained using the<br><code>message</code> event.</p>
<h3 id="child-stdin">child.stdin</h3><ul>
<li>{Stream object}</li>
</ul>
<p>A <code>Writable Stream</code> that represents the child process’s <code>stdin</code>.<br>If the child is waiting to read all its input, it will not continue until this<br>stream has been closed via <code>end()</code>.</p>
<p>If the child was not spawned with <code>stdio[0]</code> set to <code>&#39;pipe&#39;</code>, then this will<br>not be set.</p>
<p><code>child.stdin</code> is shorthand for <code>child.stdio[0]</code>. Both properties will refer<br>to the same object, or null.</p>
<h3 id="child-stdout">child.stdout</h3><ul>
<li>{Stream object}</li>
</ul>
<p>A <code>Readable Stream</code> that represents the child process’s <code>stdout</code>.</p>
<p>If the child was not spawned with <code>stdio[1]</code> set to <code>&#39;pipe&#39;</code>, then this will<br>not be set.</p>
<p><code>child.stdout</code> is shorthand for <code>child.stdio[1]</code>. Both properties will refer<br>to the same object, or null.</p>
<h3 id="child-stderr">child.stderr</h3><ul>
<li>{Stream object}</li>
</ul>
<p>A <code>Readable Stream</code> that represents the child process’s <code>stderr</code>.</p>
<p>If the child was not spawned with <code>stdio[2]</code> set to <code>&#39;pipe&#39;</code>, then this will<br>not be set.</p>
<p><code>child.stderr</code> is shorthand for <code>child.stdio[2]</code>. Both properties will refer<br>to the same object, or null.</p>
<h3 id="child-stdio">child.stdio</h3><ul>
<li>{Array}</li>
</ul>
<p>A sparse array of pipes to the child process, corresponding with positions in<br>the <a href="#child_process_options_stdio">stdio</a> option to<br><a href="#child_process_child_process_spawn_command_args_options">spawn</a> that have been<br>set to <code>&#39;pipe&#39;</code>.<br>Note that streams 0-2 are also available as ChildProcess.stdin,<br>ChildProcess.stdout, and ChildProcess.stderr, respectively.</p>
<p>In the following example, only the child’s fd <code>1</code> is setup as a pipe, so only<br>the parent’s <code>child.stdio[1]</code> is a stream, all other values in the array are<br><code>null</code>.</p>
<pre><code>child = child_process.spawn(<span class="string">"ls"</span>, {
    stdio: [
      <span class="number">0</span>, <span class="comment">// use parents stdin for child</span>
      'pipe', <span class="comment">// pipe child's stdout to parent</span>
      fs.openSync(<span class="string">"err.out"</span>, <span class="string">"w"</span>) <span class="comment">// direct child's stderr to a file</span>
    ]
});

<span class="built_in">assert</span>.<span class="built_in">equal</span>(child.stdio[<span class="number">0</span>], null);
<span class="built_in">assert</span>.<span class="built_in">equal</span>(child.stdio[<span class="number">0</span>], child.stdin);

<span class="built_in">assert</span>(child.stdout);
<span class="built_in">assert</span>.<span class="built_in">equal</span>(child.stdio[<span class="number">1</span>], child.stdout);

<span class="built_in">assert</span>.<span class="built_in">equal</span>(child.stdio[<span class="number">2</span>], null);
<span class="built_in">assert</span>.<span class="built_in">equal</span>(child.stdio[<span class="number">2</span>], child.stderr);
</code></pre><h3 id="child-pid">child.pid</h3><ul>
<li>{Integer}</li>
</ul>
<p>The PID of the child process.</p>
<p>Example:</p>
<pre><code>var spawn = <span class="keyword">require</span>(<span class="string">'child_process'</span>).spawn,
    <span class="keyword">grep</span>  = spawn(<span class="string">'grep'</span>, [<span class="string">'ssh'</span>]);

console.<span class="keyword">log</span>(<span class="string">'Spawned child pid: '</span> + <span class="keyword">grep</span>.pid);
<span class="keyword">grep</span>.stdin.end();
</code></pre><h3 id="child-connected">child.connected</h3><ul>
<li>{Boolean} Set to false after `.disconnect’ is called</li>
</ul>
<p>If <code>.connected</code> is false, it is no longer possible to send messages.</p>
<h3 id="child-kill([signal])">child.kill([signal])</h3><ul>
<li><code>signal</code> {String}</li>
</ul>
<p>Send a signal to the child process. If no argument is given, the process will<br>be sent <code>&#39;SIGTERM&#39;</code>. See <code>signal(7)</code> for a list of available signals.</p>
<pre><code>var spawn = require(<span class="string">'child_process'</span>).spawn,
    <span class="keyword">grep</span>  = spawn(<span class="string">'grep'</span>, [<span class="string">'ssh'</span>]);

<span class="keyword">grep</span>.<span class="keyword">on</span>(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(code, signal)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">'child process terminated due to receipt of signal '</span>+signal);
});

// send SIGHUP <span class="keyword">to</span> process
<span class="keyword">grep</span>.kill(<span class="string">'SIGHUP'</span>);
</code></pre><p>May emit an <code>&#39;error&#39;</code> event when the signal cannot be delivered. Sending a<br>signal to a child process that has already exited is not an error but may<br>have unforeseen consequences: if the PID (the process ID) has been reassigned<br>to another process, the signal will be delivered to that process instead.<br>What happens next is anyone’s guess.</p>
<p>Note that while the function is called <code>kill</code>, the signal delivered to the<br>child process may not actually kill it.  <code>kill</code> really just sends a signal<br>to a process.</p>
<p>See <code>kill(2)</code></p>
<h3 id="child-send(message[,_sendHandle])">child.send(message[, sendHandle])</h3><ul>
<li><code>message</code> {Object}</li>
<li><code>sendHandle</code> {Handle object}</li>
</ul>
<p>When using <code>child_process.fork()</code> you can write to the child using<br><code>child.send(message, [sendHandle])</code> and messages are received by<br>a <code>&#39;message&#39;</code> event on the child.</p>
<p>For example:</p>
<pre><code><span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">'child_process'</span>);

<span class="keyword">var</span> n = cp.fork(__dirname + <span class="string">'/sub.js'</span>);

n.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'PARENT got message:'</span>, m);
});

n.send({ hello: <span class="string">'world'</span> });
</code></pre><p>And then the child script, <code>&#39;sub.js&#39;</code> might look like this:</p>
<pre><code>process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'CHILD got message:'</span>, m);
});

process.send({ foo: <span class="string">'bar'</span> });
</code></pre><p>In the child the <code>process</code> object will have a <code>send()</code> method, and <code>process</code><br>will emit objects each time it receives a message on its channel.</p>
<p>Please note that the <code>send()</code> method on both the parent and child are<br>synchronous - sending large chunks of data is not advised (pipes can be used<br>instead, see<br><a href="#child_process_child_process_spawn_command_args_options"><code>child_process.spawn</code></a>).</p>
<p>There is a special case when sending a <code>{cmd: &#39;NODE_foo&#39;}</code> message. All messages<br>containing a <code>NODE_</code> prefix in its <code>cmd</code> property will not be emitted in<br>the <code>message</code> event, since they are internal messages used by node core.<br>Messages containing the prefix are emitted in the <code>internalMessage</code> event, you<br>should by all means avoid using this feature, it is subject to change without notice.</p>
<p>The <code>sendHandle</code> option to <code>child.send()</code> is for sending a TCP server or<br>socket object to another process. The child will receive the object as its<br>second argument to the <code>message</code> event.</p>
<p>Emits an <code>&#39;error&#39;</code> event if the message cannot be sent, for example because<br>the child process has already exited.</p>
<h4 id="Example:_sending_server_object">Example: sending server object</h4><p>Here is an example of sending a server:</p>
<pre><code><span class="keyword">var</span> child = <span class="built_in">require</span>(<span class="string">'child_process'</span>).fork(<span class="string">'child.js'</span>);

<span class="comment">// Open up the server object and send the handle.</span>
<span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'net'</span>).createServer();
server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>{
  socket.end(<span class="string">'handled by parent'</span>);
});
server.listen(<span class="number">1337</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
  child.send(<span class="string">'server'</span>, server);
});
</code></pre><p>And the child would the receive the server object as:</p>
<pre><code>process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(m, server)</span></span> {
  <span class="keyword">if</span> (m === <span class="string">'server'</span>) {
    server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(socket)</span></span> {
      socket.<span class="keyword">end</span>(<span class="string">'handled by child'</span>);
    });
  }
});
</code></pre><p>Note that the server is now shared between the parent and child, this means<br>that some connections will be handled by the parent and some by the child.</p>
<p>For <code>dgram</code> servers the workflow is exactly the same.  Here you listen on<br>a <code>message</code> event instead of <code>connection</code> and use <code>server.bind</code> instead of<br><code>server.listen</code>.  (Currently only supported on UNIX platforms.)</p>
<h4 id="Example:_sending_socket_object">Example: sending socket object</h4><p>Here is an example of sending a socket. It will spawn two children and handle<br>connections with the remote address <code>74.125.127.100</code> as VIP by sending the<br>socket to a “special” child process. Other sockets will go to a “normal” process.</p>
<pre><code><span class="keyword">var</span> normal = <span class="built_in">require</span>(<span class="string">'child_process'</span>).fork(<span class="string">'child.js'</span>, [<span class="string">'normal'</span>]);
<span class="keyword">var</span> special = <span class="built_in">require</span>(<span class="string">'child_process'</span>).fork(<span class="string">'child.js'</span>, [<span class="string">'special'</span>]);

<span class="comment">// Open up the server and send sockets to child</span>
<span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'net'</span>).createServer();
server.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">socket</span>) </span>{

  <span class="comment">// if this is a VIP</span>
  <span class="keyword">if</span> (socket.remoteAddress === <span class="string">'74.125.127.100'</span>) {
    special.send(<span class="string">'socket'</span>, socket);
    <span class="keyword">return</span>;
  }
  <span class="comment">// just the usual dudes</span>
  normal.send(<span class="string">'socket'</span>, socket);
});
server.listen(<span class="number">1337</span>);
</code></pre><p>The <code>child.js</code> could look like this:</p>
<pre><code>process.on('message', function(m, socket) {
  if (m === 'socket') {
    socket.end('You were handled as a ' + process.argv<span class="comment">[2]</span> + ' <span class="keyword">person</span>');
  }
});
</code></pre><p>Note that once a single socket has been sent to a child the parent can no<br>longer keep track of when the socket is destroyed. To indicate this condition<br>the <code>.connections</code> property becomes <code>null</code>.<br>It is also recommended not to use <code>.maxConnections</code> in this condition.</p>
<h3 id="child-disconnect()">child.disconnect()</h3><p>Close the IPC channel between parent and child, allowing the child to exit<br>gracefully once there are no other connections keeping it alive. After calling<br>this method the <code>.connected</code> flag will be set to <code>false</code> in both the parent and<br>child, and it is no longer possible to send messages.</p>
<p>The ‘disconnect’ event will be emitted when there are no messages in the process<br>of being received, most likely immediately.</p>
<p>Note that you can also call <code>process.disconnect()</code> in the child process when the<br>child process has any open IPC channels with the parent (i.e <code>fork()</code>).</p>
<h2 id="Asynchronous_Process_Creation">Asynchronous Process Creation</h2><p>These methods follow the common async programming patterns (accepting a<br>callback or returning an EventEmitter).</p>
<h3 id="child_process-spawn(command[,_args][,_options])">child_process.spawn(command[, args][, options])</h3><ul>
<li><code>command</code> {String} The command to run</li>
<li><code>args</code> {Array} List of string arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>stdio</code> {Array|String} Child’s stdio configuration. (See<br><a href="#child_process_options_stdio">below</a>)</li>
<li><code>customFds</code> {Array} <strong>Deprecated</strong> File descriptors for the child to use<br>for stdio.  (See <a href="#child_process_options_customFds">below</a>)</li>
<li><code>detached</code> {Boolean} The child will be a process group leader.  (See<br><a href="#child_process_options_detached">below</a>)</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
</ul>
</li>
<li>return: {ChildProcess object}</li>
</ul>
<p>Launches a new process with the given <code>command</code>, with  command line arguments in <code>args</code>.<br>If omitted, <code>args</code> defaults to an empty Array.</p>
<p>The third argument is used to specify additional options, with these defaults:</p>
<pre><code>{ <span class="attribute">cwd</span>: undefined,
  <span class="attribute">env</span>: process.env
}
</code></pre><p>Use <code>cwd</code> to specify the working directory from which the process is spawned.<br>If not given, the default is to inherit the current working directory.</p>
<p>Use <code>env</code> to specify environment variables that will be visible to the new<br>process, the default is <code>process.env</code>.</p>
<p>Example of running <code>ls -lh /usr</code>, capturing <code>stdout</code>, <code>stderr</code>, and the exit code:</p>
<pre><code>var spawn = require(<span class="string">'child_process'</span>).spawn,
    <span class="keyword">ls</span>    = spawn(<span class="string">'ls'</span>, [<span class="string">'-lh'</span>, <span class="string">'/usr'</span>]);

<span class="keyword">ls</span>.stdout.<span class="keyword">on</span>(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">'stdout: '</span> + data);
});

<span class="keyword">ls</span>.stderr.<span class="keyword">on</span>(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">'stderr: '</span> + data);
});

<span class="keyword">ls</span>.<span class="keyword">on</span>(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(code)</span> {</span>
  console.<span class="built_in">log</span>(<span class="string">'child process exited with code '</span> + code);
});
</code></pre><p>Example: A very elaborate way to run ‘ps ax | grep ssh’</p>
<pre><code><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).spawn,
    ps    = spawn(<span class="string">'ps'</span>, [<span class="string">'ax'</span>]),
    grep  = spawn(<span class="string">'grep'</span>, [<span class="string">'ssh'</span>]);

ps.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
  grep.stdin.write(data);
});

ps.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'ps stderr: '</span> + data);
});

ps.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>{
  <span class="keyword">if</span> (code !== <span class="number">0</span>) {
    <span class="built_in">console</span>.log(<span class="string">'ps process exited with code '</span> + code);
  }
  grep.stdin.end();
});

grep.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">''</span> + data);
});

grep.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'grep stderr: '</span> + data);
});

grep.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>{
  <span class="keyword">if</span> (code !== <span class="number">0</span>) {
    <span class="built_in">console</span>.log(<span class="string">'grep process exited with code '</span> + code);
  }
});
</code></pre><h3 id="options-stdio">options.stdio</h3><p>As a shorthand, the <code>stdio</code> argument may also be one of the following<br>strings:</p>
<ul>
<li><code>&#39;pipe&#39;</code> - <code>[&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;]</code>, this is the default value</li>
<li><code>&#39;ignore&#39;</code> - <code>[&#39;ignore&#39;, &#39;ignore&#39;, &#39;ignore&#39;]</code></li>
<li><code>&#39;inherit&#39;</code> - <code>[process.stdin, process.stdout, process.stderr]</code> or <code>[0,1,2]</code></li>
</ul>
<p>Otherwise, the ‘stdio’ option to <code>child_process.spawn()</code> is an array where each<br>index corresponds to a fd in the child.  The value is one of the following:</p>
<ol>
<li><code>&#39;pipe&#39;</code> - Create a pipe between the child process and the parent process.<br>The parent end of the pipe is exposed to the parent as a property on the<br><code>child_process</code> object as <code>ChildProcess.stdio[fd]</code>. Pipes created for<br>fds 0 - 2 are also available as ChildProcess.stdin, ChildProcess.stdout<br>and ChildProcess.stderr, respectively.</li>
<li><code>&#39;ipc&#39;</code> - Create an IPC channel for passing messages/file descriptors<br>between parent and child. A ChildProcess may have at most <em>one</em> IPC stdio<br>file descriptor. Setting this option enables the ChildProcess.send() method.<br>If the child writes JSON messages to this file descriptor, then this will<br>trigger ChildProcess.on(‘message’).  If the child is a Node.js program, then<br>the presence of an IPC channel will enable process.send() and<br>process.on(‘message’).</li>
<li><code>&#39;ignore&#39;</code> - Do not set this file descriptor in the child. Note that Node<br>will always open fd 0 - 2 for the processes it spawns. When any of these is<br>ignored node will open <code>/dev/null</code> and attach it to the child’s fd.</li>
<li><code>Stream</code> object - Share a readable or writable stream that refers to a tty,<br>file, socket, or a pipe with the child process. The stream’s underlying<br>file descriptor is duplicated in the child process to the fd that<br>corresponds to the index in the <code>stdio</code> array. Note that the stream must<br>have an underlying descriptor (file streams do not until the <code>&#39;open&#39;</code><br>event has occurred).</li>
<li>Positive integer - The integer value is interpreted as a file descriptor<br>that is is currently open in the parent process. It is shared with the child<br>process, similar to how <code>Stream</code> objects can be shared.</li>
<li><code>null</code>, <code>undefined</code> - Use default value. For stdio fds 0, 1 and 2 (in other<br>words, stdin, stdout, and stderr) a pipe is created. For fd 3 and up, the<br>default is <code>&#39;ignore&#39;</code>.</li>
</ol>
<p>Example:</p>
<pre><code>var spawn = require(<span class="string">'child_process'</span>).spawn;

<span class="comment">// Child will use parent's stdios</span>
spawn(<span class="string">'prg'</span>, [], { <span class="string">stdio:</span> <span class="string">'inherit'</span> });

<span class="comment">// Spawn child sharing only stderr</span>
spawn(<span class="string">'prg'</span>, [], { <span class="string">stdio:</span> [<span class="string">'pipe'</span>, <span class="string">'pipe'</span>, process.stderr] });

<span class="comment">// Open an extra fd=4, to interact with programs present a</span>
<span class="comment">// startd-style interface.</span>
spawn(<span class="string">'prg'</span>, [], { <span class="string">stdio:</span> [<span class="string">'pipe'</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">'pipe'</span>] });
</code></pre><h3 id="options-detached">options.detached</h3><p>If the <code>detached</code> option is set, the child process will be made the leader of a<br>new process group.  This makes it possible for the child to continue running<br>after the parent exits.</p>
<p>By default, the parent will wait for the detached child to exit.  To prevent<br>the parent from waiting for a given <code>child</code>, use the <code>child.unref()</code> method,<br>and the parent’s event loop will not include the child in its reference count.</p>
<p>Example of detaching a long-running process and redirecting its output to a<br>file:</p>
<pre><code><span class="reserved">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),
    spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).spawn,
    out = fs.openSync(<span class="string">'./out.log'</span>, <span class="string">'a'</span>),
    err = fs.openSync(<span class="string">'./out.log'</span>, <span class="string">'a'</span>);

<span class="reserved">var</span> child = spawn(<span class="string">'prg'</span>, [], {
  <span class="attribute">detached</span>: <span class="literal">true</span>,
  <span class="attribute">stdio</span>: [ <span class="string">'ignore'</span>, out, err ]
});

child.unref();
</code></pre><p>When using the <code>detached</code> option to start a long-running process, the process<br>will not stay running in the background unless it is provided with a <code>stdio</code><br>configuration that is not connected to the parent.  If the parent’s <code>stdio</code> is<br>inherited, the child will remain attached to the controlling terminal.</p>
<h3 id="options-customFds">options.customFds</h3><p>There is a deprecated option called <code>customFds</code> which allows one to specify<br>specific file descriptors for the stdio of the child process. This API was<br>not portable to all platforms and therefore removed.<br>With <code>customFds</code> it was possible to hook up the new process’ <code>[stdin, stdout,
stderr]</code> to existing streams; <code>-1</code> meant that a new stream should be created.<br>Use at your own risk.</p>
<p>See also: <code>child_process.exec()</code> and <code>child_process.fork()</code></p>
<h3 id="child_process-exec(command[,_options],_callback)">child_process.exec(command[, options], callback)</h3><ul>
<li><code>command</code> {String} The command to run, with space-separated arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>encoding</code> {String} (Default: ‘utf8’)</li>
<li><code>shell</code> {String} Shell to execute the command with<br>(Default: ‘/bin/sh’ on UNIX, ‘cmd.exe’ on Windows,  The shell should<br> understand the <code>-c</code> switch on UNIX or <code>/s /c</code> on Windows. On Windows,<br> command line parsing should be compatible with <code>cmd.exe</code>.)</li>
<li><code>timeout</code> {Number} (Default: 0)</li>
<li><code>maxBuffer</code> {Number} (Default: <code>200*1024</code>)</li>
<li><code>killSignal</code> {String} (Default: ‘SIGTERM’)</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
</ul>
</li>
<li><code>callback</code> {Function} called with the output when process terminates<ul>
<li><code>error</code> {Error}</li>
<li><code>stdout</code> {Buffer}</li>
<li><code>stderr</code> {Buffer}</li>
</ul>
</li>
<li>Return: ChildProcess object</li>
</ul>
<p>Runs a command in a shell and buffers the output.</p>
<pre><code><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec,
    child;

child = exec(<span class="string">'cat *.js bad_file | wc -l'</span>,
  <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'stdout: '</span> + stdout);
    <span class="built_in">console</span>.log(<span class="string">'stderr: '</span> + stderr);
    <span class="keyword">if</span> (error !== <span class="literal">null</span>) {
      <span class="built_in">console</span>.log(<span class="string">'exec error: '</span> + error);
    }
});
</code></pre><p>The callback gets the arguments <code>(error, stdout, stderr)</code>. On success, <code>error</code><br>will be <code>null</code>.  On error, <code>error</code> will be an instance of <code>Error</code> and <code>error.code</code><br>will be the exit code of the child process, and <code>error.signal</code> will be set to the<br>signal that terminated the process.</p>
<p>There is a second optional argument to specify several options. The<br>default options are</p>
<pre><code>{ <span class="attribute">encoding</span>: <span class="string">'utf8'</span>,
  <span class="attribute">timeout</span>: <span class="number">0</span>,
  <span class="attribute">maxBuffer</span>: <span class="number">200</span>*<span class="number">1024</span>,
  <span class="attribute">killSignal</span>: <span class="string">'SIGTERM'</span>,
  <span class="attribute">cwd</span>: null,
  <span class="attribute">env</span>: null }
</code></pre><p>If <code>timeout</code> is greater than 0, then it will kill the child process<br>if it runs longer than <code>timeout</code> milliseconds. The child process is killed with<br><code>killSignal</code> (default: <code>&#39;SIGTERM&#39;</code>). <code>maxBuffer</code> specifies the largest<br>amount of data allowed on stdout or stderr - if this value is exceeded then<br>the child process is killed.</p>
<h3 id="child_process-execFile(file[,_args][,_options][,_callback])">child_process.execFile(file[, args][, options][, callback])</h3><ul>
<li><code>file</code> {String} The filename of the program to run</li>
<li><code>args</code> {Array} List of string arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>encoding</code> {String} (Default: ‘utf8’)</li>
<li><code>timeout</code> {Number} (Default: 0)</li>
<li><code>maxBuffer</code> {Number} (Default: 200*1024)</li>
<li><code>killSignal</code> {String} (Default: ‘SIGTERM’)</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
</ul>
</li>
<li><code>callback</code> {Function} called with the output when process terminates<ul>
<li><code>error</code> {Error}</li>
<li><code>stdout</code> {Buffer}</li>
<li><code>stderr</code> {Buffer}</li>
</ul>
</li>
<li>Return: ChildProcess object</li>
</ul>
<p>This is similar to <code>child_process.exec()</code> except it does not execute a<br>subshell but rather the specified file directly. This makes it slightly<br>leaner than <code>child_process.exec</code>. It has the same options.</p>
<h3 id="child_process-fork(modulePath[,_args][,_options])">child_process.fork(modulePath[, args][, options])</h3><ul>
<li><code>modulePath</code> {String} The module to run in the child</li>
<li><code>args</code> {Array} List of string arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>execPath</code> {String} Executable used to create the child process</li>
<li><code>execArgv</code> {Array} List of string arguments passed to the executable<br>(Default: <code>process.execArgv</code>)</li>
<li><code>silent</code> {Boolean} If true, stdin, stdout, and stderr of the child will be<br>piped to the parent, otherwise they will be inherited from the parent, see<br>the “pipe” and “inherit” options for <code>spawn()</code>‘s <code>stdio</code> for more details<br>(default is false)</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
</ul>
</li>
<li>Return: ChildProcess object</li>
</ul>
<p>This is a special case of the <code>spawn()</code> functionality for spawning Node<br>processes. In addition to having all the methods in a normal ChildProcess<br>instance, the returned object has a communication channel built-in. See<br><code>child.send(message, [sendHandle])</code> for details.</p>
<p>These child Nodes are still whole new instances of V8. Assume at least 30ms<br>startup and 10mb memory for each new Node. That is, you cannot create many<br>thousands of them.</p>
<p>The <code>execPath</code> property in the <code>options</code> object allows for a process to be<br>created for the child rather than the current <code>node</code> executable. This should be<br>done with care and by default will talk over the fd represented an<br>environmental variable <code>NODE_CHANNEL_FD</code> on the child process. The input and<br>output on this fd is expected to be line delimited JSON objects.</p>
<h2 id="Synchronous_Process_Creation">Synchronous Process Creation</h2><p>These methods are <strong>synchronous</strong>, meaning they <strong>WILL</strong> block the event loop,<br>pausing execution of your code until the spawned process exits.</p>
<p>Blocking calls like these are mostly useful for simplifying general purpose<br>scripting tasks and for simplifying the loading/processing of application<br>configuration at startup.</p>
<h3 id="child_process-spawnSync(command[,_args][,_options])">child_process.spawnSync(command[, args][, options])</h3><ul>
<li><code>command</code> {String} The command to run</li>
<li><code>args</code> {Array} List of string arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>input</code> {String|Buffer} The value which will be passed as stdin to the spawned process<ul>
<li>supplying this value will override <code>stdio[0]</code></li>
</ul>
</li>
<li><code>stdio</code> {Array} Child’s stdio configuration.</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
<li><code>timeout</code> {Number} In milliseconds the maximum amount of time the process is allowed to run. (Default: undefined)</li>
<li><code>killSignal</code> {String} The signal value to be used when the spawned process will be killed. (Default: ‘SIGTERM’)</li>
<li><code>maxBuffer</code> {Number}</li>
<li><code>encoding</code> {String} The encoding used for all stdio inputs and outputs. (Default: ‘buffer’)</li>
</ul>
</li>
<li>return: {Object}<ul>
<li><code>pid</code> {Number} Pid of the child process</li>
<li><code>output</code> {Array} Array of results from stdio output</li>
<li><code>stdout</code> {Buffer|String} The contents of <code>output[1]</code></li>
<li><code>stderr</code> {Buffer|String} The contents of <code>output[2]</code></li>
<li><code>status</code> {Number} The exit code of the child process</li>
<li><code>signal</code> {String} The signal used to kill the child process</li>
<li><code>error</code> {Error} The error object if the child process failed or timed out</li>
</ul>
</li>
</ul>
<p><code>spawnSync</code> will not return until the child process has fully closed. When a<br>timeout has been encountered and <code>killSignal</code> is sent, the method won’t return<br>until the process has completely exited. That is to say, if the process handles<br>the <code>SIGTERM</code> signal and doesn’t exit, your process will wait until the child<br>process has exited.</p>
<h3 id="child_process-execFileSync(command[,_args][,_options])">child_process.execFileSync(command[, args][, options])</h3><ul>
<li><code>command</code> {String} The command to run</li>
<li><code>args</code> {Array} List of string arguments</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>input</code> {String|Buffer} The value which will be passed as stdin to the spawned process<ul>
<li>supplying this value will override <code>stdio[0]</code></li>
</ul>
</li>
<li><code>stdio</code> {Array} Child’s stdio configuration. (Default: ‘pipe’)<ul>
<li><code>stderr</code> by default will be output to the parent process’ stderr unless<br><code>stdio</code> is specified</li>
</ul>
</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
<li><code>timeout</code> {Number} In milliseconds the maximum amount of time the process is allowed to run. (Default: undefined)</li>
<li><code>killSignal</code> {String} The signal value to be used when the spawned process will be killed. (Default: ‘SIGTERM’)</li>
<li><code>maxBuffer</code> {Number}</li>
<li><code>encoding</code> {String} The encoding used for all stdio inputs and outputs. (Default: ‘buffer’)</li>
</ul>
</li>
<li>return: {Buffer|String} The stdout from the command</li>
</ul>
<p><code>execFileSync</code> will not return until the child process has fully closed. When a<br>timeout has been encountered and <code>killSignal</code> is sent, the method won’t return<br>until the process has completely exited. That is to say, if the process handles<br>the <code>SIGTERM</code> signal and doesn’t exit, your process will wait until the child<br>process has exited.</p>
<p>If the process times out, or has a non-zero exit code, this method <strong><em>will</em></strong><br>throw.  The <code>Error</code> object will contain the entire result from<br><a href="#child_process_child_process_spawnsync_command_args_options"><code>child_process.spawnSync</code></a></p>
<h3 id="child_process-execSync(command[,_options])">child_process.execSync(command[, options])</h3><ul>
<li><code>command</code> {String} The command to run</li>
<li><code>options</code> {Object}<ul>
<li><code>cwd</code> {String} Current working directory of the child process</li>
<li><code>input</code> {String|Buffer} The value which will be passed as stdin to the spawned process<ul>
<li>supplying this value will override <code>stdio[0]</code></li>
</ul>
</li>
<li><code>stdio</code> {Array} Child’s stdio configuration. (Default: ‘pipe’)<ul>
<li><code>stderr</code> by default will be output to the parent process’ stderr unless<br><code>stdio</code> is specified</li>
</ul>
</li>
<li><code>env</code> {Object} Environment key-value pairs</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
<li><code>timeout</code> {Number} In milliseconds the maximum amount of time the process is allowed to run. (Default: undefined)</li>
<li><code>killSignal</code> {String} The signal value to be used when the spawned process will be killed. (Default: ‘SIGTERM’)</li>
<li><code>maxBuffer</code> {Number}</li>
<li><code>encoding</code> {String} The encoding used for all stdio inputs and outputs. (Default: ‘buffer’)</li>
</ul>
</li>
<li>return: {Buffer|String} The stdout from the command</li>
</ul>
<p><code>execSync</code> will not return until the child process has fully closed. When a<br>timeout has been encountered and <code>killSignal</code> is sent, the method won’t return<br>until the process has completely exited. That is to say, if the process handles<br>the <code>SIGTERM</code> signal and doesn’t exit, your process will wait until the child<br>process has exited.</p>
<p>If the process times out, or has a non-zero exit code, this method <strong><em>will</em></strong><br>throw.  The <code>Error</code> object will contain the entire result from<br><a href="#child_process_child_process_spawnsync_command_args_options"><code>child_process.spawnSync</code></a></p>
<h1 id="Assert"><a id="assert">Assert</a></h1><pre><code>Stability: 5 - <span class="keyword">Locked</span>
</code></pre><p>This module is used for writing unit tests for your applications, you can<br>access it with <code>require(&#39;assert&#39;)</code>.</p>
<h2 id="assert-fail(actual,_expected,_message,_operator)">assert.fail(actual, expected, message, operator)</h2><p>Throws an exception that displays the values for <code>actual</code> and <code>expected</code> separated by the provided operator.</p>
<h2 id="assert(value[,_message]),_assert-ok(value[,_message])">assert(value[, message]), assert.ok(value[, message])</h2><p>Tests if value is truthy, it is equivalent to <code>assert.equal(true, !!value, message);</code></p>
<h2 id="assert-equal(actual,_expected[,_message])">assert.equal(actual, expected[, message])</h2><p>Tests shallow, coercive equality with the equal comparison operator ( <code>==</code> ).</p>
<h2 id="assert-notEqual(actual,_expected[,_message])">assert.notEqual(actual, expected[, message])</h2><p>Tests shallow, coercive non-equality with the not equal comparison operator ( <code>!=</code> ).</p>
<h2 id="assert-deepEqual(actual,_expected[,_message])">assert.deepEqual(actual, expected[, message])</h2><p>Tests for deep equality.</p>
<h2 id="assert-notDeepEqual(actual,_expected[,_message])">assert.notDeepEqual(actual, expected[, message])</h2><p>Tests for any deep inequality.</p>
<h2 id="assert-strictEqual(actual,_expected[,_message])">assert.strictEqual(actual, expected[, message])</h2><p>Tests strict equality, as determined by the strict equality operator ( <code>===</code> )</p>
<h2 id="assert-notStrictEqual(actual,_expected[,_message])">assert.notStrictEqual(actual, expected[, message])</h2><p>Tests strict non-equality, as determined by the strict not equal operator ( <code>!==</code> )</p>
<h2 id="assert-throws(block[,_error][,_message])">assert.throws(block[, error][, message])</h2><p>Expects <code>block</code> to throw an error. <code>error</code> can be constructor, <code>RegExp</code> or<br>validation function.</p>
<p>Validate instanceof using constructor:</p>
<pre><code>assert.throws(
  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Wrong value"</span>);
  },
  <span class="built_in">Error</span>
);
</code></pre><p>Validate error message using RegExp:</p>
<pre><code>assert.throws(
  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Wrong value"</span>);
  },
  <span class="regexp">/value/</span>
);
</code></pre><p>Custom error validation:</p>
<pre><code>assert.throws(
  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Wrong value"</span>);
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{
    <span class="keyword">if</span> ( (err <span class="keyword">instanceof</span> <span class="built_in">Error</span>) &amp;&amp; <span class="regexp">/value/</span>.test(err) ) {
      <span class="keyword">return</span> <span class="literal">true</span>;
    }
  },
  <span class="string">"unexpected error"</span>
);
</code></pre><h2 id="assert-doesNotThrow(block[,_message])">assert.doesNotThrow(block[, message])</h2><p>Expects <code>block</code> not to throw an error, see <code>assert.throws</code> for details.</p>
<h2 id="assert-ifError(value)">assert.ifError(value)</h2><p>Tests if value is not a false value, throws if it is a true value. Useful when<br>testing the first argument, <code>error</code> in callbacks.</p>
<h1 id="Zlib"><a id="zlib">Zlib</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><p>You can access this module with:</p>
<pre><code><span class="reserved">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>);
</code></pre><p>This provides bindings to Gzip/Gunzip, Deflate/Inflate, and<br>DeflateRaw/InflateRaw classes.  Each class takes the same options, and<br>is a readable/writable Stream.</p>
<h2 id="Examples">Examples</h2><p>Compressing or decompressing a file can be done by piping an<br>fs.ReadStream into a zlib stream, then into an fs.WriteStream.</p>
<pre><code><span class="keyword">var</span> gzip = zlib.createGzip();
<span class="keyword">var</span> fs = <span class="keyword">require</span>(<span class="string">'fs'</span>);
<span class="keyword">var</span> inp = fs.createReadStream(<span class="string">'input.txt'</span>);
<span class="keyword">var</span> <span class="keyword">out</span> = fs.createWriteStream(<span class="string">'input.txt.gz'</span>);

inp.pipe(gzip).pipe(<span class="keyword">out</span>);
</code></pre><p>Compressing or decompressing data in one step can be done by using<br>the convenience methods.</p>
<pre><code><span class="keyword">var</span> input = <span class="string">'.................................'</span>;
zlib.deflate(input, <span class="function"><span class="keyword">function</span>(<span class="params">err, buffer</span>) </span>{
  <span class="keyword">if</span> (!err) {
    <span class="built_in">console</span>.log(buffer.toString(<span class="string">'base64'</span>));
  }
});

<span class="keyword">var</span> buffer = <span class="keyword">new</span> Buffer(<span class="string">'eJzT0yMAAGTvBe8='</span>, <span class="string">'base64'</span>);
zlib.unzip(buffer, <span class="function"><span class="keyword">function</span>(<span class="params">err, buffer</span>) </span>{
  <span class="keyword">if</span> (!err) {
    <span class="built_in">console</span>.log(buffer.toString());
  }
});
</code></pre><p>To use this module in an HTTP client or server, use the<br><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3" target="_blank" rel="external">accept-encoding</a><br>on requests, and the<br><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.11" target="_blank" rel="external">content-encoding</a><br>header on responses.</p>
<p><strong>Note: these examples are drastically simplified to show<br>the basic concept.</strong>  Zlib encoding can be expensive, and the results<br>ought to be cached.  See <a href="#zlib_memory_usage_tuning">Memory Usage Tuning</a><br>below for more information on the speed/memory/compression<br>tradeoffs involved in zlib usage.</p>
<pre><code><span class="comment">// client request example</span>
<span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>);
<span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">var</span> request = http.get({ host: <span class="string">'izs.me'</span>,
                         path: <span class="string">'/'</span>,
                         port: <span class="number">80</span>,
                         headers: { <span class="string">'accept-encoding'</span>: <span class="string">'gzip,deflate'</span> } });
request.on(<span class="string">'response'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>{
  <span class="keyword">var</span> output = fs.createWriteStream(<span class="string">'izs.me_index.html'</span>);

  <span class="keyword">switch</span> (response.headers[<span class="string">'content-encoding'</span>]) {
    <span class="comment">// or, just use zlib.createUnzip() to handle both cases</span>
    <span class="keyword">case</span> <span class="string">'gzip'</span>:
      response.pipe(zlib.createGunzip()).pipe(output);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'deflate'</span>:
      response.pipe(zlib.createInflate()).pipe(output);
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      response.pipe(output);
      <span class="keyword">break</span>;
  }
});

<span class="comment">// server example</span>
<span class="comment">// Running a gzip operation on every request is quite expensive.</span>
<span class="comment">// It would be much more efficient to cache the compressed buffer.</span>
<span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">'zlib'</span>);
<span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>{
  <span class="keyword">var</span> raw = fs.createReadStream(<span class="string">'index.html'</span>);
  <span class="keyword">var</span> acceptEncoding = request.headers[<span class="string">'accept-encoding'</span>];
  <span class="keyword">if</span> (!acceptEncoding) {
    acceptEncoding = <span class="string">''</span>;
  }

  <span class="comment">// <span class="doctag">Note</span>: this is not a conformant accept-encoding parser.</span>
  <span class="comment">// See http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.3</span>
  <span class="keyword">if</span> (acceptEncoding.match(<span class="regexp">/\bdeflate\b/</span>)) {
    response.writeHead(<span class="number">200</span>, { <span class="string">'content-encoding'</span>: <span class="string">'deflate'</span> });
    raw.pipe(zlib.createDeflate()).pipe(response);
  } <span class="keyword">else</span> <span class="keyword">if</span> (acceptEncoding.match(<span class="regexp">/\bgzip\b/</span>)) {
    response.writeHead(<span class="number">200</span>, { <span class="string">'content-encoding'</span>: <span class="string">'gzip'</span> });
    raw.pipe(zlib.createGzip()).pipe(response);
  } <span class="keyword">else</span> {
    response.writeHead(<span class="number">200</span>, {});
    raw.pipe(response);
  }
}).listen(<span class="number">1337</span>);
</code></pre><h2 id="zlib-createGzip([options])">zlib.createGzip([options])</h2><p>Returns a new <a href="#zlib_class_zlib_gzip">Gzip</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createGunzip([options])">zlib.createGunzip([options])</h2><p>Returns a new <a href="#zlib_class_zlib_gunzip">Gunzip</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createDeflate([options])">zlib.createDeflate([options])</h2><p>Returns a new <a href="#zlib_class_zlib_deflate">Deflate</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createInflate([options])">zlib.createInflate([options])</h2><p>Returns a new <a href="#zlib_class_zlib_inflate">Inflate</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createDeflateRaw([options])">zlib.createDeflateRaw([options])</h2><p>Returns a new <a href="#zlib_class_zlib_deflateraw">DeflateRaw</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createInflateRaw([options])">zlib.createInflateRaw([options])</h2><p>Returns a new <a href="#zlib_class_zlib_inflateraw">InflateRaw</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="zlib-createUnzip([options])">zlib.createUnzip([options])</h2><p>Returns a new <a href="#zlib_class_zlib_unzip">Unzip</a> object with an<br><a href="#zlib_options">options</a>.</p>
<h2 id="Class:_zlib-Zlib">Class: zlib.Zlib</h2><p>Not exported by the <code>zlib</code> module. It is documented here because it is the base<br>class of the compressor/decompressor classes.</p>
<h3 id="zlib-flush([kind],_callback)">zlib.flush([kind], callback)</h3><p><code>kind</code> defaults to <code>zlib.Z_FULL_FLUSH</code>.</p>
<p>Flush pending data. Don’t call this frivolously, premature flushes negatively<br>impact the effectiveness of the compression algorithm.</p>
<h3 id="zlib-params(level,_strategy,_callback)">zlib.params(level, strategy, callback)</h3><p>Dynamically update the compression level and compression strategy.<br>Only applicable to deflate algorithm.</p>
<h3 id="zlib-reset()">zlib.reset()</h3><p>Reset the compressor/decompressor to factory defaults. Only applicable to<br>the inflate and deflate algorithms.</p>
<h2 id="Class:_zlib-Gzip">Class: zlib.Gzip</h2><p>Compress data using gzip.</p>
<h2 id="Class:_zlib-Gunzip">Class: zlib.Gunzip</h2><p>Decompress a gzip stream.</p>
<h2 id="Class:_zlib-Deflate">Class: zlib.Deflate</h2><p>Compress data using deflate.</p>
<h2 id="Class:_zlib-Inflate">Class: zlib.Inflate</h2><p>Decompress a deflate stream.</p>
<h2 id="Class:_zlib-DeflateRaw">Class: zlib.DeflateRaw</h2><p>Compress data using deflate, and do not append a zlib header.</p>
<h2 id="Class:_zlib-InflateRaw">Class: zlib.InflateRaw</h2><p>Decompress a raw deflate stream.</p>
<h2 id="Class:_zlib-Unzip">Class: zlib.Unzip</h2><p>Decompress either a Gzip- or Deflate-compressed stream by auto-detecting<br>the header.</p>
<h2 id="Convenience_Methods">Convenience Methods</h2><!--type=misc-->
<p>All of these take a string or buffer as the first argument, an optional second<br>argument to supply options to the zlib classes and will call the supplied<br>callback with <code>callback(error, result)</code>.</p>
<p>Every method has a <code>*Sync</code> counterpart, which accept the same arguments, but<br>without a callback.</p>
<h2 id="zlib-deflate(buf[,_options],_callback)">zlib.deflate(buf[, options], callback)</h2><h2 id="zlib-deflateSync(buf[,_options])">zlib.deflateSync(buf[, options])</h2><p>Compress a string with Deflate.</p>
<h2 id="zlib-deflateRaw(buf[,_options],_callback)">zlib.deflateRaw(buf[, options], callback)</h2><h2 id="zlib-deflateRawSync(buf[,_options])">zlib.deflateRawSync(buf[, options])</h2><p>Compress a string with DeflateRaw.</p>
<h2 id="zlib-gzip(buf[,_options],_callback)">zlib.gzip(buf[, options], callback)</h2><h2 id="zlib-gzipSync(buf[,_options])">zlib.gzipSync(buf[, options])</h2><p>Compress a string with Gzip.</p>
<h2 id="zlib-gunzip(buf[,_options],_callback)">zlib.gunzip(buf[, options], callback)</h2><h2 id="zlib-gunzipSync(buf[,_options])">zlib.gunzipSync(buf[, options])</h2><p>Decompress a raw Buffer with Gunzip.</p>
<h2 id="zlib-inflate(buf[,_options],_callback)">zlib.inflate(buf[, options], callback)</h2><h2 id="zlib-inflateSync(buf[,_options])">zlib.inflateSync(buf[, options])</h2><p>Decompress a raw Buffer with Inflate.</p>
<h2 id="zlib-inflateRaw(buf[,_options],_callback)">zlib.inflateRaw(buf[, options], callback)</h2><h2 id="zlib-inflateRawSync(buf[,_options])">zlib.inflateRawSync(buf[, options])</h2><p>Decompress a raw Buffer with InflateRaw.</p>
<h2 id="zlib-unzip(buf[,_options],_callback)">zlib.unzip(buf[, options], callback)</h2><h2 id="zlib-unzipSync(buf[,_options])">zlib.unzipSync(buf[, options])</h2><p>Decompress a raw Buffer with Unzip.</p>
<h2 id="Options">Options</h2><!--type=misc-->
<p>Each class takes an options object.  All options are optional.</p>
<p>Note that some options are only relevant when compressing, and are<br>ignored by the decompression classes.</p>
<ul>
<li>flush (default: <code>zlib.Z_NO_FLUSH</code>)</li>
<li>chunkSize (default: 16*1024)</li>
<li>windowBits</li>
<li>level (compression only)</li>
<li>memLevel (compression only)</li>
<li>strategy (compression only)</li>
<li>dictionary (deflate/inflate only, empty dictionary by default)</li>
</ul>
<p>See the description of <code>deflateInit2</code> and <code>inflateInit2</code> at<br><a href="http://zlib.net/manual.html#Advanced" target="_blank" rel="external">http://zlib.net/manual.html#Advanced</a> for more information on these.</p>
<h2 id="Memory_Usage_Tuning">Memory Usage Tuning</h2><!--type=misc-->
<p>From <code>zlib/zconf.h</code>, modified to node’s usage:</p>
<p>The memory requirements for deflate are (in bytes):</p>
<pre><code><span class="list">(<span class="number">1</span> &lt;&lt; <span class="list">(<span class="keyword">windowBits+2</span>)</span>)</span> +  <span class="list">(<span class="number">1</span> &lt;&lt; <span class="list">(<span class="keyword">memLevel+9</span>)</span>)</span>
</code></pre><p>that is: 128K for windowBits=15  +  128K for memLevel = 8<br>(default values) plus a few kilobytes for small objects.</p>
<p>For example, if you want to reduce<br>the default memory requirements from 256K to 128K, set the options to:</p>
<pre><code>{ <span class="attribute">windowBits</span>: <span class="number">14</span>, <span class="attribute">memLevel</span>: <span class="number">7</span> }
</code></pre><p>Of course this will generally degrade compression (there’s no free lunch).</p>
<p>The memory requirements for inflate are (in bytes)</p>
<pre><code>1 &lt;&lt; windowBits
</code></pre><p>that is, 32K for windowBits=15 (default value) plus a few kilobytes<br>for small objects.</p>
<p>This is in addition to a single internal output slab buffer of size<br><code>chunkSize</code>, which defaults to 16K.</p>
<p>The speed of zlib compression is affected most dramatically by the<br><code>level</code> setting.  A higher level will result in better compression, but<br>will take longer to complete.  A lower level will result in less<br>compression, but will be much faster.</p>
<p>In general, greater memory usage options will mean that node has to make<br>fewer calls to zlib, since it’ll be able to process more data in a<br>single <code>write</code> operation.  So, this is another factor that affects the<br>speed, at the cost of memory usage.</p>
<h2 id="Constants">Constants</h2><!--type=misc-->
<p>All of the constants defined in zlib.h are also defined on<br><code>require(&#39;zlib&#39;)</code>.<br>In the normal course of operations, you will not need to ever set any of<br>these.  They are documented here so that their presence is not<br>surprising.  This section is taken almost directly from the <a href="http://zlib.net/manual.html#Constants" target="_blank" rel="external">zlib<br>documentation</a>.  See<br><a href="http://zlib.net/manual.html#Constants" target="_blank" rel="external">http://zlib.net/manual.html#Constants</a> for more details.</p>
<p>Allowed flush values.</p>
<ul>
<li><code>zlib.Z_NO_FLUSH</code></li>
<li><code>zlib.Z_PARTIAL_FLUSH</code></li>
<li><code>zlib.Z_SYNC_FLUSH</code></li>
<li><code>zlib.Z_FULL_FLUSH</code></li>
<li><code>zlib.Z_FINISH</code></li>
<li><code>zlib.Z_BLOCK</code></li>
<li><code>zlib.Z_TREES</code></li>
</ul>
<p>Return codes for the compression/decompression functions. Negative<br>values are errors, positive values are used for special but normal<br>events.</p>
<ul>
<li><code>zlib.Z_OK</code></li>
<li><code>zlib.Z_STREAM_END</code></li>
<li><code>zlib.Z_NEED_DICT</code></li>
<li><code>zlib.Z_ERRNO</code></li>
<li><code>zlib.Z_STREAM_ERROR</code></li>
<li><code>zlib.Z_DATA_ERROR</code></li>
<li><code>zlib.Z_MEM_ERROR</code></li>
<li><code>zlib.Z_BUF_ERROR</code></li>
<li><code>zlib.Z_VERSION_ERROR</code></li>
</ul>
<p>Compression levels.</p>
<ul>
<li><code>zlib.Z_NO_COMPRESSION</code></li>
<li><code>zlib.Z_BEST_SPEED</code></li>
<li><code>zlib.Z_BEST_COMPRESSION</code></li>
<li><code>zlib.Z_DEFAULT_COMPRESSION</code></li>
</ul>
<p>Compression strategy.</p>
<ul>
<li><code>zlib.Z_FILTERED</code></li>
<li><code>zlib.Z_HUFFMAN_ONLY</code></li>
<li><code>zlib.Z_RLE</code></li>
<li><code>zlib.Z_FIXED</code></li>
<li><code>zlib.Z_DEFAULT_STRATEGY</code></li>
</ul>
<p>Possible values of the data_type field.</p>
<ul>
<li><code>zlib.Z_BINARY</code></li>
<li><code>zlib.Z_TEXT</code></li>
<li><code>zlib.Z_ASCII</code></li>
<li><code>zlib.Z_UNKNOWN</code></li>
</ul>
<p>The deflate compression method (the only one supported in this version).</p>
<ul>
<li><code>zlib.Z_DEFLATED</code></li>
</ul>
<p>For initializing zalloc, zfree, opaque.</p>
<ul>
<li><code>zlib.Z_NULL</code></li>
</ul>
<h1 id="os"><a id="os">os</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">4 - API Frozen</span>
</code></pre><p>Provides a few basic operating-system related utility functions.</p>
<p>Use <code>require(&#39;os&#39;)</code> to access this module.</p>
<h2 id="os-tmpdir()">os.tmpdir()</h2><p>Returns the operating system’s default directory for temp files.</p>
<h2 id="os-endianness()">os.endianness()</h2><p>Returns the endianness of the CPU. Possible values are <code>&quot;BE&quot;</code> or <code>&quot;LE&quot;</code>.</p>
<h2 id="os-hostname()">os.hostname()</h2><p>Returns the hostname of the operating system.</p>
<h2 id="os-type()">os.type()</h2><p>Returns the operating system name.</p>
<h2 id="os-platform()">os.platform()</h2><p>Returns the operating system platform.</p>
<h2 id="os-arch()">os.arch()</h2><p>Returns the operating system CPU architecture. Possible values are <code>&quot;x64&quot;</code>,<br><code>&quot;arm&quot;</code> and <code>&quot;ia32&quot;</code>.</p>
<h2 id="os-release()">os.release()</h2><p>Returns the operating system release.</p>
<h2 id="os-uptime()">os.uptime()</h2><p>Returns the system uptime in seconds.</p>
<h2 id="os-loadavg()">os.loadavg()</h2><p>Returns an array containing the 1, 5, and 15 minute load averages.</p>
<p>The load average is a measure of system activity, calculated by the operating<br>system and expressed as a fractional number.  As a rule of thumb, the load<br>average should ideally be less than the number of logical CPUs in the system.</p>
<p>The load average is a very UNIX-y concept; there is no real equivalent on<br>Windows platforms.  That is why this function always returns <code>[0, 0, 0]</code> on<br>Windows.</p>
<h2 id="os-totalmem()">os.totalmem()</h2><p>Returns the total amount of system memory in bytes.</p>
<h2 id="os-freemem()">os.freemem()</h2><p>Returns the amount of free system memory in bytes.</p>
<h2 id="os-cpus()">os.cpus()</h2><p>Returns an array of objects containing information about each CPU/core<br>installed: model, speed (in MHz), and times (an object containing the number of<br>milliseconds the CPU/core spent in: user, nice, sys, idle, and irq).</p>
<p>Example inspection of os.cpus:</p>
<pre><code><span class="collection">[ <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">252020</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">30340</span>,
       idle: <span class="number">1070356870</span>,
       irq: <span class="number">0</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">306960</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">26980</span>,
       idle: <span class="number">1071569080</span>,
       irq: <span class="number">0</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">248450</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">21750</span>,
       idle: <span class="number">1070919370</span>,
       irq: <span class="number">0</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">256880</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">19430</span>,
       idle: <span class="number">1070905480</span>,
       irq: <span class="number">20</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">511580</span>,
       nice: <span class="number">20</span>,
       sys: <span class="number">40900</span>,
       idle: <span class="number">1070842510</span>,
       irq: <span class="number">0</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">291660</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">34360</span>,
       idle: <span class="number">1070888000</span>,
       irq: <span class="number">10</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">308260</span>,
       nice: <span class="number">0</span>,
       sys: <span class="number">55410</span>,
       idle: <span class="number">1071129970</span>,
       irq: <span class="number">880</span> }</span> }</span>,
  <span class="collection">{ model: 'Intel<span class="list">(<span class="keyword">R</span>)</span> Core<span class="list">(<span class="keyword">TM</span>)</span> i7 CPU         <span class="number">860</span>  @ <span class="number">2.80</span>GHz',
    speed: <span class="number">2926</span>,
    times:
     <span class="collection">{ user: <span class="number">266450</span>,
       nice: <span class="number">1480</span>,
       sys: <span class="number">34920</span>,
       idle: <span class="number">1072572010</span>,
       irq: <span class="number">30</span> }</span> }</span> ]</span>
</code></pre><h2 id="os-networkInterfaces()">os.networkInterfaces()</h2><p>Get a list of network interfaces:</p>
<pre><code>{ <span class="string">lo:</span>
   [ { <span class="string">address:</span> <span class="string">'127.0.0.1'</span>,
<span class="label">       netmask:</span> <span class="string">'255.0.0.0'</span>,
<span class="label">       family:</span> <span class="string">'IPv4'</span>,
<span class="label">       mac:</span> <span class="string">'00:00:00:00:00:00'</span>,
<span class="label">       internal:</span> <span class="literal">true</span> },
     { <span class="string">address:</span> <span class="string">'::1'</span>,
<span class="label">       netmask:</span> <span class="string">'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff'</span>,
<span class="label">       family:</span> <span class="string">'IPv6'</span>,
<span class="label">       mac:</span> <span class="string">'00:00:00:00:00:00'</span>,
<span class="label">       internal:</span> <span class="literal">true</span> } ],
<span class="label">  eth0:</span>
   [ { <span class="string">address:</span> <span class="string">'192.168.1.108'</span>,
<span class="label">       netmask:</span> <span class="string">'255.255.255.0'</span>,
<span class="label">       family:</span> <span class="string">'IPv4'</span>,
<span class="label">       mac:</span> <span class="string">'01:02:03:0a:0b:0c'</span>,
<span class="label">       internal:</span> <span class="literal">false</span> },
     { <span class="string">address:</span> <span class="string">'fe80::a00:27ff:fe4e:66a1'</span>,
<span class="label">       netmask:</span> <span class="string">'ffff:ffff:ffff:ffff::'</span>,
<span class="label">       family:</span> <span class="string">'IPv6'</span>,
<span class="label">       mac:</span> <span class="string">'01:02:03:0a:0b:0c'</span>,
<span class="label">       internal:</span> <span class="literal">false</span> } ] }
</code></pre><h2 id="os-EOL">os.EOL</h2><p>A constant defining the appropriate End-of-line marker for the operating system.</p>
<h1 id="Debugger"><a id="debugger">Debugger</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">3 - Stable</span>
</code></pre><!-- type=misc -->
<p>V8 comes with an extensive debugger which is accessible out-of-process via a<br>simple <a href="http://code.google.com/p/v8/wiki/DebuggerProtocol" target="_blank" rel="external">TCP protocol</a>.<br>Node has a built-in client for this debugger. To use this, start Node with the<br><code>debug</code> argument; a prompt will appear:</p>
<pre><code>% node debug myscript.js
&lt; <span class="keyword">debugger</span> listening on port <span class="number">5858</span>
connecting... ok
<span class="keyword">break</span> <span class="keyword">in</span> /home/indutny/Code/git/indutny/myscript.js:<span class="number">1</span>
  <span class="number">1</span> x = <span class="number">5</span>;
  <span class="number">2</span> setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
  <span class="number">3</span>   <span class="keyword">debugger</span>;
debug&gt;
</code></pre><p>Node’s debugger client doesn’t support the full range of commands, but<br>simple step and inspection is possible. By putting the statement <code>debugger;</code><br>into the source code of your script, you will enable a breakpoint.</p>
<p>For example, suppose <code>myscript.js</code> looked like this:</p>
<pre><code><span class="comment">// myscript.js</span>
x = <span class="number">5</span>;
setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
  <span class="keyword">debugger</span>;
  <span class="built_in">console</span>.log(<span class="string">"world"</span>);
}, <span class="number">1000</span>);
<span class="built_in">console</span>.log(<span class="string">"hello"</span>);
</code></pre><p>Then once the debugger is run, it will break on line 4.</p>
<pre><code>% node <span class="keyword">debug</span> myscript.js
&lt; debugger listening <span class="keyword">on</span> port <span class="number">5858</span>
connecting... ok
<span class="keyword">break</span> in /home/indutny/Code/git/indutny/myscript.<span class="keyword">j</span><span class="variable">s:1</span>
  <span class="number">1</span> <span class="keyword">x</span> = <span class="number">5</span>;
  <span class="number">2</span> setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="number">3</span>   debugger;
<span class="keyword">debug</span>&gt; cont
&lt; hello
<span class="keyword">break</span> in /home/indutny/Code/git/indutny/myscript.<span class="keyword">j</span><span class="variable">s:3</span>
  <span class="number">1</span> <span class="keyword">x</span> = <span class="number">5</span>;
  <span class="number">2</span> setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="number">3</span>   debugger;
  <span class="number">4</span>   console.<span class="built_in">log</span>(<span class="string">"world"</span>);
  <span class="number">5</span> }, <span class="number">1000</span>);
<span class="keyword">debug</span>&gt; <span class="keyword">next</span>
<span class="keyword">break</span> in /home/indutny/Code/git/indutny/myscript.<span class="keyword">j</span><span class="variable">s:4</span>
  <span class="number">2</span> setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
  <span class="number">3</span>   debugger;
  <span class="number">4</span>   console.<span class="built_in">log</span>(<span class="string">"world"</span>);
  <span class="number">5</span> }, <span class="number">1000</span>);
  <span class="number">6</span> console.<span class="built_in">log</span>(<span class="string">"hello"</span>);
<span class="keyword">debug</span>&gt; repl
Press Ctrl + C <span class="keyword">to</span> leave <span class="keyword">debug</span> repl
&gt; <span class="keyword">x</span>
<span class="number">5</span>
&gt; <span class="number">2</span>+<span class="number">2</span>
<span class="number">4</span>
<span class="keyword">debug</span>&gt; <span class="keyword">next</span>
&lt; world
<span class="keyword">break</span> in /home/indutny/Code/git/indutny/myscript.<span class="keyword">j</span><span class="variable">s:5</span>
  <span class="number">3</span>   debugger;
  <span class="number">4</span>   console.<span class="built_in">log</span>(<span class="string">"world"</span>);
  <span class="number">5</span> }, <span class="number">1000</span>);
  <span class="number">6</span> console.<span class="built_in">log</span>(<span class="string">"hello"</span>);
  <span class="number">7</span>
<span class="keyword">debug</span>&gt; <span class="keyword">quit</span>
%
</code></pre><p>The <code>repl</code> command allows you to evaluate code remotely. The <code>next</code> command<br>steps over to the next line. There are a few other commands available and more<br>to come. Type <code>help</code> to see others.</p>
<h2 id="Watchers">Watchers</h2><p>You can watch expression and variable values while debugging your code.<br>On every breakpoint each expression from the watchers list will be evaluated<br>in the current context and displayed just before the breakpoint’s source code<br>listing.</p>
<p>To start watching an expression, type <code>watch(&quot;my_expression&quot;)</code>. <code>watchers</code><br>prints the active watchers. To remove a watcher, type<br><code>unwatch(&quot;my_expression&quot;)</code>.</p>
<h2 id="Commands_reference">Commands reference</h2><h3 id="Stepping">Stepping</h3><ul>
<li><code>cont</code>, <code>c</code> - Continue execution</li>
<li><code>next</code>, <code>n</code> - Step next</li>
<li><code>step</code>, <code>s</code> - Step in</li>
<li><code>out</code>, <code>o</code> - Step out</li>
<li><code>pause</code> - Pause running code (like pause button in Developer Tools)</li>
</ul>
<h3 id="Breakpoints">Breakpoints</h3><ul>
<li><code>setBreakpoint()</code>, <code>sb()</code> - Set breakpoint on current line</li>
<li><code>setBreakpoint(line)</code>, <code>sb(line)</code> - Set breakpoint on specific line</li>
<li><code>setBreakpoint(&#39;fn()&#39;)</code>, <code>sb(...)</code> - Set breakpoint on a first statement in<br>functions body</li>
<li><code>setBreakpoint(&#39;script.js&#39;, 1)</code>, <code>sb(...)</code> - Set breakpoint on first line of<br>script.js</li>
<li><code>clearBreakpoint</code>, <code>cb(...)</code> - Clear breakpoint</li>
</ul>
<p>It is also possible to set a breakpoint in a file (module) that<br>isn’t loaded yet:</p>
<pre><code>% ./node debug test/fixtures/<span class="keyword">break</span>-<span class="keyword">in</span>-<span class="keyword">module</span>/main.js
&lt; debugger listening <span class="keyword">on</span> port <span class="number">5858</span>
connecting <span class="keyword">to</span> port <span class="number">5858</span>... ok
<span class="keyword">break</span> <span class="keyword">in</span> test/fixtures/<span class="keyword">break</span>-<span class="keyword">in</span>-<span class="keyword">module</span>/main.js:<span class="number">1</span>
  <span class="number">1</span> <span class="keyword">var</span> <span class="keyword">mod</span> = <span class="keyword">require</span>(<span class="string">'./mod.js'</span>);
  <span class="number">2</span> <span class="keyword">mod</span>.hello();
  <span class="number">3</span> <span class="keyword">mod</span>.hello();
debug&gt; setBreakpoint(<span class="string">'mod.js'</span>, <span class="number">23</span>)
Warning: script <span class="string">'mod.js'</span> was <span class="keyword">not</span> loaded yet.
  <span class="number">1</span> <span class="keyword">var</span> <span class="keyword">mod</span> = <span class="keyword">require</span>(<span class="string">'./mod.js'</span>);
  <span class="number">2</span> <span class="keyword">mod</span>.hello();
  <span class="number">3</span> <span class="keyword">mod</span>.hello();
debug&gt; c
<span class="keyword">break</span> <span class="keyword">in</span> test/fixtures/<span class="keyword">break</span>-<span class="keyword">in</span>-<span class="keyword">module</span>/<span class="keyword">mod</span>.js:<span class="number">23</span>
 <span class="number">21</span>
 <span class="number">22</span> exports.hello = <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="comment">{
 23   return 'hello from module';
 24 }</span>;</span>
 <span class="number">25</span>
debug&gt;
</code></pre><h3 id="Info">Info</h3><ul>
<li><code>backtrace</code>, <code>bt</code> - Print backtrace of current execution frame</li>
<li><code>list(5)</code> - List scripts source code with 5 line context (5 lines before and<br>after)</li>
<li><code>watch(expr)</code> - Add expression to watch list</li>
<li><code>unwatch(expr)</code> - Remove expression from watch list</li>
<li><code>watchers</code> - List all watchers and their values (automatically listed on each<br>breakpoint)</li>
<li><code>repl</code> - Open debugger’s repl for evaluation in debugging script’s context</li>
</ul>
<h3 id="Execution_control">Execution control</h3><ul>
<li><code>run</code> - Run script (automatically runs on debugger’s start)</li>
<li><code>restart</code> - Restart script</li>
<li><code>kill</code> - Kill script</li>
</ul>
<h3 id="Various">Various</h3><ul>
<li><code>scripts</code> - List all loaded scripts</li>
<li><code>version</code> - Display v8’s version</li>
</ul>
<h2 id="Advanced_Usage">Advanced Usage</h2><p>The V8 debugger can be enabled and accessed either by starting Node with<br>the <code>--debug</code> command-line flag or by signaling an existing Node process<br>with <code>SIGUSR1</code>.</p>
<p>Once a process has been set in debug mode with this it can be connected to<br>with the node debugger. Either connect to the <code>pid</code> or the URI to the debugger.<br>The syntax is:</p>
<ul>
<li><code>node debug -p &lt;pid&gt;</code> - Connects to the process via the <code>pid</code></li>
<li><code>node debug &lt;URI&gt;</code> - Connects to the process via the URI such as localhost:5858</li>
</ul>
<h1 id="Cluster"><a id="cluster">Cluster</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">2 - Unstable</span>
</code></pre><p>A single instance of Node runs in a single thread. To take advantage of<br>multi-core systems the user will sometimes want to launch a cluster of Node<br>processes to handle the load.</p>
<p>The cluster module allows you to easily create child processes that<br>all share server ports.</p>
<pre><code><span class="keyword">var</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);
<span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">var</span> numCPUs = <span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length;

<span class="keyword">if</span> (cluster.isMaster) {
  <span class="comment">// Fork workers.</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) {
    cluster.fork();
  }

  cluster.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker, code, signal</span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">'worker '</span> + worker.process.pid + <span class="string">' died'</span>);
  });
} <span class="keyword">else</span> {
  <span class="comment">// Workers can share any TCP connection</span>
  <span class="comment">// In this case its a HTTP server</span>
  http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.writeHead(<span class="number">200</span>);
    res.end(<span class="string">"hello world\n"</span>);
  }).listen(<span class="number">8000</span>);
}
</code></pre><p>Running node will now share port 8000 between the workers:</p>
<pre><code>% NODE_DEBUG=cluster node <span class="keyword">server</span>.js
<span class="number">23521</span>,Master Worker <span class="number">23524</span> online
<span class="number">23521</span>,Master Worker <span class="number">23526</span> online
<span class="number">23521</span>,Master Worker <span class="number">23523</span> online
<span class="number">23521</span>,Master Worker <span class="number">23528</span> online
</code></pre><p>This feature was introduced recently, and may change in future versions.<br>Please try it out and provide feedback.</p>
<p>Also note that, on Windows, it is not yet possible to set up a named pipe<br>server in a worker.</p>
<h2 id="How_It_Works">How It Works</h2><!--type=misc-->
<p>The worker processes are spawned using the <code>child_process.fork</code> method,<br>so that they can communicate with the parent via IPC and pass server<br>handles back and forth.</p>
<p>The cluster module supports two methods of distributing incoming<br>connections.</p>
<p>The first one (and the default one on all platforms except Windows),<br>is the round-robin approach, where the master process listens on a<br>port, accepts new connections and distributes them across the workers<br>in a round-robin fashion, with some built-in smarts to avoid<br>overloading a worker process.</p>
<p>The second approach is where the master process creates the listen<br>socket and sends it to interested workers. The workers then accept<br>incoming connections directly.</p>
<p>The second approach should, in theory, give the best performance.<br>In practice however, distribution tends to be very unbalanced due<br>to operating system scheduler vagaries. Loads have been observed<br>where over 70% of all connections ended up in just two processes,<br>out of a total of eight.</p>
<p>Because <code>server.listen()</code> hands off most of the work to the master<br>process, there are three cases where the behavior between a normal<br>node.js process and a cluster worker differs:</p>
<ol>
<li><code>server.listen({fd: 7})</code> Because the message is passed to the master,<br>file descriptor 7 <strong>in the parent</strong> will be listened on, and the<br>handle passed to the worker, rather than listening to the worker’s<br>idea of what the number 7 file descriptor references.</li>
<li><code>server.listen(handle)</code> Listening on handles explicitly will cause<br>the worker to use the supplied handle, rather than talk to the master<br>process.  If the worker already has the handle, then it’s presumed<br>that you know what you are doing.</li>
<li><code>server.listen(0)</code> Normally, this will cause servers to listen on a<br>random port.  However, in a cluster, each worker will receive the<br>same “random” port each time they do <code>listen(0)</code>.  In essence, the<br>port is random the first time, but predictable thereafter.  If you<br>want to listen on a unique port, generate a port number based on the<br>cluster worker ID.</li>
</ol>
<p>There is no routing logic in Node.js, or in your program, and no shared<br>state between the workers.  Therefore, it is important to design your<br>program such that it does not rely too heavily on in-memory data objects<br>for things like sessions and login.</p>
<p>Because workers are all separate processes, they can be killed or<br>re-spawned depending on your program’s needs, without affecting other<br>workers.  As long as there are some workers still alive, the server will<br>continue to accept connections.  Node does not automatically manage the<br>number of workers for you, however.  It is your responsibility to manage<br>the worker pool for your application’s needs.</p>
<h2 id="cluster-schedulingPolicy">cluster.schedulingPolicy</h2><p>The scheduling policy, either <code>cluster.SCHED_RR</code> for round-robin or<br><code>cluster.SCHED_NONE</code> to leave it to the operating system. This is a<br>global setting and effectively frozen once you spawn the first worker<br>or call <code>cluster.setupMaster()</code>, whatever comes first.</p>
<p><code>SCHED_RR</code> is the default on all operating systems except Windows.<br>Windows will change to <code>SCHED_RR</code> once libuv is able to effectively<br>distribute IOCP handles without incurring a large performance hit.</p>
<p><code>cluster.schedulingPolicy</code> can also be set through the<br><code>NODE_CLUSTER_SCHED_POLICY</code> environment variable. Valid<br>values are <code>&quot;rr&quot;</code> and <code>&quot;none&quot;</code>.</p>
<h2 id="cluster-settings">cluster.settings</h2><ul>
<li>{Object}<ul>
<li><code>execArgv</code> {Array} list of string arguments passed to the node executable.<br>(Default=<code>process.execArgv</code>)</li>
<li><code>exec</code> {String} file path to worker file.  (Default=<code>process.argv[1]</code>)</li>
<li><code>args</code> {Array} string arguments passed to worker.<br>(Default=<code>process.argv.slice(2)</code>)</li>
<li><code>silent</code> {Boolean} whether or not to send output to parent’s stdio.<br>(Default=<code>false</code>)</li>
<li><code>uid</code> {Number} Sets the user identity of the process. (See setuid(2).)</li>
<li><code>gid</code> {Number} Sets the group identity of the process. (See setgid(2).)</li>
</ul>
</li>
</ul>
<p>After calling <code>.setupMaster()</code> (or <code>.fork()</code>) this settings object will contain<br>the settings, including the default values.</p>
<p>It is effectively frozen after being set, because <code>.setupMaster()</code> can<br>only be called once.</p>
<p>This object is not supposed to be changed or set manually, by you.</p>
<h2 id="cluster-isMaster">cluster.isMaster</h2><ul>
<li>{Boolean}</li>
</ul>
<p>True if the process is a master. This is determined<br>by the <code>process.env.NODE_UNIQUE_ID</code>. If <code>process.env.NODE_UNIQUE_ID</code> is<br>undefined, then <code>isMaster</code> is <code>true</code>.</p>
<h2 id="cluster-isWorker">cluster.isWorker</h2><ul>
<li>{Boolean}</li>
</ul>
<p>True if the process is not a master (it is the negation of <code>cluster.isMaster</code>).</p>
<h2 id="Event:_‘fork’">Event: ‘fork’</h2><ul>
<li><code>worker</code> {Worker object}</li>
</ul>
<p>When a new worker is forked the cluster module will emit a ‘fork’ event.<br>This can be used to log worker activity, and create your own timeout.</p>
<pre><code><span class="keyword">var</span> timeouts = [];
<span class="function"><span class="keyword">function</span> <span class="title">errorMsg</span><span class="params">()</span> <span class="comment">{
  console.error("Something must be wrong with the connection ...");
}</span>

<span class="title">cluster</span>.<span class="title">on</span><span class="params">(<span class="string">'fork'</span>, <span class="keyword">function</span>(worker)</span> <span class="comment">{
  timeouts[worker.id] = setTimeout(errorMsg, 2000);
}</span>);</span>
cluster.<span class="keyword">on</span>(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span><span class="params">(worker, address)</span> <span class="comment">{
  clearTimeout(timeouts[worker.id]);
}</span>);</span>
cluster.<span class="keyword">on</span>(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span><span class="params">(worker, code, signal)</span> <span class="comment">{
  clearTimeout(timeouts[worker.id]);
  errorMsg();
}</span>);</span>
</code></pre><h2 id="Event:_‘online’">Event: ‘online’</h2><ul>
<li><code>worker</code> {Worker object}</li>
</ul>
<p>After forking a new worker, the worker should respond with an online message.<br>When the master receives an online message it will emit this event.<br>The difference between ‘fork’ and ‘online’ is that fork is emitted when the<br>master forks a worker, and ‘online’ is emitted when the worker is running.</p>
<pre><code>cluster.<span class="keyword">on</span>(<span class="string">'online'</span>, <span class="function"><span class="keyword">function</span><span class="params">(worker)</span> <span class="comment">{
  console.log("Yay, the worker responded after it was forked");
}</span>);</span>
</code></pre><h2 id="Event:_‘listening’-2">Event: ‘listening’</h2><ul>
<li><code>worker</code> {Worker object}</li>
<li><code>address</code> {Object}</li>
</ul>
<p>After calling <code>listen()</code> from a worker, when the ‘listening’ event is emitted on<br>the server, a listening event will also be emitted on <code>cluster</code> in the master.</p>
<p>The event handler is executed with two arguments, the <code>worker</code> contains the worker<br>object and the <code>address</code> object contains the following connection properties:<br><code>address</code>, <code>port</code> and <code>addressType</code>. This is very useful if the worker is listening<br>on more than one address.</p>
<pre><code>cluster.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker, address</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">"A worker is now connected to "</span> + address.address + <span class="string">":"</span> + address.port);
});
</code></pre><p>The <code>addressType</code> is one of:</p>
<ul>
<li><code>4</code> (TCPv4)</li>
<li><code>6</code> (TCPv6)</li>
<li><code>-1</code> (unix domain socket)</li>
<li><code>&quot;udp4&quot;</code> or <code>&quot;udp6&quot;</code> (UDP v4 or v6)</li>
</ul>
<h2 id="Event:_‘disconnect’-1">Event: ‘disconnect’</h2><ul>
<li><code>worker</code> {Worker object}</li>
</ul>
<p>Emitted after the worker IPC channel has disconnected. This can occur when a<br>worker exits gracefully, is killed, or is disconnected manually (such as with<br>worker.disconnect()).</p>
<p>There may be a delay between the <code>disconnect</code> and <code>exit</code> events.  These events<br>can be used to detect if the process is stuck in a cleanup or if there are<br>long-living connections.</p>
<pre><code>cluster.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'The worker #'</span> + worker.id + <span class="string">' has disconnected'</span>);
});
</code></pre><h2 id="Event:_‘exit’-2">Event: ‘exit’</h2><ul>
<li><code>worker</code> {Worker object}</li>
<li><code>code</code> {Number} the exit code, if it exited normally.</li>
<li><code>signal</code> {String} the name of the signal (eg. <code>&#39;SIGHUP&#39;</code>) that caused<br>the process to be killed.</li>
</ul>
<p>When any of the workers die the cluster module will emit the ‘exit’ event.</p>
<p>This can be used to restart the worker by calling <code>.fork()</code> again.</p>
<pre><code>cluster.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker, code, signal</span>) </span>{
  <span class="built_in">console</span>.log(<span class="string">'worker %d died (%s). restarting...'</span>,
    worker.process.pid, signal || code);
  cluster.fork();
});
</code></pre><p>See <a href="child_process.html#child_process_event_exit">child_process event: ‘exit’</a>.</p>
<h2 id="Event:_‘setup’">Event: ‘setup’</h2><ul>
<li><code>settings</code> {Object}</li>
</ul>
<p>Emitted every time <code>.setupMaster()</code> is called.</p>
<p>The <code>settings</code> object is the <code>cluster.settings</code> object at the time<br><code>.setupMaster()</code> was called and is advisory only, since multiple calls to<br><code>.setupMaster()</code> can be made in a single tick.</p>
<p>If accuracy is important, use <code>cluster.settings</code>.</p>
<h2 id="cluster-setupMaster([settings])">cluster.setupMaster([settings])</h2><ul>
<li><code>settings</code> {Object}<ul>
<li><code>exec</code> {String} file path to worker file.  (Default=<code>process.argv[1]</code>)</li>
<li><code>args</code> {Array} string arguments passed to worker.<br>(Default=<code>process.argv.slice(2)</code>)</li>
<li><code>silent</code> {Boolean} whether or not to send output to parent’s stdio.<br>(Default=<code>false</code>)</li>
</ul>
</li>
</ul>
<p><code>setupMaster</code> is used to change the default ‘fork’ behavior. Once called,<br>the settings will be present in <code>cluster.settings</code>.</p>
<p>Note that:</p>
<ul>
<li>any settings changes only affect future calls to <code>.fork()</code> and have no<br>effect on workers that are already running</li>
<li>The <em>only</em> attribute of a worker that cannot be set via <code>.setupMaster()</code> is<br>the <code>env</code> passed to <code>.fork()</code></li>
<li>the defaults above apply to the first call only, the defaults for later<br>calls is the current value at the time of <code>cluster.setupMaster()</code> is called</li>
</ul>
<p>Example:</p>
<pre><code>var <span class="keyword">cluster</span> = require(<span class="string">'cluster'</span>);
<span class="keyword">cluster</span>.setupMaster({
  <span class="keyword">exec</span>: <span class="string">'worker.js'</span>,
  args: [<span class="string">'--use'</span>, <span class="string">'https'</span>],
  silent: true
});
<span class="keyword">cluster</span>.fork(); <span class="comment">// https worker</span>
<span class="keyword">cluster</span>.setupMaster({
  args: [<span class="string">'--use'</span>, <span class="string">'http'</span>]
});
<span class="keyword">cluster</span>.fork(); <span class="comment">// http worker</span>
</code></pre><p>This can only be called from the master process.</p>
<h2 id="cluster-fork([env])">cluster.fork([env])</h2><ul>
<li><code>env</code> {Object} Key/value pairs to add to worker process environment.</li>
<li>return {Worker object}</li>
</ul>
<p>Spawn a new worker process.</p>
<p>This can only be called from the master process.</p>
<h2 id="cluster-disconnect([callback])">cluster.disconnect([callback])</h2><ul>
<li><code>callback</code> {Function} called when all workers are disconnected and handles are<br>closed</li>
</ul>
<p>Calls <code>.disconnect()</code> on each worker in <code>cluster.workers</code>.</p>
<p>When they are disconnected all internal handles will be closed, allowing the<br>master process to die gracefully if no other event is waiting.</p>
<p>The method takes an optional callback argument which will be called when finished.</p>
<p>This can only be called from the master process.</p>
<h2 id="cluster-worker">cluster.worker</h2><ul>
<li>{Object}</li>
</ul>
<p>A reference to the current worker object. Not available in the master process.</p>
<pre><code>var <span class="keyword">cluster</span> = require(<span class="string">'cluster'</span>);

<span class="keyword">if</span> (<span class="keyword">cluster</span>.isMaster) {
  console.<span class="keyword">log</span>(<span class="string">'I am master'</span>);
  <span class="keyword">cluster</span>.fork();
  <span class="keyword">cluster</span>.fork();
} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">cluster</span>.isWorker) {
  console.<span class="keyword">log</span>(<span class="string">'I am worker #'</span> + <span class="keyword">cluster</span>.worker.id);
}
</code></pre><h2 id="cluster-workers">cluster.workers</h2><ul>
<li>{Object}</li>
</ul>
<p>A hash that stores the active worker objects, keyed by <code>id</code> field. Makes it<br>easy to loop through all the workers. It is only available in the master<br>process.</p>
<p>A worker is removed from cluster.workers after the worker has disconnected <em>and</em><br>exited. The order between these two events cannot be determined in advance.<br>However, it is guaranteed that the removal from the cluster.workers list happens<br>before last <code>&#39;disconnect&#39;</code> or <code>&#39;exit&#39;</code> event is emitted.</p>
<pre><code><span class="comment">// Go through all workers</span>
<span class="function"><span class="keyword">function</span> <span class="title">eachWorker</span><span class="params">(callback)</span> </span>{
  <span class="keyword">for</span> (<span class="keyword">var</span> id <span class="keyword">in</span> cluster.workers) {
    <span class="keyword">callback</span>(cluster.workers[id]);
  }
}
eachWorker(<span class="function"><span class="keyword">function</span><span class="params">(worker)</span> </span>{
  worker.send(<span class="string">'big announcement to all workers'</span>);
});
</code></pre><p>Should you wish to reference a worker over a communication channel, using<br>the worker’s unique id is the easiest way to find the worker.</p>
<pre><code>socket.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(id)</span> </span>{
  <span class="keyword">var</span> worker = cluster.workers[id];
});
</code></pre><h2 id="Class:_Worker">Class: Worker</h2><p>A Worker object contains all public information and method about a worker.<br>In the master it can be obtained using <code>cluster.workers</code>. In a worker<br>it can be obtained using <code>cluster.worker</code>.</p>
<h3 id="worker-id">worker.id</h3><ul>
<li>{String}</li>
</ul>
<p>Each new worker is given its own unique id, this id is stored in the<br><code>id</code>.</p>
<p>While a worker is alive, this is the key that indexes it in<br>cluster.workers</p>
<h3 id="worker-process">worker.process</h3><ul>
<li>{ChildProcess object}</li>
</ul>
<p>All workers are created using <code>child_process.fork()</code>, the returned object<br>from this function is stored as <code>.process</code>. In a worker, the global <code>process</code><br>is stored.</p>
<p>See: <a href="child_process.html#child_process_child_process_fork_modulepath_args_options">Child Process module</a></p>
<p>Note that workers will call <code>process.exit(0)</code> if the <code>&#39;disconnect&#39;</code> event occurs<br>on <code>process</code> and <code>.suicide</code> is not <code>true</code>. This protects against accidental<br>disconnection.</p>
<h3 id="worker-suicide">worker.suicide</h3><ul>
<li>{Boolean}</li>
</ul>
<p>Set by calling <code>.kill()</code> or <code>.disconnect()</code>, until then it is <code>undefined</code>.</p>
<p>The boolean <code>worker.suicide</code> lets you distinguish between voluntary and accidental<br>exit, the master may choose not to respawn a worker based on this value.</p>
<pre><code>cluster.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker, code, signal</span>) </span>{
  <span class="keyword">if</span> (worker.suicide === <span class="literal">true</span>) {
    <span class="built_in">console</span>.log(<span class="string">'Oh, it was just suicide\' – no need to worry'</span>).
  }
});

<span class="comment">// kill worker</span>
worker.kill();
</code></pre><h3 id="worker-send(message[,_sendHandle])">worker.send(message[, sendHandle])</h3><ul>
<li><code>message</code> {Object}</li>
<li><code>sendHandle</code> {Handle object}</li>
</ul>
<p>This function is equal to the send methods provided by<br><code>child_process.fork()</code>.  In the master you should use this function to<br>send a message to a specific worker.</p>
<p>In a worker you can also use <code>process.send(message)</code>, it is the same function.</p>
<p>This example will echo back all messages from the master:</p>
<pre><code><span class="keyword">if</span> <span class="params">(cluster.isMaster)</span> {
  var worker = cluster.fork<span class="params">()</span>;
  worker.send<span class="params">('hi there')</span>;

} <span class="keyword">else</span> <span class="keyword">if</span> <span class="params">(cluster.isWorker)</span> {
  process.on<span class="params">('message', function<span class="params">(msg)</span> {
    process.send<span class="params">(msg)</span>;
  })</span>;
}
</code></pre><h3 id="worker-kill([signal=’SIGTERM’])">worker.kill([signal=’SIGTERM’])</h3><ul>
<li><code>signal</code> {String} Name of the kill signal to send to the worker<br>process.</li>
</ul>
<p>This function will kill the worker. In the master, it does this by disconnecting<br>the <code>worker.process</code>, and once disconnected, killing with <code>signal</code>. In the<br>worker, it does it by disconnecting the channel, and then exiting with code <code>0</code>.</p>
<p>Causes <code>.suicide</code> to be set.</p>
<p>This method is aliased as <code>worker.destroy()</code> for backwards compatibility.</p>
<p>Note that in a worker, <code>process.kill()</code> exists, but it is not this function,<br>it is <a href="process.html#process_process_kill_pid_signal">kill</a>.</p>
<h3 id="worker-disconnect()">worker.disconnect()</h3><p>In a worker, this function will close all servers, wait for the ‘close’ event on<br>those servers, and then disconnect the IPC channel.</p>
<p>In the master, an internal message is sent to the worker causing it to call<br><code>.disconnect()</code> on itself.</p>
<p>Causes <code>.suicide</code> to be set.</p>
<p>Note that after a server is closed, it will no longer accept new connections,<br>but connections may be accepted by any other listening worker. Existing<br>connections will be allowed to close as usual. When no more connections exist,<br>see <a href="net.html#net_event_close">server.close()</a>, the IPC channel to the worker<br>will close allowing it to die gracefully.</p>
<p>The above applies <em>only</em> to server connections, client connections are not<br>automatically closed by workers, and disconnect does not wait for them to close<br>before exiting.</p>
<p>Note that in a worker, <code>process.disconnect</code> exists, but it is not this function,<br>it is <a href="child_process.html#child_process_child_disconnect">disconnect</a>.</p>
<p>Because long living server connections may block workers from disconnecting, it<br>may be useful to send a message, so application specific actions may be taken to<br>close them. It also may be useful to implement a timeout, killing a worker if<br>the <code>disconnect</code> event has not been emitted after some time.</p>
<pre><code><span class="keyword">if</span> (cluster.isMaster) {
  <span class="keyword">var</span> worker = cluster.fork();
  <span class="keyword">var</span> timeout;

  worker.on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">address</span>) </span>{
    worker.send(<span class="string">'shutdown'</span>);
    worker.disconnect();
    timeout = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
      worker.kill();
    }, <span class="number">2000</span>);
  });

  worker.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    clearTimeout(timeout);
  });

} <span class="keyword">else</span> <span class="keyword">if</span> (cluster.isWorker) {
  <span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);
  <span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>{
    <span class="comment">// connections never end</span>
  });

  server.listen(<span class="number">8000</span>);

  process.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>{
    <span class="keyword">if</span>(msg === <span class="string">'shutdown'</span>) {
      <span class="comment">// initiate graceful close of any connections to server</span>
    }
  });
}
</code></pre><h3 id="worker-isDead()">worker.isDead()</h3><p>This function returns <code>true</code> if the worker’s process has terminated (either<br>because of exiting or being signaled). Otherwise, it returns <code>false</code>.</p>
<h3 id="worker-isConnected()">worker.isConnected()</h3><p>This function returns <code>true</code> if the worker is connected to its master via its IPC<br>channel, <code>false</code> otherwise. A worker is connected to its master after it’s been<br>created. It is disconnected after the <code>disconnect</code> event is emitted.</p>
<h3 id="Event:_‘message’-2">Event: ‘message’</h3><ul>
<li><code>message</code> {Object}</li>
</ul>
<p>This event is the same as the one provided by <code>child_process.fork()</code>.</p>
<p>In a worker you can also use <code>process.on(&#39;message&#39;)</code>.</p>
<p>As an example, here is a cluster that keeps count of the number of requests<br>in the master process using the message system:</p>
<pre><code><span class="keyword">var</span> cluster = <span class="built_in">require</span>(<span class="string">'cluster'</span>);
<span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">if</span> (cluster.isMaster) {

  <span class="comment">// Keep track of http requests</span>
  <span class="keyword">var</span> numReqs = <span class="number">0</span>;
  setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="built_in">console</span>.log(<span class="string">"numReqs ="</span>, numReqs);
  }, <span class="number">1000</span>);

  <span class="comment">// Count requestes</span>
  <span class="function"><span class="keyword">function</span> <span class="title">messageHandler</span>(<span class="params">msg</span>) </span>{
    <span class="keyword">if</span> (msg.cmd &amp;&amp; msg.cmd == <span class="string">'notifyRequest'</span>) {
      numReqs += <span class="number">1</span>;
    }
  }

  <span class="comment">// Start workers and listen for messages containing notifyRequest</span>
  <span class="keyword">var</span> numCPUs = <span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length;
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) {
    cluster.fork();
  }

  <span class="built_in">Object</span>.keys(cluster.workers).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>{
    cluster.workers[id].on(<span class="string">'message'</span>, messageHandler);
  });

} <span class="keyword">else</span> {

  <span class="comment">// Worker processes have a http server.</span>
  http.Server(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.writeHead(<span class="number">200</span>);
    res.end(<span class="string">"hello world\n"</span>);

    <span class="comment">// notify master about the request</span>
    process.send({ cmd: <span class="string">'notifyRequest'</span> });
  }).listen(<span class="number">8000</span>);
}
</code></pre><h3 id="Event:_‘online’-1">Event: ‘online’</h3><p>Similar to the <code>cluster.on(&#39;online&#39;)</code> event, but specific to this worker.</p>
<pre><code>cluster.fork().on(<span class="string">'online'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="comment">// Worker is online</span>
});
</code></pre><p>It is not emitted in the worker.</p>
<h3 id="Event:_‘listening’-3">Event: ‘listening’</h3><ul>
<li><code>address</code> {Object}</li>
</ul>
<p>Similar to the <code>cluster.on(&#39;listening&#39;)</code> event, but specific to this worker.</p>
<pre><code>cluster.fork().on(<span class="string">'listening'</span>, <span class="function"><span class="keyword">function</span><span class="params">(address)</span> </span>{
  <span class="comment">// Worker is listening</span>
});
</code></pre><p>It is not emitted in the worker.</p>
<h3 id="Event:_‘disconnect’-2">Event: ‘disconnect’</h3><p>Similar to the <code>cluster.on(&#39;disconnect&#39;)</code> event, but specfic to this worker.</p>
<pre><code>cluster.fork().on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
  <span class="comment">// Worker has disconnected</span>
});
</code></pre><h3 id="Event:_‘exit’-3">Event: ‘exit’</h3><ul>
<li><code>code</code> {Number} the exit code, if it exited normally.</li>
<li><code>signal</code> {String} the name of the signal (eg. <code>&#39;SIGHUP&#39;</code>) that caused<br>the process to be killed.</li>
</ul>
<p>Similar to the <code>cluster.on(&#39;exit&#39;)</code> event, but specific to this worker.</p>
<pre><code><span class="keyword">var</span> worker = cluster.fork();
worker.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code, signal</span>) </span>{
  <span class="keyword">if</span>( signal ) {
    <span class="built_in">console</span>.log(<span class="string">"worker was killed by signal: "</span>+signal);
  } <span class="keyword">else</span> <span class="keyword">if</span>( code !== <span class="number">0</span> ) {
    <span class="built_in">console</span>.log(<span class="string">"worker exited with error code: "</span>+code);
  } <span class="keyword">else</span> {
    <span class="built_in">console</span>.log(<span class="string">"worker success!"</span>);
  }
});
</code></pre><h3 id="Event:_‘error’-7">Event: ‘error’</h3><p>This event is the same as the one provided by <code>child_process.fork()</code>.</p>
<p>In a worker you can also use <code>process.on(&#39;error&#39;)</code>.</p>
<h1 id="Smalloc"><a id="smalloc">Smalloc</a></h1><pre><code><span class="attribute">Stability</span>: <span class="string">1 - Experimental</span>
</code></pre><h2 id="Class:_smalloc">Class: smalloc</h2><p>Buffers are backed by a simple allocator that only handles the assignation of<br>external raw memory. Smalloc exposes that functionality.</p>
<h3 id="smalloc-alloc(length[,_receiver][,_type])">smalloc.alloc(length[, receiver][, type])</h3><ul>
<li><code>length</code> {Number} <code>&lt;= smalloc.kMaxLength</code></li>
<li><code>receiver</code> {Object} Default: <code>new Object</code></li>
<li><code>type</code> {Enum} Default: <code>Uint8</code></li>
</ul>
<p>Returns <code>receiver</code> with allocated external array data. If no <code>receiver</code> is<br>passed then a new Object will be created and returned.</p>
<p>This can be used to create your own Buffer-like classes. No other properties are<br>set, so the user will need to keep track of other necessary information (e.g.<br><code>length</code> of the allocation).</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">SimpleData</span><span class="params">(n)</span> </span>{
  <span class="keyword">this</span>.length = n;
  smalloc.alloc(<span class="keyword">this</span>.length, <span class="keyword">this</span>);
}

SimpleData.prototype = { <span class="comment">/* ... */</span> };
</code></pre><p>It only checks if the <code>receiver</code> is an Object, and also not an Array. Because of<br>this it is possible to allocate external array data to more than a plain Object.</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">allocMe</span><span class="params">()</span></span> { }
smalloc.alloc(<span class="number">3</span>, allocMe);

// { [Function allocMe] <span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">0</span>, <span class="string">'2'</span>: <span class="number">0</span> }
</code></pre><p>v8 does not support allocating external array data to an Array, and if passed<br>will throw.</p>
<p>It’s possible to specify the type of external array data you would like. All<br>possible options are listed in <code>smalloc.Types</code>. Example usage:</p>
<pre><code><span class="keyword">var</span> doubleArr = smalloc.alloc(<span class="number">3</span>, smalloc.Types.Double);

<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)
  doubleArr = i / <span class="number">10</span>;

// { <span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">0.1</span>, <span class="string">'2'</span>: <span class="number">0.2</span> }
</code></pre><p>It is not possible to freeze, seal and prevent extensions of objects with<br>external data using <code>Object.freeze</code>, <code>Object.seal</code> and<br><code>Object.preventExtensions</code> respectively.</p>
<h3 id="smalloc-copyOnto(source,_sourceStart,_dest,_destStart,_copyLength);">smalloc.copyOnto(source, sourceStart, dest, destStart, copyLength);</h3><ul>
<li><code>source</code> {Object} with external array allocation</li>
<li><code>sourceStart</code> {Number} Position to begin copying from</li>
<li><code>dest</code> {Object} with external array allocation</li>
<li><code>destStart</code> {Number} Position to begin copying onto</li>
<li><code>copyLength</code> {Number} Length of copy</li>
</ul>
<p>Copy memory from one external array allocation to another. No arguments are<br>optional, and any violation will throw.</p>
<pre><code><span class="keyword">var</span> a = smalloc.alloc(<span class="number">4</span>);
<span class="keyword">var</span> b = smalloc.alloc(<span class="number">4</span>);

<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {
  a[i] = i;
  b[i] = i * <span class="number">2</span>;
}

// { <span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'3'</span>: <span class="number">3</span> }
// { <span class="string">'0'</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">2</span>, <span class="string">'2'</span>: <span class="number">4</span>, <span class="string">'3'</span>: <span class="number">6</span> }

smalloc.copyOnto(b, <span class="number">2</span>, a, <span class="number">0</span>, <span class="number">2</span>);

// { <span class="string">'0'</span>: <span class="number">4</span>, <span class="string">'1'</span>: <span class="number">6</span>, <span class="string">'2'</span>: <span class="number">2</span>, <span class="string">'3'</span>: <span class="number">3</span> }
</code></pre><p><code>copyOnto</code> automatically detects the length of the allocation internally, so no<br>need to set any additional properties for this to work.</p>
<h3 id="smalloc-dispose(obj)">smalloc.dispose(obj)</h3><ul>
<li><code>obj</code> Object</li>
</ul>
<p>Free memory that has been allocated to an object via <code>smalloc.alloc</code>.</p>
<pre><code>var a = {};
smalloc.alloc<span class="comment">(3, a)</span>;

<span class="comment">// { '0': 0, '1': 0, '2': 0 }</span>

smalloc.dispose<span class="comment">(a)</span>;

<span class="comment">// {}</span>
</code></pre><p>This is useful to reduce strain on the garbage collector, but developers must be<br>careful. Cryptic errors may arise in applications that are difficult to trace.</p>
<pre><code><span class="variable"><span class="keyword">var</span> a</span> = smalloc.alloc(<span class="number">4</span>);
<span class="variable"><span class="keyword">var</span> b</span> = smalloc.alloc(<span class="number">4</span>);

<span class="comment">// perform this somewhere along the line</span>
smalloc.dispose(b);

<span class="comment">// now trying to copy some data out</span>
smalloc.copyOnto(b, <span class="number">2</span>, a, <span class="number">0</span>, <span class="number">2</span>);

<span class="comment">// now results in:</span>
<span class="comment">// RangeError: copy_length &gt; source_length</span>
</code></pre><p>After <code>dispose()</code> is called object still behaves as one with external data, for<br>example <code>smalloc.hasExternalData()</code> returns <code>true</code>.<br><code>dispose()</code> does not support Buffers, and will throw if passed.</p>
<h3 id="smalloc-hasExternalData(obj)">smalloc.hasExternalData(obj)</h3><ul>
<li><code>obj</code> {Object}</li>
</ul>
<p>Returns <code>true</code> if the <code>obj</code> has externally allocated memory.</p>
<h3 id="smalloc-kMaxLength">smalloc.kMaxLength</h3><p>Size of maximum allocation. This is also applicable to Buffer creation.</p>
<h3 id="smalloc-Types">smalloc.Types</h3><p>Enum of possible external array types. Contains:</p>
<ul>
<li><code>Int8</code></li>
<li><code>Uint8</code></li>
<li><code>Int16</code></li>
<li><code>Uint16</code></li>
<li><code>Int32</code></li>
<li><code>Uint32</code></li>
<li><code>Float</code></li>
<li><code>Double</code></li>
<li><code>Uint8Clamped</code></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/07/24/2015-07-generic-pool代码分析/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">generic_pool代码分析</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 uxfork
    	</div>
<!--       	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div> -->
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>